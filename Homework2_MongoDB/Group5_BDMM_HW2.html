<!DOCTYPE html>

<html lang="en">
<head><meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Group5_BDMM_HW2</title><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<style type="text/css">
    pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: var(--jp-cell-editor-active-background) }
.highlight { background: var(--jp-cell-editor-background); color: var(--jp-mirror-editor-variable-color) }
.highlight .c { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment */
.highlight .err { color: var(--jp-mirror-editor-error-color) } /* Error */
.highlight .k { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword */
.highlight .o { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator */
.highlight .p { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation */
.highlight .ch { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Multiline */
.highlight .cp { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Preproc */
.highlight .cpf { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Single */
.highlight .cs { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Special */
.highlight .kc { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Type */
.highlight .m { color: var(--jp-mirror-editor-number-color) } /* Literal.Number */
.highlight .s { color: var(--jp-mirror-editor-string-color) } /* Literal.String */
.highlight .ow { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator.Word */
.highlight .pm { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation.Marker */
.highlight .w { color: var(--jp-mirror-editor-variable-color) } /* Text.Whitespace */
.highlight .mb { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Bin */
.highlight .mf { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Float */
.highlight .mh { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Hex */
.highlight .mi { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer */
.highlight .mo { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Oct */
.highlight .sa { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Affix */
.highlight .sb { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Backtick */
.highlight .sc { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Char */
.highlight .dl { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Delimiter */
.highlight .sd { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Doc */
.highlight .s2 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Double */
.highlight .se { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Escape */
.highlight .sh { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Heredoc */
.highlight .si { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Interpol */
.highlight .sx { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Other */
.highlight .sr { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Regex */
.highlight .s1 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Single */
.highlight .ss { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Symbol */
.highlight .il { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer.Long */
  </style>
<style type="text/css">
/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*
 * Mozilla scrollbar styling
 */

/* use standard opaque scrollbars for most nodes */
[data-jp-theme-scrollbars='true'] {
  scrollbar-color: rgb(var(--jp-scrollbar-thumb-color))
    var(--jp-scrollbar-background-color);
}

/* for code nodes, use a transparent style of scrollbar. These selectors
 * will match lower in the tree, and so will override the above */
[data-jp-theme-scrollbars='true'] .CodeMirror-hscrollbar,
[data-jp-theme-scrollbars='true'] .CodeMirror-vscrollbar {
  scrollbar-color: rgba(var(--jp-scrollbar-thumb-color), 0.5) transparent;
}

/* tiny scrollbar */

.jp-scrollbar-tiny {
  scrollbar-color: rgba(var(--jp-scrollbar-thumb-color), 0.5) transparent;
  scrollbar-width: thin;
}

/* tiny scrollbar */

.jp-scrollbar-tiny::-webkit-scrollbar,
.jp-scrollbar-tiny::-webkit-scrollbar-corner {
  background-color: transparent;
  height: 4px;
  width: 4px;
}

.jp-scrollbar-tiny::-webkit-scrollbar-thumb {
  background: rgba(var(--jp-scrollbar-thumb-color), 0.5);
}

.jp-scrollbar-tiny::-webkit-scrollbar-track:horizontal {
  border-left: 0 solid transparent;
  border-right: 0 solid transparent;
}

.jp-scrollbar-tiny::-webkit-scrollbar-track:vertical {
  border-top: 0 solid transparent;
  border-bottom: 0 solid transparent;
}

/*
 * Lumino
 */

.lm-ScrollBar[data-orientation='horizontal'] {
  min-height: 16px;
  max-height: 16px;
  min-width: 45px;
  border-top: 1px solid #a0a0a0;
}

.lm-ScrollBar[data-orientation='vertical'] {
  min-width: 16px;
  max-width: 16px;
  min-height: 45px;
  border-left: 1px solid #a0a0a0;
}

.lm-ScrollBar-button {
  background-color: #f0f0f0;
  background-position: center center;
  min-height: 15px;
  max-height: 15px;
  min-width: 15px;
  max-width: 15px;
}

.lm-ScrollBar-button:hover {
  background-color: #dadada;
}

.lm-ScrollBar-button.lm-mod-active {
  background-color: #cdcdcd;
}

.lm-ScrollBar-track {
  background: #f0f0f0;
}

.lm-ScrollBar-thumb {
  background: #cdcdcd;
}

.lm-ScrollBar-thumb:hover {
  background: #bababa;
}

.lm-ScrollBar-thumb.lm-mod-active {
  background: #a0a0a0;
}

.lm-ScrollBar[data-orientation='horizontal'] .lm-ScrollBar-thumb {
  height: 100%;
  min-width: 15px;
  border-left: 1px solid #a0a0a0;
  border-right: 1px solid #a0a0a0;
}

.lm-ScrollBar[data-orientation='vertical'] .lm-ScrollBar-thumb {
  width: 100%;
  min-height: 15px;
  border-top: 1px solid #a0a0a0;
  border-bottom: 1px solid #a0a0a0;
}

.lm-ScrollBar[data-orientation='horizontal']
  .lm-ScrollBar-button[data-action='decrement'] {
  background-image: var(--jp-icon-caret-left);
  background-size: 17px;
}

.lm-ScrollBar[data-orientation='horizontal']
  .lm-ScrollBar-button[data-action='increment'] {
  background-image: var(--jp-icon-caret-right);
  background-size: 17px;
}

.lm-ScrollBar[data-orientation='vertical']
  .lm-ScrollBar-button[data-action='decrement'] {
  background-image: var(--jp-icon-caret-up);
  background-size: 17px;
}

.lm-ScrollBar[data-orientation='vertical']
  .lm-ScrollBar-button[data-action='increment'] {
  background-image: var(--jp-icon-caret-down);
  background-size: 17px;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-Widget {
  box-sizing: border-box;
  position: relative;
  overflow: hidden;
}

.lm-Widget.lm-mod-hidden {
  display: none !important;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

.lm-AccordionPanel[data-orientation='horizontal'] > .lm-AccordionPanel-title {
  /* Title is rotated for horizontal accordion panel using CSS */
  display: block;
  transform-origin: top left;
  transform: rotate(-90deg) translate(-100%);
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-CommandPalette {
  display: flex;
  flex-direction: column;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.lm-CommandPalette-search {
  flex: 0 0 auto;
}

.lm-CommandPalette-content {
  flex: 1 1 auto;
  margin: 0;
  padding: 0;
  min-height: 0;
  overflow: auto;
  list-style-type: none;
}

.lm-CommandPalette-header {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

.lm-CommandPalette-item {
  display: flex;
  flex-direction: row;
}

.lm-CommandPalette-itemIcon {
  flex: 0 0 auto;
}

.lm-CommandPalette-itemContent {
  flex: 1 1 auto;
  overflow: hidden;
}

.lm-CommandPalette-itemShortcut {
  flex: 0 0 auto;
}

.lm-CommandPalette-itemLabel {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

.lm-close-icon {
  border: 1px solid transparent;
  background-color: transparent;
  position: absolute;
  z-index: 1;
  right: 3%;
  top: 0;
  bottom: 0;
  margin: auto;
  padding: 7px 0;
  display: none;
  vertical-align: middle;
  outline: 0;
  cursor: pointer;
}
.lm-close-icon:after {
  content: 'X';
  display: block;
  width: 15px;
  height: 15px;
  text-align: center;
  color: #000;
  font-weight: normal;
  font-size: 12px;
  cursor: pointer;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-DockPanel {
  z-index: 0;
}

.lm-DockPanel-widget {
  z-index: 0;
}

.lm-DockPanel-tabBar {
  z-index: 1;
}

.lm-DockPanel-handle {
  z-index: 2;
}

.lm-DockPanel-handle.lm-mod-hidden {
  display: none !important;
}

.lm-DockPanel-handle:after {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  content: '';
}

.lm-DockPanel-handle[data-orientation='horizontal'] {
  cursor: ew-resize;
}

.lm-DockPanel-handle[data-orientation='vertical'] {
  cursor: ns-resize;
}

.lm-DockPanel-handle[data-orientation='horizontal']:after {
  left: 50%;
  min-width: 8px;
  transform: translateX(-50%);
}

.lm-DockPanel-handle[data-orientation='vertical']:after {
  top: 50%;
  min-height: 8px;
  transform: translateY(-50%);
}

.lm-DockPanel-overlay {
  z-index: 3;
  box-sizing: border-box;
  pointer-events: none;
}

.lm-DockPanel-overlay.lm-mod-hidden {
  display: none !important;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-Menu {
  z-index: 10000;
  position: absolute;
  white-space: nowrap;
  overflow-x: hidden;
  overflow-y: auto;
  outline: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.lm-Menu-content {
  margin: 0;
  padding: 0;
  display: table;
  list-style-type: none;
}

.lm-Menu-item {
  display: table-row;
}

.lm-Menu-item.lm-mod-hidden,
.lm-Menu-item.lm-mod-collapsed {
  display: none !important;
}

.lm-Menu-itemIcon,
.lm-Menu-itemSubmenuIcon {
  display: table-cell;
  text-align: center;
}

.lm-Menu-itemLabel {
  display: table-cell;
  text-align: left;
}

.lm-Menu-itemShortcut {
  display: table-cell;
  text-align: right;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-MenuBar {
  outline: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.lm-MenuBar-content {
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: row;
  list-style-type: none;
}

.lm-MenuBar-item {
  box-sizing: border-box;
}

.lm-MenuBar-itemIcon,
.lm-MenuBar-itemLabel {
  display: inline-block;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-ScrollBar {
  display: flex;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.lm-ScrollBar[data-orientation='horizontal'] {
  flex-direction: row;
}

.lm-ScrollBar[data-orientation='vertical'] {
  flex-direction: column;
}

.lm-ScrollBar-button {
  box-sizing: border-box;
  flex: 0 0 auto;
}

.lm-ScrollBar-track {
  box-sizing: border-box;
  position: relative;
  overflow: hidden;
  flex: 1 1 auto;
}

.lm-ScrollBar-thumb {
  box-sizing: border-box;
  position: absolute;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-SplitPanel-child {
  z-index: 0;
}

.lm-SplitPanel-handle {
  z-index: 1;
}

.lm-SplitPanel-handle.lm-mod-hidden {
  display: none !important;
}

.lm-SplitPanel-handle:after {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  content: '';
}

.lm-SplitPanel[data-orientation='horizontal'] > .lm-SplitPanel-handle {
  cursor: ew-resize;
}

.lm-SplitPanel[data-orientation='vertical'] > .lm-SplitPanel-handle {
  cursor: ns-resize;
}

.lm-SplitPanel[data-orientation='horizontal'] > .lm-SplitPanel-handle:after {
  left: 50%;
  min-width: 8px;
  transform: translateX(-50%);
}

.lm-SplitPanel[data-orientation='vertical'] > .lm-SplitPanel-handle:after {
  top: 50%;
  min-height: 8px;
  transform: translateY(-50%);
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-TabBar {
  display: flex;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.lm-TabBar[data-orientation='horizontal'] {
  flex-direction: row;
  align-items: flex-end;
}

.lm-TabBar[data-orientation='vertical'] {
  flex-direction: column;
  align-items: flex-end;
}

.lm-TabBar-content {
  margin: 0;
  padding: 0;
  display: flex;
  flex: 1 1 auto;
  list-style-type: none;
}

.lm-TabBar[data-orientation='horizontal'] > .lm-TabBar-content {
  flex-direction: row;
}

.lm-TabBar[data-orientation='vertical'] > .lm-TabBar-content {
  flex-direction: column;
}

.lm-TabBar-tab {
  display: flex;
  flex-direction: row;
  box-sizing: border-box;
  overflow: hidden;
  touch-action: none; /* Disable native Drag/Drop */
}

.lm-TabBar-tabIcon,
.lm-TabBar-tabCloseIcon {
  flex: 0 0 auto;
}

.lm-TabBar-tabLabel {
  flex: 1 1 auto;
  overflow: hidden;
  white-space: nowrap;
}

.lm-TabBar-tabInput {
  user-select: all;
  width: 100%;
  box-sizing: border-box;
}

.lm-TabBar-tab.lm-mod-hidden {
  display: none !important;
}

.lm-TabBar-addButton.lm-mod-hidden {
  display: none !important;
}

.lm-TabBar.lm-mod-dragging .lm-TabBar-tab {
  position: relative;
}

.lm-TabBar.lm-mod-dragging[data-orientation='horizontal'] .lm-TabBar-tab {
  left: 0;
  transition: left 150ms ease;
}

.lm-TabBar.lm-mod-dragging[data-orientation='vertical'] .lm-TabBar-tab {
  top: 0;
  transition: top 150ms ease;
}

.lm-TabBar.lm-mod-dragging .lm-TabBar-tab.lm-mod-dragging {
  transition: none;
}

.lm-TabBar-tabLabel .lm-TabBar-tabInput {
  user-select: all;
  width: 100%;
  box-sizing: border-box;
  background: inherit;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-TabPanel-tabBar {
  z-index: 1;
}

.lm-TabPanel-stackedPanel {
  z-index: 0;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-Collapse {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}

.jp-Collapse-header {
  padding: 1px 12px;
  background-color: var(--jp-layout-color1);
  border-bottom: solid var(--jp-border-width) var(--jp-border-color2);
  color: var(--jp-ui-font-color1);
  cursor: pointer;
  display: flex;
  align-items: center;
  font-size: var(--jp-ui-font-size0);
  font-weight: 600;
  text-transform: uppercase;
  user-select: none;
}

.jp-Collapser-icon {
  height: 16px;
}

.jp-Collapse-header-collapsed .jp-Collapser-icon {
  transform: rotate(-90deg);
  margin: auto 0;
}

.jp-Collapser-title {
  line-height: 25px;
}

.jp-Collapse-contents {
  padding: 0 12px;
  background-color: var(--jp-layout-color1);
  color: var(--jp-ui-font-color1);
  overflow: auto;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/* This file was auto-generated by ensureUiComponents() in @jupyterlab/buildutils */

/**
 * (DEPRECATED) Support for consuming icons as CSS background images
 */

/* Icons urls */

:root {
  --jp-icon-add-above: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzEzN18xOTQ5MikiPgo8cGF0aCBjbGFzcz0ianAtaWNvbjMiIGQ9Ik00Ljc1IDQuOTMwNjZINi42MjVWNi44MDU2NkM2LjYyNSA3LjAxMTkxIDYuNzkzNzUgNy4xODA2NiA3IDcuMTgwNjZDNy4yMDYyNSA3LjE4MDY2IDcuMzc1IDcuMDExOTEgNy4zNzUgNi44MDU2NlY0LjkzMDY2SDkuMjVDOS40NTYyNSA0LjkzMDY2IDkuNjI1IDQuNzYxOTEgOS42MjUgNC41NTU2NkM5LjYyNSA0LjM0OTQxIDkuNDU2MjUgNC4xODA2NiA5LjI1IDQuMTgwNjZINy4zNzVWMi4zMDU2NkM3LjM3NSAyLjA5OTQxIDcuMjA2MjUgMS45MzA2NiA3IDEuOTMwNjZDNi43OTM3NSAxLjkzMDY2IDYuNjI1IDIuMDk5NDEgNi42MjUgMi4zMDU2NlY0LjE4MDY2SDQuNzVDNC41NDM3NSA0LjE4MDY2IDQuMzc1IDQuMzQ5NDEgNC4zNzUgNC41NTU2NkM0LjM3NSA0Ljc2MTkxIDQuNTQzNzUgNC45MzA2NiA0Ljc1IDQuOTMwNjZaIiBmaWxsPSIjNjE2MTYxIiBzdHJva2U9IiM2MTYxNjEiIHN0cm9rZS13aWR0aD0iMC43Ii8+CjwvZz4KPHBhdGggY2xhc3M9ImpwLWljb24zIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTExLjUgOS41VjExLjVMMi41IDExLjVWOS41TDExLjUgOS41Wk0xMiA4QzEyLjU1MjMgOCAxMyA4LjQ0NzcyIDEzIDlWMTJDMTMgMTIuNTUyMyAxMi41NTIzIDEzIDEyIDEzTDIgMTNDMS40NDc3MiAxMyAxIDEyLjU1MjMgMSAxMlY5QzEgOC40NDc3MiAxLjQ0NzcxIDggMiA4TDEyIDhaIiBmaWxsPSIjNjE2MTYxIi8+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzEzN18xOTQ5MiI+CjxyZWN0IGNsYXNzPSJqcC1pY29uMyIgd2lkdGg9IjYiIGhlaWdodD0iNiIgZmlsbD0id2hpdGUiIHRyYW5zZm9ybT0ibWF0cml4KC0xIDAgMCAxIDEwIDEuNTU1NjYpIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==);
  --jp-icon-add-below: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzEzN18xOTQ5OCkiPgo8cGF0aCBjbGFzcz0ianAtaWNvbjMiIGQ9Ik05LjI1IDEwLjA2OTNMNy4zNzUgMTAuMDY5M0w3LjM3NSA4LjE5NDM0QzcuMzc1IDcuOTg4MDkgNy4yMDYyNSA3LjgxOTM0IDcgNy44MTkzNEM2Ljc5Mzc1IDcuODE5MzQgNi42MjUgNy45ODgwOSA2LjYyNSA4LjE5NDM0TDYuNjI1IDEwLjA2OTNMNC43NSAxMC4wNjkzQzQuNTQzNzUgMTAuMDY5MyA0LjM3NSAxMC4yMzgxIDQuMzc1IDEwLjQ0NDNDNC4zNzUgMTAuNjUwNiA0LjU0Mzc1IDEwLjgxOTMgNC43NSAxMC44MTkzTDYuNjI1IDEwLjgxOTNMNi42MjUgMTIuNjk0M0M2LjYyNSAxMi45MDA2IDYuNzkzNzUgMTMuMDY5MyA3IDEzLjA2OTNDNy4yMDYyNSAxMy4wNjkzIDcuMzc1IDEyLjkwMDYgNy4zNzUgMTIuNjk0M0w3LjM3NSAxMC44MTkzTDkuMjUgMTAuODE5M0M5LjQ1NjI1IDEwLjgxOTMgOS42MjUgMTAuNjUwNiA5LjYyNSAxMC40NDQzQzkuNjI1IDEwLjIzODEgOS40NTYyNSAxMC4wNjkzIDkuMjUgMTAuMDY5M1oiIGZpbGw9IiM2MTYxNjEiIHN0cm9rZT0iIzYxNjE2MSIgc3Ryb2tlLXdpZHRoPSIwLjciLz4KPC9nPgo8cGF0aCBjbGFzcz0ianAtaWNvbjMiIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMi41IDUuNUwyLjUgMy41TDExLjUgMy41TDExLjUgNS41TDIuNSA1LjVaTTIgN0MxLjQ0NzcyIDcgMSA2LjU1MjI4IDEgNkwxIDNDMSAyLjQ0NzcyIDEuNDQ3NzIgMiAyIDJMMTIgMkMxMi41NTIzIDIgMTMgMi40NDc3MiAxMyAzTDEzIDZDMTMgNi41NTIyOSAxMi41NTIzIDcgMTIgN0wyIDdaIiBmaWxsPSIjNjE2MTYxIi8+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzEzN18xOTQ5OCI+CjxyZWN0IGNsYXNzPSJqcC1pY29uMyIgd2lkdGg9IjYiIGhlaWdodD0iNiIgZmlsbD0id2hpdGUiIHRyYW5zZm9ybT0ibWF0cml4KDEgMS43NDg0NmUtMDcgMS43NDg0NmUtMDcgLTEgNCAxMy40NDQzKSIvPgo8L2NsaXBQYXRoPgo8L2RlZnM+Cjwvc3ZnPgo=);
  --jp-icon-add: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTE5IDEzaC02djZoLTJ2LTZINXYtMmg2VjVoMnY2aDZ2MnoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-bell: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE2IDE2IiB2ZXJzaW9uPSIxLjEiPgogICA8cGF0aCBjbGFzcz0ianAtaWNvbjIganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjMzMzMzMzIgogICAgICBkPSJtOCAwLjI5Yy0xLjQgMC0yLjcgMC43My0zLjYgMS44LTEuMiAxLjUtMS40IDMuNC0xLjUgNS4yLTAuMTggMi4yLTAuNDQgNC0yLjMgNS4zbDAuMjggMS4zaDVjMC4wMjYgMC42NiAwLjMyIDEuMSAwLjcxIDEuNSAwLjg0IDAuNjEgMiAwLjYxIDIuOCAwIDAuNTItMC40IDAuNi0xIDAuNzEtMS41aDVsMC4yOC0xLjNjLTEuOS0wLjk3LTIuMi0zLjMtMi4zLTUuMy0wLjEzLTEuOC0wLjI2LTMuNy0xLjUtNS4yLTAuODUtMS0yLjItMS44LTMuNi0xLjh6bTAgMS40YzAuODggMCAxLjkgMC41NSAyLjUgMS4zIDAuODggMS4xIDEuMSAyLjcgMS4yIDQuNCAwLjEzIDEuNyAwLjIzIDMuNiAxLjMgNS4yaC0xMGMxLjEtMS42IDEuMi0zLjQgMS4zLTUuMiAwLjEzLTEuNyAwLjMtMy4zIDEuMi00LjQgMC41OS0wLjcyIDEuNi0xLjMgMi41LTEuM3ptLTAuNzQgMTJoMS41Yy0wLjAwMTUgMC4yOCAwLjAxNSAwLjc5LTAuNzQgMC43OS0wLjczIDAuMDAxNi0wLjcyLTAuNTMtMC43NC0wLjc5eiIgLz4KPC9zdmc+Cg==);
  --jp-icon-bug-dot: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiM2MTYxNjEiPgogICAgICAgIDxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTcuMTkgOEgyMFYxMEgxNy45MUMxNy45NiAxMC4zMyAxOCAxMC42NiAxOCAxMVYxMkgyMFYxNEgxOC41SDE4VjE0LjAyNzVDMTUuNzUgMTQuMjc2MiAxNCAxNi4xODM3IDE0IDE4LjVDMTQgMTkuMjA4IDE0LjE2MzUgMTkuODc3OSAxNC40NTQ5IDIwLjQ3MzlDMTMuNzA2MyAyMC44MTE3IDEyLjg3NTcgMjEgMTIgMjFDOS43OCAyMSA3Ljg1IDE5Ljc5IDYuODEgMThINFYxNkg2LjA5QzYuMDQgMTUuNjcgNiAxNS4zNCA2IDE1VjE0SDRWMTJINlYxMUM2IDEwLjY2IDYuMDQgMTAuMzMgNi4wOSAxMEg0VjhINi44MUM3LjI2IDcuMjIgNy44OCA2LjU1IDguNjIgNi4wNEw3IDQuNDFMOC40MSAzTDEwLjU5IDUuMTdDMTEuMDQgNS4wNiAxMS41MSA1IDEyIDVDMTIuNDkgNSAxMi45NiA1LjA2IDEzLjQyIDUuMTdMMTUuNTkgM0wxNyA0LjQxTDE1LjM3IDYuMDRDMTYuMTIgNi41NSAxNi43NCA3LjIyIDE3LjE5IDhaTTEwIDE2SDE0VjE0SDEwVjE2Wk0xMCAxMkgxNFYxMEgxMFYxMloiIGZpbGw9IiM2MTYxNjEiLz4KICAgICAgICA8cGF0aCBkPSJNMjIgMTguNUMyMiAyMC40MzMgMjAuNDMzIDIyIDE4LjUgMjJDMTYuNTY3IDIyIDE1IDIwLjQzMyAxNSAxOC41QzE1IDE2LjU2NyAxNi41NjcgMTUgMTguNSAxNUMyMC40MzMgMTUgMjIgMTYuNTY3IDIyIDE4LjVaIiBmaWxsPSIjNjE2MTYxIi8+CiAgICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-bug: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIj4KICAgIDxwYXRoIGQ9Ik0yMCA4aC0yLjgxYy0uNDUtLjc4LTEuMDctMS40NS0xLjgyLTEuOTZMMTcgNC40MSAxNS41OSAzbC0yLjE3IDIuMTdDMTIuOTYgNS4wNiAxMi40OSA1IDEyIDVjLS40OSAwLS45Ni4wNi0xLjQxLjE3TDguNDEgMyA3IDQuNDFsMS42MiAxLjYzQzcuODggNi41NSA3LjI2IDcuMjIgNi44MSA4SDR2MmgyLjA5Yy0uMDUuMzMtLjA5LjY2LS4wOSAxdjFINHYyaDJ2MWMwIC4zNC4wNC42Ny4wOSAxSDR2MmgyLjgxYzEuMDQgMS43OSAyLjk3IDMgNS4xOSAzczQuMTUtMS4yMSA1LjE5LTNIMjB2LTJoLTIuMDljLjA1LS4zMy4wOS0uNjYuMDktMXYtMWgydi0yaC0ydi0xYzAtLjM0LS4wNC0uNjctLjA5LTFIMjBWOHptLTYgOGgtNHYtMmg0djJ6bTAtNGgtNHYtMmg0djJ6Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-build: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTE0LjkgMTcuNDVDMTYuMjUgMTcuNDUgMTcuMzUgMTYuMzUgMTcuMzUgMTVDMTcuMzUgMTMuNjUgMTYuMjUgMTIuNTUgMTQuOSAxMi41NUMxMy41NCAxMi41NSAxMi40NSAxMy42NSAxMi40NSAxNUMxMi40NSAxNi4zNSAxMy41NCAxNy40NSAxNC45IDE3LjQ1Wk0yMC4xIDE1LjY4TDIxLjU4IDE2Ljg0QzIxLjcxIDE2Ljk1IDIxLjc1IDE3LjEzIDIxLjY2IDE3LjI5TDIwLjI2IDE5LjcxQzIwLjE3IDE5Ljg2IDIwIDE5LjkyIDE5LjgzIDE5Ljg2TDE4LjA5IDE5LjE2QzE3LjczIDE5LjQ0IDE3LjMzIDE5LjY3IDE2LjkxIDE5Ljg1TDE2LjY0IDIxLjdDMTYuNjIgMjEuODcgMTYuNDcgMjIgMTYuMyAyMkgxMy41QzEzLjMyIDIyIDEzLjE4IDIxLjg3IDEzLjE1IDIxLjdMMTIuODkgMTkuODVDMTIuNDYgMTkuNjcgMTIuMDcgMTkuNDQgMTEuNzEgMTkuMTZMOS45NjAwMiAxOS44NkM5LjgxMDAyIDE5LjkyIDkuNjIwMDIgMTkuODYgOS41NDAwMiAxOS43MUw4LjE0MDAyIDE3LjI5QzguMDUwMDIgMTcuMTMgOC4wOTAwMiAxNi45NSA4LjIyMDAyIDE2Ljg0TDkuNzAwMDIgMTUuNjhMOS42NTAwMSAxNUw5LjcwMDAyIDE0LjMxTDguMjIwMDIgMTMuMTZDOC4wOTAwMiAxMy4wNSA4LjA1MDAyIDEyLjg2IDguMTQwMDIgMTIuNzFMOS41NDAwMiAxMC4yOUM5LjYyMDAyIDEwLjEzIDkuODEwMDIgMTAuMDcgOS45NjAwMiAxMC4xM0wxMS43MSAxMC44NEMxMi4wNyAxMC41NiAxMi40NiAxMC4zMiAxMi44OSAxMC4xNUwxMy4xNSA4LjI4OTk4QzEzLjE4IDguMTI5OTggMTMuMzIgNy45OTk5OCAxMy41IDcuOTk5OThIMTYuM0MxNi40NyA3Ljk5OTk4IDE2LjYyIDguMTI5OTggMTYuNjQgOC4yODk5OEwxNi45MSAxMC4xNUMxNy4zMyAxMC4zMiAxNy43MyAxMC41NiAxOC4wOSAxMC44NEwxOS44MyAxMC4xM0MyMCAxMC4wNyAyMC4xNyAxMC4xMyAyMC4yNiAxMC4yOUwyMS42NiAxMi43MUMyMS43NSAxMi44NiAyMS43MSAxMy4wNSAyMS41OCAxMy4xNkwyMC4xIDE0LjMxTDIwLjE1IDE1TDIwLjEgMTUuNjhaIi8+CiAgICA8cGF0aCBkPSJNNy4zMjk2NiA3LjQ0NDU0QzguMDgzMSA3LjAwOTU0IDguMzM5MzIgNi4wNTMzMiA3LjkwNDMyIDUuMjk5ODhDNy40NjkzMiA0LjU0NjQzIDYuNTA4MSA0LjI4MTU2IDUuNzU0NjYgNC43MTY1NkM1LjM5MTc2IDQuOTI2MDggNS4xMjY5NSA1LjI3MTE4IDUuMDE4NDkgNS42NzU5NEM0LjkxMDA0IDYuMDgwNzEgNC45NjY4MiA2LjUxMTk4IDUuMTc2MzQgNi44NzQ4OEM1LjYxMTM0IDcuNjI4MzIgNi41NzYyMiA3Ljg3OTU0IDcuMzI5NjYgNy40NDQ1NFpNOS42NTcxOCA0Ljc5NTkzTDEwLjg2NzIgNC45NTE3OUMxMC45NjI4IDQuOTc3NDEgMTEuMDQwMiA1LjA3MTMzIDExLjAzODIgNS4xODc5M0wxMS4wMzg4IDYuOTg4OTNDMTEuMDQ1NSA3LjEwMDU0IDEwLjk2MTYgNy4xOTUxOCAxMC44NTUgNy4yMTA1NEw5LjY2MDAxIDcuMzgwODNMOS4yMzkxNSA4LjEzMTg4TDkuNjY5NjEgOS4yNTc0NUM5LjcwNzI5IDkuMzYyNzEgOS42NjkzNCA5LjQ3Njk5IDkuNTc0MDggOS41MzE5OUw4LjAxNTIzIDEwLjQzMkM3LjkxMTMxIDEwLjQ5MiA3Ljc5MzM3IDEwLjQ2NzcgNy43MjEwNSAxMC4zODI0TDYuOTg3NDggOS40MzE4OEw2LjEwOTMxIDkuNDMwODNMNS4zNDcwNCAxMC4zOTA1QzUuMjg5MDkgMTAuNDcwMiA1LjE3MzgzIDEwLjQ5MDUgNS4wNzE4NyAxMC40MzM5TDMuNTEyNDUgOS41MzI5M0MzLjQxMDQ5IDkuNDc2MzMgMy4zNzY0NyA5LjM1NzQxIDMuNDEwNzUgOS4yNTY3OUwzLjg2MzQ3IDguMTQwOTNMMy42MTc0OSA3Ljc3NDg4TDMuNDIzNDcgNy4zNzg4M0wyLjIzMDc1IDcuMjEyOTdDMi4xMjY0NyA3LjE5MjM1IDIuMDQwNDkgNy4xMDM0MiAyLjA0MjQ1IDYuOTg2ODJMMi4wNDE4NyA1LjE4NTgyQzIuMDQzODMgNS4wNjkyMiAyLjExOTA5IDQuOTc5NTggMi4yMTcwNCA0Ljk2OTIyTDMuNDIwNjUgNC43OTM5M0wzLjg2NzQ5IDQuMDI3ODhMMy40MTEwNSAyLjkxNzMxQzMuMzczMzcgMi44MTIwNCAzLjQxMTMxIDIuNjk3NzYgMy41MTUyMyAyLjYzNzc2TDUuMDc0MDggMS43Mzc3NkM1LjE2OTM0IDEuNjgyNzYgNS4yODcyOSAxLjcwNzA0IDUuMzU5NjEgMS43OTIzMUw2LjExOTE1IDIuNzI3ODhMNi45ODAwMSAyLjczODkzTDcuNzI0OTYgMS43ODkyMkM3Ljc5MTU2IDEuNzA0NTggNy45MTU0OCAxLjY3OTIyIDguMDA4NzkgMS43NDA4Mkw5LjU2ODIxIDIuNjQxODJDOS42NzAxNyAyLjY5ODQyIDkuNzEyODUgMi44MTIzNCA5LjY4NzIzIDIuOTA3OTdMOS4yMTcxOCA0LjAzMzgzTDkuNDYzMTYgNC4zOTk4OEw5LjY1NzE4IDQuNzk1OTNaIi8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-caret-down-empty-thin: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIwIDIwIj4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iPgoJCTxwb2x5Z29uIGNsYXNzPSJzdDEiIHBvaW50cz0iOS45LDEzLjYgMy42LDcuNCA0LjQsNi42IDkuOSwxMi4yIDE1LjQsNi43IDE2LjEsNy40ICIvPgoJPC9nPgo8L3N2Zz4K);
  --jp-icon-caret-down-empty: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE4IDE4Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIj4KICAgIDxwYXRoIGQ9Ik01LjIsNS45TDksOS43bDMuOC0zLjhsMS4yLDEuMmwtNC45LDVsLTQuOS01TDUuMiw1Ljl6Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-caret-down: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE4IDE4Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIj4KICAgIDxwYXRoIGQ9Ik01LjIsNy41TDksMTEuMmwzLjgtMy44SDUuMnoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-caret-left: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE4IDE4Ij4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iPgoJCTxwYXRoIGQ9Ik0xMC44LDEyLjhMNy4xLDlsMy44LTMuOGwwLDcuNkgxMC44eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-caret-right: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE4IDE4Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIj4KICAgIDxwYXRoIGQ9Ik03LjIsNS4yTDEwLjksOWwtMy44LDMuOFY1LjJINy4yeiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-caret-up-empty-thin: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIwIDIwIj4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iPgoJCTxwb2x5Z29uIGNsYXNzPSJzdDEiIHBvaW50cz0iMTUuNCwxMy4zIDkuOSw3LjcgNC40LDEzLjIgMy42LDEyLjUgOS45LDYuMyAxNi4xLDEyLjYgIi8+Cgk8L2c+Cjwvc3ZnPgo=);
  --jp-icon-caret-up: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE4IDE4Ij4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iPgoJCTxwYXRoIGQ9Ik01LjIsMTAuNUw5LDYuOGwzLjgsMy44SDUuMnoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-case-sensitive: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIwIDIwIj4KICA8ZyBjbGFzcz0ianAtaWNvbjIiIGZpbGw9IiM0MTQxNDEiPgogICAgPHJlY3QgeD0iMiIgeT0iMiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+CiAgPC9nPgogIDxnIGNsYXNzPSJqcC1pY29uLWFjY2VudDIiIGZpbGw9IiNGRkYiPgogICAgPHBhdGggZD0iTTcuNiw4aDAuOWwzLjUsOGgtMS4xTDEwLDE0SDZsLTAuOSwySDRMNy42LDh6IE04LDkuMUw2LjQsMTNoMy4yTDgsOS4xeiIvPgogICAgPHBhdGggZD0iTTE2LjYsOS44Yy0wLjIsMC4xLTAuNCwwLjEtMC43LDAuMWMtMC4yLDAtMC40LTAuMS0wLjYtMC4yYy0wLjEtMC4xLTAuMi0wLjQtMC4yLTAuNyBjLTAuMywwLjMtMC42LDAuNS0wLjksMC43Yy0wLjMsMC4xLTAuNywwLjItMS4xLDAuMmMtMC4zLDAtMC41LDAtMC43LTAuMWMtMC4yLTAuMS0wLjQtMC4yLTAuNi0wLjNjLTAuMi0wLjEtMC4zLTAuMy0wLjQtMC41IGMtMC4xLTAuMi0wLjEtMC40LTAuMS0wLjdjMC0wLjMsMC4xLTAuNiwwLjItMC44YzAuMS0wLjIsMC4zLTAuNCwwLjQtMC41QzEyLDcsMTIuMiw2LjksMTIuNSw2LjhjMC4yLTAuMSwwLjUtMC4xLDAuNy0wLjIgYzAuMy0wLjEsMC41LTAuMSwwLjctMC4xYzAuMiwwLDAuNC0wLjEsMC42LTAuMWMwLjIsMCwwLjMtMC4xLDAuNC0wLjJjMC4xLTAuMSwwLjItMC4yLDAuMi0wLjRjMC0xLTEuMS0xLTEuMy0xIGMtMC40LDAtMS40LDAtMS40LDEuMmgtMC45YzAtMC40LDAuMS0wLjcsMC4yLTFjMC4xLTAuMiwwLjMtMC40LDAuNS0wLjZjMC4yLTAuMiwwLjUtMC4zLDAuOC0wLjNDMTMuMyw0LDEzLjYsNCwxMy45LDQgYzAuMywwLDAuNSwwLDAuOCwwLjFjMC4zLDAsMC41LDAuMSwwLjcsMC4yYzAuMiwwLjEsMC40LDAuMywwLjUsMC41QzE2LDUsMTYsNS4yLDE2LDUuNnYyLjljMCwwLjIsMCwwLjQsMCwwLjUgYzAsMC4xLDAuMSwwLjIsMC4zLDAuMmMwLjEsMCwwLjIsMCwwLjMsMFY5Ljh6IE0xNS4yLDYuOWMtMS4yLDAuNi0zLjEsMC4yLTMuMSwxLjRjMCwxLjQsMy4xLDEsMy4xLTAuNVY2Ljl6Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-check: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIj4KICAgIDxwYXRoIGQ9Ik05IDE2LjE3TDQuODMgMTJsLTEuNDIgMS40MUw5IDE5IDIxIDdsLTEuNDEtMS40MXoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-circle-empty: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTEyIDJDNi40NyAyIDIgNi40NyAyIDEyczQuNDcgMTAgMTAgMTAgMTAtNC40NyAxMC0xMFMxNy41MyAyIDEyIDJ6bTAgMThjLTQuNDEgMC04LTMuNTktOC04czMuNTktOCA4LTggOCAzLjU5IDggOC0zLjU5IDgtOCA4eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-circle: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTggMTgiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjgiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-clear: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8bWFzayBpZD0iZG9udXRIb2xlIj4KICAgIDxyZWN0IHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0id2hpdGUiIC8+CiAgICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI4IiBmaWxsPSJibGFjayIvPgogIDwvbWFzaz4KCiAgPGcgY2xhc3M9ImpwLWljb24zIiBmaWxsPSIjNjE2MTYxIj4KICAgIDxyZWN0IGhlaWdodD0iMTgiIHdpZHRoPSIyIiB4PSIxMSIgeT0iMyIgdHJhbnNmb3JtPSJyb3RhdGUoMzE1LCAxMiwgMTIpIi8+CiAgICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgbWFzaz0idXJsKCNkb251dEhvbGUpIi8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-close: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbi1ub25lIGpwLWljb24tc2VsZWN0YWJsZS1pbnZlcnNlIGpwLWljb24zLWhvdmVyIiBmaWxsPSJub25lIj4KICAgIDxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjExIi8+CiAgPC9nPgoKICA8ZyBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIGpwLWljb24tYWNjZW50Mi1ob3ZlciIgZmlsbD0iIzYxNjE2MSI+CiAgICA8cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPgogIDwvZz4KCiAgPGcgY2xhc3M9ImpwLWljb24tbm9uZSBqcC1pY29uLWJ1c3kiIGZpbGw9Im5vbmUiPgogICAgPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iNyIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-code-check: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiI+CiAgICA8cGF0aCBkPSJNNi41OSwzLjQxTDIsOEw2LjU5LDEyLjZMOCwxMS4xOEw0LjgyLDhMOCw0LjgyTDYuNTksMy40MU0xMi40MSwzLjQxTDExLDQuODJMMTQuMTgsOEwxMSwxMS4xOEwxMi40MSwxMi42TDE3LDhMMTIuNDEsMy40MU0yMS41OSwxMS41OUwxMy41LDE5LjY4TDkuODMsMTZMOC40MiwxNy40MUwxMy41LDIyLjVMMjMsMTNMMjEuNTksMTEuNTlaIiAvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-code: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIiIGhlaWdodD0iMjIiIHZpZXdCb3g9IjAgMCAyOCAyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CgkJPHBhdGggZD0iTTExLjQgMTguNkw2LjggMTRMMTEuNCA5LjRMMTAgOEw0IDE0TDEwIDIwTDExLjQgMTguNlpNMTYuNiAxOC42TDIxLjIgMTRMMTYuNiA5LjRMMTggOEwyNCAxNEwxOCAyMEwxNi42IDE4LjZWMTguNloiLz4KCTwvZz4KPC9zdmc+Cg==);
  --jp-icon-collapse-all: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGgKICAgICAgICAgICAgZD0iTTggMmMxIDAgMTEgMCAxMiAwczIgMSAyIDJjMCAxIDAgMTEgMCAxMnMwIDItMiAyQzIwIDE0IDIwIDQgMjAgNFMxMCA0IDYgNGMwLTIgMS0yIDItMnoiIC8+CiAgICAgICAgPHBhdGgKICAgICAgICAgICAgZD0iTTE4IDhjMC0xLTEtMi0yLTJTNSA2IDQgNnMtMiAxLTIgMmMwIDEgMCAxMSAwIDEyczEgMiAyIDJjMSAwIDExIDAgMTIgMHMyLTEgMi0yYzAtMSAwLTExIDAtMTJ6bS0yIDB2MTJINFY4eiIgLz4KICAgICAgICA8cGF0aCBkPSJNNiAxM3YyaDh2LTJ6IiAvPgogICAgPC9nPgo8L3N2Zz4K);
  --jp-icon-console: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIwMCAyMDAiPgogIDxnIGNsYXNzPSJqcC1jb25zb2xlLWljb24tYmFja2dyb3VuZC1jb2xvciBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiMwMjg4RDEiPgogICAgPHBhdGggZD0iTTIwIDE5LjhoMTYwdjE1OS45SDIweiIvPgogIDwvZz4KICA8ZyBjbGFzcz0ianAtY29uc29sZS1pY29uLWNvbG9yIGpwLWljb24tc2VsZWN0YWJsZS1pbnZlcnNlIiBmaWxsPSIjZmZmIj4KICAgIDxwYXRoIGQ9Ik0xMDUgMTI3LjNoNDB2MTIuOGgtNDB6TTUxLjEgNzdMNzQgOTkuOWwtMjMuMyAyMy4zIDEwLjUgMTAuNSAyMy4zLTIzLjNMOTUgOTkuOSA4NC41IDg5LjQgNjEuNiA2Ni41eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-copy: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTggMTgiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTExLjksMUgzLjJDMi40LDEsMS43LDEuNywxLjcsMi41djEwLjJoMS41VjIuNWg4LjdWMXogTTE0LjEsMy45aC04Yy0wLjgsMC0xLjUsMC43LTEuNSwxLjV2MTAuMmMwLDAuOCwwLjcsMS41LDEuNSwxLjVoOCBjMC44LDAsMS41LTAuNywxLjUtMS41VjUuNEMxNS41LDQuNiwxNC45LDMuOSwxNC4xLDMuOXogTTE0LjEsMTUuNWgtOFY1LjRoOFYxNS41eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-copyright: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCI+CiAgPGcgY2xhc3M9ImpwLWljb24zIiBmaWxsPSIjNjE2MTYxIj4KICAgIDxwYXRoIGQ9Ik0xMS44OCw5LjE0YzEuMjgsMC4wNiwxLjYxLDEuMTUsMS42MywxLjY2aDEuNzljLTAuMDgtMS45OC0xLjQ5LTMuMTktMy40NS0zLjE5QzkuNjQsNy42MSw4LDksOCwxMi4xNCBjMCwxLjk0LDAuOTMsNC4yNCwzLjg0LDQuMjRjMi4yMiwwLDMuNDEtMS42NSwzLjQ0LTIuOTVoLTEuNzljLTAuMDMsMC41OS0wLjQ1LDEuMzgtMS42MywxLjQ0QzEwLjU1LDE0LjgzLDEwLDEzLjgxLDEwLDEyLjE0IEMxMCw5LjI1LDExLjI4LDkuMTYsMTEuODgsOS4xNHogTTEyLDJDNi40OCwyLDIsNi40OCwyLDEyczQuNDgsMTAsMTAsMTBzMTAtNC40OCwxMC0xMFMxNy41MiwyLDEyLDJ6IE0xMiwyMGMtNC40MSwwLTgtMy41OS04LTggczMuNTktOCw4LThzOCwzLjU5LDgsOFMxNi40MSwyMCwxMiwyMHoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-cut: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTkuNjQgNy42NGMuMjMtLjUuMzYtMS4wNS4zNi0xLjY0IDAtMi4yMS0xLjc5LTQtNC00UzIgMy43OSAyIDZzMS43OSA0IDQgNGMuNTkgMCAxLjE0LS4xMyAxLjY0LS4zNkwxMCAxMmwtMi4zNiAyLjM2QzcuMTQgMTQuMTMgNi41OSAxNCA2IDE0Yy0yLjIxIDAtNCAxLjc5LTQgNHMxLjc5IDQgNCA0IDQtMS43OSA0LTRjMC0uNTktLjEzLTEuMTQtLjM2LTEuNjRMMTIgMTRsNyA3aDN2LTFMOS42NCA3LjY0ek02IDhjLTEuMSAwLTItLjg5LTItMnMuOS0yIDItMiAyIC44OSAyIDItLjkgMi0yIDJ6bTAgMTJjLTEuMSAwLTItLjg5LTItMnMuOS0yIDItMiAyIC44OSAyIDItLjkgMi0yIDJ6bTYtNy41Yy0uMjggMC0uNS0uMjItLjUtLjVzLjIyLS41LjUtLjUuNS4yMi41LjUtLjIyLjUtLjUuNXpNMTkgM2wtNiA2IDIgMiA3LTdWM3oiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-delete: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIiAvPgogICAgPHBhdGggY2xhc3M9ImpwLWljb24zIiBmaWxsPSIjNjI2MjYyIiBkPSJNNiAxOWMwIDEuMS45IDIgMiAyaDhjMS4xIDAgMi0uOSAyLTJWN0g2djEyek0xOSA0aC0zLjVsLTEtMWgtNWwtMSAxSDV2MmgxNFY0eiIgLz4KPC9zdmc+Cg==);
  --jp-icon-download: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTE5IDloLTRWM0g5djZINWw3IDcgNy03ek01IDE4djJoMTR2LTJINXoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-duplicate: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggY2xhc3M9ImpwLWljb24zIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTIuNzk5OTggMC44NzVIOC44OTU4MkM5LjIwMDYxIDAuODc1IDkuNDQ5OTggMS4xMzkxNCA5LjQ0OTk4IDEuNDYxOThDOS40NDk5OCAxLjc4NDgyIDkuMjAwNjEgMi4wNDg5NiA4Ljg5NTgyIDIuMDQ4OTZIMy4zNTQxNUMzLjA0OTM2IDIuMDQ4OTYgMi43OTk5OCAyLjMxMzEgMi43OTk5OCAyLjYzNTk0VjkuNjc5NjlDMi43OTk5OCAxMC4wMDI1IDIuNTUwNjEgMTAuMjY2NyAyLjI0NTgyIDEwLjI2NjdDMS45NDEwMyAxMC4yNjY3IDEuNjkxNjUgMTAuMDAyNSAxLjY5MTY1IDkuNjc5NjlWMi4wNDg5NkMxLjY5MTY1IDEuNDAzMjggMi4xOTA0IDAuODc1IDIuNzk5OTggMC44NzVaTTUuMzY2NjUgMTEuOVY0LjU1SDExLjA4MzNWMTEuOUg1LjM2NjY1Wk00LjE0MTY1IDQuMTQxNjdDNC4xNDE2NSAzLjY5MDYzIDQuNTA3MjggMy4zMjUgNC45NTgzMiAzLjMyNUgxMS40OTE3QzExLjk0MjcgMy4zMjUgMTIuMzA4MyAzLjY5MDYzIDEyLjMwODMgNC4xNDE2N1YxMi4zMDgzQzEyLjMwODMgMTIuNzU5NCAxMS45NDI3IDEzLjEyNSAxMS40OTE3IDEzLjEyNUg0Ljk1ODMyQzQuNTA3MjggMTMuMTI1IDQuMTQxNjUgMTIuNzU5NCA0LjE0MTY1IDEyLjMwODNWNC4xNDE2N1oiIGZpbGw9IiM2MTYxNjEiLz4KPHBhdGggY2xhc3M9ImpwLWljb24zIiBkPSJNOS40MzU3NCA4LjI2NTA3SDguMzY0MzFWOS4zMzY1QzguMzY0MzEgOS40NTQzNSA4LjI2Nzg4IDkuNTUwNzggOC4xNTAwMiA5LjU1MDc4QzguMDMyMTcgOS41NTA3OCA3LjkzNTc0IDkuNDU0MzUgNy45MzU3NCA5LjMzNjVWOC4yNjUwN0g2Ljg2NDMxQzYuNzQ2NDUgOC4yNjUwNyA2LjY1MDAyIDguMTY4NjQgNi42NTAwMiA4LjA1MDc4QzYuNjUwMDIgNy45MzI5MiA2Ljc0NjQ1IDcuODM2NSA2Ljg2NDMxIDcuODM2NUg3LjkzNTc0VjYuNzY1MDdDNy45MzU3NCA2LjY0NzIxIDguMDMyMTcgNi41NTA3OCA4LjE1MDAyIDYuNTUwNzhDOC4yNjc4OCA2LjU1MDc4IDguMzY0MzEgNi42NDcyMSA4LjM2NDMxIDYuNzY1MDdWNy44MzY1SDkuNDM1NzRDOS41NTM2IDcuODM2NSA5LjY1MDAyIDcuOTMyOTIgOS42NTAwMiA4LjA1MDc4QzkuNjUwMDIgOC4xNjg2NCA5LjU1MzYgOC4yNjUwNyA5LjQzNTc0IDguMjY1MDdaIiBmaWxsPSIjNjE2MTYxIiBzdHJva2U9IiM2MTYxNjEiIHN0cm9rZS13aWR0aD0iMC41Ii8+Cjwvc3ZnPgo=);
  --jp-icon-edit: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTMgMTcuMjVWMjFoMy43NUwxNy44MSA5Ljk0bC0zLjc1LTMuNzVMMyAxNy4yNXpNMjAuNzEgNy4wNGMuMzktLjM5LjM5LTEuMDIgMC0xLjQxbC0yLjM0LTIuMzRjLS4zOS0uMzktMS4wMi0uMzktMS40MSAwbC0xLjgzIDEuODMgMy43NSAzLjc1IDEuODMtMS44M3oiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-ellipses: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPGNpcmNsZSBjeD0iNSIgY3k9IjEyIiByPSIyIi8+CiAgICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIyIi8+CiAgICA8Y2lyY2xlIGN4PSIxOSIgY3k9IjEyIiByPSIyIi8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-error: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KPGcgY2xhc3M9ImpwLWljb24zIiBmaWxsPSIjNjE2MTYxIj48Y2lyY2xlIGN4PSIxMiIgY3k9IjE5IiByPSIyIi8+PHBhdGggZD0iTTEwIDNoNHYxMmgtNHoiLz48L2c+CjxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0wIDBoMjR2MjRIMHoiLz4KPC9zdmc+Cg==);
  --jp-icon-expand-all: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGgKICAgICAgICAgICAgZD0iTTggMmMxIDAgMTEgMCAxMiAwczIgMSAyIDJjMCAxIDAgMTEgMCAxMnMwIDItMiAyQzIwIDE0IDIwIDQgMjAgNFMxMCA0IDYgNGMwLTIgMS0yIDItMnoiIC8+CiAgICAgICAgPHBhdGgKICAgICAgICAgICAgZD0iTTE4IDhjMC0xLTEtMi0yLTJTNSA2IDQgNnMtMiAxLTIgMmMwIDEgMCAxMSAwIDEyczEgMiAyIDJjMSAwIDExIDAgMTIgMHMyLTEgMi0yYzAtMSAwLTExIDAtMTJ6bS0yIDB2MTJINFY4eiIgLz4KICAgICAgICA8cGF0aCBkPSJNMTEgMTBIOXYzSDZ2MmgzdjNoMnYtM2gzdi0yaC0zeiIgLz4KICAgIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-extension: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTIwLjUgMTFIMTlWN2MwLTEuMS0uOS0yLTItMmgtNFYzLjVDMTMgMi4xMiAxMS44OCAxIDEwLjUgMVM4IDIuMTIgOCAzLjVWNUg0Yy0xLjEgMC0xLjk5LjktMS45OSAydjMuOEgzLjVjMS40OSAwIDIuNyAxLjIxIDIuNyAyLjdzLTEuMjEgMi43LTIuNyAyLjdIMlYyMGMwIDEuMS45IDIgMiAyaDMuOHYtMS41YzAtMS40OSAxLjIxLTIuNyAyLjctMi43IDEuNDkgMCAyLjcgMS4yMSAyLjcgMi43VjIySDE3YzEuMSAwIDItLjkgMi0ydi00aDEuNWMxLjM4IDAgMi41LTEuMTIgMi41LTIuNVMyMS44OCAxMSAyMC41IDExeiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-fast-forward: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTQgMThsOC41LTZMNCA2djEyem05LTEydjEybDguNS02TDEzIDZ6Ii8+CiAgICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-file-upload: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTkgMTZoNnYtNmg0bC03LTctNyA3aDR6bS00IDJoMTR2Mkg1eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-file: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8cGF0aCBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBkPSJNMTkuMyA4LjJsLTUuNS01LjVjLS4zLS4zLS43LS41LTEuMi0uNUgzLjljLS44LjEtMS42LjktMS42IDEuOHYxNC4xYzAgLjkuNyAxLjYgMS42IDEuNmgxNC4yYy45IDAgMS42LS43IDEuNi0xLjZWOS40Yy4xLS41LS4xLS45LS40LTEuMnptLTUuOC0zLjNsMy40IDMuNmgtMy40VjQuOXptMy45IDEyLjdINC43Yy0uMSAwLS4yIDAtLjItLjJWNC43YzAtLjIuMS0uMy4yLS4zaDcuMnY0LjRzMCAuOC4zIDEuMWMuMy4zIDEuMS4zIDEuMS4zaDQuM3Y3LjJzLS4xLjItLjIuMnoiLz4KPC9zdmc+Cg==);
  --jp-icon-filter-dot: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiNGRkYiPgogICAgPHBhdGggZD0iTTE0LDEyVjE5Ljg4QzE0LjA0LDIwLjE4IDEzLjk0LDIwLjUgMTMuNzEsMjAuNzFDMTMuMzIsMjEuMSAxMi42OSwyMS4xIDEyLjMsMjAuNzFMMTAuMjksMTguN0MxMC4wNiwxOC40NyA5Ljk2LDE4LjE2IDEwLDE3Ljg3VjEySDkuOTdMNC4yMSw0LjYyQzMuODcsNC4xOSAzLjk1LDMuNTYgNC4zOCwzLjIyQzQuNTcsMy4wOCA0Ljc4LDMgNSwzVjNIMTlWM0MxOS4yMiwzIDE5LjQzLDMuMDggMTkuNjIsMy4yMkMyMC4wNSwzLjU2IDIwLjEzLDQuMTkgMTkuNzksNC42MkwxNC4wMywxMkgxNFoiIC8+CiAgPC9nPgogIDxnIGNsYXNzPSJqcC1pY29uLWRvdCIgZmlsbD0iI0ZGRiI+CiAgICA8Y2lyY2xlIGN4PSIxOCIgY3k9IjE3IiByPSIzIj48L2NpcmNsZT4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-filter-list: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTEwIDE4aDR2LTJoLTR2MnpNMyA2djJoMThWNkgzem0zIDdoMTJ2LTJINnYyeiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-filter: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiNGRkYiPgogICAgPHBhdGggZD0iTTE0LDEyVjE5Ljg4QzE0LjA0LDIwLjE4IDEzLjk0LDIwLjUgMTMuNzEsMjAuNzFDMTMuMzIsMjEuMSAxMi42OSwyMS4xIDEyLjMsMjAuNzFMMTAuMjksMTguN0MxMC4wNiwxOC40NyA5Ljk2LDE4LjE2IDEwLDE3Ljg3VjEySDkuOTdMNC4yMSw0LjYyQzMuODcsNC4xOSAzLjk1LDMuNTYgNC4zOCwzLjIyQzQuNTcsMy4wOCA0Ljc4LDMgNSwzVjNIMTlWM0MxOS4yMiwzIDE5LjQzLDMuMDggMTkuNjIsMy4yMkMyMC4wNSwzLjU2IDIwLjEzLDQuMTkgMTkuNzksNC42MkwxNC4wMywxMkgxNFoiIC8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-folder-favorite: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iIzAwMDAwMCI+CiAgPHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PHBhdGggY2xhc3M9ImpwLWljb24zIGpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iIzYxNjE2MSIgZD0iTTIwIDZoLThsLTItMkg0Yy0xLjEgMC0yIC45LTIgMnYxMmMwIDEuMS45IDIgMiAyaDE2YzEuMSAwIDItLjkgMi0yVjhjMC0xLjEtLjktMi0yLTJ6bS0yLjA2IDExTDE1IDE1LjI4IDEyLjA2IDE3bC43OC0zLjMzLTIuNTktMi4yNCAzLjQxLS4yOUwxNSA4bDEuMzQgMy4xNCAzLjQxLjI5LTIuNTkgMi4yNC43OCAzLjMzeiIvPgo8L3N2Zz4K);
  --jp-icon-folder: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBkPSJNMTAgNEg0Yy0xLjEgMC0xLjk5LjktMS45OSAyTDIgMThjMCAxLjEuOSAyIDIgMmgxNmMxLjEgMCAyLS45IDItMlY4YzAtMS4xLS45LTItMi0yaC04bC0yLTJ6Ii8+Cjwvc3ZnPgo=);
  --jp-icon-home: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iIzAwMDAwMCI+CiAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGNsYXNzPSJqcC1pY29uMyBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiM2MTYxNjEiIGQ9Ik0xMCAyMHYtNmg0djZoNXYtOGgzTDEyIDMgMiAxMmgzdjh6Ii8+Cjwvc3ZnPgo=);
  --jp-icon-html5: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDUxMiA1MTIiPgogIDxwYXRoIGNsYXNzPSJqcC1pY29uMCBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiMwMDAiIGQ9Ik0xMDguNCAwaDIzdjIyLjhoMjEuMlYwaDIzdjY5aC0yM1Y0NmgtMjF2MjNoLTIzLjJNMjA2IDIzaC0yMC4zVjBoNjMuN3YyM0gyMjl2NDZoLTIzbTUzLjUtNjloMjQuMWwxNC44IDI0LjNMMzEzLjIgMGgyNC4xdjY5aC0yM1YzNC44bC0xNi4xIDI0LjgtMTYuMS0yNC44VjY5aC0yMi42bTg5LjItNjloMjN2NDYuMmgzMi42VjY5aC01NS42Ii8+CiAgPHBhdGggY2xhc3M9ImpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iI2U0NGQyNiIgZD0iTTEwNy42IDQ3MWwtMzMtMzcwLjRoMzYyLjhsLTMzIDM3MC4yTDI1NS43IDUxMiIvPgogIDxwYXRoIGNsYXNzPSJqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiNmMTY1MjkiIGQ9Ik0yNTYgNDgwLjVWMTMxaDE0OC4zTDM3NiA0NDciLz4KICA8cGF0aCBjbGFzcz0ianAtaWNvbi1zZWxlY3RhYmxlLWludmVyc2UiIGZpbGw9IiNlYmViZWIiIGQ9Ik0xNDIgMTc2LjNoMTE0djQ1LjRoLTY0LjJsNC4yIDQ2LjVoNjB2NDUuM0gxNTQuNG0yIDIyLjhIMjAybDMuMiAzNi4zIDUwLjggMTMuNnY0Ny40bC05My4yLTI2Ii8+CiAgPHBhdGggY2xhc3M9ImpwLWljb24tc2VsZWN0YWJsZS1pbnZlcnNlIiBmaWxsPSIjZmZmIiBkPSJNMzY5LjYgMTc2LjNIMjU1Ljh2NDUuNGgxMDkuNm0tNC4xIDQ2LjVIMjU1Ljh2NDUuNGg1NmwtNS4zIDU5LTUwLjcgMTMuNnY0Ny4ybDkzLTI1LjgiLz4KPC9zdmc+Cg==);
  --jp-icon-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8cGF0aCBjbGFzcz0ianAtaWNvbi1icmFuZDQganAtaWNvbi1zZWxlY3RhYmxlLWludmVyc2UiIGZpbGw9IiNGRkYiIGQ9Ik0yLjIgMi4yaDE3LjV2MTcuNUgyLjJ6Ii8+CiAgPHBhdGggY2xhc3M9ImpwLWljb24tYnJhbmQwIGpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iIzNGNTFCNSIgZD0iTTIuMiAyLjJ2MTcuNWgxNy41bC4xLTE3LjVIMi4yem0xMi4xIDIuMmMxLjIgMCAyLjIgMSAyLjIgMi4ycy0xIDIuMi0yLjIgMi4yLTIuMi0xLTIuMi0yLjIgMS0yLjIgMi4yLTIuMnpNNC40IDE3LjZsMy4zLTguOCAzLjMgNi42IDIuMi0zLjIgNC40IDUuNEg0LjR6Ii8+Cjwvc3ZnPgo=);
  --jp-icon-info: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDUwLjk3OCA1MC45NzgiPgoJPGcgY2xhc3M9ImpwLWljb24zIiBmaWxsPSIjNjE2MTYxIj4KCQk8cGF0aCBkPSJNNDMuNTIsNy40NThDMzguNzExLDIuNjQ4LDMyLjMwNywwLDI1LjQ4OSwwQzE4LjY3LDAsMTIuMjY2LDIuNjQ4LDcuNDU4LDcuNDU4CgkJCWMtOS45NDMsOS45NDEtOS45NDMsMjYuMTE5LDAsMzYuMDYyYzQuODA5LDQuODA5LDExLjIxMiw3LjQ1NiwxOC4wMzEsNy40NThjMCwwLDAuMDAxLDAsMC4wMDIsMAoJCQljNi44MTYsMCwxMy4yMjEtMi42NDgsMTguMDI5LTcuNDU4YzQuODA5LTQuODA5LDcuNDU3LTExLjIxMiw3LjQ1Ny0xOC4wM0M1MC45NzcsMTguNjcsNDguMzI4LDEyLjI2Niw0My41Miw3LjQ1OHoKCQkJIE00Mi4xMDYsNDIuMTA1Yy00LjQzMiw0LjQzMS0xMC4zMzIsNi44NzItMTYuNjE1LDYuODcyaC0wLjAwMmMtNi4yODUtMC4wMDEtMTIuMTg3LTIuNDQxLTE2LjYxNy02Ljg3MgoJCQljLTkuMTYyLTkuMTYzLTkuMTYyLTI0LjA3MSwwLTMzLjIzM0MxMy4zMDMsNC40NCwxOS4yMDQsMiwyNS40ODksMmM2LjI4NCwwLDEyLjE4NiwyLjQ0LDE2LjYxNyw2Ljg3MgoJCQljNC40MzEsNC40MzEsNi44NzEsMTAuMzMyLDYuODcxLDE2LjYxN0M0OC45NzcsMzEuNzcyLDQ2LjUzNiwzNy42NzUsNDIuMTA2LDQyLjEwNXoiLz4KCQk8cGF0aCBkPSJNMjMuNTc4LDMyLjIxOGMtMC4wMjMtMS43MzQsMC4xNDMtMy4wNTksMC40OTYtMy45NzJjMC4zNTMtMC45MTMsMS4xMS0xLjk5NywyLjI3Mi0zLjI1MwoJCQljMC40NjgtMC41MzYsMC45MjMtMS4wNjIsMS4zNjctMS41NzVjMC42MjYtMC43NTMsMS4xMDQtMS40NzgsMS40MzYtMi4xNzVjMC4zMzEtMC43MDcsMC40OTUtMS41NDEsMC40OTUtMi41CgkJCWMwLTEuMDk2LTAuMjYtMi4wODgtMC43NzktMi45NzljLTAuNTY1LTAuODc5LTEuNTAxLTEuMzM2LTIuODA2LTEuMzY5Yy0xLjgwMiwwLjA1Ny0yLjk4NSwwLjY2Ny0zLjU1LDEuODMyCgkJCWMtMC4zMDEsMC41MzUtMC41MDMsMS4xNDEtMC42MDcsMS44MTRjLTAuMTM5LDAuNzA3LTAuMjA3LDEuNDMyLTAuMjA3LDIuMTc0aC0yLjkzN2MtMC4wOTEtMi4yMDgsMC40MDctNC4xMTQsMS40OTMtNS43MTkKCQkJYzEuMDYyLTEuNjQsMi44NTUtMi40ODEsNS4zNzgtMi41MjdjMi4xNiwwLjAyMywzLjg3NCwwLjYwOCw1LjE0MSwxLjc1OGMxLjI3OCwxLjE2LDEuOTI5LDIuNzY0LDEuOTUsNC44MTEKCQkJYzAsMS4xNDItMC4xMzcsMi4xMTEtMC40MSwyLjkxMWMtMC4zMDksMC44NDUtMC43MzEsMS41OTMtMS4yNjgsMi4yNDNjLTAuNDkyLDAuNjUtMS4wNjgsMS4zMTgtMS43MywyLjAwMgoJCQljLTAuNjUsMC42OTctMS4zMTMsMS40NzktMS45ODcsMi4zNDZjLTAuMjM5LDAuMzc3LTAuNDI5LDAuNzc3LTAuNTY1LDEuMTk5Yy0wLjE2LDAuOTU5LTAuMjE3LDEuOTUxLTAuMTcxLDIuOTc5CgkJCUMyNi41ODksMzIuMjE4LDIzLjU3OCwzMi4yMTgsMjMuNTc4LDMyLjIxOHogTTIzLjU3OCwzOC4yMnYtMy40ODRoMy4wNzZ2My40ODRIMjMuNTc4eiIvPgoJPC9nPgo8L3N2Zz4K);
  --jp-icon-inspector: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBjbGFzcz0ianAtaW5zcGVjdG9yLWljb24tY29sb3IganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBkPSJNMjAgNEg0Yy0xLjEgMC0xLjk5LjktMS45OSAyTDIgMThjMCAxLjEuOSAyIDIgMmgxNmMxLjEgMCAyLS45IDItMlY2YzAtMS4xLS45LTItMi0yem0tNSAxNEg0di00aDExdjR6bTAtNUg0VjloMTF2NHptNSA1aC00VjloNHY5eiIvPgo8L3N2Zz4K);
  --jp-icon-json: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8ZyBjbGFzcz0ianAtanNvbi1pY29uLWNvbG9yIGpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iI0Y5QTgyNSI+CiAgICA8cGF0aCBkPSJNMjAuMiAxMS44Yy0xLjYgMC0xLjcuNS0xLjcgMSAwIC40LjEuOS4xIDEuMy4xLjUuMS45LjEgMS4zIDAgMS43LTEuNCAyLjMtMy41IDIuM2gtLjl2LTEuOWguNWMxLjEgMCAxLjQgMCAxLjQtLjggMC0uMyAwLS42LS4xLTEgMC0uNC0uMS0uOC0uMS0xLjIgMC0xLjMgMC0xLjggMS4zLTItMS4zLS4yLTEuMy0uNy0xLjMtMiAwLS40LjEtLjguMS0xLjIuMS0uNC4xLS43LjEtMSAwLS44LS40LS43LTEuNC0uOGgtLjVWNC4xaC45YzIuMiAwIDMuNS43IDMuNSAyLjMgMCAuNC0uMS45LS4xIDEuMy0uMS41LS4xLjktLjEgMS4zIDAgLjUuMiAxIDEuNyAxdjEuOHpNMS44IDEwLjFjMS42IDAgMS43LS41IDEuNy0xIDAtLjQtLjEtLjktLjEtMS4zLS4xLS41LS4xLS45LS4xLTEuMyAwLTEuNiAxLjQtMi4zIDMuNS0yLjNoLjl2MS45aC0uNWMtMSAwLTEuNCAwLTEuNC44IDAgLjMgMCAuNi4xIDEgMCAuMi4xLjYuMSAxIDAgMS4zIDAgMS44LTEuMyAyQzYgMTEuMiA2IDExLjcgNiAxM2MwIC40LS4xLjgtLjEgMS4yLS4xLjMtLjEuNy0uMSAxIDAgLjguMy44IDEuNC44aC41djEuOWgtLjljLTIuMSAwLTMuNS0uNi0zLjUtMi4zIDAtLjQuMS0uOS4xLTEuMy4xLS41LjEtLjkuMS0xLjMgMC0uNS0uMi0xLTEuNy0xdi0xLjl6Ii8+CiAgICA8Y2lyY2xlIGN4PSIxMSIgY3k9IjEzLjgiIHI9IjIuMSIvPgogICAgPGNpcmNsZSBjeD0iMTEiIGN5PSI4LjIiIHI9IjIuMSIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-julia: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDMyNSAzMDAiPgogIDxnIGNsYXNzPSJqcC1icmFuZDAganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjY2IzYzMzIj4KICAgIDxwYXRoIGQ9Ik0gMTUwLjg5ODQzOCAyMjUgQyAxNTAuODk4NDM4IDI2Ni40MjE4NzUgMTE3LjMyMDMxMiAzMDAgNzUuODk4NDM4IDMwMCBDIDM0LjQ3NjU2MiAzMDAgMC44OTg0MzggMjY2LjQyMTg3NSAwLjg5ODQzOCAyMjUgQyAwLjg5ODQzOCAxODMuNTc4MTI1IDM0LjQ3NjU2MiAxNTAgNzUuODk4NDM4IDE1MCBDIDExNy4zMjAzMTIgMTUwIDE1MC44OTg0MzggMTgzLjU3ODEyNSAxNTAuODk4NDM4IDIyNSIvPgogIDwvZz4KICA8ZyBjbGFzcz0ianAtYnJhbmQwIGpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iIzM4OTgyNiI+CiAgICA8cGF0aCBkPSJNIDIzNy41IDc1IEMgMjM3LjUgMTE2LjQyMTg3NSAyMDMuOTIxODc1IDE1MCAxNjIuNSAxNTAgQyAxMjEuMDc4MTI1IDE1MCA4Ny41IDExNi40MjE4NzUgODcuNSA3NSBDIDg3LjUgMzMuNTc4MTI1IDEyMS4wNzgxMjUgMCAxNjIuNSAwIEMgMjAzLjkyMTg3NSAwIDIzNy41IDMzLjU3ODEyNSAyMzcuNSA3NSIvPgogIDwvZz4KICA8ZyBjbGFzcz0ianAtYnJhbmQwIGpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iIzk1NThiMiI+CiAgICA8cGF0aCBkPSJNIDMyNC4xMDE1NjIgMjI1IEMgMzI0LjEwMTU2MiAyNjYuNDIxODc1IDI5MC41MjM0MzggMzAwIDI0OS4xMDE1NjIgMzAwIEMgMjA3LjY3OTY4OCAzMDAgMTc0LjEwMTU2MiAyNjYuNDIxODc1IDE3NC4xMDE1NjIgMjI1IEMgMTc0LjEwMTU2MiAxODMuNTc4MTI1IDIwNy42Nzk2ODggMTUwIDI0OS4xMDE1NjIgMTUwIEMgMjkwLjUyMzQzOCAxNTAgMzI0LjEwMTU2MiAxODMuNTc4MTI1IDMyNC4xMDE1NjIgMjI1Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-jupyter-favicon: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUyIiBoZWlnaHQ9IjE2NSIgdmlld0JveD0iMCAwIDE1MiAxNjUiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgPGcgY2xhc3M9ImpwLWp1cHl0ZXItaWNvbi1jb2xvciIgZmlsbD0iI0YzNzcyNiI+CiAgICA8cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjA3ODk0NywgMTEwLjU4MjkyNykiIGQ9Ik03NS45NDIyODQyLDI5LjU4MDQ1NjEgQzQzLjMwMjM5NDcsMjkuNTgwNDU2MSAxNC43OTY3ODMyLDE3LjY1MzQ2MzQgMCwwIEM1LjUxMDgzMjExLDE1Ljg0MDY4MjkgMTUuNzgxNTM4OSwyOS41NjY3NzMyIDI5LjM5MDQ5NDcsMzkuMjc4NDE3MSBDNDIuOTk5Nyw0OC45ODk4NTM3IDU5LjI3MzcsNTQuMjA2NzgwNSA3NS45NjA1Nzg5LDU0LjIwNjc4MDUgQzkyLjY0NzQ1NzksNTQuMjA2NzgwNSAxMDguOTIxNDU4LDQ4Ljk4OTg1MzcgMTIyLjUzMDY2MywzOS4yNzg0MTcxIEMxMzYuMTM5NDUzLDI5LjU2Njc3MzIgMTQ2LjQxMDI4NCwxNS44NDA2ODI5IDE1MS45MjExNTgsMCBDMTM3LjA4Nzg2OCwxNy42NTM0NjM0IDEwOC41ODI1ODksMjkuNTgwNDU2MSA3NS45NDIyODQyLDI5LjU4MDQ1NjEgTDc1Ljk0MjI4NDIsMjkuNTgwNDU2MSBaIiAvPgogICAgPHBhdGggdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMzczNjgsIDAuNzA0ODc4KSIgZD0iTTc1Ljk3ODQ1NzksMjQuNjI2NDA3MyBDMTA4LjYxODc2MywyNC42MjY0MDczIDEzNy4xMjQ0NTgsMzYuNTUzNDQxNSAxNTEuOTIxMTU4LDU0LjIwNjc4MDUgQzE0Ni40MTAyODQsMzguMzY2MjIyIDEzNi4xMzk0NTMsMjQuNjQwMTMxNyAxMjIuNTMwNjYzLDE0LjkyODQ4NzggQzEwOC45MjE0NTgsNS4yMTY4NDM5IDkyLjY0NzQ1NzksMCA3NS45NjA1Nzg5LDAgQzU5LjI3MzcsMCA0Mi45OTk3LDUuMjE2ODQzOSAyOS4zOTA0OTQ3LDE0LjkyODQ4NzggQzE1Ljc4MTUzODksMjQuNjQwMTMxNyA1LjUxMDgzMjExLDM4LjM2NjIyMiAwLDU0LjIwNjc4MDUgQzE0LjgzMzA4MTYsMzYuNTg5OTI5MyA0My4zMzg1Njg0LDI0LjYyNjQwNzMgNzUuOTc4NDU3OSwyNC42MjY0MDczIEw3NS45Nzg0NTc5LDI0LjYyNjQwNzMgWiIgLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-jupyter: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzkiIGhlaWdodD0iNTEiIHZpZXdCb3g9IjAgMCAzOSA1MSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTYzOCAtMjI4MSkiPgogICAgIDxnIGNsYXNzPSJqcC1qdXB5dGVyLWljb24tY29sb3IiIGZpbGw9IiNGMzc3MjYiPgogICAgICA8cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNjM5Ljc0IDIzMTEuOTgpIiBkPSJNIDE4LjI2NDYgNy4xMzQxMUMgMTAuNDE0NSA3LjEzNDExIDMuNTU4NzIgNC4yNTc2IDAgMEMgMS4zMjUzOSAzLjgyMDQgMy43OTU1NiA3LjEzMDgxIDcuMDY4NiA5LjQ3MzAzQyAxMC4zNDE3IDExLjgxNTIgMTQuMjU1NyAxMy4wNzM0IDE4LjI2OSAxMy4wNzM0QyAyMi4yODIzIDEzLjA3MzQgMjYuMTk2MyAxMS44MTUyIDI5LjQ2OTQgOS40NzMwM0MgMzIuNzQyNCA3LjEzMDgxIDM1LjIxMjYgMy44MjA0IDM2LjUzOCAwQyAzMi45NzA1IDQuMjU3NiAyNi4xMTQ4IDcuMTM0MTEgMTguMjY0NiA3LjEzNDExWiIvPgogICAgICA8cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNjM5LjczIDIyODUuNDgpIiBkPSJNIDE4LjI3MzMgNS45MzkzMUMgMjYuMTIzNSA1LjkzOTMxIDMyLjk3OTMgOC44MTU4MyAzNi41MzggMTMuMDczNEMgMzUuMjEyNiA5LjI1MzAzIDMyLjc0MjQgNS45NDI2MiAyOS40Njk0IDMuNjAwNEMgMjYuMTk2MyAxLjI1ODE4IDIyLjI4MjMgMCAxOC4yNjkgMEMgMTQuMjU1NyAwIDEwLjM0MTcgMS4yNTgxOCA3LjA2ODYgMy42MDA0QyAzLjc5NTU2IDUuOTQyNjIgMS4zMjUzOSA5LjI1MzAzIDAgMTMuMDczNEMgMy41Njc0NSA4LjgyNDYzIDEwLjQyMzIgNS45MzkzMSAxOC4yNzMzIDUuOTM5MzFaIi8+CiAgICA8L2c+CiAgICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgICA8cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNjY5LjMgMjI4MS4zMSkiIGQ9Ik0gNS44OTM1MyAyLjg0NEMgNS45MTg4OSAzLjQzMTY1IDUuNzcwODUgNC4wMTM2NyA1LjQ2ODE1IDQuNTE2NDVDIDUuMTY1NDUgNS4wMTkyMiA0LjcyMTY4IDUuNDIwMTUgNC4xOTI5OSA1LjY2ODUxQyAzLjY2NDMgNS45MTY4OCAzLjA3NDQ0IDYuMDAxNTEgMi40OTgwNSA1LjkxMTcxQyAxLjkyMTY2IDUuODIxOSAxLjM4NDYzIDUuNTYxNyAwLjk1NDg5OCA1LjE2NDAxQyAwLjUyNTE3IDQuNzY2MzMgMC4yMjIwNTYgNC4yNDkwMyAwLjA4MzkwMzcgMy42Nzc1N0MgLTAuMDU0MjQ4MyAzLjEwNjExIC0wLjAyMTIzIDIuNTA2MTcgMC4xNzg3ODEgMS45NTM2NEMgMC4zNzg3OTMgMS40MDExIDAuNzM2ODA5IDAuOTIwODE3IDEuMjA3NTQgMC41NzM1MzhDIDEuNjc4MjYgMC4yMjYyNTkgMi4yNDA1NSAwLjAyNzU5MTkgMi44MjMyNiAwLjAwMjY3MjI5QyAzLjYwMzg5IC0wLjAzMDcxMTUgNC4zNjU3MyAwLjI0OTc4OSA0Ljk0MTQyIDAuNzgyNTUxQyA1LjUxNzExIDEuMzE1MzEgNS44NTk1NiAyLjA1Njc2IDUuODkzNTMgMi44NDRaIi8+CiAgICAgIDxwYXRoIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE2MzkuOCAyMzIzLjgxKSIgZD0iTSA3LjQyNzg5IDMuNTgzMzhDIDcuNDYwMDggNC4zMjQzIDcuMjczNTUgNS4wNTgxOSA2Ljg5MTkzIDUuNjkyMTNDIDYuNTEwMzEgNi4zMjYwNyA1Ljk1MDc1IDYuODMxNTYgNS4yODQxMSA3LjE0NDZDIDQuNjE3NDcgNy40NTc2MyAzLjg3MzcxIDcuNTY0MTQgMy4xNDcwMiA3LjQ1MDYzQyAyLjQyMDMyIDcuMzM3MTIgMS43NDMzNiA3LjAwODcgMS4yMDE4NCA2LjUwNjk1QyAwLjY2MDMyOCA2LjAwNTIgMC4yNzg2MSA1LjM1MjY4IDAuMTA1MDE3IDQuNjMyMDJDIC0wLjA2ODU3NTcgMy45MTEzNSAtMC4wMjYyMzYxIDMuMTU0OTQgMC4yMjY2NzUgMi40NTg1NkMgMC40Nzk1ODcgMS43NjIxNyAwLjkzMTY5NyAxLjE1NzEzIDEuNTI1NzYgMC43MjAwMzNDIDIuMTE5ODMgMC4yODI5MzUgMi44MjkxNCAwLjAzMzQzOTUgMy41NjM4OSAwLjAwMzEzMzQ0QyA0LjU0NjY3IC0wLjAzNzQwMzMgNS41MDUyOSAwLjMxNjcwNiA2LjIyOTYxIDAuOTg3ODM1QyA2Ljk1MzkzIDEuNjU4OTYgNy4zODQ4NCAyLjU5MjM1IDcuNDI3ODkgMy41ODMzOEwgNy40Mjc4OSAzLjU4MzM4WiIvPgogICAgICA8cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNjM4LjM2IDIyODYuMDYpIiBkPSJNIDIuMjc0NzEgNC4zOTYyOUMgMS44NDM2MyA0LjQxNTA4IDEuNDE2NzEgNC4zMDQ0NSAxLjA0Nzk5IDQuMDc4NDNDIDAuNjc5MjY4IDMuODUyNCAwLjM4NTMyOCAzLjUyMTE0IDAuMjAzMzcxIDMuMTI2NTZDIDAuMDIxNDEzNiAyLjczMTk4IC0wLjA0MDM3OTggMi4yOTE4MyAwLjAyNTgxMTYgMS44NjE4MUMgMC4wOTIwMDMxIDEuNDMxOCAwLjI4MzIwNCAxLjAzMTI2IDAuNTc1MjEzIDAuNzEwODgzQyAwLjg2NzIyMiAwLjM5MDUxIDEuMjQ2OTEgMC4xNjQ3MDggMS42NjYyMiAwLjA2MjA1OTJDIDIuMDg1NTMgLTAuMDQwNTg5NyAyLjUyNTYxIC0wLjAxNTQ3MTQgMi45MzA3NiAwLjEzNDIzNUMgMy4zMzU5MSAwLjI4Mzk0MSAzLjY4NzkyIDAuNTUxNTA1IDMuOTQyMjIgMC45MDMwNkMgNC4xOTY1MiAxLjI1NDYyIDQuMzQxNjkgMS42NzQzNiA0LjM1OTM1IDIuMTA5MTZDIDQuMzgyOTkgMi42OTEwNyA0LjE3Njc4IDMuMjU4NjkgMy43ODU5NyAzLjY4NzQ2QyAzLjM5NTE2IDQuMTE2MjQgMi44NTE2NiA0LjM3MTE2IDIuMjc0NzEgNC4zOTYyOUwgMi4yNzQ3MSA0LjM5NjI5WiIvPgogICAgPC9nPgogIDwvZz4+Cjwvc3ZnPgo=);
  --jp-icon-jupyterlab-wordmark: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIHZpZXdCb3g9IjAgMCAxODYwLjggNDc1Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjIiIGZpbGw9IiM0RTRFNEUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQ4MC4xMzY0MDEsIDY0LjI3MTQ5MykiPgogICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDU4Ljg3NTU2NikiPgogICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjA4NzYwMywgMC4xNDAyOTQpIj4KICAgICAgICA8cGF0aCBkPSJNLTQyNi45LDE2OS44YzAsNDguNy0zLjcsNjQuNy0xMy42LDc2LjRjLTEwLjgsMTAtMjUsMTUuNS0zOS43LDE1LjVsMy43LDI5IGMyMi44LDAuMyw0NC44LTcuOSw2MS45LTIzLjFjMTcuOC0xOC41LDI0LTQ0LjEsMjQtODMuM1YwSC00Mjd2MTcwLjFMLTQyNi45LDE2OS44TC00MjYuOSwxNjkuOHoiLz4KICAgICAgPC9nPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTU1LjA0NTI5NiwgNTYuODM3MTA0KSI+CiAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuNTYyNDUzLCAxLjc5OTg0MikiPgogICAgICAgIDxwYXRoIGQ9Ik0tMzEyLDE0OGMwLDIxLDAsMzkuNSwxLjcsNTUuNGgtMzEuOGwtMi4xLTMzLjNoLTAuOGMtNi43LDExLjYtMTYuNCwyMS4zLTI4LDI3LjkgYy0xMS42LDYuNi0yNC44LDEwLTM4LjIsOS44Yy0zMS40LDAtNjktMTcuNy02OS04OVYwaDM2LjR2MTEyLjdjMCwzOC43LDExLjYsNjQuNyw0NC42LDY0LjdjMTAuMy0wLjIsMjAuNC0zLjUsMjguOS05LjQgYzguNS01LjksMTUuMS0xNC4zLDE4LjktMjMuOWMyLjItNi4xLDMuMy0xMi41LDMuMy0xOC45VjAuMmgzNi40VjE0OEgtMzEyTC0zMTIsMTQ4eiIvPgogICAgICA8L2c+CiAgICA8L2c+CiAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzOTAuMDEzMzIyLCA1My40Nzk2MzgpIj4KICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMS43MDY0NTgsIDAuMjMxNDI1KSI+CiAgICAgICAgPHBhdGggZD0iTS00NzguNiw3MS40YzAtMjYtMC44LTQ3LTEuNy02Ni43aDMyLjdsMS43LDM0LjhoMC44YzcuMS0xMi41LDE3LjUtMjIuOCwzMC4xLTI5LjcgYzEyLjUtNywyNi43LTEwLjMsNDEtOS44YzQ4LjMsMCw4NC43LDQxLjcsODQuNywxMDMuM2MwLDczLjEtNDMuNywxMDkuMi05MSwxMDkuMmMtMTIuMSwwLjUtMjQuMi0yLjItMzUtNy44IGMtMTAuOC01LjYtMTkuOS0xMy45LTI2LjYtMjQuMmgtMC44VjI5MWgtMzZ2LTIyMEwtNDc4LjYsNzEuNEwtNDc4LjYsNzEuNHogTS00NDIuNiwxMjUuNmMwLjEsNS4xLDAuNiwxMC4xLDEuNywxNS4xIGMzLDEyLjMsOS45LDIzLjMsMTkuOCwzMS4xYzkuOSw3LjgsMjIuMSwxMi4xLDM0LjcsMTIuMWMzOC41LDAsNjAuNy0zMS45LDYwLjctNzguNWMwLTQwLjctMjEuMS03NS42LTU5LjUtNzUuNiBjLTEyLjksMC40LTI1LjMsNS4xLTM1LjMsMTMuNGMtOS45LDguMy0xNi45LDE5LjctMTkuNiwzMi40Yy0xLjUsNC45LTIuMywxMC0yLjUsMTUuMVYxMjUuNkwtNDQyLjYsMTI1LjZMLTQ0Mi42LDEyNS42eiIvPgogICAgICA8L2c+CiAgICA8L2c+CiAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2MDYuNzQwNzI2LCA1Ni44MzcxMDQpIj4KICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC43NTEyMjYsIDEuOTg5Mjk5KSI+CiAgICAgICAgPHBhdGggZD0iTS00NDAuOCwwbDQzLjcsMTIwLjFjNC41LDEzLjQsOS41LDI5LjQsMTIuOCw0MS43aDAuOGMzLjctMTIuMiw3LjktMjcuNywxMi44LTQyLjQgbDM5LjctMTE5LjJoMzguNUwtMzQ2LjksMTQ1Yy0yNiw2OS43LTQzLjcsMTA1LjQtNjguNiwxMjcuMmMtMTIuNSwxMS43LTI3LjksMjAtNDQuNiwyMy45bC05LjEtMzEuMSBjMTEuNy0zLjksMjIuNS0xMC4xLDMxLjgtMTguMWMxMy4yLTExLjEsMjMuNy0yNS4yLDMwLjYtNDEuMmMxLjUtMi44LDIuNS01LjcsMi45LTguOGMtMC4zLTMuMy0xLjItNi42LTIuNS05LjdMLTQ4MC4yLDAuMSBoMzkuN0wtNDQwLjgsMEwtNDQwLjgsMHoiLz4KICAgICAgPC9nPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoODIyLjc0ODEwNCwgMC4wMDAwMDApIj4KICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMS40NjQwNTAsIDAuMzc4OTE0KSI+CiAgICAgICAgPHBhdGggZD0iTS00MTMuNywwdjU4LjNoNTJ2MjguMmgtNTJWMTk2YzAsMjUsNywzOS41LDI3LjMsMzkuNWM3LjEsMC4xLDE0LjItMC43LDIxLjEtMi41IGwxLjcsMjcuN2MtMTAuMywzLjctMjEuMyw1LjQtMzIuMiw1Yy03LjMsMC40LTE0LjYtMC43LTIxLjMtMy40Yy02LjgtMi43LTEyLjktNi44LTE3LjktMTIuMWMtMTAuMy0xMC45LTE0LjEtMjktMTQuMS01Mi45IFY4Ni41aC0zMVY1OC4zaDMxVjkuNkwtNDEzLjcsMEwtNDEzLjcsMHoiLz4KICAgICAgPC9nPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOTc0LjQzMzI4NiwgNTMuNDc5NjM4KSI+CiAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuOTkwMDM0LCAwLjYxMDMzOSkiPgogICAgICAgIDxwYXRoIGQ9Ik0tNDQ1LjgsMTEzYzAuOCw1MCwzMi4yLDcwLjYsNjguNiw3MC42YzE5LDAuNiwzNy45LTMsNTUuMy0xMC41bDYuMiwyNi40IGMtMjAuOSw4LjktNDMuNSwxMy4xLTY2LjIsMTIuNmMtNjEuNSwwLTk4LjMtNDEuMi05OC4zLTEwMi41Qy00ODAuMiw0OC4yLTQ0NC43LDAtMzg2LjUsMGM2NS4yLDAsODIuNyw1OC4zLDgyLjcsOTUuNyBjLTAuMSw1LjgtMC41LDExLjUtMS4yLDE3LjJoLTE0MC42SC00NDUuOEwtNDQ1LjgsMTEzeiBNLTMzOS4yLDg2LjZjMC40LTIzLjUtOS41LTYwLjEtNTAuNC02MC4xIGMtMzYuOCwwLTUyLjgsMzQuNC01NS43LDYwLjFILTMzOS4yTC0zMzkuMiw4Ni42TC0zMzkuMiw4Ni42eiIvPgogICAgICA8L2c+CiAgICA8L2c+CiAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjAxLjk2MTA1OCwgNTMuNDc5NjM4KSI+CiAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuMTc5NjQwLCAwLjcwNTA2OCkiPgogICAgICAgIDxwYXRoIGQ9Ik0tNDc4LjYsNjhjMC0yMy45LTAuNC00NC41LTEuNy02My40aDMxLjhsMS4yLDM5LjloMS43YzkuMS0yNy4zLDMxLTQ0LjUsNTUuMy00NC41IGMzLjUtMC4xLDcsMC40LDEwLjMsMS4ydjM0LjhjLTQuMS0wLjktOC4yLTEuMy0xMi40LTEuMmMtMjUuNiwwLTQzLjcsMTkuNy00OC43LDQ3LjRjLTEsNS43LTEuNiwxMS41LTEuNywxNy4ydjEwOC4zaC0zNlY2OCBMLTQ3OC42LDY4eiIvPgogICAgICA8L2c+CiAgICA8L2c+CiAgPC9nPgoKICA8ZyBjbGFzcz0ianAtaWNvbi13YXJuMCIgZmlsbD0iI0YzNzcyNiI+CiAgICA8cGF0aCBkPSJNMTM1Mi4zLDMyNi4yaDM3VjI4aC0zN1YzMjYuMnogTTE2MDQuOCwzMjYuMmMtMi41LTEzLjktMy40LTMxLjEtMy40LTQ4Ljd2LTc2IGMwLTQwLjctMTUuMS04My4xLTc3LjMtODMuMWMtMjUuNiwwLTUwLDcuMS02Ni44LDE4LjFsOC40LDI0LjRjMTQuMy05LjIsMzQtMTUuMSw1My0xNS4xYzQxLjYsMCw0Ni4yLDMwLjIsNDYuMiw0N3Y0LjIgYy03OC42LTAuNC0xMjIuMywyNi41LTEyMi4zLDc1LjZjMCwyOS40LDIxLDU4LjQsNjIuMiw1OC40YzI5LDAsNTAuOS0xNC4zLDYyLjItMzAuMmgxLjNsMi45LDI1LjZIMTYwNC44eiBNMTU2NS43LDI1Ny43IGMwLDMuOC0wLjgsOC0yLjEsMTEuOGMtNS45LDE3LjItMjIuNywzNC00OS4yLDM0Yy0xOC45LDAtMzQuOS0xMS4zLTM0LjktMzUuM2MwLTM5LjUsNDUuOC00Ni42LDg2LjItNDUuOFYyNTcuN3ogTTE2OTguNSwzMjYuMiBsMS43LTMzLjZoMS4zYzE1LjEsMjYuOSwzOC43LDM4LjIsNjguMSwzOC4yYzQ1LjQsMCw5MS4yLTM2LjEsOTEuMi0xMDguOGMwLjQtNjEuNy0zNS4zLTEwMy43LTg1LjctMTAzLjcgYy0zMi44LDAtNTYuMywxNC43LTY5LjMsMzcuNGgtMC44VjI4aC0zNi42djI0NS43YzAsMTguMS0wLjgsMzguNi0xLjcsNTIuNUgxNjk4LjV6IE0xNzA0LjgsMjA4LjJjMC01LjksMS4zLTEwLjksMi4xLTE1LjEgYzcuNi0yOC4xLDMxLjEtNDUuNCw1Ni4zLTQ1LjRjMzkuNSwwLDYwLjUsMzQuOSw2MC41LDc1LjZjMCw0Ni42LTIzLjEsNzguMS02MS44LDc4LjFjLTI2LjksMC00OC4zLTE3LjYtNTUuNS00My4zIGMtMC44LTQuMi0xLjctOC44LTEuNy0xMy40VjIwOC4yeiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-kernel: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGNsYXNzPSJqcC1pY29uMiIgZmlsbD0iIzYxNjE2MSIgZD0iTTE1IDlIOXY2aDZWOXptLTIgNGgtMnYtMmgydjJ6bTgtMlY5aC0yVjdjMC0xLjEtLjktMi0yLTJoLTJWM2gtMnYyaC0yVjNIOXYySDdjLTEuMSAwLTIgLjktMiAydjJIM3YyaDJ2MkgzdjJoMnYyYzAgMS4xLjkgMiAyIDJoMnYyaDJ2LTJoMnYyaDJ2LTJoMmMxLjEgMCAyLS45IDItMnYtMmgydi0yaC0ydi0yaDJ6bS00IDZIN1Y3aDEwdjEweiIvPgo8L3N2Zz4K);
  --jp-icon-keyboard: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBkPSJNMjAgNUg0Yy0xLjEgMC0xLjk5LjktMS45OSAyTDIgMTdjMCAxLjEuOSAyIDIgMmgxNmMxLjEgMCAyLS45IDItMlY3YzAtMS4xLS45LTItMi0yem0tOSAzaDJ2MmgtMlY4em0wIDNoMnYyaC0ydi0yek04IDhoMnYySDhWOHptMCAzaDJ2Mkg4di0yem0tMSAySDV2LTJoMnYyem0wLTNINVY4aDJ2MnptOSA3SDh2LTJoOHYyem0wLTRoLTJ2LTJoMnYyem0wLTNoLTJWOGgydjJ6bTMgM2gtMnYtMmgydjJ6bTAtM2gtMlY4aDJ2MnoiLz4KPC9zdmc+Cg==);
  --jp-icon-launch: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMzIgMzIiIHdpZHRoPSIzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIj4KICAgIDxwYXRoIGQ9Ik0yNiwyOEg2YTIuMDAyNywyLjAwMjcsMCwwLDEtMi0yVjZBMi4wMDI3LDIuMDAyNywwLDAsMSw2LDRIMTZWNkg2VjI2SDI2VjE2aDJWMjZBMi4wMDI3LDIuMDAyNywwLDAsMSwyNiwyOFoiLz4KICAgIDxwb2x5Z29uIHBvaW50cz0iMjAgMiAyMCA0IDI2LjU4NiA0IDE4IDEyLjU4NiAxOS40MTQgMTQgMjggNS40MTQgMjggMTIgMzAgMTIgMzAgMiAyMCAyIi8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-launcher: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBkPSJNMTkgMTlINVY1aDdWM0g1YTIgMiAwIDAwLTIgMnYxNGEyIDIgMCAwMDIgMmgxNGMxLjEgMCAyLS45IDItMnYtN2gtMnY3ek0xNCAzdjJoMy41OWwtOS44MyA5LjgzIDEuNDEgMS40MUwxOSA2LjQxVjEwaDJWM2gtN3oiLz4KPC9zdmc+Cg==);
  --jp-icon-line-form: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGZpbGw9IndoaXRlIiBkPSJNNS44OCA0LjEyTDEzLjc2IDEybC03Ljg4IDcuODhMOCAyMmwxMC0xMEw4IDJ6Ii8+Cjwvc3ZnPgo=);
  --jp-icon-link: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTMuOSAxMmMwLTEuNzEgMS4zOS0zLjEgMy4xLTMuMWg0VjdIN2MtMi43NiAwLTUgMi4yNC01IDVzMi4yNCA1IDUgNWg0di0xLjlIN2MtMS43MSAwLTMuMS0xLjM5LTMuMS0zLjF6TTggMTNoOHYtMkg4djJ6bTktNmgtNHYxLjloNGMxLjcxIDAgMy4xIDEuMzkgMy4xIDMuMXMtMS4zOSAzLjEtMy4xIDMuMWgtNFYxN2g0YzIuNzYgMCA1LTIuMjQgNS01cy0yLjI0LTUtNS01eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-list: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGNsYXNzPSJqcC1pY29uMiBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiM2MTYxNjEiIGQ9Ik0xOSA1djE0SDVWNWgxNG0xLjEtMkgzLjljLS41IDAtLjkuNC0uOS45djE2LjJjMCAuNC40LjkuOS45aDE2LjJjLjQgMCAuOS0uNS45LS45VjMuOWMwLS41LS41LS45LS45LS45ek0xMSA3aDZ2MmgtNlY3em0wIDRoNnYyaC02di0yem0wIDRoNnYyaC02ek03IDdoMnYySDd6bTAgNGgydjJIN3ptMCA0aDJ2Mkg3eiIvPgo8L3N2Zz4K);
  --jp-icon-markdown: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8cGF0aCBjbGFzcz0ianAtaWNvbi1jb250cmFzdDAganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjN0IxRkEyIiBkPSJNNSAxNC45aDEybC02LjEgNnptOS40LTYuOGMwLTEuMy0uMS0yLjktLjEtNC41LS40IDEuNC0uOSAyLjktMS4zIDQuM2wtMS4zIDQuM2gtMkw4LjUgNy45Yy0uNC0xLjMtLjctMi45LTEtNC4zLS4xIDEuNi0uMSAzLjItLjIgNC42TDcgMTIuNEg0LjhsLjctMTFoMy4zTDEwIDVjLjQgMS4yLjcgMi43IDEgMy45LjMtMS4yLjctMi42IDEtMy45bDEuMi0zLjdoMy4zbC42IDExaC0yLjRsLS4zLTQuMnoiLz4KPC9zdmc+Cg==);
  --jp-icon-move-down: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggY2xhc3M9ImpwLWljb24zIiBkPSJNMTIuNDcxIDcuNTI4OTlDMTIuNzYzMiA3LjIzNjg0IDEyLjc2MzIgNi43NjMxNiAxMi40NzEgNi40NzEwMVY2LjQ3MTAxQzEyLjE3OSA2LjE3OTA1IDExLjcwNTcgNi4xNzg4NCAxMS40MTM1IDYuNDcwNTRMNy43NSAxMC4xMjc1VjEuNzVDNy43NSAxLjMzNTc5IDcuNDE0MjEgMSA3IDFWMUM2LjU4NTc5IDEgNi4yNSAxLjMzNTc5IDYuMjUgMS43NVYxMC4xMjc1TDIuNTk3MjYgNi40NjgyMkMyLjMwMzM4IDYuMTczODEgMS44MjY0MSA2LjE3MzU5IDEuNTMyMjYgNi40Njc3NFY2LjQ2Nzc0QzEuMjM4MyA2Ljc2MTcgMS4yMzgzIDcuMjM4MyAxLjUzMjI2IDcuNTMyMjZMNi4yOTI4OSAxMi4yOTI5QzYuNjgzNDIgMTIuNjgzNCA3LjMxNjU4IDEyLjY4MzQgNy43MDcxMSAxMi4yOTI5TDEyLjQ3MSA3LjUyODk5WiIgZmlsbD0iIzYxNjE2MSIvPgo8L3N2Zz4K);
  --jp-icon-move-up: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggY2xhc3M9ImpwLWljb24zIiBkPSJNMS41Mjg5OSA2LjQ3MTAxQzEuMjM2ODQgNi43NjMxNiAxLjIzNjg0IDcuMjM2ODQgMS41Mjg5OSA3LjUyODk5VjcuNTI4OTlDMS44MjA5NSA3LjgyMDk1IDIuMjk0MjYgNy44MjExNiAyLjU4NjQ5IDcuNTI5NDZMNi4yNSAzLjg3MjVWMTIuMjVDNi4yNSAxMi42NjQyIDYuNTg1NzkgMTMgNyAxM1YxM0M3LjQxNDIxIDEzIDcuNzUgMTIuNjY0MiA3Ljc1IDEyLjI1VjMuODcyNUwxMS40MDI3IDcuNTMxNzhDMTEuNjk2NiA3LjgyNjE5IDEyLjE3MzYgNy44MjY0MSAxMi40Njc3IDcuNTMyMjZWNy41MzIyNkMxMi43NjE3IDcuMjM4MyAxMi43NjE3IDYuNzYxNyAxMi40Njc3IDYuNDY3NzRMNy43MDcxMSAxLjcwNzExQzcuMzE2NTggMS4zMTY1OCA2LjY4MzQyIDEuMzE2NTggNi4yOTI4OSAxLjcwNzExTDEuNTI4OTkgNi40NzEwMVoiIGZpbGw9IiM2MTYxNjEiLz4KPC9zdmc+Cg==);
  --jp-icon-new-folder: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTIwIDZoLThsLTItMkg0Yy0xLjExIDAtMS45OS44OS0xLjk5IDJMMiAxOGMwIDEuMTEuODkgMiAyIDJoMTZjMS4xMSAwIDItLjg5IDItMlY4YzAtMS4xMS0uODktMi0yLTJ6bS0xIDhoLTN2M2gtMnYtM2gtM3YtMmgzVjloMnYzaDN2MnoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-not-trusted: url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI1IDI1Ij4KICAgIDxwYXRoIGNsYXNzPSJqcC1pY29uMiIgc3Ryb2tlPSIjMzMzMzMzIiBzdHJva2Utd2lkdGg9IjIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMgMykiIGQ9Ik0xLjg2MDk0IDExLjQ0MDlDMC44MjY0NDggOC43NzAyNyAwLjg2Mzc3OSA2LjA1NzY0IDEuMjQ5MDcgNC4xOTkzMkMyLjQ4MjA2IDMuOTMzNDcgNC4wODA2OCAzLjQwMzQ3IDUuNjAxMDIgMi44NDQ5QzcuMjM1NDkgMi4yNDQ0IDguODU2NjYgMS41ODE1IDkuOTg3NiAxLjA5NTM5QzExLjA1OTcgMS41ODM0MSAxMi42MDk0IDIuMjQ0NCAxNC4yMTggMi44NDMzOUMxNS43NTAzIDMuNDEzOTQgMTcuMzk5NSAzLjk1MjU4IDE4Ljc1MzkgNC4yMTM4NUMxOS4xMzY0IDYuMDcxNzcgMTkuMTcwOSA4Ljc3NzIyIDE4LjEzOSAxMS40NDA5QzE3LjAzMDMgMTQuMzAzMiAxNC42NjY4IDE3LjE4NDQgOS45OTk5OSAxOC45MzU0QzUuMzMzMTkgMTcuMTg0NCAyLjk2OTY4IDE0LjMwMzIgMS44NjA5NCAxMS40NDA5WiIvPgogICAgPHBhdGggY2xhc3M9ImpwLWljb24yIiBzdHJva2U9IiMzMzMzMzMiIHN0cm9rZS13aWR0aD0iMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOS4zMTU5MiA5LjMyMDMxKSIgZD0iTTcuMzY4NDIgMEwwIDcuMzY0NzkiLz4KICAgIDxwYXRoIGNsYXNzPSJqcC1pY29uMiIgc3Ryb2tlPSIjMzMzMzMzIiBzdHJva2Utd2lkdGg9IjIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDkuMzE1OTIgMTYuNjgzNikgc2NhbGUoMSAtMSkiIGQ9Ik03LjM2ODQyIDBMMCA3LjM2NDc5Ii8+Cjwvc3ZnPgo=);
  --jp-icon-notebook: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8ZyBjbGFzcz0ianAtbm90ZWJvb2staWNvbi1jb2xvciBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiNFRjZDMDAiPgogICAgPHBhdGggZD0iTTE4LjcgMy4zdjE1LjRIMy4zVjMuM2gxNS40bTEuNS0xLjVIMS44djE4LjNoMTguM2wuMS0xOC4zeiIvPgogICAgPHBhdGggZD0iTTE2LjUgMTYuNWwtNS40LTQuMy01LjYgNC4zdi0xMWgxMXoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-numbering: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIiIGhlaWdodD0iMjIiIHZpZXdCb3g9IjAgMCAyOCAyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CgkJPHBhdGggZD0iTTQgMTlINlYxOS41SDVWMjAuNUg2VjIxSDRWMjJIN1YxOEg0VjE5Wk01IDEwSDZWNkg0VjdINVYxMFpNNCAxM0g1LjhMNCAxNS4xVjE2SDdWMTVINS4yTDcgMTIuOVYxMkg0VjEzWk05IDdWOUgyM1Y3SDlaTTkgMjFIMjNWMTlIOVYyMVpNOSAxNUgyM1YxM0g5VjE1WiIvPgoJPC9nPgo8L3N2Zz4K);
  --jp-icon-offline-bolt: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE2Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTEyIDIuMDJjLTUuNTEgMC05Ljk4IDQuNDctOS45OCA5Ljk4czQuNDcgOS45OCA5Ljk4IDkuOTggOS45OC00LjQ3IDkuOTgtOS45OFMxNy41MSAyLjAyIDEyIDIuMDJ6TTExLjQ4IDIwdi02LjI2SDhMMTMgNHY2LjI2aDMuMzVMMTEuNDggMjB6Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-palette: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTE4IDEzVjIwSDRWNkg5LjAyQzkuMDcgNS4yOSA5LjI0IDQuNjIgOS41IDRINEMyLjkgNCAyIDQuOSAyIDZWMjBDMiAyMS4xIDIuOSAyMiA0IDIySDE4QzE5LjEgMjIgMjAgMjEuMSAyMCAyMFYxNUwxOCAxM1pNMTkuMyA4Ljg5QzE5Ljc0IDguMTkgMjAgNy4zOCAyMCA2LjVDMjAgNC4wMSAxNy45OSAyIDE1LjUgMkMxMy4wMSAyIDExIDQuMDEgMTEgNi41QzExIDguOTkgMTMuMDEgMTEgMTUuNDkgMTFDMTYuMzcgMTEgMTcuMTkgMTAuNzQgMTcuODggMTAuM0wyMSAxMy40MkwyMi40MiAxMkwxOS4zIDguODlaTTE1LjUgOUMxNC4xMiA5IDEzIDcuODggMTMgNi41QzEzIDUuMTIgMTQuMTIgNCAxNS41IDRDMTYuODggNCAxOCA1LjEyIDE4IDYuNUMxOCA3Ljg4IDE2Ljg4IDkgMTUuNSA5WiIvPgogICAgPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik00IDZIOS4wMTg5NEM5LjAwNjM5IDYuMTY1MDIgOSA2LjMzMTc2IDkgNi41QzkgOC44MTU3NyAxMC4yMTEgMTAuODQ4NyAxMi4wMzQzIDEySDlWMTRIMTZWMTIuOTgxMUMxNi41NzAzIDEyLjkzNzcgMTcuMTIgMTIuODIwNyAxNy42Mzk2IDEyLjYzOTZMMTggMTNWMjBINFY2Wk04IDhINlYxMEg4VjhaTTYgMTJIOFYxNEg2VjEyWk04IDE2SDZWMThIOFYxNlpNOSAxNkgxNlYxOEg5VjE2WiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-paste: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTE5IDJoLTQuMThDMTQuNC44NCAxMy4zIDAgMTIgMGMtMS4zIDAtMi40Ljg0LTIuODIgMkg1Yy0xLjEgMC0yIC45LTIgMnYxNmMwIDEuMS45IDIgMiAyaDE0YzEuMSAwIDItLjkgMi0yVjRjMC0xLjEtLjktMi0yLTJ6bS03IDBjLjU1IDAgMSAuNDUgMSAxcy0uNDUgMS0xIDEtMS0uNDUtMS0xIC40NS0xIDEtMXptNyAxOEg1VjRoMnYzaDEwVjRoMnYxNnoiLz4KICAgIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-pdf: url(data:image/svg+xml;base64,PHN2ZwogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMiAyMiIgd2lkdGg9IjE2Ij4KICAgIDxwYXRoIHRyYW5zZm9ybT0icm90YXRlKDQ1KSIgY2xhc3M9ImpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iI0ZGMkEyQSIKICAgICAgIGQ9Im0gMjIuMzQ0MzY5LC0zLjAxNjM2NDIgaCA1LjYzODYwNCB2IDEuNTc5MjQzMyBoIC0zLjU0OTIyNyB2IDEuNTA4NjkyOTkgaCAzLjMzNzU3NiBWIDEuNjUwODE1NCBoIC0zLjMzNzU3NiB2IDMuNDM1MjYxMyBoIC0yLjA4OTM3NyB6IG0gLTcuMTM2NDQ0LDEuNTc5MjQzMyB2IDQuOTQzOTU0MyBoIDAuNzQ4OTIgcSAxLjI4MDc2MSwwIDEuOTUzNzAzLC0wLjYzNDk1MzUgMC42NzgzNjksLTAuNjM0OTUzNSAwLjY3ODM2OSwtMS44NDUxNjQxIDAsLTEuMjA0NzgzNTUgLTAuNjcyOTQyLC0xLjgzNDMxMDExIC0wLjY3Mjk0MiwtMC42Mjk1MjY1OSAtMS45NTkxMywtMC42Mjk1MjY1OSB6IG0gLTIuMDg5Mzc3LC0xLjU3OTI0MzMgaCAyLjIwMzM0MyBxIDEuODQ1MTY0LDAgMi43NDYwMzksMC4yNjU5MjA3IDAuOTA2MzAxLDAuMjYwNDkzNyAxLjU1MjEwOCwwLjg5MDAyMDMgMC41Njk4MywwLjU0ODEyMjMgMC44NDY2MDUsMS4yNjQ0ODAwNiAwLjI3Njc3NCwwLjcxNjM1NzgxIDAuMjc2Nzc0LDEuNjIyNjU4OTQgMCwwLjkxNzE1NTEgLTAuMjc2Nzc0LDEuNjM4OTM5OSAtMC4yNzY3NzUsMC43MTYzNTc4IC0wLjg0NjYwNSwxLjI2NDQ4IC0wLjY1MTIzNCwwLjYyOTUyNjYgLTEuNTYyOTYyLDAuODk1NDQ3MyAtMC45MTE3MjgsMC4yNjA0OTM3IC0yLjczNTE4NSwwLjI2MDQ5MzcgaCAtMi4yMDMzNDMgeiBtIC04LjE0NTg1NjUsMCBoIDMuNDY3ODIzIHEgMS41NDY2ODE2LDAgMi4zNzE1Nzg1LDAuNjg5MjIzIDAuODMwMzI0LDAuNjgzNzk2MSAwLjgzMDMyNCwxLjk1MzcwMzE0IDAsMS4yNzUzMzM5NyAtMC44MzAzMjQsMS45NjQ1NTcwNiBRIDkuOTg3MTk2MSwyLjI3NDkxNSA4LjQ0MDUxNDUsMi4yNzQ5MTUgSCA3LjA2MjA2ODQgViA1LjA4NjA3NjcgSCA0Ljk3MjY5MTUgWiBtIDIuMDg5Mzc2OSwxLjUxNDExOTkgdiAyLjI2MzAzOTQzIGggMS4xNTU5NDEgcSAwLjYwNzgxODgsMCAwLjkzODg2MjksLTAuMjkzMDU1NDcgMC4zMzEwNDQxLC0wLjI5ODQ4MjQxIDAuMzMxMDQ0MSwtMC44NDExNzc3MiAwLC0wLjU0MjY5NTMxIC0wLjMzMTA0NDEsLTAuODM1NzUwNzQgLTAuMzMxMDQ0MSwtMC4yOTMwNTU1IC0wLjkzODg2MjksLTAuMjkzMDU1NSB6IgovPgo8L3N2Zz4K);
  --jp-icon-python: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iLTEwIC0xMCAxMzEuMTYxMzYxNjk0MzM1OTQgMTMyLjM4ODk5OTkzODk2NDg0Ij4KICA8cGF0aCBjbGFzcz0ianAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjMzA2OTk4IiBkPSJNIDU0LjkxODc4NSw5LjE5Mjc0MjFlLTQgQyA1MC4zMzUxMzIsMC4wMjIyMTcyNyA0NS45NTc4NDYsMC40MTMxMzY5NyA0Mi4xMDYyODUsMS4wOTQ2NjkzIDMwLjc2MDA2OSwzLjA5OTE3MzEgMjguNzAwMDM2LDcuMjk0NzcxNCAyOC43MDAwMzUsMTUuMDMyMTY5IHYgMTAuMjE4NzUgaCAyNi44MTI1IHYgMy40MDYyNSBoIC0yNi44MTI1IC0xMC4wNjI1IGMgLTcuNzkyNDU5LDAgLTE0LjYxNTc1ODgsNC42ODM3MTcgLTE2Ljc0OTk5OTgsMTMuNTkzNzUgLTIuNDYxODE5OTgsMTAuMjEyOTY2IC0yLjU3MTAxNTA4LDE2LjU4NjAyMyAwLDI3LjI1IDEuOTA1OTI4Myw3LjkzNzg1MiA2LjQ1NzU0MzIsMTMuNTkzNzQ4IDE0LjI0OTk5OTgsMTMuNTkzNzUgaCA5LjIxODc1IHYgLTEyLjI1IGMgMCwtOC44NDk5MDIgNy42NTcxNDQsLTE2LjY1NjI0OCAxNi43NSwtMTYuNjU2MjUgaCAyNi43ODEyNSBjIDcuNDU0OTUxLDAgMTMuNDA2MjUzLC02LjEzODE2NCAxMy40MDYyNSwtMTMuNjI1IHYgLTI1LjUzMTI1IGMgMCwtNy4yNjYzMzg2IC02LjEyOTk4LC0xMi43MjQ3NzcxIC0xMy40MDYyNSwtMTMuOTM3NDk5NyBDIDY0LjI4MTU0OCwwLjMyNzk0Mzk3IDU5LjUwMjQzOCwtMC4wMjAzNzkwMyA1NC45MTg3ODUsOS4xOTI3NDIxZS00IFogbSAtMTQuNSw4LjIxODc1MDEyNTc5IGMgMi43Njk1NDcsMCA1LjAzMTI1LDIuMjk4NjQ1NiA1LjAzMTI1LDUuMTI0OTk5NiAtMmUtNiwyLjgxNjMzNiAtMi4yNjE3MDMsNS4wOTM3NSAtNS4wMzEyNSw1LjA5Mzc1IC0yLjc3OTQ3NiwtMWUtNiAtNS4wMzEyNSwtMi4yNzc0MTUgLTUuMDMxMjUsLTUuMDkzNzUgLTEwZS03LC0yLjgyNjM1MyAyLjI1MTc3NCwtNS4xMjQ5OTk2IDUuMDMxMjUsLTUuMTI0OTk5NiB6Ii8+CiAgPHBhdGggY2xhc3M9ImpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iI2ZmZDQzYiIgZD0ibSA4NS42Mzc1MzUsMjguNjU3MTY5IHYgMTEuOTA2MjUgYyAwLDkuMjMwNzU1IC03LjgyNTg5NSwxNi45OTk5OTkgLTE2Ljc1LDE3IGggLTI2Ljc4MTI1IGMgLTcuMzM1ODMzLDAgLTEzLjQwNjI0OSw2LjI3ODQ4MyAtMTMuNDA2MjUsMTMuNjI1IHYgMjUuNTMxMjQ3IGMgMCw3LjI2NjM0NCA2LjMxODU4OCwxMS41NDAzMjQgMTMuNDA2MjUsMTMuNjI1MDA0IDguNDg3MzMxLDIuNDk1NjEgMTYuNjI2MjM3LDIuOTQ2NjMgMjYuNzgxMjUsMCA2Ljc1MDE1NSwtMS45NTQzOSAxMy40MDYyNTMsLTUuODg3NjEgMTMuNDA2MjUsLTEzLjYyNTAwNCBWIDg2LjUwMDkxOSBoIC0yNi43ODEyNSB2IC0zLjQwNjI1IGggMjYuNzgxMjUgMTMuNDA2MjU0IGMgNy43OTI0NjEsMCAxMC42OTYyNTEsLTUuNDM1NDA4IDEzLjQwNjI0MSwtMTMuNTkzNzUgMi43OTkzMywtOC4zOTg4ODYgMi42ODAyMiwtMTYuNDc1Nzc2IDAsLTI3LjI1IC0xLjkyNTc4LC03Ljc1NzQ0MSAtNS42MDM4NywtMTMuNTkzNzUgLTEzLjQwNjI0MSwtMTMuNTkzNzUgeiBtIC0xNS4wNjI1LDY0LjY1NjI1IGMgMi43Nzk0NzgsM2UtNiA1LjAzMTI1LDIuMjc3NDE3IDUuMDMxMjUsNS4wOTM3NDcgLTJlLTYsMi44MjYzNTQgLTIuMjUxNzc1LDUuMTI1MDA0IC01LjAzMTI1LDUuMTI1MDA0IC0yLjc2OTU1LDAgLTUuMDMxMjUsLTIuMjk4NjUgLTUuMDMxMjUsLTUuMTI1MDA0IDJlLTYsLTIuODE2MzMgMi4yNjE2OTcsLTUuMDkzNzQ3IDUuMDMxMjUsLTUuMDkzNzQ3IHoiLz4KPC9zdmc+Cg==);
  --jp-icon-r-kernel: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8cGF0aCBjbGFzcz0ianAtaWNvbi1jb250cmFzdDMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjMjE5NkYzIiBkPSJNNC40IDIuNWMxLjItLjEgMi45LS4zIDQuOS0uMyAyLjUgMCA0LjEuNCA1LjIgMS4zIDEgLjcgMS41IDEuOSAxLjUgMy41IDAgMi0xLjQgMy41LTIuOSA0LjEgMS4yLjQgMS43IDEuNiAyLjIgMyAuNiAxLjkgMSAzLjkgMS4zIDQuNmgtMy44Yy0uMy0uNC0uOC0xLjctMS4yLTMuN3MtMS4yLTIuNi0yLjYtMi42aC0uOXY2LjRINC40VjIuNXptMy43IDYuOWgxLjRjMS45IDAgMi45LS45IDIuOS0yLjNzLTEtMi4zLTIuOC0yLjNjLS43IDAtMS4zIDAtMS42LjJ2NC41aC4xdi0uMXoiLz4KPC9zdmc+Cg==);
  --jp-icon-react: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMTUwIDE1MCA1NDEuOSAyOTUuMyI+CiAgPGcgY2xhc3M9ImpwLWljb24tYnJhbmQyIGpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iIzYxREFGQiI+CiAgICA8cGF0aCBkPSJNNjY2LjMgMjk2LjVjMC0zMi41LTQwLjctNjMuMy0xMDMuMS04Mi40IDE0LjQtNjMuNiA4LTExNC4yLTIwLjItMTMwLjQtNi41LTMuOC0xNC4xLTUuNi0yMi40LTUuNnYyMi4zYzQuNiAwIDguMy45IDExLjQgMi42IDEzLjYgNy44IDE5LjUgMzcuNSAxNC45IDc1LjctMS4xIDkuNC0yLjkgMTkuMy01LjEgMjkuNC0xOS42LTQuOC00MS04LjUtNjMuNS0xMC45LTEzLjUtMTguNS0yNy41LTM1LjMtNDEuNi01MCAzMi42LTMwLjMgNjMuMi00Ni45IDg0LTQ2LjlWNzhjLTI3LjUgMC02My41IDE5LjYtOTkuOSA1My42LTM2LjQtMzMuOC03Mi40LTUzLjItOTkuOS01My4ydjIyLjNjMjAuNyAwIDUxLjQgMTYuNSA4NCA0Ni42LTE0IDE0LjctMjggMzEuNC00MS4zIDQ5LjktMjIuNiAyLjQtNDQgNi4xLTYzLjYgMTEtMi4zLTEwLTQtMTkuNy01LjItMjktNC43LTM4LjIgMS4xLTY3LjkgMTQuNi03NS44IDMtMS44IDYuOS0yLjYgMTEuNS0yLjZWNzguNWMtOC40IDAtMTYgMS44LTIyLjYgNS42LTI4LjEgMTYuMi0zNC40IDY2LjctMTkuOSAxMzAuMS02Mi4yIDE5LjItMTAyLjcgNDkuOS0xMDIuNyA4Mi4zIDAgMzIuNSA0MC43IDYzLjMgMTAzLjEgODIuNC0xNC40IDYzLjYtOCAxMTQuMiAyMC4yIDEzMC40IDYuNSAzLjggMTQuMSA1LjYgMjIuNSA1LjYgMjcuNSAwIDYzLjUtMTkuNiA5OS45LTUzLjYgMzYuNCAzMy44IDcyLjQgNTMuMiA5OS45IDUzLjIgOC40IDAgMTYtMS44IDIyLjYtNS42IDI4LjEtMTYuMiAzNC40LTY2LjcgMTkuOS0xMzAuMSA2Mi0xOS4xIDEwMi41LTQ5LjkgMTAyLjUtODIuM3ptLTEzMC4yLTY2LjdjLTMuNyAxMi45LTguMyAyNi4yLTEzLjUgMzkuNS00LjEtOC04LjQtMTYtMTMuMS0yNC00LjYtOC05LjUtMTUuOC0xNC40LTIzLjQgMTQuMiAyLjEgMjcuOSA0LjcgNDEgNy45em0tNDUuOCAxMDYuNWMtNy44IDEzLjUtMTUuOCAyNi4zLTI0LjEgMzguMi0xNC45IDEuMy0zMCAyLTQ1LjIgMi0xNS4xIDAtMzAuMi0uNy00NS0xLjktOC4zLTExLjktMTYuNC0yNC42LTI0LjItMzgtNy42LTEzLjEtMTQuNS0yNi40LTIwLjgtMzkuOCA2LjItMTMuNCAxMy4yLTI2LjggMjAuNy0zOS45IDcuOC0xMy41IDE1LjgtMjYuMyAyNC4xLTM4LjIgMTQuOS0xLjMgMzAtMiA0NS4yLTIgMTUuMSAwIDMwLjIuNyA0NSAxLjkgOC4zIDExLjkgMTYuNCAyNC42IDI0LjIgMzggNy42IDEzLjEgMTQuNSAyNi40IDIwLjggMzkuOC02LjMgMTMuNC0xMy4yIDI2LjgtMjAuNyAzOS45em0zMi4zLTEzYzUuNCAxMy40IDEwIDI2LjggMTMuOCAzOS44LTEzLjEgMy4yLTI2LjkgNS45LTQxLjIgOCA0LjktNy43IDkuOC0xNS42IDE0LjQtMjMuNyA0LjYtOCA4LjktMTYuMSAxMy0yNC4xek00MjEuMiA0MzBjLTkuMy05LjYtMTguNi0yMC4zLTI3LjgtMzIgOSAuNCAxOC4yLjcgMjcuNS43IDkuNCAwIDE4LjctLjIgMjcuOC0uNy05IDExLjctMTguMyAyMi40LTI3LjUgMzJ6bS03NC40LTU4LjljLTE0LjItMi4xLTI3LjktNC43LTQxLTcuOSAzLjctMTIuOSA4LjMtMjYuMiAxMy41LTM5LjUgNC4xIDggOC40IDE2IDEzLjEgMjQgNC43IDggOS41IDE1LjggMTQuNCAyMy40ek00MjAuNyAxNjNjOS4zIDkuNiAxOC42IDIwLjMgMjcuOCAzMi05LS40LTE4LjItLjctMjcuNS0uNy05LjQgMC0xOC43LjItMjcuOC43IDktMTEuNyAxOC4zLTIyLjQgMjcuNS0zMnptLTc0IDU4LjljLTQuOSA3LjctOS44IDE1LjYtMTQuNCAyMy43LTQuNiA4LTguOSAxNi0xMyAyNC01LjQtMTMuNC0xMC0yNi44LTEzLjgtMzkuOCAxMy4xLTMuMSAyNi45LTUuOCA0MS4yLTcuOXptLTkwLjUgMTI1LjJjLTM1LjQtMTUuMS01OC4zLTM0LjktNTguMy01MC42IDAtMTUuNyAyMi45LTM1LjYgNTguMy01MC42IDguNi0zLjcgMTgtNyAyNy43LTEwLjEgNS43IDE5LjYgMTMuMiA0MCAyMi41IDYwLjktOS4yIDIwLjgtMTYuNiA0MS4xLTIyLjIgNjAuNi05LjktMy4xLTE5LjMtNi41LTI4LTEwLjJ6TTMxMCA0OTBjLTEzLjYtNy44LTE5LjUtMzcuNS0xNC45LTc1LjcgMS4xLTkuNCAyLjktMTkuMyA1LjEtMjkuNCAxOS42IDQuOCA0MSA4LjUgNjMuNSAxMC45IDEzLjUgMTguNSAyNy41IDM1LjMgNDEuNiA1MC0zMi42IDMwLjMtNjMuMiA0Ni45LTg0IDQ2LjktNC41LS4xLTguMy0xLTExLjMtMi43em0yMzcuMi03Ni4yYzQuNyAzOC4yLTEuMSA2Ny45LTE0LjYgNzUuOC0zIDEuOC02LjkgMi42LTExLjUgMi42LTIwLjcgMC01MS40LTE2LjUtODQtNDYuNiAxNC0xNC43IDI4LTMxLjQgNDEuMy00OS45IDIyLjYtMi40IDQ0LTYuMSA2My42LTExIDIuMyAxMC4xIDQuMSAxOS44IDUuMiAyOS4xem0zOC41LTY2LjdjLTguNiAzLjctMTggNy0yNy43IDEwLjEtNS43LTE5LjYtMTMuMi00MC0yMi41LTYwLjkgOS4yLTIwLjggMTYuNi00MS4xIDIyLjItNjAuNiA5LjkgMy4xIDE5LjMgNi41IDI4LjEgMTAuMiAzNS40IDE1LjEgNTguMyAzNC45IDU4LjMgNTAuNi0uMSAxNS43LTIzIDM1LjYtNTguNCA1MC42ek0zMjAuOCA3OC40eiIvPgogICAgPGNpcmNsZSBjeD0iNDIwLjkiIGN5PSIyOTYuNSIgcj0iNDUuNyIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-redo: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE2Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTE4LjQgMTAuNkMxNi41NSA4Ljk5IDE0LjE1IDggMTEuNSA4Yy00LjY1IDAtOC41OCAzLjAzLTkuOTYgNy4yMkwzLjkgMTZjMS4wNS0zLjE5IDQuMDUtNS41IDcuNi01LjUgMS45NSAwIDMuNzMuNzIgNS4xMiAxLjg4TDEzIDE2aDlWN2wtMy42IDMuNnoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-refresh: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE4IDE4Ij4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTkgMTMuNWMtMi40OSAwLTQuNS0yLjAxLTQuNS00LjVTNi41MSA0LjUgOSA0LjVjMS4yNCAwIDIuMzYuNTIgMy4xNyAxLjMzTDEwIDhoNVYzbC0xLjc2IDEuNzZDMTIuMTUgMy42OCAxMC42NiAzIDkgMyA1LjY5IDMgMy4wMSA1LjY5IDMuMDEgOVM1LjY5IDE1IDkgMTVjMi45NyAwIDUuNDMtMi4xNiA1LjktNWgtMS41MmMtLjQ2IDItMi4yNCAzLjUtNC4zOCAzLjV6Ii8+CiAgICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-regex: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIwIDIwIj4KICA8ZyBjbGFzcz0ianAtaWNvbjIiIGZpbGw9IiM0MTQxNDEiPgogICAgPHJlY3QgeD0iMiIgeT0iMiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+CiAgPC9nPgoKICA8ZyBjbGFzcz0ianAtaWNvbi1hY2NlbnQyIiBmaWxsPSIjRkZGIj4KICAgIDxjaXJjbGUgY2xhc3M9InN0MiIgY3g9IjUuNSIgY3k9IjE0LjUiIHI9IjEuNSIvPgogICAgPHJlY3QgeD0iMTIiIHk9IjQiIGNsYXNzPSJzdDIiIHdpZHRoPSIxIiBoZWlnaHQ9IjgiLz4KICAgIDxyZWN0IHg9IjguNSIgeT0iNy41IiB0cmFuc2Zvcm09Im1hdHJpeCgwLjg2NiAtMC41IDAuNSAwLjg2NiAtMi4zMjU1IDcuMzIxOSkiIGNsYXNzPSJzdDIiIHdpZHRoPSI4IiBoZWlnaHQ9IjEiLz4KICAgIDxyZWN0IHg9IjEyIiB5PSI0IiB0cmFuc2Zvcm09Im1hdHJpeCgwLjUgLTAuODY2IDAuODY2IDAuNSAtMC42Nzc5IDE0LjgyNTIpIiBjbGFzcz0ic3QyIiB3aWR0aD0iMSIgaGVpZ2h0PSI4Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-run: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTggNXYxNGwxMS03eiIvPgogICAgPC9nPgo8L3N2Zz4K);
  --jp-icon-running: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDUxMiA1MTIiPgogIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICA8cGF0aCBkPSJNMjU2IDhDMTE5IDggOCAxMTkgOCAyNTZzMTExIDI0OCAyNDggMjQ4IDI0OC0xMTEgMjQ4LTI0OFMzOTMgOCAyNTYgOHptOTYgMzI4YzAgOC44LTcuMiAxNi0xNiAxNkgxNzZjLTguOCAwLTE2LTcuMi0xNi0xNlYxNzZjMC04LjggNy4yLTE2IDE2LTE2aDE2MGM4LjggMCAxNiA3LjIgMTYgMTZ2MTYweiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-save: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTE3IDNINWMtMS4xMSAwLTIgLjktMiAydjE0YzAgMS4xLjg5IDIgMiAyaDE0YzEuMSAwIDItLjkgMi0yVjdsLTQtNHptLTUgMTZjLTEuNjYgMC0zLTEuMzQtMy0zczEuMzQtMyAzLTMgMyAxLjM0IDMgMy0xLjM0IDMtMyAzem0zLTEwSDVWNWgxMHY0eiIvPgogICAgPC9nPgo8L3N2Zz4K);
  --jp-icon-search: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTggMTgiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTEyLjEsMTAuOWgtMC43bC0wLjItMC4yYzAuOC0wLjksMS4zLTIuMiwxLjMtMy41YzAtMy0yLjQtNS40LTUuNC01LjRTMS44LDQuMiwxLjgsNy4xczIuNCw1LjQsNS40LDUuNCBjMS4zLDAsMi41LTAuNSwzLjUtMS4zbDAuMiwwLjJ2MC43bDQuMSw0LjFsMS4yLTEuMkwxMi4xLDEwLjl6IE03LjEsMTAuOWMtMi4xLDAtMy43LTEuNy0zLjctMy43czEuNy0zLjcsMy43LTMuN3MzLjcsMS43LDMuNywzLjcgUzkuMiwxMC45LDcuMSwxMC45eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-settings: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBkPSJNMTkuNDMgMTIuOThjLjA0LS4zMi4wNy0uNjQuMDctLjk4cy0uMDMtLjY2LS4wNy0uOThsMi4xMS0xLjY1Yy4xOS0uMTUuMjQtLjQyLjEyLS42NGwtMi0zLjQ2Yy0uMTItLjIyLS4zOS0uMy0uNjEtLjIybC0yLjQ5IDFjLS41Mi0uNC0xLjA4LS43My0xLjY5LS45OGwtLjM4LTIuNjVBLjQ4OC40ODggMCAwMDE0IDJoLTRjLS4yNSAwLS40Ni4xOC0uNDkuNDJsLS4zOCAyLjY1Yy0uNjEuMjUtMS4xNy41OS0xLjY5Ljk4bC0yLjQ5LTFjLS4yMy0uMDktLjQ5IDAtLjYxLjIybC0yIDMuNDZjLS4xMy4yMi0uMDcuNDkuMTIuNjRsMi4xMSAxLjY1Yy0uMDQuMzItLjA3LjY1LS4wNy45OHMuMDMuNjYuMDcuOThsLTIuMTEgMS42NWMtLjE5LjE1LS4yNC40Mi0uMTIuNjRsMiAzLjQ2Yy4xMi4yMi4zOS4zLjYxLjIybDIuNDktMWMuNTIuNCAxLjA4LjczIDEuNjkuOThsLjM4IDIuNjVjLjAzLjI0LjI0LjQyLjQ5LjQyaDRjLjI1IDAgLjQ2LS4xOC40OS0uNDJsLjM4LTIuNjVjLjYxLS4yNSAxLjE3LS41OSAxLjY5LS45OGwyLjQ5IDFjLjIzLjA5LjQ5IDAgLjYxLS4yMmwyLTMuNDZjLjEyLS4yMi4wNy0uNDktLjEyLS42NGwtMi4xMS0xLjY1ek0xMiAxNS41Yy0xLjkzIDAtMy41LTEuNTctMy41LTMuNXMxLjU3LTMuNSAzLjUtMy41IDMuNSAxLjU3IDMuNSAzLjUtMS41NyAzLjUtMy41IDMuNXoiLz4KPC9zdmc+Cg==);
  --jp-icon-share: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTSAxOCAyIEMgMTYuMzU0OTkgMiAxNSAzLjM1NDk5MDQgMTUgNSBDIDE1IDUuMTkwOTUyOSAxNS4wMjE3OTEgNS4zNzcxMjI0IDE1LjA1NjY0MSA1LjU1ODU5MzggTCA3LjkyMTg3NSA5LjcyMDcwMzEgQyA3LjM5ODUzOTkgOS4yNzc4NTM5IDYuNzMyMDc3MSA5IDYgOSBDIDQuMzU0OTkwNCA5IDMgMTAuMzU0OTkgMyAxMiBDIDMgMTMuNjQ1MDEgNC4zNTQ5OTA0IDE1IDYgMTUgQyA2LjczMjA3NzEgMTUgNy4zOTg1Mzk5IDE0LjcyMjE0NiA3LjkyMTg3NSAxNC4yNzkyOTcgTCAxNS4wNTY2NDEgMTguNDM5NDUzIEMgMTUuMDIxNTU1IDE4LjYyMTUxNCAxNSAxOC44MDgzODYgMTUgMTkgQyAxNSAyMC42NDUwMSAxNi4zNTQ5OSAyMiAxOCAyMiBDIDE5LjY0NTAxIDIyIDIxIDIwLjY0NTAxIDIxIDE5IEMgMjEgMTcuMzU0OTkgMTkuNjQ1MDEgMTYgMTggMTYgQyAxNy4yNjc0OCAxNiAxNi42MDE1OTMgMTYuMjc5MzI4IDE2LjA3ODEyNSAxNi43MjI2NTYgTCA4Ljk0MzM1OTQgMTIuNTU4NTk0IEMgOC45NzgyMDk1IDEyLjM3NzEyMiA5IDEyLjE5MDk1MyA5IDEyIEMgOSAxMS44MDkwNDcgOC45NzgyMDk1IDExLjYyMjg3OCA4Ljk0MzM1OTQgMTEuNDQxNDA2IEwgMTYuMDc4MTI1IDcuMjc5Mjk2OSBDIDE2LjYwMTQ2IDcuNzIyMTQ2MSAxNy4yNjc5MjMgOCAxOCA4IEMgMTkuNjQ1MDEgOCAyMSA2LjY0NTAwOTYgMjEgNSBDIDIxIDMuMzU0OTkwNCAxOS42NDUwMSAyIDE4IDIgeiBNIDE4IDQgQyAxOC41NjQxMjkgNCAxOSA0LjQzNTg3MDYgMTkgNSBDIDE5IDUuNTY0MTI5NCAxOC41NjQxMjkgNiAxOCA2IEMgMTcuNDM1ODcxIDYgMTcgNS41NjQxMjk0IDE3IDUgQyAxNyA0LjQzNTg3MDYgMTcuNDM1ODcxIDQgMTggNCB6IE0gNiAxMSBDIDYuNTY0MTI5NCAxMSA3IDExLjQzNTg3MSA3IDEyIEMgNyAxMi41NjQxMjkgNi41NjQxMjk0IDEzIDYgMTMgQyA1LjQzNTg3MDYgMTMgNSAxMi41NjQxMjkgNSAxMiBDIDUgMTEuNDM1ODcxIDUuNDM1ODcwNiAxMSA2IDExIHogTSAxOCAxOCBDIDE4LjU2NDEyOSAxOCAxOSAxOC40MzU4NzEgMTkgMTkgQyAxOSAxOS41NjQxMjkgMTguNTY0MTI5IDIwIDE4IDIwIEMgMTcuNDM1ODcxIDIwIDE3IDE5LjU2NDEyOSAxNyAxOSBDIDE3IDE4LjQzNTg3MSAxNy40MzU4NzEgMTggMTggMTggeiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-spreadsheet: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8cGF0aCBjbGFzcz0ianAtaWNvbi1jb250cmFzdDEganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNENBRjUwIiBkPSJNMi4yIDIuMnYxNy42aDE3LjZWMi4ySDIuMnptMTUuNCA3LjdoLTUuNVY0LjRoNS41djUuNXpNOS45IDQuNHY1LjVINC40VjQuNGg1LjV6bS01LjUgNy43aDUuNXY1LjVINC40di01LjV6bTcuNyA1LjV2LTUuNWg1LjV2NS41aC01LjV6Ii8+Cjwvc3ZnPgo=);
  --jp-icon-stop: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgogICAgICAgIDxwYXRoIGQ9Ik02IDZoMTJ2MTJINnoiLz4KICAgIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-tab: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTIxIDNIM2MtMS4xIDAtMiAuOS0yIDJ2MTRjMCAxLjEuOSAyIDIgMmgxOGMxLjEgMCAyLS45IDItMlY1YzAtMS4xLS45LTItMi0yem0wIDE2SDNWNWgxMHY0aDh2MTB6Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-table-rows: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgogICAgICAgIDxwYXRoIGQ9Ik0yMSw4SDNWNGgxOFY4eiBNMjEsMTBIM3Y0aDE4VjEweiBNMjEsMTZIM3Y0aDE4VjE2eiIvPgogICAgPC9nPgo8L3N2Zz4K);
  --jp-icon-tag: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCA0MyAyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CgkJPHBhdGggZD0iTTI4LjgzMzIgMTIuMzM0TDMyLjk5OTggMTYuNTAwN0wzNy4xNjY1IDEyLjMzNEgyOC44MzMyWiIvPgoJCTxwYXRoIGQ9Ik0xNi4yMDk1IDIxLjYxMDRDMTUuNjg3MyAyMi4xMjk5IDE0Ljg0NDMgMjIuMTI5OSAxNC4zMjQ4IDIxLjYxMDRMNi45ODI5IDE0LjcyNDVDNi41NzI0IDE0LjMzOTQgNi4wODMxMyAxMy42MDk4IDYuMDQ3ODYgMTMuMDQ4MkM1Ljk1MzQ3IDExLjUyODggNi4wMjAwMiA4LjYxOTQ0IDYuMDY2MjEgNy4wNzY5NUM2LjA4MjgxIDYuNTE0NzcgNi41NTU0OCA2LjA0MzQ3IDcuMTE4MDQgNi4wMzA1NUM5LjA4ODYzIDUuOTg0NzMgMTMuMjYzOCA1LjkzNTc5IDEzLjY1MTggNi4zMjQyNUwyMS43MzY5IDEzLjYzOUMyMi4yNTYgMTQuMTU4NSAyMS43ODUxIDE1LjQ3MjQgMjEuMjYyIDE1Ljk5NDZMMTYuMjA5NSAyMS42MTA0Wk05Ljc3NTg1IDguMjY1QzkuMzM1NTEgNy44MjU2NiA4LjYyMzUxIDcuODI1NjYgOC4xODI4IDguMjY1QzcuNzQzNDYgOC43MDU3MSA3Ljc0MzQ2IDkuNDE3MzMgOC4xODI4IDkuODU2NjdDOC42MjM4MiAxMC4yOTY0IDkuMzM1ODIgMTAuMjk2NCA5Ljc3NTg1IDkuODU2NjdDMTAuMjE1NiA5LjQxNzMzIDEwLjIxNTYgOC43MDUzMyA5Ljc3NTg1IDguMjY1WiIvPgoJPC9nPgo8L3N2Zz4K);
  --jp-icon-terminal: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0IiA+CiAgICA8cmVjdCBjbGFzcz0ianAtdGVybWluYWwtaWNvbi1iYWNrZ3JvdW5kLWNvbG9yIGpwLWljb24tc2VsZWN0YWJsZSIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyIDIpIiBmaWxsPSIjMzMzMzMzIi8+CiAgICA8cGF0aCBjbGFzcz0ianAtdGVybWluYWwtaWNvbi1jb2xvciBqcC1pY29uLXNlbGVjdGFibGUtaW52ZXJzZSIgZD0iTTUuMDU2NjQgOC43NjE3MkM1LjA1NjY0IDguNTk3NjYgNS4wMzEyNSA4LjQ1MzEyIDQuOTgwNDcgOC4zMjgxMkM0LjkzMzU5IDguMTk5MjIgNC44NTU0NyA4LjA4MjAzIDQuNzQ2MDkgNy45NzY1NkM0LjY0MDYyIDcuODcxMDkgNC41IDcuNzc1MzkgNC4zMjQyMiA3LjY4OTQ1QzQuMTUyMzQgNy41OTk2MSAzLjk0MzM2IDcuNTExNzIgMy42OTcyNyA3LjQyNTc4QzMuMzAyNzMgNy4yODUxNiAyLjk0MzM2IDcuMTM2NzIgMi42MTkxNCA2Ljk4MDQ3QzIuMjk0OTIgNi44MjQyMiAyLjAxNzU4IDYuNjQyNTggMS43ODcxMSA2LjQzNTU1QzEuNTYwNTUgNi4yMjg1MiAxLjM4NDc3IDUuOTg4MjggMS4yNTk3NyA1LjcxNDg0QzEuMTM0NzcgNS40Mzc1IDEuMDcyMjcgNS4xMDkzOCAxLjA3MjI3IDQuNzMwNDdDMS4wNzIyNyA0LjM5ODQ0IDEuMTI4OTEgNC4wOTU3IDEuMjQyMTkgMy44MjIyN0MxLjM1NTQ3IDMuNTQ0OTIgMS41MTU2MiAzLjMwNDY5IDEuNzIyNjYgMy4xMDE1NkMxLjkyOTY5IDIuODk4NDQgMi4xNzk2OSAyLjczNDM3IDIuNDcyNjYgMi42MDkzOEMyLjc2NTYyIDIuNDg0MzggMy4wOTE4IDIuNDA0MyAzLjQ1MTE3IDIuMzY5MTRWMS4xMDkzOEg0LjM4ODY3VjIuMzgwODZDNC43NDAyMyAyLjQyNzczIDUuMDU2NjQgMi41MjM0NCA1LjMzNzg5IDIuNjY3OTdDNS42MTkxNCAyLjgxMjUgNS44NTc0MiAzLjAwMTk1IDYuMDUyNzMgMy4yMzYzM0M2LjI1MTk1IDMuNDY2OCA2LjQwNDMgMy43NDAyMyA2LjUwOTc3IDQuMDU2NjRDNi42MTkxNCA0LjM2OTE0IDYuNjczODMgNC43MjA3IDYuNjczODMgNS4xMTEzM0g1LjA0NDkyQzUuMDQ0OTIgNC42Mzg2NyA0LjkzNzUgNC4yODEyNSA0LjcyMjY2IDQuMDM5MDZDNC41MDc4MSAzLjc5Mjk3IDQuMjE2OCAzLjY2OTkyIDMuODQ5NjEgMy42Njk5MkMzLjY1MDM5IDMuNjY5OTIgMy40NzY1NiAzLjY5NzI3IDMuMzI4MTIgMy43NTE5NUMzLjE4MzU5IDMuODAyNzMgMy4wNjQ0NSAzLjg3Njk1IDIuOTcwNyAzLjk3NDYxQzIuODc2OTUgNC4wNjgzNiAyLjgwNjY0IDQuMTc5NjkgMi43NTk3NyA0LjMwODU5QzIuNzE2OCA0LjQzNzUgMi42OTUzMSA0LjU3ODEyIDIuNjk1MzEgNC43MzA0N0MyLjY5NTMxIDQuODgyODEgMi43MTY4IDUuMDE5NTMgMi43NTk3NyA1LjE0MDYyQzIuODA2NjQgNS4yNTc4MSAyLjg4MjgxIDUuMzY3MTkgMi45ODgyOCA1LjQ2ODc1QzMuMDk3NjYgNS41NzAzMSAzLjI0MDIzIDUuNjY3OTcgMy40MTYwMiA1Ljc2MTcyQzMuNTkxOCA1Ljg1MTU2IDMuODEwNTUgNS45NDMzNiA0LjA3MjI3IDYuMDM3MTFDNC40NjY4IDYuMTg1NTUgNC44MjQyMiA2LjMzOTg0IDUuMTQ0NTMgNi41QzUuNDY0ODQgNi42NTYyNSA1LjczODI4IDYuODM5ODQgNS45NjQ4NCA3LjA1MDc4QzYuMTk1MzEgNy4yNTc4MSA2LjM3MTA5IDcuNSA2LjQ5MjE5IDcuNzc3MzRDNi42MTcxOSA4LjA1MDc4IDYuNjc5NjkgOC4zNzUgNi42Nzk2OSA4Ljc1QzYuNjc5NjkgOS4wOTM3NSA2LjYyMzA1IDkuNDA0MyA2LjUwOTc3IDkuNjgxNjRDNi4zOTY0OCA5Ljk1NTA4IDYuMjM0MzggMTAuMTkxNCA2LjAyMzQ0IDEwLjM5MDZDNS44MTI1IDEwLjU4OTggNS41NTg1OSAxMC43NSA1LjI2MTcyIDEwLjg3MTFDNC45NjQ4NCAxMC45ODgzIDQuNjMyODEgMTEuMDY0NSA0LjI2NTYyIDExLjA5OTZWMTIuMjQ4SDMuMzMzOThWMTEuMDk5NkMzLjAwMTk1IDExLjA2ODQgMi42Nzk2OSAxMC45OTYxIDIuMzY3MTkgMTAuODgyOEMyLjA1NDY5IDEwLjc2NTYgMS43NzczNCAxMC41OTc3IDEuNTM1MTYgMTAuMzc4OUMxLjI5Njg4IDEwLjE2MDIgMS4xMDU0NyA5Ljg4NDc3IDAuOTYwOTM4IDkuNTUyNzNDMC44MTY0MDYgOS4yMTY4IDAuNzQ0MTQxIDguODE0NDUgMC43NDQxNDEgOC4zNDU3SDIuMzc4OTFDMi4zNzg5MSA4LjYyNjk1IDIuNDE5OTIgOC44NjMyOCAyLjUwMTk1IDkuMDU0NjlDMi41ODM5OCA5LjI0MjE5IDIuNjg5NDUgOS4zOTI1OCAyLjgxODM2IDkuNTA1ODZDMi45NTExNyA5LjYxNTIzIDMuMTAxNTYgOS42OTMzNiAzLjI2OTUzIDkuNzQwMjNDMy40Mzc1IDkuNzg3MTEgMy42MDkzOCA5LjgxMDU1IDMuNzg1MTYgOS44MTA1NUM0LjIwMzEyIDkuODEwNTUgNC41MTk1MyA5LjcxMjg5IDQuNzM0MzggOS41MTc1OEM0Ljk0OTIyIDkuMzIyMjcgNS4wNTY2NCA5LjA3MDMxIDUuMDU2NjQgOC43NjE3MlpNMTMuNDE4IDEyLjI3MTVIOC4wNzQyMlYxMUgxMy40MThWMTIuMjcxNVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMuOTUyNjQgNikiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=);
  --jp-icon-text-editor: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBjbGFzcz0ianAtdGV4dC1lZGl0b3ItaWNvbi1jb2xvciBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiM2MTYxNjEiIGQ9Ik0xNSAxNUgzdjJoMTJ2LTJ6bTAtOEgzdjJoMTJWN3pNMyAxM2gxOHYtMkgzdjJ6bTAgOGgxOHYtMkgzdjJ6TTMgM3YyaDE4VjNIM3oiLz4KPC9zdmc+Cg==);
  --jp-icon-toc: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIj4KICAgIDxwYXRoIGQ9Ik03LDVIMjFWN0g3VjVNNywxM1YxMUgyMVYxM0g3TTQsNC41QTEuNSwxLjUgMCAwLDEgNS41LDZBMS41LDEuNSAwIDAsMSA0LDcuNUExLjUsMS41IDAgMCwxIDIuNSw2QTEuNSwxLjUgMCAwLDEgNCw0LjVNNCwxMC41QTEuNSwxLjUgMCAwLDEgNS41LDEyQTEuNSwxLjUgMCAwLDEgNCwxMy41QTEuNSwxLjUgMCAwLDEgMi41LDEyQTEuNSwxLjUgMCAwLDEgNCwxMC41TTcsMTlWMTdIMjFWMTlIN000LDE2LjVBMS41LDEuNSAwIDAsMSA1LjUsMThBMS41LDEuNSAwIDAsMSA0LDE5LjVBMS41LDEuNSAwIDAsMSAyLjUsMThBMS41LDEuNSAwIDAsMSA0LDE2LjVaIiAvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-tree-view: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgogICAgICAgIDxwYXRoIGQ9Ik0yMiAxMVYzaC03djNIOVYzSDJ2OGg3VjhoMnYxMGg0djNoN3YtOGgtN3YzaC0yVjhoMnYzeiIvPgogICAgPC9nPgo8L3N2Zz4K);
  --jp-icon-trusted: url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI1Ij4KICAgIDxwYXRoIGNsYXNzPSJqcC1pY29uMiIgc3Ryb2tlPSIjMzMzMzMzIiBzdHJva2Utd2lkdGg9IjIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIgMykiIGQ9Ik0xLjg2MDk0IDExLjQ0MDlDMC44MjY0NDggOC43NzAyNyAwLjg2Mzc3OSA2LjA1NzY0IDEuMjQ5MDcgNC4xOTkzMkMyLjQ4MjA2IDMuOTMzNDcgNC4wODA2OCAzLjQwMzQ3IDUuNjAxMDIgMi44NDQ5QzcuMjM1NDkgMi4yNDQ0IDguODU2NjYgMS41ODE1IDkuOTg3NiAxLjA5NTM5QzExLjA1OTcgMS41ODM0MSAxMi42MDk0IDIuMjQ0NCAxNC4yMTggMi44NDMzOUMxNS43NTAzIDMuNDEzOTQgMTcuMzk5NSAzLjk1MjU4IDE4Ljc1MzkgNC4yMTM4NUMxOS4xMzY0IDYuMDcxNzcgMTkuMTcwOSA4Ljc3NzIyIDE4LjEzOSAxMS40NDA5QzE3LjAzMDMgMTQuMzAzMiAxNC42NjY4IDE3LjE4NDQgOS45OTk5OSAxOC45MzU0QzUuMzMzMiAxNy4xODQ0IDIuOTY5NjggMTQuMzAzMiAxLjg2MDk0IDExLjQ0MDlaIi8+CiAgICA8cGF0aCBjbGFzcz0ianAtaWNvbjIiIGZpbGw9IiMzMzMzMzMiIHN0cm9rZT0iIzMzMzMzMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOCA5Ljg2NzE5KSIgZD0iTTIuODYwMTUgNC44NjUzNUwwLjcyNjU0OSAyLjk5OTU5TDAgMy42MzA0NUwyLjg2MDE1IDYuMTMxNTdMOCAwLjYzMDg3Mkw3LjI3ODU3IDBMMi44NjAxNSA0Ljg2NTM1WiIvPgo8L3N2Zz4K);
  --jp-icon-undo: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTEyLjUgOGMtMi42NSAwLTUuMDUuOTktNi45IDIuNkwyIDd2OWg5bC0zLjYyLTMuNjJjMS4zOS0xLjE2IDMuMTYtMS44OCA1LjEyLTEuODggMy41NCAwIDYuNTUgMi4zMSA3LjYgNS41bDIuMzctLjc4QzIxLjA4IDExLjAzIDE3LjE1IDggMTIuNSA4eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-user: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTE2IDdhNCA0IDAgMTEtOCAwIDQgNCAwIDAxOCAwek0xMiAxNGE3IDcgMCAwMC03IDdoMTRhNyA3IDAgMDAtNy03eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-users: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDM2IDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogPGcgY2xhc3M9ImpwLWljb24zIiB0cmFuc2Zvcm09Im1hdHJpeCgxLjczMjcgMCAwIDEuNzMyNyAtMy42MjgyIC4wOTk1NzcpIiBmaWxsPSIjNjE2MTYxIj4KICA8cGF0aCB0cmFuc2Zvcm09Im1hdHJpeCgxLjUsMCwwLDEuNSwwLC02KSIgZD0ibTEyLjE4NiA3LjUwOThjLTEuMDUzNSAwLTEuOTc1NyAwLjU2NjUtMi40Nzg1IDEuNDEwMiAwLjc1MDYxIDAuMzEyNzcgMS4zOTc0IDAuODI2NDggMS44NzMgMS40NzI3aDMuNDg2M2MwLTEuNTkyLTEuMjg4OS0yLjg4MjgtMi44ODA5LTIuODgyOHoiLz4KICA8cGF0aCBkPSJtMjAuNDY1IDIuMzg5NWEyLjE4ODUgMi4xODg1IDAgMCAxLTIuMTg4NCAyLjE4ODUgMi4xODg1IDIuMTg4NSAwIDAgMS0yLjE4ODUtMi4xODg1IDIuMTg4NSAyLjE4ODUgMCAwIDEgMi4xODg1LTIuMTg4NSAyLjE4ODUgMi4xODg1IDAgMCAxIDIuMTg4NCAyLjE4ODV6Ii8+CiAgPHBhdGggdHJhbnNmb3JtPSJtYXRyaXgoMS41LDAsMCwxLjUsMCwtNikiIGQ9Im0zLjU4OTggOC40MjE5Yy0xLjExMjYgMC0yLjAxMzcgMC45MDExMS0yLjAxMzcgMi4wMTM3aDIuODE0NWMwLjI2Nzk3LTAuMzczMDkgMC41OTA3LTAuNzA0MzUgMC45NTg5OC0wLjk3ODUyLTAuMzQ0MzMtMC42MTY4OC0xLjAwMzEtMS4wMzUyLTEuNzU5OC0xLjAzNTJ6Ii8+CiAgPHBhdGggZD0ibTYuOTE1NCA0LjYyM2ExLjUyOTQgMS41Mjk0IDAgMCAxLTEuNTI5NCAxLjUyOTQgMS41Mjk0IDEuNTI5NCAwIDAgMS0xLjUyOTQtMS41Mjk0IDEuNTI5NCAxLjUyOTQgMCAwIDEgMS41Mjk0LTEuNTI5NCAxLjUyOTQgMS41Mjk0IDAgMCAxIDEuNTI5NCAxLjUyOTR6Ii8+CiAgPHBhdGggZD0ibTYuMTM1IDEzLjUzNWMwLTMuMjM5MiAyLjYyNTktNS44NjUgNS44NjUtNS44NjUgMy4yMzkyIDAgNS44NjUgMi42MjU5IDUuODY1IDUuODY1eiIvPgogIDxjaXJjbGUgY3g9IjEyIiBjeT0iMy43Njg1IiByPSIyLjk2ODUiLz4KIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-vega: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8ZyBjbGFzcz0ianAtaWNvbjEganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjMjEyMTIxIj4KICAgIDxwYXRoIGQ9Ik0xMC42IDUuNGwyLjItMy4ySDIuMnY3LjNsNC02LjZ6Ii8+CiAgICA8cGF0aCBkPSJNMTUuOCAyLjJsLTQuNCA2LjZMNyA2LjNsLTQuOCA4djUuNWgxNy42VjIuMmgtNHptLTcgMTUuNEg1LjV2LTQuNGgzLjN2NC40em00LjQgMEg5LjhWOS44aDMuNHY3Ljh6bTQuNCAwaC0zLjRWNi41aDMuNHYxMS4xeiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-word: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIwIDIwIj4KIDxnIGNsYXNzPSJqcC1pY29uMiIgZmlsbD0iIzQxNDE0MSI+CiAgPHJlY3QgeD0iMiIgeT0iMiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+CiA8L2c+CiA8ZyBjbGFzcz0ianAtaWNvbi1hY2NlbnQyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSguNDMgLjA0MDEpIiBmaWxsPSIjZmZmIj4KICA8cGF0aCBkPSJtNC4xNCA4Ljc2cTAuMDY4Mi0xLjg5IDIuNDItMS44OSAxLjE2IDAgMS42OCAwLjQyIDAuNTY3IDAuNDEgMC41NjcgMS4xNnYzLjQ3cTAgMC40NjIgMC41MTQgMC40NjIgMC4xMDMgMCAwLjItMC4wMjMxdjAuNzE0cS0wLjM5OSAwLjEwMy0wLjY1MSAwLjEwMy0wLjQ1MiAwLTAuNjkzLTAuMjItMC4yMzEtMC4yLTAuMjg0LTAuNjYyLTAuOTU2IDAuODcyLTIgMC44NzItMC45MDMgMC0xLjQ3LTAuNDcyLTAuNTI1LTAuNDcyLTAuNTI1LTEuMjYgMC0wLjI2MiAwLjA0NTItMC40NzIgMC4wNTY3LTAuMjIgMC4xMTYtMC4zNzggMC4wNjgyLTAuMTY4IDAuMjMxLTAuMzA0IDAuMTU4LTAuMTQ3IDAuMjYyLTAuMjQyIDAuMTE2LTAuMDkxNCAwLjM2OC0wLjE2OCAwLjI2Mi0wLjA5MTQgMC4zOTktMC4xMjYgMC4xMzYtMC4wNDUyIDAuNDcyLTAuMTAzIDAuMzM2LTAuMDU3OCAwLjUwNC0wLjA3OTggMC4xNTgtMC4wMjMxIDAuNTY3LTAuMDc5OCAwLjU1Ni0wLjA2ODIgMC43NzctMC4yMjEgMC4yMi0wLjE1MiAwLjIyLTAuNDQxdi0wLjI1MnEwLTAuNDMtMC4zNTctMC42NjItMC4zMzYtMC4yMzEtMC45NzYtMC4yMzEtMC42NjIgMC0wLjk5OCAwLjI2Mi0wLjMzNiAwLjI1Mi0wLjM5OSAwLjc5OHptMS44OSAzLjY4cTAuNzg4IDAgMS4yNi0wLjQxIDAuNTA0LTAuNDIgMC41MDQtMC45MDN2LTEuMDVxLTAuMjg0IDAuMTM2LTAuODYxIDAuMjMxLTAuNTY3IDAuMDkxNC0wLjk4NyAwLjE1OC0wLjQyIDAuMDY4Mi0wLjc2NiAwLjMyNi0wLjMzNiAwLjI1Mi0wLjMzNiAwLjcwNHQwLjMwNCAwLjcwNCAwLjg2MSAwLjI1MnoiIHN0cm9rZS13aWR0aD0iMS4wNSIvPgogIDxwYXRoIGQ9Im0xMCA0LjU2aDAuOTQ1djMuMTVxMC42NTEtMC45NzYgMS44OS0wLjk3NiAxLjE2IDAgMS44OSAwLjg0IDAuNjgyIDAuODQgMC42ODIgMi4zMSAwIDEuNDctMC43MDQgMi40Mi0wLjcwNCAwLjg4Mi0xLjg5IDAuODgyLTEuMjYgMC0xLjg5LTEuMDJ2MC43NjZoLTAuODV6bTIuNjIgMy4wNHEtMC43NDYgMC0xLjE2IDAuNjQtMC40NTIgMC42My0wLjQ1MiAxLjY4IDAgMS4wNSAwLjQ1MiAxLjY4dDEuMTYgMC42M3EwLjc3NyAwIDEuMjYtMC42MyAwLjQ5NC0wLjY0IDAuNDk0LTEuNjggMC0xLjA1LTAuNDcyLTEuNjgtMC40NjItMC42NC0xLjI2LTAuNjR6IiBzdHJva2Utd2lkdGg9IjEuMDUiLz4KICA8cGF0aCBkPSJtMi43MyAxNS44IDEzLjYgMC4wMDgxYzAuMDA2OSAwIDAtMi42IDAtMi42IDAtMC4wMDc4LTEuMTUgMC0xLjE1IDAtMC4wMDY5IDAtMC4wMDgzIDEuNS0wLjAwODMgMS41LTJlLTMgLTAuMDAxNC0xMS4zLTAuMDAxNC0xMS4zLTAuMDAxNGwtMC4wMDU5Mi0xLjVjMC0wLjAwNzgtMS4xNyAwLjAwMTMtMS4xNyAwLjAwMTN6IiBzdHJva2Utd2lkdGg9Ii45NzUiLz4KIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-yaml: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8ZyBjbGFzcz0ianAtaWNvbi1jb250cmFzdDIganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjRDgxQjYwIj4KICAgIDxwYXRoIGQ9Ik03LjIgMTguNnYtNS40TDMgNS42aDMuM2wxLjQgMy4xYy4zLjkuNiAxLjYgMSAyLjUuMy0uOC42LTEuNiAxLTIuNWwxLjQtMy4xaDMuNGwtNC40IDcuNnY1LjVsLTIuOS0uMXoiLz4KICAgIDxjaXJjbGUgY2xhc3M9InN0MCIgY3g9IjE3LjYiIGN5PSIxNi41IiByPSIyLjEiLz4KICAgIDxjaXJjbGUgY2xhc3M9InN0MCIgY3g9IjE3LjYiIGN5PSIxMSIgcj0iMi4xIi8+CiAgPC9nPgo8L3N2Zz4K);
}

/* Icon CSS class declarations */

.jp-AddAboveIcon {
  background-image: var(--jp-icon-add-above);
}

.jp-AddBelowIcon {
  background-image: var(--jp-icon-add-below);
}

.jp-AddIcon {
  background-image: var(--jp-icon-add);
}

.jp-BellIcon {
  background-image: var(--jp-icon-bell);
}

.jp-BugDotIcon {
  background-image: var(--jp-icon-bug-dot);
}

.jp-BugIcon {
  background-image: var(--jp-icon-bug);
}

.jp-BuildIcon {
  background-image: var(--jp-icon-build);
}

.jp-CaretDownEmptyIcon {
  background-image: var(--jp-icon-caret-down-empty);
}

.jp-CaretDownEmptyThinIcon {
  background-image: var(--jp-icon-caret-down-empty-thin);
}

.jp-CaretDownIcon {
  background-image: var(--jp-icon-caret-down);
}

.jp-CaretLeftIcon {
  background-image: var(--jp-icon-caret-left);
}

.jp-CaretRightIcon {
  background-image: var(--jp-icon-caret-right);
}

.jp-CaretUpEmptyThinIcon {
  background-image: var(--jp-icon-caret-up-empty-thin);
}

.jp-CaretUpIcon {
  background-image: var(--jp-icon-caret-up);
}

.jp-CaseSensitiveIcon {
  background-image: var(--jp-icon-case-sensitive);
}

.jp-CheckIcon {
  background-image: var(--jp-icon-check);
}

.jp-CircleEmptyIcon {
  background-image: var(--jp-icon-circle-empty);
}

.jp-CircleIcon {
  background-image: var(--jp-icon-circle);
}

.jp-ClearIcon {
  background-image: var(--jp-icon-clear);
}

.jp-CloseIcon {
  background-image: var(--jp-icon-close);
}

.jp-CodeCheckIcon {
  background-image: var(--jp-icon-code-check);
}

.jp-CodeIcon {
  background-image: var(--jp-icon-code);
}

.jp-CollapseAllIcon {
  background-image: var(--jp-icon-collapse-all);
}

.jp-ConsoleIcon {
  background-image: var(--jp-icon-console);
}

.jp-CopyIcon {
  background-image: var(--jp-icon-copy);
}

.jp-CopyrightIcon {
  background-image: var(--jp-icon-copyright);
}

.jp-CutIcon {
  background-image: var(--jp-icon-cut);
}

.jp-DeleteIcon {
  background-image: var(--jp-icon-delete);
}

.jp-DownloadIcon {
  background-image: var(--jp-icon-download);
}

.jp-DuplicateIcon {
  background-image: var(--jp-icon-duplicate);
}

.jp-EditIcon {
  background-image: var(--jp-icon-edit);
}

.jp-EllipsesIcon {
  background-image: var(--jp-icon-ellipses);
}

.jp-ErrorIcon {
  background-image: var(--jp-icon-error);
}

.jp-ExpandAllIcon {
  background-image: var(--jp-icon-expand-all);
}

.jp-ExtensionIcon {
  background-image: var(--jp-icon-extension);
}

.jp-FastForwardIcon {
  background-image: var(--jp-icon-fast-forward);
}

.jp-FileIcon {
  background-image: var(--jp-icon-file);
}

.jp-FileUploadIcon {
  background-image: var(--jp-icon-file-upload);
}

.jp-FilterDotIcon {
  background-image: var(--jp-icon-filter-dot);
}

.jp-FilterIcon {
  background-image: var(--jp-icon-filter);
}

.jp-FilterListIcon {
  background-image: var(--jp-icon-filter-list);
}

.jp-FolderFavoriteIcon {
  background-image: var(--jp-icon-folder-favorite);
}

.jp-FolderIcon {
  background-image: var(--jp-icon-folder);
}

.jp-HomeIcon {
  background-image: var(--jp-icon-home);
}

.jp-Html5Icon {
  background-image: var(--jp-icon-html5);
}

.jp-ImageIcon {
  background-image: var(--jp-icon-image);
}

.jp-InfoIcon {
  background-image: var(--jp-icon-info);
}

.jp-InspectorIcon {
  background-image: var(--jp-icon-inspector);
}

.jp-JsonIcon {
  background-image: var(--jp-icon-json);
}

.jp-JuliaIcon {
  background-image: var(--jp-icon-julia);
}

.jp-JupyterFaviconIcon {
  background-image: var(--jp-icon-jupyter-favicon);
}

.jp-JupyterIcon {
  background-image: var(--jp-icon-jupyter);
}

.jp-JupyterlabWordmarkIcon {
  background-image: var(--jp-icon-jupyterlab-wordmark);
}

.jp-KernelIcon {
  background-image: var(--jp-icon-kernel);
}

.jp-KeyboardIcon {
  background-image: var(--jp-icon-keyboard);
}

.jp-LaunchIcon {
  background-image: var(--jp-icon-launch);
}

.jp-LauncherIcon {
  background-image: var(--jp-icon-launcher);
}

.jp-LineFormIcon {
  background-image: var(--jp-icon-line-form);
}

.jp-LinkIcon {
  background-image: var(--jp-icon-link);
}

.jp-ListIcon {
  background-image: var(--jp-icon-list);
}

.jp-MarkdownIcon {
  background-image: var(--jp-icon-markdown);
}

.jp-MoveDownIcon {
  background-image: var(--jp-icon-move-down);
}

.jp-MoveUpIcon {
  background-image: var(--jp-icon-move-up);
}

.jp-NewFolderIcon {
  background-image: var(--jp-icon-new-folder);
}

.jp-NotTrustedIcon {
  background-image: var(--jp-icon-not-trusted);
}

.jp-NotebookIcon {
  background-image: var(--jp-icon-notebook);
}

.jp-NumberingIcon {
  background-image: var(--jp-icon-numbering);
}

.jp-OfflineBoltIcon {
  background-image: var(--jp-icon-offline-bolt);
}

.jp-PaletteIcon {
  background-image: var(--jp-icon-palette);
}

.jp-PasteIcon {
  background-image: var(--jp-icon-paste);
}

.jp-PdfIcon {
  background-image: var(--jp-icon-pdf);
}

.jp-PythonIcon {
  background-image: var(--jp-icon-python);
}

.jp-RKernelIcon {
  background-image: var(--jp-icon-r-kernel);
}

.jp-ReactIcon {
  background-image: var(--jp-icon-react);
}

.jp-RedoIcon {
  background-image: var(--jp-icon-redo);
}

.jp-RefreshIcon {
  background-image: var(--jp-icon-refresh);
}

.jp-RegexIcon {
  background-image: var(--jp-icon-regex);
}

.jp-RunIcon {
  background-image: var(--jp-icon-run);
}

.jp-RunningIcon {
  background-image: var(--jp-icon-running);
}

.jp-SaveIcon {
  background-image: var(--jp-icon-save);
}

.jp-SearchIcon {
  background-image: var(--jp-icon-search);
}

.jp-SettingsIcon {
  background-image: var(--jp-icon-settings);
}

.jp-ShareIcon {
  background-image: var(--jp-icon-share);
}

.jp-SpreadsheetIcon {
  background-image: var(--jp-icon-spreadsheet);
}

.jp-StopIcon {
  background-image: var(--jp-icon-stop);
}

.jp-TabIcon {
  background-image: var(--jp-icon-tab);
}

.jp-TableRowsIcon {
  background-image: var(--jp-icon-table-rows);
}

.jp-TagIcon {
  background-image: var(--jp-icon-tag);
}

.jp-TerminalIcon {
  background-image: var(--jp-icon-terminal);
}

.jp-TextEditorIcon {
  background-image: var(--jp-icon-text-editor);
}

.jp-TocIcon {
  background-image: var(--jp-icon-toc);
}

.jp-TreeViewIcon {
  background-image: var(--jp-icon-tree-view);
}

.jp-TrustedIcon {
  background-image: var(--jp-icon-trusted);
}

.jp-UndoIcon {
  background-image: var(--jp-icon-undo);
}

.jp-UserIcon {
  background-image: var(--jp-icon-user);
}

.jp-UsersIcon {
  background-image: var(--jp-icon-users);
}

.jp-VegaIcon {
  background-image: var(--jp-icon-vega);
}

.jp-WordIcon {
  background-image: var(--jp-icon-word);
}

.jp-YamlIcon {
  background-image: var(--jp-icon-yaml);
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/**
 * (DEPRECATED) Support for consuming icons as CSS background images
 */

.jp-Icon,
.jp-MaterialIcon {
  background-position: center;
  background-repeat: no-repeat;
  background-size: 16px;
  min-width: 16px;
  min-height: 16px;
}

.jp-Icon-cover {
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
}

/**
 * (DEPRECATED) Support for specific CSS icon sizes
 */

.jp-Icon-16 {
  background-size: 16px;
  min-width: 16px;
  min-height: 16px;
}

.jp-Icon-18 {
  background-size: 18px;
  min-width: 18px;
  min-height: 18px;
}

.jp-Icon-20 {
  background-size: 20px;
  min-width: 20px;
  min-height: 20px;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.lm-TabBar .lm-TabBar-addButton {
  align-items: center;
  display: flex;
  padding: 4px;
  padding-bottom: 5px;
  margin-right: 1px;
  background-color: var(--jp-layout-color2);
}

.lm-TabBar .lm-TabBar-addButton:hover {
  background-color: var(--jp-layout-color1);
}

.lm-DockPanel-tabBar .lm-TabBar-tab {
  width: var(--jp-private-horizontal-tab-width);
}

.lm-DockPanel-tabBar .lm-TabBar-content {
  flex: unset;
}

.lm-DockPanel-tabBar[data-orientation='horizontal'] {
  flex: 1 1 auto;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/**
 * Support for icons as inline SVG HTMLElements
 */

/* recolor the primary elements of an icon */
.jp-icon0[fill] {
  fill: var(--jp-inverse-layout-color0);
}

.jp-icon1[fill] {
  fill: var(--jp-inverse-layout-color1);
}

.jp-icon2[fill] {
  fill: var(--jp-inverse-layout-color2);
}

.jp-icon3[fill] {
  fill: var(--jp-inverse-layout-color3);
}

.jp-icon4[fill] {
  fill: var(--jp-inverse-layout-color4);
}

.jp-icon0[stroke] {
  stroke: var(--jp-inverse-layout-color0);
}

.jp-icon1[stroke] {
  stroke: var(--jp-inverse-layout-color1);
}

.jp-icon2[stroke] {
  stroke: var(--jp-inverse-layout-color2);
}

.jp-icon3[stroke] {
  stroke: var(--jp-inverse-layout-color3);
}

.jp-icon4[stroke] {
  stroke: var(--jp-inverse-layout-color4);
}

/* recolor the accent elements of an icon */
.jp-icon-accent0[fill] {
  fill: var(--jp-layout-color0);
}

.jp-icon-accent1[fill] {
  fill: var(--jp-layout-color1);
}

.jp-icon-accent2[fill] {
  fill: var(--jp-layout-color2);
}

.jp-icon-accent3[fill] {
  fill: var(--jp-layout-color3);
}

.jp-icon-accent4[fill] {
  fill: var(--jp-layout-color4);
}

.jp-icon-accent0[stroke] {
  stroke: var(--jp-layout-color0);
}

.jp-icon-accent1[stroke] {
  stroke: var(--jp-layout-color1);
}

.jp-icon-accent2[stroke] {
  stroke: var(--jp-layout-color2);
}

.jp-icon-accent3[stroke] {
  stroke: var(--jp-layout-color3);
}

.jp-icon-accent4[stroke] {
  stroke: var(--jp-layout-color4);
}

/* set the color of an icon to transparent */
.jp-icon-none[fill] {
  fill: none;
}

.jp-icon-none[stroke] {
  stroke: none;
}

/* brand icon colors. Same for light and dark */
.jp-icon-brand0[fill] {
  fill: var(--jp-brand-color0);
}

.jp-icon-brand1[fill] {
  fill: var(--jp-brand-color1);
}

.jp-icon-brand2[fill] {
  fill: var(--jp-brand-color2);
}

.jp-icon-brand3[fill] {
  fill: var(--jp-brand-color3);
}

.jp-icon-brand4[fill] {
  fill: var(--jp-brand-color4);
}

.jp-icon-brand0[stroke] {
  stroke: var(--jp-brand-color0);
}

.jp-icon-brand1[stroke] {
  stroke: var(--jp-brand-color1);
}

.jp-icon-brand2[stroke] {
  stroke: var(--jp-brand-color2);
}

.jp-icon-brand3[stroke] {
  stroke: var(--jp-brand-color3);
}

.jp-icon-brand4[stroke] {
  stroke: var(--jp-brand-color4);
}

/* warn icon colors. Same for light and dark */
.jp-icon-warn0[fill] {
  fill: var(--jp-warn-color0);
}

.jp-icon-warn1[fill] {
  fill: var(--jp-warn-color1);
}

.jp-icon-warn2[fill] {
  fill: var(--jp-warn-color2);
}

.jp-icon-warn3[fill] {
  fill: var(--jp-warn-color3);
}

.jp-icon-warn0[stroke] {
  stroke: var(--jp-warn-color0);
}

.jp-icon-warn1[stroke] {
  stroke: var(--jp-warn-color1);
}

.jp-icon-warn2[stroke] {
  stroke: var(--jp-warn-color2);
}

.jp-icon-warn3[stroke] {
  stroke: var(--jp-warn-color3);
}

/* icon colors that contrast well with each other and most backgrounds */
.jp-icon-contrast0[fill] {
  fill: var(--jp-icon-contrast-color0);
}

.jp-icon-contrast1[fill] {
  fill: var(--jp-icon-contrast-color1);
}

.jp-icon-contrast2[fill] {
  fill: var(--jp-icon-contrast-color2);
}

.jp-icon-contrast3[fill] {
  fill: var(--jp-icon-contrast-color3);
}

.jp-icon-contrast0[stroke] {
  stroke: var(--jp-icon-contrast-color0);
}

.jp-icon-contrast1[stroke] {
  stroke: var(--jp-icon-contrast-color1);
}

.jp-icon-contrast2[stroke] {
  stroke: var(--jp-icon-contrast-color2);
}

.jp-icon-contrast3[stroke] {
  stroke: var(--jp-icon-contrast-color3);
}

.jp-icon-dot[fill] {
  fill: var(--jp-warn-color0);
}

.jp-jupyter-icon-color[fill] {
  fill: var(--jp-jupyter-icon-color, var(--jp-warn-color0));
}

.jp-notebook-icon-color[fill] {
  fill: var(--jp-notebook-icon-color, var(--jp-warn-color0));
}

.jp-json-icon-color[fill] {
  fill: var(--jp-json-icon-color, var(--jp-warn-color1));
}

.jp-console-icon-color[fill] {
  fill: var(--jp-console-icon-color, white);
}

.jp-console-icon-background-color[fill] {
  fill: var(--jp-console-icon-background-color, var(--jp-brand-color1));
}

.jp-terminal-icon-color[fill] {
  fill: var(--jp-terminal-icon-color, var(--jp-layout-color2));
}

.jp-terminal-icon-background-color[fill] {
  fill: var(
    --jp-terminal-icon-background-color,
    var(--jp-inverse-layout-color2)
  );
}

.jp-text-editor-icon-color[fill] {
  fill: var(--jp-text-editor-icon-color, var(--jp-inverse-layout-color3));
}

.jp-inspector-icon-color[fill] {
  fill: var(--jp-inspector-icon-color, var(--jp-inverse-layout-color3));
}

/* CSS for icons in selected filebrowser listing items */
.jp-DirListing-item.jp-mod-selected .jp-icon-selectable[fill] {
  fill: #fff;
}

.jp-DirListing-item.jp-mod-selected .jp-icon-selectable-inverse[fill] {
  fill: var(--jp-brand-color1);
}

/* stylelint-disable selector-max-class, selector-max-compound-selectors */

/**
* TODO: come up with non css-hack solution for showing the busy icon on top
*  of the close icon
* CSS for complex behavior of close icon of tabs in the main area tabbar
*/
.lm-DockPanel-tabBar
  .lm-TabBar-tab.lm-mod-closable.jp-mod-dirty
  > .lm-TabBar-tabCloseIcon
  > :not(:hover)
  > .jp-icon3[fill] {
  fill: none;
}

.lm-DockPanel-tabBar
  .lm-TabBar-tab.lm-mod-closable.jp-mod-dirty
  > .lm-TabBar-tabCloseIcon
  > :not(:hover)
  > .jp-icon-busy[fill] {
  fill: var(--jp-inverse-layout-color3);
}

/* stylelint-enable selector-max-class, selector-max-compound-selectors */

/* CSS for icons in status bar */
#jp-main-statusbar .jp-mod-selected .jp-icon-selectable[fill] {
  fill: #fff;
}

#jp-main-statusbar .jp-mod-selected .jp-icon-selectable-inverse[fill] {
  fill: var(--jp-brand-color1);
}

/* special handling for splash icon CSS. While the theme CSS reloads during
   splash, the splash icon can loose theming. To prevent that, we set a
   default for its color variable */
:root {
  --jp-warn-color0: var(--md-orange-700);
}

/* not sure what to do with this one, used in filebrowser listing */
.jp-DragIcon {
  margin-right: 4px;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/**
 * Support for alt colors for icons as inline SVG HTMLElements
 */

/* alt recolor the primary elements of an icon */
.jp-icon-alt .jp-icon0[fill] {
  fill: var(--jp-layout-color0);
}

.jp-icon-alt .jp-icon1[fill] {
  fill: var(--jp-layout-color1);
}

.jp-icon-alt .jp-icon2[fill] {
  fill: var(--jp-layout-color2);
}

.jp-icon-alt .jp-icon3[fill] {
  fill: var(--jp-layout-color3);
}

.jp-icon-alt .jp-icon4[fill] {
  fill: var(--jp-layout-color4);
}

.jp-icon-alt .jp-icon0[stroke] {
  stroke: var(--jp-layout-color0);
}

.jp-icon-alt .jp-icon1[stroke] {
  stroke: var(--jp-layout-color1);
}

.jp-icon-alt .jp-icon2[stroke] {
  stroke: var(--jp-layout-color2);
}

.jp-icon-alt .jp-icon3[stroke] {
  stroke: var(--jp-layout-color3);
}

.jp-icon-alt .jp-icon4[stroke] {
  stroke: var(--jp-layout-color4);
}

/* alt recolor the accent elements of an icon */
.jp-icon-alt .jp-icon-accent0[fill] {
  fill: var(--jp-inverse-layout-color0);
}

.jp-icon-alt .jp-icon-accent1[fill] {
  fill: var(--jp-inverse-layout-color1);
}

.jp-icon-alt .jp-icon-accent2[fill] {
  fill: var(--jp-inverse-layout-color2);
}

.jp-icon-alt .jp-icon-accent3[fill] {
  fill: var(--jp-inverse-layout-color3);
}

.jp-icon-alt .jp-icon-accent4[fill] {
  fill: var(--jp-inverse-layout-color4);
}

.jp-icon-alt .jp-icon-accent0[stroke] {
  stroke: var(--jp-inverse-layout-color0);
}

.jp-icon-alt .jp-icon-accent1[stroke] {
  stroke: var(--jp-inverse-layout-color1);
}

.jp-icon-alt .jp-icon-accent2[stroke] {
  stroke: var(--jp-inverse-layout-color2);
}

.jp-icon-alt .jp-icon-accent3[stroke] {
  stroke: var(--jp-inverse-layout-color3);
}

.jp-icon-alt .jp-icon-accent4[stroke] {
  stroke: var(--jp-inverse-layout-color4);
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-icon-hoverShow:not(:hover) .jp-icon-hoverShow-content {
  display: none !important;
}

/**
 * Support for hover colors for icons as inline SVG HTMLElements
 */

/**
 * regular colors
 */

/* recolor the primary elements of an icon */
.jp-icon-hover :hover .jp-icon0-hover[fill] {
  fill: var(--jp-inverse-layout-color0);
}

.jp-icon-hover :hover .jp-icon1-hover[fill] {
  fill: var(--jp-inverse-layout-color1);
}

.jp-icon-hover :hover .jp-icon2-hover[fill] {
  fill: var(--jp-inverse-layout-color2);
}

.jp-icon-hover :hover .jp-icon3-hover[fill] {
  fill: var(--jp-inverse-layout-color3);
}

.jp-icon-hover :hover .jp-icon4-hover[fill] {
  fill: var(--jp-inverse-layout-color4);
}

.jp-icon-hover :hover .jp-icon0-hover[stroke] {
  stroke: var(--jp-inverse-layout-color0);
}

.jp-icon-hover :hover .jp-icon1-hover[stroke] {
  stroke: var(--jp-inverse-layout-color1);
}

.jp-icon-hover :hover .jp-icon2-hover[stroke] {
  stroke: var(--jp-inverse-layout-color2);
}

.jp-icon-hover :hover .jp-icon3-hover[stroke] {
  stroke: var(--jp-inverse-layout-color3);
}

.jp-icon-hover :hover .jp-icon4-hover[stroke] {
  stroke: var(--jp-inverse-layout-color4);
}

/* recolor the accent elements of an icon */
.jp-icon-hover :hover .jp-icon-accent0-hover[fill] {
  fill: var(--jp-layout-color0);
}

.jp-icon-hover :hover .jp-icon-accent1-hover[fill] {
  fill: var(--jp-layout-color1);
}

.jp-icon-hover :hover .jp-icon-accent2-hover[fill] {
  fill: var(--jp-layout-color2);
}

.jp-icon-hover :hover .jp-icon-accent3-hover[fill] {
  fill: var(--jp-layout-color3);
}

.jp-icon-hover :hover .jp-icon-accent4-hover[fill] {
  fill: var(--jp-layout-color4);
}

.jp-icon-hover :hover .jp-icon-accent0-hover[stroke] {
  stroke: var(--jp-layout-color0);
}

.jp-icon-hover :hover .jp-icon-accent1-hover[stroke] {
  stroke: var(--jp-layout-color1);
}

.jp-icon-hover :hover .jp-icon-accent2-hover[stroke] {
  stroke: var(--jp-layout-color2);
}

.jp-icon-hover :hover .jp-icon-accent3-hover[stroke] {
  stroke: var(--jp-layout-color3);
}

.jp-icon-hover :hover .jp-icon-accent4-hover[stroke] {
  stroke: var(--jp-layout-color4);
}

/* set the color of an icon to transparent */
.jp-icon-hover :hover .jp-icon-none-hover[fill] {
  fill: none;
}

.jp-icon-hover :hover .jp-icon-none-hover[stroke] {
  stroke: none;
}

/**
 * inverse colors
 */

/* inverse recolor the primary elements of an icon */
.jp-icon-hover.jp-icon-alt :hover .jp-icon0-hover[fill] {
  fill: var(--jp-layout-color0);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon1-hover[fill] {
  fill: var(--jp-layout-color1);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon2-hover[fill] {
  fill: var(--jp-layout-color2);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon3-hover[fill] {
  fill: var(--jp-layout-color3);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon4-hover[fill] {
  fill: var(--jp-layout-color4);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon0-hover[stroke] {
  stroke: var(--jp-layout-color0);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon1-hover[stroke] {
  stroke: var(--jp-layout-color1);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon2-hover[stroke] {
  stroke: var(--jp-layout-color2);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon3-hover[stroke] {
  stroke: var(--jp-layout-color3);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon4-hover[stroke] {
  stroke: var(--jp-layout-color4);
}

/* inverse recolor the accent elements of an icon */
.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent0-hover[fill] {
  fill: var(--jp-inverse-layout-color0);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent1-hover[fill] {
  fill: var(--jp-inverse-layout-color1);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent2-hover[fill] {
  fill: var(--jp-inverse-layout-color2);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent3-hover[fill] {
  fill: var(--jp-inverse-layout-color3);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent4-hover[fill] {
  fill: var(--jp-inverse-layout-color4);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent0-hover[stroke] {
  stroke: var(--jp-inverse-layout-color0);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent1-hover[stroke] {
  stroke: var(--jp-inverse-layout-color1);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent2-hover[stroke] {
  stroke: var(--jp-inverse-layout-color2);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent3-hover[stroke] {
  stroke: var(--jp-inverse-layout-color3);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent4-hover[stroke] {
  stroke: var(--jp-inverse-layout-color4);
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-IFrame {
  width: 100%;
  height: 100%;
}

.jp-IFrame > iframe {
  border: none;
}

/*
When drag events occur, `lm-mod-override-cursor` is added to the body.
Because iframes steal all cursor events, the following two rules are necessary
to suppress pointer events while resize drags are occurring. There may be a
better solution to this problem.
*/
body.lm-mod-override-cursor .jp-IFrame {
  position: relative;
}

body.lm-mod-override-cursor .jp-IFrame::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: transparent;
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2016, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-HoverBox {
  position: fixed;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-FormGroup-content fieldset {
  border: none;
  padding: 0;
  min-width: 0;
  width: 100%;
}

/* stylelint-disable selector-max-type */

.jp-FormGroup-content fieldset .jp-inputFieldWrapper input,
.jp-FormGroup-content fieldset .jp-inputFieldWrapper select,
.jp-FormGroup-content fieldset .jp-inputFieldWrapper textarea {
  font-size: var(--jp-content-font-size2);
  border-color: var(--jp-input-border-color);
  border-style: solid;
  border-radius: var(--jp-border-radius);
  border-width: 1px;
  padding: 6px 8px;
  background: none;
  color: var(--jp-ui-font-color0);
  height: inherit;
}

.jp-FormGroup-content fieldset input[type='checkbox'] {
  position: relative;
  top: 2px;
  margin-left: 0;
}

.jp-FormGroup-content button.jp-mod-styled {
  cursor: pointer;
}

.jp-FormGroup-content .checkbox label {
  cursor: pointer;
  font-size: var(--jp-content-font-size1);
}

.jp-FormGroup-content .jp-root > fieldset > legend {
  display: none;
}

.jp-FormGroup-content .jp-root > fieldset > p {
  display: none;
}

/** copy of `input.jp-mod-styled:focus` style */
.jp-FormGroup-content fieldset input:focus,
.jp-FormGroup-content fieldset select:focus {
  -moz-outline-radius: unset;
  outline: var(--jp-border-width) solid var(--md-blue-500);
  outline-offset: -1px;
  box-shadow: inset 0 0 4px var(--md-blue-300);
}

.jp-FormGroup-content fieldset input:hover:not(:focus),
.jp-FormGroup-content fieldset select:hover:not(:focus) {
  background-color: var(--jp-border-color2);
}

/* stylelint-enable selector-max-type */

.jp-FormGroup-content .checkbox .field-description {
  /* Disable default description field for checkbox:
   because other widgets do not have description fields,
   we add descriptions to each widget on the field level.
  */
  display: none;
}

.jp-FormGroup-content #root__description {
  display: none;
}

.jp-FormGroup-content .jp-modifiedIndicator {
  width: 5px;
  background-color: var(--jp-brand-color2);
  margin-top: 0;
  margin-left: calc(var(--jp-private-settingeditor-modifier-indent) * -1);
  flex-shrink: 0;
}

.jp-FormGroup-content .jp-modifiedIndicator.jp-errorIndicator {
  background-color: var(--jp-error-color0);
  margin-right: 0.5em;
}

/* RJSF ARRAY style */

.jp-arrayFieldWrapper legend {
  font-size: var(--jp-content-font-size2);
  color: var(--jp-ui-font-color0);
  flex-basis: 100%;
  padding: 4px 0;
  font-weight: var(--jp-content-heading-font-weight);
  border-bottom: 1px solid var(--jp-border-color2);
}

.jp-arrayFieldWrapper .field-description {
  padding: 4px 0;
  white-space: pre-wrap;
}

.jp-arrayFieldWrapper .array-item {
  width: 100%;
  border: 1px solid var(--jp-border-color2);
  border-radius: 4px;
  margin: 4px;
}

.jp-ArrayOperations {
  display: flex;
  margin-left: 8px;
}

.jp-ArrayOperationsButton {
  margin: 2px;
}

.jp-ArrayOperationsButton .jp-icon3[fill] {
  fill: var(--jp-ui-font-color0);
}

button.jp-ArrayOperationsButton.jp-mod-styled:disabled {
  cursor: not-allowed;
  opacity: 0.5;
}

/* RJSF form validation error */

.jp-FormGroup-content .validationErrors {
  color: var(--jp-error-color0);
}

/* Hide panel level error as duplicated the field level error */
.jp-FormGroup-content .panel.errors {
  display: none;
}

/* RJSF normal content (settings-editor) */

.jp-FormGroup-contentNormal {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
}

.jp-FormGroup-contentNormal .jp-FormGroup-contentItem {
  margin-left: 7px;
  color: var(--jp-ui-font-color0);
}

.jp-FormGroup-contentNormal .jp-FormGroup-description {
  flex-basis: 100%;
  padding: 4px 7px;
}

.jp-FormGroup-contentNormal .jp-FormGroup-default {
  flex-basis: 100%;
  padding: 4px 7px;
}

.jp-FormGroup-contentNormal .jp-FormGroup-fieldLabel {
  font-size: var(--jp-content-font-size1);
  font-weight: normal;
  min-width: 120px;
}

.jp-FormGroup-contentNormal fieldset:not(:first-child) {
  margin-left: 7px;
}

.jp-FormGroup-contentNormal .field-array-of-string .array-item {
  /* Display `jp-ArrayOperations` buttons side-by-side with content except
    for small screens where flex-wrap will place them one below the other.
  */
  display: flex;
  align-items: center;
  flex-wrap: wrap;
}

.jp-FormGroup-contentNormal .jp-objectFieldWrapper .form-group {
  padding: 2px 8px 2px var(--jp-private-settingeditor-modifier-indent);
  margin-top: 2px;
}

/* RJSF compact content (metadata-form) */

.jp-FormGroup-content.jp-FormGroup-contentCompact {
  width: 100%;
}

.jp-FormGroup-contentCompact .form-group {
  display: flex;
  padding: 0.5em 0.2em 0.5em 0;
}

.jp-FormGroup-contentCompact
  .jp-FormGroup-compactTitle
  .jp-FormGroup-description {
  font-size: var(--jp-ui-font-size1);
  color: var(--jp-ui-font-color2);
}

.jp-FormGroup-contentCompact .jp-FormGroup-fieldLabel {
  padding-bottom: 0.3em;
}

.jp-FormGroup-contentCompact .jp-inputFieldWrapper .form-control {
  width: 100%;
  box-sizing: border-box;
}

.jp-FormGroup-contentCompact .jp-arrayFieldWrapper .jp-FormGroup-compactTitle {
  padding-bottom: 7px;
}

.jp-FormGroup-contentCompact
  .jp-objectFieldWrapper
  .jp-objectFieldWrapper
  .form-group {
  padding: 2px 8px 2px var(--jp-private-settingeditor-modifier-indent);
  margin-top: 2px;
}

.jp-FormGroup-contentCompact ul.error-detail {
  margin-block-start: 0.5em;
  margin-block-end: 0.5em;
  padding-inline-start: 1em;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

.jp-SidePanel {
  display: flex;
  flex-direction: column;
  min-width: var(--jp-sidebar-min-width);
  overflow-y: auto;
  color: var(--jp-ui-font-color1);
  background: var(--jp-layout-color1);
  font-size: var(--jp-ui-font-size1);
}

.jp-SidePanel-header {
  flex: 0 0 auto;
  display: flex;
  border-bottom: var(--jp-border-width) solid var(--jp-border-color2);
  font-size: var(--jp-ui-font-size0);
  font-weight: 600;
  letter-spacing: 1px;
  margin: 0;
  padding: 2px;
  text-transform: uppercase;
}

.jp-SidePanel-toolbar {
  flex: 0 0 auto;
}

.jp-SidePanel-content {
  flex: 1 1 auto;
}

.jp-SidePanel-toolbar,
.jp-AccordionPanel-toolbar {
  height: var(--jp-private-toolbar-height);
}

.jp-SidePanel-toolbar.jp-Toolbar-micro {
  display: none;
}

.lm-AccordionPanel .jp-AccordionPanel-title {
  box-sizing: border-box;
  line-height: 25px;
  margin: 0;
  display: flex;
  align-items: center;
  background: var(--jp-layout-color1);
  color: var(--jp-ui-font-color1);
  border-bottom: var(--jp-border-width) solid var(--jp-toolbar-border-color);
  box-shadow: var(--jp-toolbar-box-shadow);
  font-size: var(--jp-ui-font-size0);
}

.jp-AccordionPanel-title {
  cursor: pointer;
  user-select: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  text-transform: uppercase;
}

.lm-AccordionPanel[data-orientation='horizontal'] > .jp-AccordionPanel-title {
  /* Title is rotated for horizontal accordion panel using CSS */
  display: block;
  transform-origin: top left;
  transform: rotate(-90deg) translate(-100%);
}

.jp-AccordionPanel-title .lm-AccordionPanel-titleLabel {
  user-select: none;
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}

.jp-AccordionPanel-title .lm-AccordionPanel-titleCollapser {
  transform: rotate(-90deg);
  margin: auto 0;
  height: 16px;
}

.jp-AccordionPanel-title.lm-mod-expanded .lm-AccordionPanel-titleCollapser {
  transform: rotate(0deg);
}

.lm-AccordionPanel .jp-AccordionPanel-toolbar {
  background: none;
  box-shadow: none;
  border: none;
  margin-left: auto;
}

.lm-AccordionPanel .lm-SplitPanel-handle:hover {
  background: var(--jp-layout-color3);
}

.jp-text-truncated {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2017, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-Spinner {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: var(--jp-layout-color0);
  outline: none;
}

.jp-SpinnerContent {
  font-size: 10px;
  margin: 50px auto;
  text-indent: -9999em;
  width: 3em;
  height: 3em;
  border-radius: 50%;
  background: var(--jp-brand-color3);
  background: linear-gradient(
    to right,
    #f37626 10%,
    rgba(255, 255, 255, 0) 42%
  );
  position: relative;
  animation: load3 1s infinite linear, fadeIn 1s;
}

.jp-SpinnerContent::before {
  width: 50%;
  height: 50%;
  background: #f37626;
  border-radius: 100% 0 0;
  position: absolute;
  top: 0;
  left: 0;
  content: '';
}

.jp-SpinnerContent::after {
  background: var(--jp-layout-color0);
  width: 75%;
  height: 75%;
  border-radius: 50%;
  content: '';
  margin: auto;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
}

@keyframes fadeIn {
  0% {
    opacity: 0;
  }

  100% {
    opacity: 1;
  }
}

@keyframes load3 {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

button.jp-mod-styled {
  font-size: var(--jp-ui-font-size1);
  color: var(--jp-ui-font-color0);
  border: none;
  box-sizing: border-box;
  text-align: center;
  line-height: 32px;
  height: 32px;
  padding: 0 12px;
  letter-spacing: 0.8px;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
}

input.jp-mod-styled {
  background: var(--jp-input-background);
  height: 28px;
  box-sizing: border-box;
  border: var(--jp-border-width) solid var(--jp-border-color1);
  padding-left: 7px;
  padding-right: 7px;
  font-size: var(--jp-ui-font-size2);
  color: var(--jp-ui-font-color0);
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
}

input[type='checkbox'].jp-mod-styled {
  appearance: checkbox;
  -webkit-appearance: checkbox;
  -moz-appearance: checkbox;
  height: auto;
}

input.jp-mod-styled:focus {
  border: var(--jp-border-width) solid var(--md-blue-500);
  box-shadow: inset 0 0 4px var(--md-blue-300);
}

.jp-select-wrapper {
  display: flex;
  position: relative;
  flex-direction: column;
  padding: 1px;
  background-color: var(--jp-layout-color1);
  box-sizing: border-box;
  margin-bottom: 12px;
}

.jp-select-wrapper:not(.multiple) {
  height: 28px;
}

.jp-select-wrapper.jp-mod-focused select.jp-mod-styled {
  border: var(--jp-border-width) solid var(--jp-input-active-border-color);
  box-shadow: var(--jp-input-box-shadow);
  background-color: var(--jp-input-active-background);
}

select.jp-mod-styled:hover {
  cursor: pointer;
  color: var(--jp-ui-font-color0);
  background-color: var(--jp-input-hover-background);
  box-shadow: inset 0 0 1px rgba(0, 0, 0, 0.5);
}

select.jp-mod-styled {
  flex: 1 1 auto;
  width: 100%;
  font-size: var(--jp-ui-font-size2);
  background: var(--jp-input-background);
  color: var(--jp-ui-font-color0);
  padding: 0 25px 0 8px;
  border: var(--jp-border-width) solid var(--jp-input-border-color);
  border-radius: 0;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
}

select.jp-mod-styled:not([multiple]) {
  height: 32px;
}

select.jp-mod-styled[multiple] {
  max-height: 200px;
  overflow-y: auto;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-switch {
  display: flex;
  align-items: center;
  padding-left: 4px;
  padding-right: 4px;
  font-size: var(--jp-ui-font-size1);
  background-color: transparent;
  color: var(--jp-ui-font-color1);
  border: none;
  height: 20px;
}

.jp-switch:hover {
  background-color: var(--jp-layout-color2);
}

.jp-switch-label {
  margin-right: 5px;
  font-family: var(--jp-ui-font-family);
}

.jp-switch-track {
  cursor: pointer;
  background-color: var(--jp-switch-color, var(--jp-border-color1));
  -webkit-transition: 0.4s;
  transition: 0.4s;
  border-radius: 34px;
  height: 16px;
  width: 35px;
  position: relative;
}

.jp-switch-track::before {
  content: '';
  position: absolute;
  height: 10px;
  width: 10px;
  margin: 3px;
  left: 0;
  background-color: var(--jp-ui-inverse-font-color1);
  -webkit-transition: 0.4s;
  transition: 0.4s;
  border-radius: 50%;
}

.jp-switch[aria-checked='true'] .jp-switch-track {
  background-color: var(--jp-switch-true-position-color, var(--jp-warn-color0));
}

.jp-switch[aria-checked='true'] .jp-switch-track::before {
  /* track width (35) - margins (3 + 3) - thumb width (10) */
  left: 19px;
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2016, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

:root {
  --jp-private-toolbar-height: calc(
    28px + var(--jp-border-width)
  ); /* leave 28px for content */
}

.jp-Toolbar {
  color: var(--jp-ui-font-color1);
  flex: 0 0 auto;
  display: flex;
  flex-direction: row;
  border-bottom: var(--jp-border-width) solid var(--jp-toolbar-border-color);
  box-shadow: var(--jp-toolbar-box-shadow);
  background: var(--jp-toolbar-background);
  min-height: var(--jp-toolbar-micro-height);
  padding: 2px;
  z-index: 8;
  overflow-x: hidden;
}

/* Toolbar items */

.jp-Toolbar > .jp-Toolbar-item.jp-Toolbar-spacer {
  flex-grow: 1;
  flex-shrink: 1;
}

.jp-Toolbar-item.jp-Toolbar-kernelStatus {
  display: inline-block;
  width: 32px;
  background-repeat: no-repeat;
  background-position: center;
  background-size: 16px;
}

.jp-Toolbar > .jp-Toolbar-item {
  flex: 0 0 auto;
  display: flex;
  padding-left: 1px;
  padding-right: 1px;
  font-size: var(--jp-ui-font-size1);
  line-height: var(--jp-private-toolbar-height);
  height: 100%;
}

/* Toolbar buttons */

/* This is the div we use to wrap the react component into a Widget */
div.jp-ToolbarButton {
  color: transparent;
  border: none;
  box-sizing: border-box;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  padding: 0;
  margin: 0;
}

button.jp-ToolbarButtonComponent {
  background: var(--jp-layout-color1);
  border: none;
  box-sizing: border-box;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  padding: 0 6px;
  margin: 0;
  height: 24px;
  border-radius: var(--jp-border-radius);
  display: flex;
  align-items: center;
  text-align: center;
  font-size: 14px;
  min-width: unset;
  min-height: unset;
}

button.jp-ToolbarButtonComponent:disabled {
  opacity: 0.4;
}

button.jp-ToolbarButtonComponent > span {
  padding: 0;
  flex: 0 0 auto;
}

button.jp-ToolbarButtonComponent .jp-ToolbarButtonComponent-label {
  font-size: var(--jp-ui-font-size1);
  line-height: 100%;
  padding-left: 2px;
  color: var(--jp-ui-font-color1);
  font-family: var(--jp-ui-font-family);
}

#jp-main-dock-panel[data-mode='single-document']
  .jp-MainAreaWidget
  > .jp-Toolbar.jp-Toolbar-micro {
  padding: 0;
  min-height: 0;
}

#jp-main-dock-panel[data-mode='single-document']
  .jp-MainAreaWidget
  > .jp-Toolbar {
  border: none;
  box-shadow: none;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

.jp-WindowedPanel-outer {
  position: relative;
  overflow-y: auto;
}

.jp-WindowedPanel-inner {
  position: relative;
}

.jp-WindowedPanel-window {
  position: absolute;
  left: 0;
  right: 0;
  overflow: visible;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/* Sibling imports */

body {
  color: var(--jp-ui-font-color1);
  font-size: var(--jp-ui-font-size1);
}

/* Disable native link decoration styles everywhere outside of dialog boxes */
a {
  text-decoration: unset;
  color: unset;
}

a:hover {
  text-decoration: unset;
  color: unset;
}

/* Accessibility for links inside dialog box text */
.jp-Dialog-content a {
  text-decoration: revert;
  color: var(--jp-content-link-color);
}

.jp-Dialog-content a:hover {
  text-decoration: revert;
}

/* Styles for ui-components */
.jp-Button {
  color: var(--jp-ui-font-color2);
  border-radius: var(--jp-border-radius);
  padding: 0 12px;
  font-size: var(--jp-ui-font-size1);

  /* Copy from blueprint 3 */
  display: inline-flex;
  flex-direction: row;
  border: none;
  cursor: pointer;
  align-items: center;
  justify-content: center;
  text-align: left;
  vertical-align: middle;
  min-height: 30px;
  min-width: 30px;
}

.jp-Button:disabled {
  cursor: not-allowed;
}

.jp-Button:empty {
  padding: 0 !important;
}

.jp-Button.jp-mod-small {
  min-height: 24px;
  min-width: 24px;
  font-size: 12px;
  padding: 0 7px;
}

/* Use our own theme for hover styles */
.jp-Button.jp-mod-minimal:hover {
  background-color: var(--jp-layout-color2);
}

.jp-Button.jp-mod-minimal {
  background: none;
}

.jp-InputGroup {
  display: block;
  position: relative;
}

.jp-InputGroup input {
  box-sizing: border-box;
  border: none;
  border-radius: 0;
  background-color: transparent;
  color: var(--jp-ui-font-color0);
  box-shadow: inset 0 0 0 var(--jp-border-width) var(--jp-input-border-color);
  padding-bottom: 0;
  padding-top: 0;
  padding-left: 10px;
  padding-right: 28px;
  position: relative;
  width: 100%;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  font-size: 14px;
  font-weight: 400;
  height: 30px;
  line-height: 30px;
  outline: none;
  vertical-align: middle;
}

.jp-InputGroup input:focus {
  box-shadow: inset 0 0 0 var(--jp-border-width)
      var(--jp-input-active-box-shadow-color),
    inset 0 0 0 3px var(--jp-input-active-box-shadow-color);
}

.jp-InputGroup input:disabled {
  cursor: not-allowed;
  resize: block;
  background-color: var(--jp-layout-color2);
  color: var(--jp-ui-font-color2);
}

.jp-InputGroup input:disabled ~ span {
  cursor: not-allowed;
  color: var(--jp-ui-font-color2);
}

.jp-InputGroup input::placeholder,
input::placeholder {
  color: var(--jp-ui-font-color2);
}

.jp-InputGroupAction {
  position: absolute;
  bottom: 1px;
  right: 0;
  padding: 6px;
}

.jp-HTMLSelect.jp-DefaultStyle select {
  background-color: initial;
  border: none;
  border-radius: 0;
  box-shadow: none;
  color: var(--jp-ui-font-color0);
  display: block;
  font-size: var(--jp-ui-font-size1);
  font-family: var(--jp-ui-font-family);
  height: 24px;
  line-height: 14px;
  padding: 0 25px 0 10px;
  text-align: left;
  -moz-appearance: none;
  -webkit-appearance: none;
}

.jp-HTMLSelect.jp-DefaultStyle select:disabled {
  background-color: var(--jp-layout-color2);
  color: var(--jp-ui-font-color2);
  cursor: not-allowed;
  resize: block;
}

.jp-HTMLSelect.jp-DefaultStyle select:disabled ~ span {
  cursor: not-allowed;
}

/* Use our own theme for hover and option styles */
/* stylelint-disable-next-line selector-max-type */
.jp-HTMLSelect.jp-DefaultStyle select:hover,
.jp-HTMLSelect.jp-DefaultStyle select > option {
  background-color: var(--jp-layout-color2);
  color: var(--jp-ui-font-color0);
}

select {
  box-sizing: border-box;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Styles
|----------------------------------------------------------------------------*/

.jp-StatusBar-Widget {
  display: flex;
  align-items: center;
  background: var(--jp-layout-color2);
  min-height: var(--jp-statusbar-height);
  justify-content: space-between;
  padding: 0 10px;
}

.jp-StatusBar-Left {
  display: flex;
  align-items: center;
  flex-direction: row;
}

.jp-StatusBar-Middle {
  display: flex;
  align-items: center;
}

.jp-StatusBar-Right {
  display: flex;
  align-items: center;
  flex-direction: row-reverse;
}

.jp-StatusBar-Item {
  max-height: var(--jp-statusbar-height);
  margin: 0 2px;
  height: var(--jp-statusbar-height);
  white-space: nowrap;
  text-overflow: ellipsis;
  color: var(--jp-ui-font-color1);
  padding: 0 6px;
}

.jp-mod-highlighted:hover {
  background-color: var(--jp-layout-color3);
}

.jp-mod-clicked {
  background-color: var(--jp-brand-color1);
}

.jp-mod-clicked:hover {
  background-color: var(--jp-brand-color0);
}

.jp-mod-clicked .jp-StatusBar-TextItem {
  color: var(--jp-ui-inverse-font-color1);
}

.jp-StatusBar-HoverItem {
  box-shadow: '0px 4px 4px rgba(0, 0, 0, 0.25)';
}

.jp-StatusBar-TextItem {
  font-size: var(--jp-ui-font-size1);
  font-family: var(--jp-ui-font-family);
  line-height: 24px;
  color: var(--jp-ui-font-color1);
}

.jp-StatusBar-GroupItem {
  display: flex;
  align-items: center;
  flex-direction: row;
}

.jp-Statusbar-ProgressCircle svg {
  display: block;
  margin: 0 auto;
  width: 16px;
  height: 24px;
  align-self: normal;
}

.jp-Statusbar-ProgressCircle path {
  fill: var(--jp-inverse-layout-color3);
}

.jp-Statusbar-ProgressBar-progress-bar {
  height: 10px;
  width: 100px;
  border: solid 0.25px var(--jp-brand-color2);
  border-radius: 3px;
  overflow: hidden;
  align-self: center;
}

.jp-Statusbar-ProgressBar-progress-bar > div {
  background-color: var(--jp-brand-color2);
  background-image: linear-gradient(
    -45deg,
    rgba(255, 255, 255, 0.2) 25%,
    transparent 25%,
    transparent 50%,
    rgba(255, 255, 255, 0.2) 50%,
    rgba(255, 255, 255, 0.2) 75%,
    transparent 75%,
    transparent
  );
  background-size: 40px 40px;
  float: left;
  width: 0%;
  height: 100%;
  font-size: 12px;
  line-height: 14px;
  color: #fff;
  text-align: center;
  animation: jp-Statusbar-ExecutionTime-progress-bar 2s linear infinite;
}

.jp-Statusbar-ProgressBar-progress-bar p {
  color: var(--jp-ui-font-color1);
  font-family: var(--jp-ui-font-family);
  font-size: var(--jp-ui-font-size1);
  line-height: 10px;
  width: 100px;
}

@keyframes jp-Statusbar-ExecutionTime-progress-bar {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 40px 40px;
  }
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Variables
|----------------------------------------------------------------------------*/

:root {
  --jp-private-commandpalette-search-height: 28px;
}

/*-----------------------------------------------------------------------------
| Overall styles
|----------------------------------------------------------------------------*/

.lm-CommandPalette {
  padding-bottom: 0;
  color: var(--jp-ui-font-color1);
  background: var(--jp-layout-color1);

  /* This is needed so that all font sizing of children done in ems is
   * relative to this base size */
  font-size: var(--jp-ui-font-size1);
}

/*-----------------------------------------------------------------------------
| Modal variant
|----------------------------------------------------------------------------*/

.jp-ModalCommandPalette {
  position: absolute;
  z-index: 10000;
  top: 38px;
  left: 30%;
  margin: 0;
  padding: 4px;
  width: 40%;
  box-shadow: var(--jp-elevation-z4);
  border-radius: 4px;
  background: var(--jp-layout-color0);
}

.jp-ModalCommandPalette .lm-CommandPalette {
  max-height: 40vh;
}

.jp-ModalCommandPalette .lm-CommandPalette .lm-close-icon::after {
  display: none;
}

.jp-ModalCommandPalette .lm-CommandPalette .lm-CommandPalette-header {
  display: none;
}

.jp-ModalCommandPalette .lm-CommandPalette .lm-CommandPalette-item {
  margin-left: 4px;
  margin-right: 4px;
}

.jp-ModalCommandPalette
  .lm-CommandPalette
  .lm-CommandPalette-item.lm-mod-disabled {
  display: none;
}

/*-----------------------------------------------------------------------------
| Search
|----------------------------------------------------------------------------*/

.lm-CommandPalette-search {
  padding: 4px;
  background-color: var(--jp-layout-color1);
  z-index: 2;
}

.lm-CommandPalette-wrapper {
  overflow: overlay;
  padding: 0 9px;
  background-color: var(--jp-input-active-background);
  height: 30px;
  box-shadow: inset 0 0 0 var(--jp-border-width) var(--jp-input-border-color);
}

.lm-CommandPalette.lm-mod-focused .lm-CommandPalette-wrapper {
  box-shadow: inset 0 0 0 1px var(--jp-input-active-box-shadow-color),
    inset 0 0 0 3px var(--jp-input-active-box-shadow-color);
}

.jp-SearchIconGroup {
  color: white;
  background-color: var(--jp-brand-color1);
  position: absolute;
  top: 4px;
  right: 4px;
  padding: 5px 5px 1px;
}

.jp-SearchIconGroup svg {
  height: 20px;
  width: 20px;
}

.jp-SearchIconGroup .jp-icon3[fill] {
  fill: var(--jp-layout-color0);
}

.lm-CommandPalette-input {
  background: transparent;
  width: calc(100% - 18px);
  float: left;
  border: none;
  outline: none;
  font-size: var(--jp-ui-font-size1);
  color: var(--jp-ui-font-color0);
  line-height: var(--jp-private-commandpalette-search-height);
}

.lm-CommandPalette-input::-webkit-input-placeholder,
.lm-CommandPalette-input::-moz-placeholder,
.lm-CommandPalette-input:-ms-input-placeholder {
  color: var(--jp-ui-font-color2);
  font-size: var(--jp-ui-font-size1);
}

/*-----------------------------------------------------------------------------
| Results
|----------------------------------------------------------------------------*/

.lm-CommandPalette-header:first-child {
  margin-top: 0;
}

.lm-CommandPalette-header {
  border-bottom: solid var(--jp-border-width) var(--jp-border-color2);
  color: var(--jp-ui-font-color1);
  cursor: pointer;
  display: flex;
  font-size: var(--jp-ui-font-size0);
  font-weight: 600;
  letter-spacing: 1px;
  margin-top: 8px;
  padding: 8px 0 8px 12px;
  text-transform: uppercase;
}

.lm-CommandPalette-header.lm-mod-active {
  background: var(--jp-layout-color2);
}

.lm-CommandPalette-header > mark {
  background-color: transparent;
  font-weight: bold;
  color: var(--jp-ui-font-color1);
}

.lm-CommandPalette-item {
  padding: 4px 12px 4px 4px;
  color: var(--jp-ui-font-color1);
  font-size: var(--jp-ui-font-size1);
  font-weight: 400;
  display: flex;
}

.lm-CommandPalette-item.lm-mod-disabled {
  color: var(--jp-ui-font-color2);
}

.lm-CommandPalette-item.lm-mod-active {
  color: var(--jp-ui-inverse-font-color1);
  background: var(--jp-brand-color1);
}

.lm-CommandPalette-item.lm-mod-active .lm-CommandPalette-itemLabel > mark {
  color: var(--jp-ui-inverse-font-color0);
}

.lm-CommandPalette-item.lm-mod-active .jp-icon-selectable[fill] {
  fill: var(--jp-layout-color0);
}

.lm-CommandPalette-item.lm-mod-active:hover:not(.lm-mod-disabled) {
  color: var(--jp-ui-inverse-font-color1);
  background: var(--jp-brand-color1);
}

.lm-CommandPalette-item:hover:not(.lm-mod-active):not(.lm-mod-disabled) {
  background: var(--jp-layout-color2);
}

.lm-CommandPalette-itemContent {
  overflow: hidden;
}

.lm-CommandPalette-itemLabel > mark {
  color: var(--jp-ui-font-color0);
  background-color: transparent;
  font-weight: bold;
}

.lm-CommandPalette-item.lm-mod-disabled mark {
  color: var(--jp-ui-font-color2);
}

.lm-CommandPalette-item .lm-CommandPalette-itemIcon {
  margin: 0 4px 0 0;
  position: relative;
  width: 16px;
  top: 2px;
  flex: 0 0 auto;
}

.lm-CommandPalette-item.lm-mod-disabled .lm-CommandPalette-itemIcon {
  opacity: 0.6;
}

.lm-CommandPalette-item .lm-CommandPalette-itemShortcut {
  flex: 0 0 auto;
}

.lm-CommandPalette-itemCaption {
  display: none;
}

.lm-CommandPalette-content {
  background-color: var(--jp-layout-color1);
}

.lm-CommandPalette-content:empty::after {
  content: 'No results';
  margin: auto;
  margin-top: 20px;
  width: 100px;
  display: block;
  font-size: var(--jp-ui-font-size2);
  font-family: var(--jp-ui-font-family);
  font-weight: lighter;
}

.lm-CommandPalette-emptyMessage {
  text-align: center;
  margin-top: 24px;
  line-height: 1.32;
  padding: 0 8px;
  color: var(--jp-content-font-color3);
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-Dialog {
  position: absolute;
  z-index: 10000;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  top: 0;
  left: 0;
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: var(--jp-dialog-background);
}

.jp-Dialog-content {
  display: flex;
  flex-direction: column;
  margin-left: auto;
  margin-right: auto;
  background: var(--jp-layout-color1);
  padding: 24px 24px 12px;
  min-width: 300px;
  min-height: 150px;
  max-width: 1000px;
  max-height: 500px;
  box-sizing: border-box;
  box-shadow: var(--jp-elevation-z20);
  word-wrap: break-word;
  border-radius: var(--jp-border-radius);

  /* This is needed so that all font sizing of children done in ems is
   * relative to this base size */
  font-size: var(--jp-ui-font-size1);
  color: var(--jp-ui-font-color1);
  resize: both;
}

.jp-Dialog-content.jp-Dialog-content-small {
  max-width: 500px;
}

.jp-Dialog-button {
  overflow: visible;
}

button.jp-Dialog-button:focus {
  outline: 1px solid var(--jp-brand-color1);
  outline-offset: 4px;
  -moz-outline-radius: 0;
}

button.jp-Dialog-button:focus::-moz-focus-inner {
  border: 0;
}

button.jp-Dialog-button.jp-mod-styled.jp-mod-accept:focus,
button.jp-Dialog-button.jp-mod-styled.jp-mod-warn:focus,
button.jp-Dialog-button.jp-mod-styled.jp-mod-reject:focus {
  outline-offset: 4px;
  -moz-outline-radius: 0;
}

button.jp-Dialog-button.jp-mod-styled.jp-mod-accept:focus {
  outline: 1px solid var(--jp-accept-color-normal, var(--jp-brand-color1));
}

button.jp-Dialog-button.jp-mod-styled.jp-mod-warn:focus {
  outline: 1px solid var(--jp-warn-color-normal, var(--jp-error-color1));
}

button.jp-Dialog-button.jp-mod-styled.jp-mod-reject:focus {
  outline: 1px solid var(--jp-reject-color-normal, var(--md-grey-600));
}

button.jp-Dialog-close-button {
  padding: 0;
  height: 100%;
  min-width: unset;
  min-height: unset;
}

.jp-Dialog-header {
  display: flex;
  justify-content: space-between;
  flex: 0 0 auto;
  padding-bottom: 12px;
  font-size: var(--jp-ui-font-size3);
  font-weight: 400;
  color: var(--jp-ui-font-color1);
}

.jp-Dialog-body {
  display: flex;
  flex-direction: column;
  flex: 1 1 auto;
  font-size: var(--jp-ui-font-size1);
  background: var(--jp-layout-color1);
  color: var(--jp-ui-font-color1);
  overflow: auto;
}

.jp-Dialog-footer {
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
  align-items: center;
  flex: 0 0 auto;
  margin-left: -12px;
  margin-right: -12px;
  padding: 12px;
}

.jp-Dialog-checkbox {
  padding-right: 5px;
}

.jp-Dialog-checkbox > input:focus-visible {
  outline: 1px solid var(--jp-input-active-border-color);
  outline-offset: 1px;
}

.jp-Dialog-spacer {
  flex: 1 1 auto;
}

.jp-Dialog-title {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

.jp-Dialog-body > .jp-select-wrapper {
  width: 100%;
}

.jp-Dialog-body > button {
  padding: 0 16px;
}

.jp-Dialog-body > label {
  line-height: 1.4;
  color: var(--jp-ui-font-color0);
}

.jp-Dialog-button.jp-mod-styled:not(:last-child) {
  margin-right: 12px;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

.jp-Input-Boolean-Dialog {
  flex-direction: row-reverse;
  align-items: end;
  width: 100%;
}

.jp-Input-Boolean-Dialog > label {
  flex: 1 1 auto;
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2016, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-MainAreaWidget > :focus {
  outline: none;
}

.jp-MainAreaWidget .jp-MainAreaWidget-error {
  padding: 6px;
}

.jp-MainAreaWidget .jp-MainAreaWidget-error > pre {
  width: auto;
  padding: 10px;
  background: var(--jp-error-color3);
  border: var(--jp-border-width) solid var(--jp-error-color1);
  border-radius: var(--jp-border-radius);
  color: var(--jp-ui-font-color1);
  font-size: var(--jp-ui-font-size1);
  white-space: pre-wrap;
  word-wrap: break-word;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/**
 * google-material-color v1.2.6
 * https://github.com/danlevan/google-material-color
 */
:root {
  --md-red-50: #ffebee;
  --md-red-100: #ffcdd2;
  --md-red-200: #ef9a9a;
  --md-red-300: #e57373;
  --md-red-400: #ef5350;
  --md-red-500: #f44336;
  --md-red-600: #e53935;
  --md-red-700: #d32f2f;
  --md-red-800: #c62828;
  --md-red-900: #b71c1c;
  --md-red-A100: #ff8a80;
  --md-red-A200: #ff5252;
  --md-red-A400: #ff1744;
  --md-red-A700: #d50000;
  --md-pink-50: #fce4ec;
  --md-pink-100: #f8bbd0;
  --md-pink-200: #f48fb1;
  --md-pink-300: #f06292;
  --md-pink-400: #ec407a;
  --md-pink-500: #e91e63;
  --md-pink-600: #d81b60;
  --md-pink-700: #c2185b;
  --md-pink-800: #ad1457;
  --md-pink-900: #880e4f;
  --md-pink-A100: #ff80ab;
  --md-pink-A200: #ff4081;
  --md-pink-A400: #f50057;
  --md-pink-A700: #c51162;
  --md-purple-50: #f3e5f5;
  --md-purple-100: #e1bee7;
  --md-purple-200: #ce93d8;
  --md-purple-300: #ba68c8;
  --md-purple-400: #ab47bc;
  --md-purple-500: #9c27b0;
  --md-purple-600: #8e24aa;
  --md-purple-700: #7b1fa2;
  --md-purple-800: #6a1b9a;
  --md-purple-900: #4a148c;
  --md-purple-A100: #ea80fc;
  --md-purple-A200: #e040fb;
  --md-purple-A400: #d500f9;
  --md-purple-A700: #a0f;
  --md-deep-purple-50: #ede7f6;
  --md-deep-purple-100: #d1c4e9;
  --md-deep-purple-200: #b39ddb;
  --md-deep-purple-300: #9575cd;
  --md-deep-purple-400: #7e57c2;
  --md-deep-purple-500: #673ab7;
  --md-deep-purple-600: #5e35b1;
  --md-deep-purple-700: #512da8;
  --md-deep-purple-800: #4527a0;
  --md-deep-purple-900: #311b92;
  --md-deep-purple-A100: #b388ff;
  --md-deep-purple-A200: #7c4dff;
  --md-deep-purple-A400: #651fff;
  --md-deep-purple-A700: #6200ea;
  --md-indigo-50: #e8eaf6;
  --md-indigo-100: #c5cae9;
  --md-indigo-200: #9fa8da;
  --md-indigo-300: #7986cb;
  --md-indigo-400: #5c6bc0;
  --md-indigo-500: #3f51b5;
  --md-indigo-600: #3949ab;
  --md-indigo-700: #303f9f;
  --md-indigo-800: #283593;
  --md-indigo-900: #1a237e;
  --md-indigo-A100: #8c9eff;
  --md-indigo-A200: #536dfe;
  --md-indigo-A400: #3d5afe;
  --md-indigo-A700: #304ffe;
  --md-blue-50: #e3f2fd;
  --md-blue-100: #bbdefb;
  --md-blue-200: #90caf9;
  --md-blue-300: #64b5f6;
  --md-blue-400: #42a5f5;
  --md-blue-500: #2196f3;
  --md-blue-600: #1e88e5;
  --md-blue-700: #1976d2;
  --md-blue-800: #1565c0;
  --md-blue-900: #0d47a1;
  --md-blue-A100: #82b1ff;
  --md-blue-A200: #448aff;
  --md-blue-A400: #2979ff;
  --md-blue-A700: #2962ff;
  --md-light-blue-50: #e1f5fe;
  --md-light-blue-100: #b3e5fc;
  --md-light-blue-200: #81d4fa;
  --md-light-blue-300: #4fc3f7;
  --md-light-blue-400: #29b6f6;
  --md-light-blue-500: #03a9f4;
  --md-light-blue-600: #039be5;
  --md-light-blue-700: #0288d1;
  --md-light-blue-800: #0277bd;
  --md-light-blue-900: #01579b;
  --md-light-blue-A100: #80d8ff;
  --md-light-blue-A200: #40c4ff;
  --md-light-blue-A400: #00b0ff;
  --md-light-blue-A700: #0091ea;
  --md-cyan-50: #e0f7fa;
  --md-cyan-100: #b2ebf2;
  --md-cyan-200: #80deea;
  --md-cyan-300: #4dd0e1;
  --md-cyan-400: #26c6da;
  --md-cyan-500: #00bcd4;
  --md-cyan-600: #00acc1;
  --md-cyan-700: #0097a7;
  --md-cyan-800: #00838f;
  --md-cyan-900: #006064;
  --md-cyan-A100: #84ffff;
  --md-cyan-A200: #18ffff;
  --md-cyan-A400: #00e5ff;
  --md-cyan-A700: #00b8d4;
  --md-teal-50: #e0f2f1;
  --md-teal-100: #b2dfdb;
  --md-teal-200: #80cbc4;
  --md-teal-300: #4db6ac;
  --md-teal-400: #26a69a;
  --md-teal-500: #009688;
  --md-teal-600: #00897b;
  --md-teal-700: #00796b;
  --md-teal-800: #00695c;
  --md-teal-900: #004d40;
  --md-teal-A100: #a7ffeb;
  --md-teal-A200: #64ffda;
  --md-teal-A400: #1de9b6;
  --md-teal-A700: #00bfa5;
  --md-green-50: #e8f5e9;
  --md-green-100: #c8e6c9;
  --md-green-200: #a5d6a7;
  --md-green-300: #81c784;
  --md-green-400: #66bb6a;
  --md-green-500: #4caf50;
  --md-green-600: #43a047;
  --md-green-700: #388e3c;
  --md-green-800: #2e7d32;
  --md-green-900: #1b5e20;
  --md-green-A100: #b9f6ca;
  --md-green-A200: #69f0ae;
  --md-green-A400: #00e676;
  --md-green-A700: #00c853;
  --md-light-green-50: #f1f8e9;
  --md-light-green-100: #dcedc8;
  --md-light-green-200: #c5e1a5;
  --md-light-green-300: #aed581;
  --md-light-green-400: #9ccc65;
  --md-light-green-500: #8bc34a;
  --md-light-green-600: #7cb342;
  --md-light-green-700: #689f38;
  --md-light-green-800: #558b2f;
  --md-light-green-900: #33691e;
  --md-light-green-A100: #ccff90;
  --md-light-green-A200: #b2ff59;
  --md-light-green-A400: #76ff03;
  --md-light-green-A700: #64dd17;
  --md-lime-50: #f9fbe7;
  --md-lime-100: #f0f4c3;
  --md-lime-200: #e6ee9c;
  --md-lime-300: #dce775;
  --md-lime-400: #d4e157;
  --md-lime-500: #cddc39;
  --md-lime-600: #c0ca33;
  --md-lime-700: #afb42b;
  --md-lime-800: #9e9d24;
  --md-lime-900: #827717;
  --md-lime-A100: #f4ff81;
  --md-lime-A200: #eeff41;
  --md-lime-A400: #c6ff00;
  --md-lime-A700: #aeea00;
  --md-yellow-50: #fffde7;
  --md-yellow-100: #fff9c4;
  --md-yellow-200: #fff59d;
  --md-yellow-300: #fff176;
  --md-yellow-400: #ffee58;
  --md-yellow-500: #ffeb3b;
  --md-yellow-600: #fdd835;
  --md-yellow-700: #fbc02d;
  --md-yellow-800: #f9a825;
  --md-yellow-900: #f57f17;
  --md-yellow-A100: #ffff8d;
  --md-yellow-A200: #ff0;
  --md-yellow-A400: #ffea00;
  --md-yellow-A700: #ffd600;
  --md-amber-50: #fff8e1;
  --md-amber-100: #ffecb3;
  --md-amber-200: #ffe082;
  --md-amber-300: #ffd54f;
  --md-amber-400: #ffca28;
  --md-amber-500: #ffc107;
  --md-amber-600: #ffb300;
  --md-amber-700: #ffa000;
  --md-amber-800: #ff8f00;
  --md-amber-900: #ff6f00;
  --md-amber-A100: #ffe57f;
  --md-amber-A200: #ffd740;
  --md-amber-A400: #ffc400;
  --md-amber-A700: #ffab00;
  --md-orange-50: #fff3e0;
  --md-orange-100: #ffe0b2;
  --md-orange-200: #ffcc80;
  --md-orange-300: #ffb74d;
  --md-orange-400: #ffa726;
  --md-orange-500: #ff9800;
  --md-orange-600: #fb8c00;
  --md-orange-700: #f57c00;
  --md-orange-800: #ef6c00;
  --md-orange-900: #e65100;
  --md-orange-A100: #ffd180;
  --md-orange-A200: #ffab40;
  --md-orange-A400: #ff9100;
  --md-orange-A700: #ff6d00;
  --md-deep-orange-50: #fbe9e7;
  --md-deep-orange-100: #ffccbc;
  --md-deep-orange-200: #ffab91;
  --md-deep-orange-300: #ff8a65;
  --md-deep-orange-400: #ff7043;
  --md-deep-orange-500: #ff5722;
  --md-deep-orange-600: #f4511e;
  --md-deep-orange-700: #e64a19;
  --md-deep-orange-800: #d84315;
  --md-deep-orange-900: #bf360c;
  --md-deep-orange-A100: #ff9e80;
  --md-deep-orange-A200: #ff6e40;
  --md-deep-orange-A400: #ff3d00;
  --md-deep-orange-A700: #dd2c00;
  --md-brown-50: #efebe9;
  --md-brown-100: #d7ccc8;
  --md-brown-200: #bcaaa4;
  --md-brown-300: #a1887f;
  --md-brown-400: #8d6e63;
  --md-brown-500: #795548;
  --md-brown-600: #6d4c41;
  --md-brown-700: #5d4037;
  --md-brown-800: #4e342e;
  --md-brown-900: #3e2723;
  --md-grey-50: #fafafa;
  --md-grey-100: #f5f5f5;
  --md-grey-200: #eee;
  --md-grey-300: #e0e0e0;
  --md-grey-400: #bdbdbd;
  --md-grey-500: #9e9e9e;
  --md-grey-600: #757575;
  --md-grey-700: #616161;
  --md-grey-800: #424242;
  --md-grey-900: #212121;
  --md-blue-grey-50: #eceff1;
  --md-blue-grey-100: #cfd8dc;
  --md-blue-grey-200: #b0bec5;
  --md-blue-grey-300: #90a4ae;
  --md-blue-grey-400: #78909c;
  --md-blue-grey-500: #607d8b;
  --md-blue-grey-600: #546e7a;
  --md-blue-grey-700: #455a64;
  --md-blue-grey-800: #37474f;
  --md-blue-grey-900: #263238;
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| RenderedText
|----------------------------------------------------------------------------*/

:root {
  /* This is the padding value to fill the gaps between lines containing spans with background color. */
  --jp-private-code-span-padding: calc(
    (var(--jp-code-line-height) - 1) * var(--jp-code-font-size) / 2
  );
}

.jp-RenderedText {
  text-align: left;
  padding-left: var(--jp-code-padding);
  line-height: var(--jp-code-line-height);
  font-family: var(--jp-code-font-family);
}

.jp-RenderedText pre,
.jp-RenderedJavaScript pre,
.jp-RenderedHTMLCommon pre {
  color: var(--jp-content-font-color1);
  font-size: var(--jp-code-font-size);
  border: none;
  margin: 0;
  padding: 0;
}

.jp-RenderedText pre a:link {
  text-decoration: none;
  color: var(--jp-content-link-color);
}

.jp-RenderedText pre a:hover {
  text-decoration: underline;
  color: var(--jp-content-link-color);
}

.jp-RenderedText pre a:visited {
  text-decoration: none;
  color: var(--jp-content-link-color);
}

/* console foregrounds and backgrounds */
.jp-RenderedText pre .ansi-black-fg {
  color: #3e424d;
}

.jp-RenderedText pre .ansi-red-fg {
  color: #e75c58;
}

.jp-RenderedText pre .ansi-green-fg {
  color: #00a250;
}

.jp-RenderedText pre .ansi-yellow-fg {
  color: #ddb62b;
}

.jp-RenderedText pre .ansi-blue-fg {
  color: #208ffb;
}

.jp-RenderedText pre .ansi-magenta-fg {
  color: #d160c4;
}

.jp-RenderedText pre .ansi-cyan-fg {
  color: #60c6c8;
}

.jp-RenderedText pre .ansi-white-fg {
  color: #c5c1b4;
}

.jp-RenderedText pre .ansi-black-bg {
  background-color: #3e424d;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-red-bg {
  background-color: #e75c58;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-green-bg {
  background-color: #00a250;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-yellow-bg {
  background-color: #ddb62b;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-blue-bg {
  background-color: #208ffb;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-magenta-bg {
  background-color: #d160c4;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-cyan-bg {
  background-color: #60c6c8;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-white-bg {
  background-color: #c5c1b4;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-black-intense-fg {
  color: #282c36;
}

.jp-RenderedText pre .ansi-red-intense-fg {
  color: #b22b31;
}

.jp-RenderedText pre .ansi-green-intense-fg {
  color: #007427;
}

.jp-RenderedText pre .ansi-yellow-intense-fg {
  color: #b27d12;
}

.jp-RenderedText pre .ansi-blue-intense-fg {
  color: #0065ca;
}

.jp-RenderedText pre .ansi-magenta-intense-fg {
  color: #a03196;
}

.jp-RenderedText pre .ansi-cyan-intense-fg {
  color: #258f8f;
}

.jp-RenderedText pre .ansi-white-intense-fg {
  color: #a1a6b2;
}

.jp-RenderedText pre .ansi-black-intense-bg {
  background-color: #282c36;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-red-intense-bg {
  background-color: #b22b31;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-green-intense-bg {
  background-color: #007427;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-yellow-intense-bg {
  background-color: #b27d12;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-blue-intense-bg {
  background-color: #0065ca;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-magenta-intense-bg {
  background-color: #a03196;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-cyan-intense-bg {
  background-color: #258f8f;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-white-intense-bg {
  background-color: #a1a6b2;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-default-inverse-fg {
  color: var(--jp-ui-inverse-font-color0);
}

.jp-RenderedText pre .ansi-default-inverse-bg {
  background-color: var(--jp-inverse-layout-color0);
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-bold {
  font-weight: bold;
}

.jp-RenderedText pre .ansi-underline {
  text-decoration: underline;
}

.jp-RenderedText[data-mime-type='application/vnd.jupyter.stderr'] {
  background: var(--jp-rendermime-error-background);
  padding-top: var(--jp-code-padding);
}

/*-----------------------------------------------------------------------------
| RenderedLatex
|----------------------------------------------------------------------------*/

.jp-RenderedLatex {
  color: var(--jp-content-font-color1);
  font-size: var(--jp-content-font-size1);
  line-height: var(--jp-content-line-height);
}

/* Left-justify outputs.*/
.jp-OutputArea-output.jp-RenderedLatex {
  padding: var(--jp-code-padding);
  text-align: left;
}

/*-----------------------------------------------------------------------------
| RenderedHTML
|----------------------------------------------------------------------------*/

.jp-RenderedHTMLCommon {
  color: var(--jp-content-font-color1);
  font-family: var(--jp-content-font-family);
  font-size: var(--jp-content-font-size1);
  line-height: var(--jp-content-line-height);

  /* Give a bit more R padding on Markdown text to keep line lengths reasonable */
  padding-right: 20px;
}

.jp-RenderedHTMLCommon em {
  font-style: italic;
}

.jp-RenderedHTMLCommon strong {
  font-weight: bold;
}

.jp-RenderedHTMLCommon u {
  text-decoration: underline;
}

.jp-RenderedHTMLCommon a:link {
  text-decoration: none;
  color: var(--jp-content-link-color);
}

.jp-RenderedHTMLCommon a:hover {
  text-decoration: underline;
  color: var(--jp-content-link-color);
}

.jp-RenderedHTMLCommon a:visited {
  text-decoration: none;
  color: var(--jp-content-link-color);
}

/* Headings */

.jp-RenderedHTMLCommon h1,
.jp-RenderedHTMLCommon h2,
.jp-RenderedHTMLCommon h3,
.jp-RenderedHTMLCommon h4,
.jp-RenderedHTMLCommon h5,
.jp-RenderedHTMLCommon h6 {
  line-height: var(--jp-content-heading-line-height);
  font-weight: var(--jp-content-heading-font-weight);
  font-style: normal;
  margin: var(--jp-content-heading-margin-top) 0
    var(--jp-content-heading-margin-bottom) 0;
}

.jp-RenderedHTMLCommon h1:first-child,
.jp-RenderedHTMLCommon h2:first-child,
.jp-RenderedHTMLCommon h3:first-child,
.jp-RenderedHTMLCommon h4:first-child,
.jp-RenderedHTMLCommon h5:first-child,
.jp-RenderedHTMLCommon h6:first-child {
  margin-top: calc(0.5 * var(--jp-content-heading-margin-top));
}

.jp-RenderedHTMLCommon h1:last-child,
.jp-RenderedHTMLCommon h2:last-child,
.jp-RenderedHTMLCommon h3:last-child,
.jp-RenderedHTMLCommon h4:last-child,
.jp-RenderedHTMLCommon h5:last-child,
.jp-RenderedHTMLCommon h6:last-child {
  margin-bottom: calc(0.5 * var(--jp-content-heading-margin-bottom));
}

.jp-RenderedHTMLCommon h1 {
  font-size: var(--jp-content-font-size5);
}

.jp-RenderedHTMLCommon h2 {
  font-size: var(--jp-content-font-size4);
}

.jp-RenderedHTMLCommon h3 {
  font-size: var(--jp-content-font-size3);
}

.jp-RenderedHTMLCommon h4 {
  font-size: var(--jp-content-font-size2);
}

.jp-RenderedHTMLCommon h5 {
  font-size: var(--jp-content-font-size1);
}

.jp-RenderedHTMLCommon h6 {
  font-size: var(--jp-content-font-size0);
}

/* Lists */

/* stylelint-disable selector-max-type, selector-max-compound-selectors */

.jp-RenderedHTMLCommon ul:not(.list-inline),
.jp-RenderedHTMLCommon ol:not(.list-inline) {
  padding-left: 2em;
}

.jp-RenderedHTMLCommon ul {
  list-style: disc;
}

.jp-RenderedHTMLCommon ul ul {
  list-style: square;
}

.jp-RenderedHTMLCommon ul ul ul {
  list-style: circle;
}

.jp-RenderedHTMLCommon ol {
  list-style: decimal;
}

.jp-RenderedHTMLCommon ol ol {
  list-style: upper-alpha;
}

.jp-RenderedHTMLCommon ol ol ol {
  list-style: lower-alpha;
}

.jp-RenderedHTMLCommon ol ol ol ol {
  list-style: lower-roman;
}

.jp-RenderedHTMLCommon ol ol ol ol ol {
  list-style: decimal;
}

.jp-RenderedHTMLCommon ol,
.jp-RenderedHTMLCommon ul {
  margin-bottom: 1em;
}

.jp-RenderedHTMLCommon ul ul,
.jp-RenderedHTMLCommon ul ol,
.jp-RenderedHTMLCommon ol ul,
.jp-RenderedHTMLCommon ol ol {
  margin-bottom: 0;
}

/* stylelint-enable selector-max-type, selector-max-compound-selectors */

.jp-RenderedHTMLCommon hr {
  color: var(--jp-border-color2);
  background-color: var(--jp-border-color1);
  margin-top: 1em;
  margin-bottom: 1em;
}

.jp-RenderedHTMLCommon > pre {
  margin: 1.5em 2em;
}

.jp-RenderedHTMLCommon pre,
.jp-RenderedHTMLCommon code {
  border: 0;
  background-color: var(--jp-layout-color0);
  color: var(--jp-content-font-color1);
  font-family: var(--jp-code-font-family);
  font-size: inherit;
  line-height: var(--jp-code-line-height);
  padding: 0;
  white-space: pre-wrap;
}

.jp-RenderedHTMLCommon :not(pre) > code {
  background-color: var(--jp-layout-color2);
  padding: 1px 5px;
}

/* Tables */

.jp-RenderedHTMLCommon table {
  border-collapse: collapse;
  border-spacing: 0;
  border: none;
  color: var(--jp-ui-font-color1);
  font-size: var(--jp-ui-font-size1);
  table-layout: fixed;
  margin-left: auto;
  margin-bottom: 1em;
  margin-right: auto;
}

.jp-RenderedHTMLCommon thead {
  border-bottom: var(--jp-border-width) solid var(--jp-border-color1);
  vertical-align: bottom;
}

.jp-RenderedHTMLCommon td,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon tr {
  vertical-align: middle;
  padding: 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}

.jp-RenderedMarkdown.jp-RenderedHTMLCommon td,
.jp-RenderedMarkdown.jp-RenderedHTMLCommon th {
  max-width: none;
}

:not(.jp-RenderedMarkdown).jp-RenderedHTMLCommon td,
:not(.jp-RenderedMarkdown).jp-RenderedHTMLCommon th,
:not(.jp-RenderedMarkdown).jp-RenderedHTMLCommon tr {
  text-align: right;
}

.jp-RenderedHTMLCommon th {
  font-weight: bold;
}

.jp-RenderedHTMLCommon tbody tr:nth-child(odd) {
  background: var(--jp-layout-color0);
}

.jp-RenderedHTMLCommon tbody tr:nth-child(even) {
  background: var(--jp-rendermime-table-row-background);
}

.jp-RenderedHTMLCommon tbody tr:hover {
  background: var(--jp-rendermime-table-row-hover-background);
}

.jp-RenderedHTMLCommon p {
  text-align: left;
  margin: 0;
  margin-bottom: 1em;
}

.jp-RenderedHTMLCommon img {
  -moz-force-broken-image-icon: 1;
}

/* Restrict to direct children as other images could be nested in other content. */
.jp-RenderedHTMLCommon > img {
  display: block;
  margin-left: 0;
  margin-right: 0;
  margin-bottom: 1em;
}

/* Change color behind transparent images if they need it... */
[data-jp-theme-light='false'] .jp-RenderedImage img.jp-needs-light-background {
  background-color: var(--jp-inverse-layout-color1);
}

[data-jp-theme-light='true'] .jp-RenderedImage img.jp-needs-dark-background {
  background-color: var(--jp-inverse-layout-color1);
}

.jp-RenderedHTMLCommon img,
.jp-RenderedImage img,
.jp-RenderedHTMLCommon svg,
.jp-RenderedSVG svg {
  max-width: 100%;
  height: auto;
}

.jp-RenderedHTMLCommon img.jp-mod-unconfined,
.jp-RenderedImage img.jp-mod-unconfined,
.jp-RenderedHTMLCommon svg.jp-mod-unconfined,
.jp-RenderedSVG svg.jp-mod-unconfined {
  max-width: none;
}

.jp-RenderedHTMLCommon .alert {
  padding: var(--jp-notebook-padding);
  border: var(--jp-border-width) solid transparent;
  border-radius: var(--jp-border-radius);
  margin-bottom: 1em;
}

.jp-RenderedHTMLCommon .alert-info {
  color: var(--jp-info-color0);
  background-color: var(--jp-info-color3);
  border-color: var(--jp-info-color2);
}

.jp-RenderedHTMLCommon .alert-info hr {
  border-color: var(--jp-info-color3);
}

.jp-RenderedHTMLCommon .alert-info > p:last-child,
.jp-RenderedHTMLCommon .alert-info > ul:last-child {
  margin-bottom: 0;
}

.jp-RenderedHTMLCommon .alert-warning {
  color: var(--jp-warn-color0);
  background-color: var(--jp-warn-color3);
  border-color: var(--jp-warn-color2);
}

.jp-RenderedHTMLCommon .alert-warning hr {
  border-color: var(--jp-warn-color3);
}

.jp-RenderedHTMLCommon .alert-warning > p:last-child,
.jp-RenderedHTMLCommon .alert-warning > ul:last-child {
  margin-bottom: 0;
}

.jp-RenderedHTMLCommon .alert-success {
  color: var(--jp-success-color0);
  background-color: var(--jp-success-color3);
  border-color: var(--jp-success-color2);
}

.jp-RenderedHTMLCommon .alert-success hr {
  border-color: var(--jp-success-color3);
}

.jp-RenderedHTMLCommon .alert-success > p:last-child,
.jp-RenderedHTMLCommon .alert-success > ul:last-child {
  margin-bottom: 0;
}

.jp-RenderedHTMLCommon .alert-danger {
  color: var(--jp-error-color0);
  background-color: var(--jp-error-color3);
  border-color: var(--jp-error-color2);
}

.jp-RenderedHTMLCommon .alert-danger hr {
  border-color: var(--jp-error-color3);
}

.jp-RenderedHTMLCommon .alert-danger > p:last-child,
.jp-RenderedHTMLCommon .alert-danger > ul:last-child {
  margin-bottom: 0;
}

.jp-RenderedHTMLCommon blockquote {
  margin: 1em 2em;
  padding: 0 1em;
  border-left: 5px solid var(--jp-border-color2);
}

a.jp-InternalAnchorLink {
  visibility: hidden;
  margin-left: 8px;
  color: var(--md-blue-800);
}

h1:hover .jp-InternalAnchorLink,
h2:hover .jp-InternalAnchorLink,
h3:hover .jp-InternalAnchorLink,
h4:hover .jp-InternalAnchorLink,
h5:hover .jp-InternalAnchorLink,
h6:hover .jp-InternalAnchorLink {
  visibility: visible;
}

.jp-RenderedHTMLCommon kbd {
  background-color: var(--jp-rendermime-table-row-background);
  border: 1px solid var(--jp-border-color0);
  border-bottom-color: var(--jp-border-color2);
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.25);
  display: inline-block;
  font-size: var(--jp-ui-font-size0);
  line-height: 1em;
  padding: 0.2em 0.5em;
}

/* Most direct children of .jp-RenderedHTMLCommon have a margin-bottom of 1.0.
 * At the bottom of cells this is a bit too much as there is also spacing
 * between cells. Going all the way to 0 gets too tight between markdown and
 * code cells.
 */
.jp-RenderedHTMLCommon > *:last-child {
  margin-bottom: 0.5em;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-cursor-backdrop {
  position: fixed;
  width: 200px;
  height: 200px;
  margin-top: -100px;
  margin-left: -100px;
  will-change: transform;
  z-index: 100;
}

.lm-mod-drag-image {
  will-change: transform;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

.jp-lineFormSearch {
  padding: 4px 12px;
  background-color: var(--jp-layout-color2);
  box-shadow: var(--jp-toolbar-box-shadow);
  z-index: 2;
  font-size: var(--jp-ui-font-size1);
}

.jp-lineFormCaption {
  font-size: var(--jp-ui-font-size0);
  line-height: var(--jp-ui-font-size1);
  margin-top: 4px;
  color: var(--jp-ui-font-color0);
}

.jp-baseLineForm {
  border: none;
  border-radius: 0;
  position: absolute;
  background-size: 16px;
  background-repeat: no-repeat;
  background-position: center;
  outline: none;
}

.jp-lineFormButtonContainer {
  top: 4px;
  right: 8px;
  height: 24px;
  padding: 0 12px;
  width: 12px;
}

.jp-lineFormButtonIcon {
  top: 0;
  right: 0;
  background-color: var(--jp-brand-color1);
  height: 100%;
  width: 100%;
  box-sizing: border-box;
  padding: 4px 6px;
}

.jp-lineFormButton {
  top: 0;
  right: 0;
  background-color: transparent;
  height: 100%;
  width: 100%;
  box-sizing: border-box;
}

.jp-lineFormWrapper {
  overflow: hidden;
  padding: 0 8px;
  border: 1px solid var(--jp-border-color0);
  background-color: var(--jp-input-active-background);
  height: 22px;
}

.jp-lineFormWrapperFocusWithin {
  border: var(--jp-border-width) solid var(--md-blue-500);
  box-shadow: inset 0 0 4px var(--md-blue-300);
}

.jp-lineFormInput {
  background: transparent;
  width: 200px;
  height: 100%;
  border: none;
  outline: none;
  color: var(--jp-ui-font-color0);
  line-height: 28px;
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2016, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-JSONEditor {
  display: flex;
  flex-direction: column;
  width: 100%;
}

.jp-JSONEditor-host {
  flex: 1 1 auto;
  border: var(--jp-border-width) solid var(--jp-input-border-color);
  border-radius: 0;
  background: var(--jp-layout-color0);
  min-height: 50px;
  padding: 1px;
}

.jp-JSONEditor.jp-mod-error .jp-JSONEditor-host {
  border-color: red;
  outline-color: red;
}

.jp-JSONEditor-header {
  display: flex;
  flex: 1 0 auto;
  padding: 0 0 0 12px;
}

.jp-JSONEditor-header label {
  flex: 0 0 auto;
}

.jp-JSONEditor-commitButton {
  height: 16px;
  width: 16px;
  background-size: 18px;
  background-repeat: no-repeat;
  background-position: center;
}

.jp-JSONEditor-host.jp-mod-focused {
  background-color: var(--jp-input-active-background);
  border: 1px solid var(--jp-input-active-border-color);
  box-shadow: var(--jp-input-box-shadow);
}

.jp-Editor.jp-mod-dropTarget {
  border: var(--jp-border-width) solid var(--jp-input-active-border-color);
  box-shadow: var(--jp-input-box-shadow);
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/
.jp-DocumentSearch-input {
  border: none;
  outline: none;
  color: var(--jp-ui-font-color0);
  font-size: var(--jp-ui-font-size1);
  background-color: var(--jp-layout-color0);
  font-family: var(--jp-ui-font-family);
  padding: 2px 1px;
  resize: none;
}

.jp-DocumentSearch-overlay {
  position: absolute;
  background-color: var(--jp-toolbar-background);
  border-bottom: var(--jp-border-width) solid var(--jp-toolbar-border-color);
  border-left: var(--jp-border-width) solid var(--jp-toolbar-border-color);
  top: 0;
  right: 0;
  z-index: 7;
  min-width: 405px;
  padding: 2px;
  font-size: var(--jp-ui-font-size1);

  --jp-private-document-search-button-height: 20px;
}

.jp-DocumentSearch-overlay button {
  background-color: var(--jp-toolbar-background);
  outline: 0;
}

.jp-DocumentSearch-overlay button:hover {
  background-color: var(--jp-layout-color2);
}

.jp-DocumentSearch-overlay button:active {
  background-color: var(--jp-layout-color3);
}

.jp-DocumentSearch-overlay-row {
  display: flex;
  align-items: center;
  margin-bottom: 2px;
}

.jp-DocumentSearch-button-content {
  display: inline-block;
  cursor: pointer;
  box-sizing: border-box;
  width: 100%;
  height: 100%;
}

.jp-DocumentSearch-button-content svg {
  width: 100%;
  height: 100%;
}

.jp-DocumentSearch-input-wrapper {
  border: var(--jp-border-width) solid var(--jp-border-color0);
  display: flex;
  background-color: var(--jp-layout-color0);
  margin: 2px;
}

.jp-DocumentSearch-input-wrapper:focus-within {
  border-color: var(--jp-cell-editor-active-border-color);
}

.jp-DocumentSearch-toggle-wrapper,
.jp-DocumentSearch-button-wrapper {
  all: initial;
  overflow: hidden;
  display: inline-block;
  border: none;
  box-sizing: border-box;
}

.jp-DocumentSearch-toggle-wrapper {
  width: 14px;
  height: 14px;
}

.jp-DocumentSearch-button-wrapper {
  width: var(--jp-private-document-search-button-height);
  height: var(--jp-private-document-search-button-height);
}

.jp-DocumentSearch-toggle-wrapper:focus,
.jp-DocumentSearch-button-wrapper:focus {
  outline: var(--jp-border-width) solid
    var(--jp-cell-editor-active-border-color);
  outline-offset: -1px;
}

.jp-DocumentSearch-toggle-wrapper,
.jp-DocumentSearch-button-wrapper,
.jp-DocumentSearch-button-content:focus {
  outline: none;
}

.jp-DocumentSearch-toggle-placeholder {
  width: 5px;
}

.jp-DocumentSearch-input-button::before {
  display: block;
  padding-top: 100%;
}

.jp-DocumentSearch-input-button-off {
  opacity: var(--jp-search-toggle-off-opacity);
}

.jp-DocumentSearch-input-button-off:hover {
  opacity: var(--jp-search-toggle-hover-opacity);
}

.jp-DocumentSearch-input-button-on {
  opacity: var(--jp-search-toggle-on-opacity);
}

.jp-DocumentSearch-index-counter {
  padding-left: 10px;
  padding-right: 10px;
  user-select: none;
  min-width: 35px;
  display: inline-block;
}

.jp-DocumentSearch-up-down-wrapper {
  display: inline-block;
  padding-right: 2px;
  margin-left: auto;
  white-space: nowrap;
}

.jp-DocumentSearch-spacer {
  margin-left: auto;
}

.jp-DocumentSearch-up-down-wrapper button {
  outline: 0;
  border: none;
  width: var(--jp-private-document-search-button-height);
  height: var(--jp-private-document-search-button-height);
  vertical-align: middle;
  margin: 1px 5px 2px;
}

.jp-DocumentSearch-up-down-button:hover {
  background-color: var(--jp-layout-color2);
}

.jp-DocumentSearch-up-down-button:active {
  background-color: var(--jp-layout-color3);
}

.jp-DocumentSearch-filter-button {
  border-radius: var(--jp-border-radius);
}

.jp-DocumentSearch-filter-button:hover {
  background-color: var(--jp-layout-color2);
}

.jp-DocumentSearch-filter-button-enabled {
  background-color: var(--jp-layout-color2);
}

.jp-DocumentSearch-filter-button-enabled:hover {
  background-color: var(--jp-layout-color3);
}

.jp-DocumentSearch-search-options {
  padding: 0 8px;
  margin-left: 3px;
  width: 100%;
  display: grid;
  justify-content: start;
  grid-template-columns: 1fr 1fr;
  align-items: center;
  justify-items: stretch;
}

.jp-DocumentSearch-search-filter-disabled {
  color: var(--jp-ui-font-color2);
}

.jp-DocumentSearch-search-filter {
  display: flex;
  align-items: center;
  user-select: none;
}

.jp-DocumentSearch-regex-error {
  color: var(--jp-error-color0);
}

.jp-DocumentSearch-replace-button-wrapper {
  overflow: hidden;
  display: inline-block;
  box-sizing: border-box;
  border: var(--jp-border-width) solid var(--jp-border-color0);
  margin: auto 2px;
  padding: 1px 4px;
  height: calc(var(--jp-private-document-search-button-height) + 2px);
}

.jp-DocumentSearch-replace-button-wrapper:focus {
  border: var(--jp-border-width) solid var(--jp-cell-editor-active-border-color);
}

.jp-DocumentSearch-replace-button {
  display: inline-block;
  text-align: center;
  cursor: pointer;
  box-sizing: border-box;
  color: var(--jp-ui-font-color1);

  /* height - 2 * (padding of wrapper) */
  line-height: calc(var(--jp-private-document-search-button-height) - 2px);
  width: 100%;
  height: 100%;
}

.jp-DocumentSearch-replace-button:focus {
  outline: none;
}

.jp-DocumentSearch-replace-wrapper-class {
  margin-left: 14px;
  display: flex;
}

.jp-DocumentSearch-replace-toggle {
  border: none;
  background-color: var(--jp-toolbar-background);
  border-radius: var(--jp-border-radius);
}

.jp-DocumentSearch-replace-toggle:hover {
  background-color: var(--jp-layout-color2);
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.cm-editor {
  line-height: var(--jp-code-line-height);
  font-size: var(--jp-code-font-size);
  font-family: var(--jp-code-font-family);
  border: 0;
  border-radius: 0;
  height: auto;

  /* Changed to auto to autogrow */
}

.cm-editor pre {
  padding: 0 var(--jp-code-padding);
}

.jp-CodeMirrorEditor[data-type='inline'] .cm-dialog {
  background-color: var(--jp-layout-color0);
  color: var(--jp-content-font-color1);
}

.jp-CodeMirrorEditor {
  cursor: text;
}

/* When zoomed out 67% and 33% on a screen of 1440 width x 900 height */
@media screen and (min-width: 2138px) and (max-width: 4319px) {
  .jp-CodeMirrorEditor[data-type='inline'] .cm-cursor {
    border-left: var(--jp-code-cursor-width1) solid
      var(--jp-editor-cursor-color);
  }
}

/* When zoomed out less than 33% */
@media screen and (min-width: 4320px) {
  .jp-CodeMirrorEditor[data-type='inline'] .cm-cursor {
    border-left: var(--jp-code-cursor-width2) solid
      var(--jp-editor-cursor-color);
  }
}

.cm-editor.jp-mod-readOnly .cm-cursor {
  display: none;
}

.jp-CollaboratorCursor {
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-top: none;
  border-bottom: 3px solid;
  background-clip: content-box;
  margin-left: -5px;
  margin-right: -5px;
}

.cm-searching,
.cm-searching span {
  /* `.cm-searching span`: we need to override syntax highlighting */
  background-color: var(--jp-search-unselected-match-background-color);
  color: var(--jp-search-unselected-match-color);
}

.cm-searching::selection,
.cm-searching span::selection {
  background-color: var(--jp-search-unselected-match-background-color);
  color: var(--jp-search-unselected-match-color);
}

.jp-current-match > .cm-searching,
.jp-current-match > .cm-searching span,
.cm-searching > .jp-current-match,
.cm-searching > .jp-current-match span {
  background-color: var(--jp-search-selected-match-background-color);
  color: var(--jp-search-selected-match-color);
}

.jp-current-match > .cm-searching::selection,
.cm-searching > .jp-current-match::selection,
.jp-current-match > .cm-searching span::selection {
  background-color: var(--jp-search-selected-match-background-color);
  color: var(--jp-search-selected-match-color);
}

.cm-trailingspace {
  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAsElEQVQIHQGlAFr/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7+r3zKmT0/+pk9P/7+r3zAAAAAAAAAAABAAAAAAAAAAA6OPzM+/q9wAAAAAA6OPzMwAAAAAAAAAAAgAAAAAAAAAAGR8NiRQaCgAZIA0AGR8NiQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQyoYJ/SY80UAAAAASUVORK5CYII=);
  background-position: center left;
  background-repeat: repeat-x;
}

.jp-CollaboratorCursor-hover {
  position: absolute;
  z-index: 1;
  transform: translateX(-50%);
  color: white;
  border-radius: 3px;
  padding-left: 4px;
  padding-right: 4px;
  padding-top: 1px;
  padding-bottom: 1px;
  text-align: center;
  font-size: var(--jp-ui-font-size1);
  white-space: nowrap;
}

.jp-CodeMirror-ruler {
  border-left: 1px dashed var(--jp-border-color2);
}

/* Styles for shared cursors (remote cursor locations and selected ranges) */
.jp-CodeMirrorEditor .cm-ySelectionCaret {
  position: relative;
  border-left: 1px solid black;
  margin-left: -1px;
  margin-right: -1px;
  box-sizing: border-box;
}

.jp-CodeMirrorEditor .cm-ySelectionCaret > .cm-ySelectionInfo {
  white-space: nowrap;
  position: absolute;
  top: -1.15em;
  padding-bottom: 0.05em;
  left: -1px;
  font-size: 0.95em;
  font-family: var(--jp-ui-font-family);
  font-weight: bold;
  line-height: normal;
  user-select: none;
  color: white;
  padding-left: 2px;
  padding-right: 2px;
  z-index: 101;
  transition: opacity 0.3s ease-in-out;
}

.jp-CodeMirrorEditor .cm-ySelectionInfo {
  transition-delay: 0.7s;
  opacity: 0;
}

.jp-CodeMirrorEditor .cm-ySelectionCaret:hover > .cm-ySelectionInfo {
  opacity: 1;
  transition-delay: 0s;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-MimeDocument {
  outline: none;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Variables
|----------------------------------------------------------------------------*/

:root {
  --jp-private-filebrowser-button-height: 28px;
  --jp-private-filebrowser-button-width: 48px;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-FileBrowser .jp-SidePanel-content {
  display: flex;
  flex-direction: column;
}

.jp-FileBrowser-toolbar.jp-Toolbar {
  flex-wrap: wrap;
  row-gap: 12px;
  border-bottom: none;
  height: auto;
  margin: 8px 12px 0;
  box-shadow: none;
  padding: 0;
  justify-content: flex-start;
}

.jp-FileBrowser-Panel {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
}

.jp-BreadCrumbs {
  flex: 0 0 auto;
  margin: 8px 12px;
}

.jp-BreadCrumbs-item {
  margin: 0 2px;
  padding: 0 2px;
  border-radius: var(--jp-border-radius);
  cursor: pointer;
}

.jp-BreadCrumbs-item:hover {
  background-color: var(--jp-layout-color2);
}

.jp-BreadCrumbs-item:first-child {
  margin-left: 0;
}

.jp-BreadCrumbs-item.jp-mod-dropTarget {
  background-color: var(--jp-brand-color2);
  opacity: 0.7;
}

/*-----------------------------------------------------------------------------
| Buttons
|----------------------------------------------------------------------------*/

.jp-FileBrowser-toolbar > .jp-Toolbar-item {
  flex: 0 0 auto;
  padding-left: 0;
  padding-right: 2px;
  align-items: center;
  height: unset;
}

.jp-FileBrowser-toolbar > .jp-Toolbar-item .jp-ToolbarButtonComponent {
  width: 40px;
}

/*-----------------------------------------------------------------------------
| Other styles
|----------------------------------------------------------------------------*/

.jp-FileDialog.jp-mod-conflict input {
  color: var(--jp-error-color1);
}

.jp-FileDialog .jp-new-name-title {
  margin-top: 12px;
}

.jp-LastModified-hidden {
  display: none;
}

.jp-FileSize-hidden {
  display: none;
}

.jp-FileBrowser .lm-AccordionPanel > h3:first-child {
  display: none;
}

/*-----------------------------------------------------------------------------
| DirListing
|----------------------------------------------------------------------------*/

.jp-DirListing {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  outline: 0;
}

.jp-DirListing-header {
  flex: 0 0 auto;
  display: flex;
  flex-direction: row;
  align-items: center;
  overflow: hidden;
  border-top: var(--jp-border-width) solid var(--jp-border-color2);
  border-bottom: var(--jp-border-width) solid var(--jp-border-color1);
  box-shadow: var(--jp-toolbar-box-shadow);
  z-index: 2;
}

.jp-DirListing-headerItem {
  padding: 4px 12px 2px;
  font-weight: 500;
}

.jp-DirListing-headerItem:hover {
  background: var(--jp-layout-color2);
}

.jp-DirListing-headerItem.jp-id-name {
  flex: 1 0 84px;
}

.jp-DirListing-headerItem.jp-id-modified {
  flex: 0 0 112px;
  border-left: var(--jp-border-width) solid var(--jp-border-color2);
  text-align: right;
}

.jp-DirListing-headerItem.jp-id-filesize {
  flex: 0 0 75px;
  border-left: var(--jp-border-width) solid var(--jp-border-color2);
  text-align: right;
}

.jp-id-narrow {
  display: none;
  flex: 0 0 5px;
  padding: 4px;
  border-left: var(--jp-border-width) solid var(--jp-border-color2);
  text-align: right;
  color: var(--jp-border-color2);
}

.jp-DirListing-narrow .jp-id-narrow {
  display: block;
}

.jp-DirListing-narrow .jp-id-modified,
.jp-DirListing-narrow .jp-DirListing-itemModified {
  display: none;
}

.jp-DirListing-headerItem.jp-mod-selected {
  font-weight: 600;
}

/* increase specificity to override bundled default */
.jp-DirListing-content {
  flex: 1 1 auto;
  margin: 0;
  padding: 0;
  list-style-type: none;
  overflow: auto;
  background-color: var(--jp-layout-color1);
}

.jp-DirListing-content mark {
  color: var(--jp-ui-font-color0);
  background-color: transparent;
  font-weight: bold;
}

.jp-DirListing-content .jp-DirListing-item.jp-mod-selected mark {
  color: var(--jp-ui-inverse-font-color0);
}

/* Style the directory listing content when a user drops a file to upload */
.jp-DirListing.jp-mod-native-drop .jp-DirListing-content {
  outline: 5px dashed rgba(128, 128, 128, 0.5);
  outline-offset: -10px;
  cursor: copy;
}

.jp-DirListing-item {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 4px 12px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.jp-DirListing-checkboxWrapper {
  /* Increases hit area of checkbox. */
  padding: 4px;
}

.jp-DirListing-header
  .jp-DirListing-checkboxWrapper
  + .jp-DirListing-headerItem {
  padding-left: 4px;
}

.jp-DirListing-content .jp-DirListing-checkboxWrapper {
  position: relative;
  left: -4px;
  margin: -4px 0 -4px -8px;
}

.jp-DirListing-checkboxWrapper.jp-mod-visible {
  visibility: visible;
}

/* For devices that support hovering, hide checkboxes until hovered, selected...
*/
@media (hover: hover) {
  .jp-DirListing-checkboxWrapper {
    visibility: hidden;
  }

  .jp-DirListing-item:hover .jp-DirListing-checkboxWrapper,
  .jp-DirListing-item.jp-mod-selected .jp-DirListing-checkboxWrapper {
    visibility: visible;
  }
}

.jp-DirListing-item[data-is-dot] {
  opacity: 75%;
}

.jp-DirListing-item.jp-mod-selected {
  color: var(--jp-ui-inverse-font-color1);
  background: var(--jp-brand-color1);
}

.jp-DirListing-item.jp-mod-dropTarget {
  background: var(--jp-brand-color3);
}

.jp-DirListing-item:hover:not(.jp-mod-selected) {
  background: var(--jp-layout-color2);
}

.jp-DirListing-itemIcon {
  flex: 0 0 20px;
  margin-right: 4px;
}

.jp-DirListing-itemText {
  flex: 1 0 64px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  user-select: none;
}

.jp-DirListing-itemText:focus {
  outline-width: 2px;
  outline-color: var(--jp-inverse-layout-color1);
  outline-style: solid;
  outline-offset: 1px;
}

.jp-DirListing-item.jp-mod-selected .jp-DirListing-itemText:focus {
  outline-color: var(--jp-layout-color1);
}

.jp-DirListing-itemModified {
  flex: 0 0 125px;
  text-align: right;
}

.jp-DirListing-itemFileSize {
  flex: 0 0 90px;
  text-align: right;
}

.jp-DirListing-editor {
  flex: 1 0 64px;
  outline: none;
  border: none;
  color: var(--jp-ui-font-color1);
  background-color: var(--jp-layout-color1);
}

.jp-DirListing-item.jp-mod-running .jp-DirListing-itemIcon::before {
  color: var(--jp-success-color1);
  content: '\25CF';
  font-size: 8px;
  position: absolute;
  left: -8px;
}

.jp-DirListing-item.jp-mod-running.jp-mod-selected
  .jp-DirListing-itemIcon::before {
  color: var(--jp-ui-inverse-font-color1);
}

.jp-DirListing-item.lm-mod-drag-image,
.jp-DirListing-item.jp-mod-selected.lm-mod-drag-image {
  font-size: var(--jp-ui-font-size1);
  padding-left: 4px;
  margin-left: 4px;
  width: 160px;
  background-color: var(--jp-ui-inverse-font-color2);
  box-shadow: var(--jp-elevation-z2);
  border-radius: 0;
  color: var(--jp-ui-font-color1);
  transform: translateX(-40%) translateY(-58%);
}

.jp-Document {
  min-width: 120px;
  min-height: 120px;
  outline: none;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Main OutputArea
| OutputArea has a list of Outputs
|----------------------------------------------------------------------------*/

.jp-OutputArea {
  overflow-y: auto;
}

.jp-OutputArea-child {
  display: table;
  table-layout: fixed;
  width: 100%;
  overflow: hidden;
}

.jp-OutputPrompt {
  width: var(--jp-cell-prompt-width);
  color: var(--jp-cell-outprompt-font-color);
  font-family: var(--jp-cell-prompt-font-family);
  padding: var(--jp-code-padding);
  letter-spacing: var(--jp-cell-prompt-letter-spacing);
  line-height: var(--jp-code-line-height);
  font-size: var(--jp-code-font-size);
  border: var(--jp-border-width) solid transparent;
  opacity: var(--jp-cell-prompt-opacity);

  /* Right align prompt text, don't wrap to handle large prompt numbers */
  text-align: right;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;

  /* Disable text selection */
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.jp-OutputArea-prompt {
  display: table-cell;
  vertical-align: top;
}

.jp-OutputArea-output {
  display: table-cell;
  width: 100%;
  height: auto;
  overflow: auto;
  user-select: text;
  -moz-user-select: text;
  -webkit-user-select: text;
  -ms-user-select: text;
}

.jp-OutputArea .jp-RenderedText {
  padding-left: 1ch;
}

/**
 * Prompt overlay.
 */

.jp-OutputArea-promptOverlay {
  position: absolute;
  top: 0;
  width: var(--jp-cell-prompt-width);
  height: 100%;
  opacity: 0.5;
}

.jp-OutputArea-promptOverlay:hover {
  background: var(--jp-layout-color2);
  box-shadow: inset 0 0 1px var(--jp-inverse-layout-color0);
  cursor: zoom-out;
}

.jp-mod-outputsScrolled .jp-OutputArea-promptOverlay:hover {
  cursor: zoom-in;
}

/**
 * Isolated output.
 */
.jp-OutputArea-output.jp-mod-isolated {
  width: 100%;
  display: block;
}

/*
When drag events occur, `lm-mod-override-cursor` is added to the body.
Because iframes steal all cursor events, the following two rules are necessary
to suppress pointer events while resize drags are occurring. There may be a
better solution to this problem.
*/
body.lm-mod-override-cursor .jp-OutputArea-output.jp-mod-isolated {
  position: relative;
}

body.lm-mod-override-cursor .jp-OutputArea-output.jp-mod-isolated::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: transparent;
}

/* pre */

.jp-OutputArea-output pre {
  border: none;
  margin: 0;
  padding: 0;
  overflow-x: auto;
  overflow-y: auto;
  word-break: break-all;
  word-wrap: break-word;
  white-space: pre-wrap;
}

/* tables */

.jp-OutputArea-output.jp-RenderedHTMLCommon table {
  margin-left: 0;
  margin-right: 0;
}

/* description lists */

.jp-OutputArea-output dl,
.jp-OutputArea-output dt,
.jp-OutputArea-output dd {
  display: block;
}

.jp-OutputArea-output dl {
  width: 100%;
  overflow: hidden;
  padding: 0;
  margin: 0;
}

.jp-OutputArea-output dt {
  font-weight: bold;
  float: left;
  width: 20%;
  padding: 0;
  margin: 0;
}

.jp-OutputArea-output dd {
  float: left;
  width: 80%;
  padding: 0;
  margin: 0;
}

.jp-TrimmedOutputs pre {
  background: var(--jp-layout-color3);
  font-size: calc(var(--jp-code-font-size) * 1.4);
  text-align: center;
  text-transform: uppercase;
}

/* Hide the gutter in case of
 *  - nested output areas (e.g. in the case of output widgets)
 *  - mirrored output areas
 */
.jp-OutputArea .jp-OutputArea .jp-OutputArea-prompt {
  display: none;
}

/* Hide empty lines in the output area, for instance due to cleared widgets */
.jp-OutputArea-prompt:empty {
  padding: 0;
  border: 0;
}

/*-----------------------------------------------------------------------------
| executeResult is added to any Output-result for the display of the object
| returned by a cell
|----------------------------------------------------------------------------*/

.jp-OutputArea-output.jp-OutputArea-executeResult {
  margin-left: 0;
  width: 100%;
}

/* Text output with the Out[] prompt needs a top padding to match the
 * alignment of the Out[] prompt itself.
 */
.jp-OutputArea-executeResult .jp-RenderedText.jp-OutputArea-output {
  padding-top: var(--jp-code-padding);
  border-top: var(--jp-border-width) solid transparent;
}

/*-----------------------------------------------------------------------------
| The Stdin output
|----------------------------------------------------------------------------*/

.jp-Stdin-prompt {
  color: var(--jp-content-font-color0);
  padding-right: var(--jp-code-padding);
  vertical-align: baseline;
  flex: 0 0 auto;
}

.jp-Stdin-input {
  font-family: var(--jp-code-font-family);
  font-size: inherit;
  color: inherit;
  background-color: inherit;
  width: 42%;
  min-width: 200px;

  /* make sure input baseline aligns with prompt */
  vertical-align: baseline;

  /* padding + margin = 0.5em between prompt and cursor */
  padding: 0 0.25em;
  margin: 0 0.25em;
  flex: 0 0 70%;
}

.jp-Stdin-input::placeholder {
  opacity: 0;
}

.jp-Stdin-input:focus {
  box-shadow: none;
}

.jp-Stdin-input:focus::placeholder {
  opacity: 1;
}

/*-----------------------------------------------------------------------------
| Output Area View
|----------------------------------------------------------------------------*/

.jp-LinkedOutputView .jp-OutputArea {
  height: 100%;
  display: block;
}

.jp-LinkedOutputView .jp-OutputArea-output:only-child {
  height: 100%;
}

/*-----------------------------------------------------------------------------
| Printing
|----------------------------------------------------------------------------*/

@media print {
  .jp-OutputArea-child {
    break-inside: avoid-page;
  }
}

/*-----------------------------------------------------------------------------
| Mobile
|----------------------------------------------------------------------------*/
@media only screen and (max-width: 760px) {
  .jp-OutputPrompt {
    display: table-row;
    text-align: left;
  }

  .jp-OutputArea-child .jp-OutputArea-output {
    display: table-row;
    margin-left: var(--jp-notebook-padding);
  }
}

/* Trimmed outputs warning */
.jp-TrimmedOutputs > a {
  margin: 10px;
  text-decoration: none;
  cursor: pointer;
}

.jp-TrimmedOutputs > a:hover {
  text-decoration: none;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Table of Contents
|----------------------------------------------------------------------------*/

:root {
  --jp-private-toc-active-width: 4px;
}

.jp-TableOfContents {
  display: flex;
  flex-direction: column;
  background: var(--jp-layout-color1);
  color: var(--jp-ui-font-color1);
  font-size: var(--jp-ui-font-size1);
  height: 100%;
}

.jp-TableOfContents-placeholder {
  text-align: center;
}

.jp-TableOfContents-placeholderContent {
  color: var(--jp-content-font-color2);
  padding: 8px;
}

.jp-TableOfContents-placeholderContent > h3 {
  margin-bottom: var(--jp-content-heading-margin-bottom);
}

.jp-TableOfContents .jp-SidePanel-content {
  overflow-y: auto;
}

.jp-TableOfContents-tree {
  margin: 4px;
}

.jp-TableOfContents ol {
  list-style-type: none;
}

/* stylelint-disable-next-line selector-max-type */
.jp-TableOfContents li > ol {
  /* Align left border with triangle icon center */
  padding-left: 11px;
}

.jp-TableOfContents-content {
  /* left margin for the active heading indicator */
  margin: 0 0 0 var(--jp-private-toc-active-width);
  padding: 0;
  background-color: var(--jp-layout-color1);
}

.jp-tocItem {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.jp-tocItem-heading {
  display: flex;
  cursor: pointer;
}

.jp-tocItem-heading:hover {
  background-color: var(--jp-layout-color2);
}

.jp-tocItem-content {
  display: block;
  padding: 4px 0;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow-x: hidden;
}

.jp-tocItem-collapser {
  height: 20px;
  margin: 2px 2px 0;
  padding: 0;
  background: none;
  border: none;
  cursor: pointer;
}

.jp-tocItem-collapser:hover {
  background-color: var(--jp-layout-color3);
}

/* Active heading indicator */

.jp-tocItem-heading::before {
  content: ' ';
  background: transparent;
  width: var(--jp-private-toc-active-width);
  height: 24px;
  position: absolute;
  left: 0;
  border-radius: var(--jp-border-radius);
}

.jp-tocItem-heading.jp-tocItem-active::before {
  background-color: var(--jp-brand-color1);
}

.jp-tocItem-heading:hover.jp-tocItem-active::before {
  background: var(--jp-brand-color0);
  opacity: 1;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-Collapser {
  flex: 0 0 var(--jp-cell-collapser-width);
  padding: 0;
  margin: 0;
  border: none;
  outline: none;
  background: transparent;
  border-radius: var(--jp-border-radius);
  opacity: 1;
}

.jp-Collapser-child {
  display: block;
  width: 100%;
  box-sizing: border-box;

  /* height: 100% doesn't work because the height of its parent is computed from content */
  position: absolute;
  top: 0;
  bottom: 0;
}

/*-----------------------------------------------------------------------------
| Printing
|----------------------------------------------------------------------------*/

/*
Hiding collapsers in print mode.

Note: input and output wrappers have "display: block" propery in print mode.
*/

@media print {
  .jp-Collapser {
    display: none;
  }
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Header/Footer
|----------------------------------------------------------------------------*/

/* Hidden by zero height by default */
.jp-CellHeader,
.jp-CellFooter {
  height: 0;
  width: 100%;
  padding: 0;
  margin: 0;
  border: none;
  outline: none;
  background: transparent;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Input
|----------------------------------------------------------------------------*/

/* All input areas */
.jp-InputArea {
  display: table;
  table-layout: fixed;
  width: 100%;
  overflow: hidden;
}

.jp-InputArea-editor {
  display: table-cell;
  overflow: hidden;
  vertical-align: top;

  /* This is the non-active, default styling */
  border: var(--jp-border-width) solid var(--jp-cell-editor-border-color);
  border-radius: 0;
  background: var(--jp-cell-editor-background);
}

.jp-InputPrompt {
  display: table-cell;
  vertical-align: top;
  width: var(--jp-cell-prompt-width);
  color: var(--jp-cell-inprompt-font-color);
  font-family: var(--jp-cell-prompt-font-family);
  padding: var(--jp-code-padding);
  letter-spacing: var(--jp-cell-prompt-letter-spacing);
  opacity: var(--jp-cell-prompt-opacity);
  line-height: var(--jp-code-line-height);
  font-size: var(--jp-code-font-size);
  border: var(--jp-border-width) solid transparent;

  /* Right align prompt text, don't wrap to handle large prompt numbers */
  text-align: right;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;

  /* Disable text selection */
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/*-----------------------------------------------------------------------------
| Mobile
|----------------------------------------------------------------------------*/
@media only screen and (max-width: 760px) {
  .jp-InputArea-editor {
    display: table-row;
    margin-left: var(--jp-notebook-padding);
  }

  .jp-InputPrompt {
    display: table-row;
    text-align: left;
  }
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Placeholder
|----------------------------------------------------------------------------*/

.jp-Placeholder {
  display: table;
  table-layout: fixed;
  width: 100%;
}

.jp-Placeholder-prompt {
  display: table-cell;
  box-sizing: border-box;
}

.jp-Placeholder-content {
  display: table-cell;
  padding: 4px 6px;
  border: 1px solid transparent;
  border-radius: 0;
  background: none;
  box-sizing: border-box;
  cursor: pointer;
}

.jp-Placeholder-contentContainer {
  display: flex;
}

.jp-Placeholder-content:hover,
.jp-InputPlaceholder > .jp-Placeholder-content:hover {
  border-color: var(--jp-layout-color3);
}

.jp-Placeholder-content .jp-MoreHorizIcon {
  width: 32px;
  height: 16px;
  border: 1px solid transparent;
  border-radius: var(--jp-border-radius);
}

.jp-Placeholder-content .jp-MoreHorizIcon:hover {
  border: 1px solid var(--jp-border-color1);
  box-shadow: 0 0 2px 0 rgba(0, 0, 0, 0.25);
  background-color: var(--jp-layout-color0);
}

.jp-PlaceholderText {
  white-space: nowrap;
  overflow-x: hidden;
  color: var(--jp-inverse-layout-color3);
  font-family: var(--jp-code-font-family);
}

.jp-InputPlaceholder > .jp-Placeholder-content {
  border-color: var(--jp-cell-editor-border-color);
  background: var(--jp-cell-editor-background);
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Private CSS variables
|----------------------------------------------------------------------------*/

:root {
  --jp-private-cell-scrolling-output-offset: 5px;
}

/*-----------------------------------------------------------------------------
| Cell
|----------------------------------------------------------------------------*/

.jp-Cell {
  padding: var(--jp-cell-padding);
  margin: 0;
  border: none;
  outline: none;
  background: transparent;
}

/*-----------------------------------------------------------------------------
| Common input/output
|----------------------------------------------------------------------------*/

.jp-Cell-inputWrapper,
.jp-Cell-outputWrapper {
  display: flex;
  flex-direction: row;
  padding: 0;
  margin: 0;

  /* Added to reveal the box-shadow on the input and output collapsers. */
  overflow: visible;
}

/* Only input/output areas inside cells */
.jp-Cell-inputArea,
.jp-Cell-outputArea {
  flex: 1 1 auto;
}

/*-----------------------------------------------------------------------------
| Collapser
|----------------------------------------------------------------------------*/

/* Make the output collapser disappear when there is not output, but do so
 * in a manner that leaves it in the layout and preserves its width.
 */
.jp-Cell.jp-mod-noOutputs .jp-Cell-outputCollapser {
  border: none !important;
  background: transparent !important;
}

.jp-Cell:not(.jp-mod-noOutputs) .jp-Cell-outputCollapser {
  min-height: var(--jp-cell-collapser-min-height);
}

/*-----------------------------------------------------------------------------
| Output
|----------------------------------------------------------------------------*/

/* Put a space between input and output when there IS output */
.jp-Cell:not(.jp-mod-noOutputs) .jp-Cell-outputWrapper {
  margin-top: 5px;
}

.jp-CodeCell.jp-mod-outputsScrolled .jp-Cell-outputArea {
  overflow-y: auto;
  max-height: 24em;
  margin-left: var(--jp-private-cell-scrolling-output-offset);
  resize: vertical;
}

.jp-CodeCell.jp-mod-outputsScrolled .jp-Cell-outputArea[style*='height'] {
  max-height: unset;
}

.jp-CodeCell.jp-mod-outputsScrolled .jp-Cell-outputArea::after {
  content: ' ';
  box-shadow: inset 0 0 6px 2px rgb(0 0 0 / 30%);
  width: 100%;
  height: 100%;
  position: sticky;
  bottom: 0;
  top: 0;
  margin-top: -50%;
  float: left;
  display: block;
  pointer-events: none;
}

.jp-CodeCell.jp-mod-outputsScrolled .jp-OutputArea-child {
  padding-top: 6px;
}

.jp-CodeCell.jp-mod-outputsScrolled .jp-OutputArea-prompt {
  width: calc(
    var(--jp-cell-prompt-width) - var(--jp-private-cell-scrolling-output-offset)
  );
}

.jp-CodeCell.jp-mod-outputsScrolled .jp-OutputArea-promptOverlay {
  left: calc(-1 * var(--jp-private-cell-scrolling-output-offset));
}

/*-----------------------------------------------------------------------------
| CodeCell
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| MarkdownCell
|----------------------------------------------------------------------------*/

.jp-MarkdownOutput {
  display: table-cell;
  width: 100%;
  margin-top: 0;
  margin-bottom: 0;
  padding-left: var(--jp-code-padding);
}

.jp-MarkdownOutput.jp-RenderedHTMLCommon {
  overflow: auto;
}

/* collapseHeadingButton (show always if hiddenCellsButton is _not_ shown) */
.jp-collapseHeadingButton {
  display: flex;
  min-height: var(--jp-cell-collapser-min-height);
  font-size: var(--jp-code-font-size);
  position: absolute;
  background-color: transparent;
  background-size: 25px;
  background-repeat: no-repeat;
  background-position-x: center;
  background-position-y: top;
  background-image: var(--jp-icon-caret-down);
  right: 0;
  top: 0;
  bottom: 0;
}

.jp-collapseHeadingButton.jp-mod-collapsed {
  background-image: var(--jp-icon-caret-right);
}

/*
 set the container font size to match that of content
 so that the nested collapse buttons have the right size
*/
.jp-MarkdownCell .jp-InputPrompt {
  font-size: var(--jp-content-font-size1);
}

/*
  Align collapseHeadingButton with cell top header
  The font sizes are identical to the ones in packages/rendermime/style/base.css
*/
.jp-mod-rendered .jp-collapseHeadingButton[data-heading-level='1'] {
  font-size: var(--jp-content-font-size5);
  background-position-y: calc(0.3 * var(--jp-content-font-size5));
}

.jp-mod-rendered .jp-collapseHeadingButton[data-heading-level='2'] {
  font-size: var(--jp-content-font-size4);
  background-position-y: calc(0.3 * var(--jp-content-font-size4));
}

.jp-mod-rendered .jp-collapseHeadingButton[data-heading-level='3'] {
  font-size: var(--jp-content-font-size3);
  background-position-y: calc(0.3 * var(--jp-content-font-size3));
}

.jp-mod-rendered .jp-collapseHeadingButton[data-heading-level='4'] {
  font-size: var(--jp-content-font-size2);
  background-position-y: calc(0.3 * var(--jp-content-font-size2));
}

.jp-mod-rendered .jp-collapseHeadingButton[data-heading-level='5'] {
  font-size: var(--jp-content-font-size1);
  background-position-y: top;
}

.jp-mod-rendered .jp-collapseHeadingButton[data-heading-level='6'] {
  font-size: var(--jp-content-font-size0);
  background-position-y: top;
}

/* collapseHeadingButton (show only on (hover,active) if hiddenCellsButton is shown) */
.jp-Notebook.jp-mod-showHiddenCellsButton .jp-collapseHeadingButton {
  display: none;
}

.jp-Notebook.jp-mod-showHiddenCellsButton
  :is(.jp-MarkdownCell:hover, .jp-mod-active)
  .jp-collapseHeadingButton {
  display: flex;
}

/* showHiddenCellsButton (only show if jp-mod-showHiddenCellsButton is set, which
is a consequence of the showHiddenCellsButton option in Notebook Settings)*/
.jp-Notebook.jp-mod-showHiddenCellsButton .jp-showHiddenCellsButton {
  margin-left: calc(var(--jp-cell-prompt-width) + 2 * var(--jp-code-padding));
  margin-top: var(--jp-code-padding);
  border: 1px solid var(--jp-border-color2);
  background-color: var(--jp-border-color3) !important;
  color: var(--jp-content-font-color0) !important;
  display: flex;
}

.jp-Notebook.jp-mod-showHiddenCellsButton .jp-showHiddenCellsButton:hover {
  background-color: var(--jp-border-color2) !important;
}

.jp-showHiddenCellsButton {
  display: none;
}

/*-----------------------------------------------------------------------------
| Printing
|----------------------------------------------------------------------------*/

/*
Using block instead of flex to allow the use of the break-inside CSS property for
cell outputs.
*/

@media print {
  .jp-Cell-inputWrapper,
  .jp-Cell-outputWrapper {
    display: block;
  }
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Variables
|----------------------------------------------------------------------------*/

:root {
  --jp-notebook-toolbar-padding: 2px 5px 2px 2px;
}

/*-----------------------------------------------------------------------------

/*-----------------------------------------------------------------------------
| Styles
|----------------------------------------------------------------------------*/

.jp-NotebookPanel-toolbar {
  padding: var(--jp-notebook-toolbar-padding);

  /* disable paint containment from lumino 2.0 default strict CSS containment */
  contain: style size !important;
}

.jp-Toolbar-item.jp-Notebook-toolbarCellType .jp-select-wrapper.jp-mod-focused {
  border: none;
  box-shadow: none;
}

.jp-Notebook-toolbarCellTypeDropdown select {
  height: 24px;
  font-size: var(--jp-ui-font-size1);
  line-height: 14px;
  border-radius: 0;
  display: block;
}

.jp-Notebook-toolbarCellTypeDropdown span {
  top: 5px !important;
}

.jp-Toolbar-responsive-popup {
  position: absolute;
  height: fit-content;
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: flex-end;
  border-bottom: var(--jp-border-width) solid var(--jp-toolbar-border-color);
  box-shadow: var(--jp-toolbar-box-shadow);
  background: var(--jp-toolbar-background);
  min-height: var(--jp-toolbar-micro-height);
  padding: var(--jp-notebook-toolbar-padding);
  z-index: 1;
  right: 0;
  top: 0;
}

.jp-Toolbar > .jp-Toolbar-responsive-opener {
  margin-left: auto;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Variables
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------

/*-----------------------------------------------------------------------------
| Styles
|----------------------------------------------------------------------------*/

.jp-Notebook-ExecutionIndicator {
  position: relative;
  display: inline-block;
  height: 100%;
  z-index: 9997;
}

.jp-Notebook-ExecutionIndicator-tooltip {
  visibility: hidden;
  height: auto;
  width: max-content;
  width: -moz-max-content;
  background-color: var(--jp-layout-color2);
  color: var(--jp-ui-font-color1);
  text-align: justify;
  border-radius: 6px;
  padding: 0 5px;
  position: fixed;
  display: table;
}

.jp-Notebook-ExecutionIndicator-tooltip.up {
  transform: translateX(-50%) translateY(-100%) translateY(-32px);
}

.jp-Notebook-ExecutionIndicator-tooltip.down {
  transform: translateX(calc(-100% + 16px)) translateY(5px);
}

.jp-Notebook-ExecutionIndicator-tooltip.hidden {
  display: none;
}

.jp-Notebook-ExecutionIndicator:hover .jp-Notebook-ExecutionIndicator-tooltip {
  visibility: visible;
}

.jp-Notebook-ExecutionIndicator span {
  font-size: var(--jp-ui-font-size1);
  font-family: var(--jp-ui-font-family);
  color: var(--jp-ui-font-color1);
  line-height: 24px;
  display: block;
}

.jp-Notebook-ExecutionIndicator-progress-bar {
  display: flex;
  justify-content: center;
  height: 100%;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*
 * Execution indicator
 */
.jp-tocItem-content::after {
  content: '';

  /* Must be identical to form a circle */
  width: 12px;
  height: 12px;
  background: none;
  border: none;
  position: absolute;
  right: 0;
}

.jp-tocItem-content[data-running='0']::after {
  border-radius: 50%;
  border: var(--jp-border-width) solid var(--jp-inverse-layout-color3);
  background: none;
}

.jp-tocItem-content[data-running='1']::after {
  border-radius: 50%;
  border: var(--jp-border-width) solid var(--jp-inverse-layout-color3);
  background-color: var(--jp-inverse-layout-color3);
}

.jp-tocItem-content[data-running='0'],
.jp-tocItem-content[data-running='1'] {
  margin-right: 12px;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

.jp-Notebook-footer {
  height: 27px;
  margin-left: calc(
    var(--jp-cell-prompt-width) + var(--jp-cell-collapser-width) +
      var(--jp-cell-padding)
  );
  width: calc(
    100% -
      (
        var(--jp-cell-prompt-width) + var(--jp-cell-collapser-width) +
          var(--jp-cell-padding) + var(--jp-cell-padding)
      )
  );
  border: var(--jp-border-width) solid var(--jp-cell-editor-border-color);
  color: var(--jp-ui-font-color3);
  margin-top: 6px;
  background: none;
  cursor: pointer;
}

.jp-Notebook-footer:focus {
  border-color: var(--jp-cell-editor-active-border-color);
}

/* For devices that support hovering, hide footer until hover */
@media (hover: hover) {
  .jp-Notebook-footer {
    opacity: 0;
  }

  .jp-Notebook-footer:focus,
  .jp-Notebook-footer:hover {
    opacity: 1;
  }
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Imports
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| CSS variables
|----------------------------------------------------------------------------*/

:root {
  --jp-side-by-side-output-size: 1fr;
  --jp-side-by-side-resized-cell: var(--jp-side-by-side-output-size);
  --jp-private-notebook-dragImage-width: 304px;
  --jp-private-notebook-dragImage-height: 36px;
  --jp-private-notebook-selected-color: var(--md-blue-400);
  --jp-private-notebook-active-color: var(--md-green-400);
}

/*-----------------------------------------------------------------------------
| Notebook
|----------------------------------------------------------------------------*/

/* stylelint-disable selector-max-class */

.jp-NotebookPanel {
  display: block;
  height: 100%;
}

.jp-NotebookPanel.jp-Document {
  min-width: 240px;
  min-height: 120px;
}

.jp-Notebook {
  padding: var(--jp-notebook-padding);
  outline: none;
  overflow: auto;
  background: var(--jp-layout-color0);
}

.jp-Notebook.jp-mod-scrollPastEnd::after {
  display: block;
  content: '';
  min-height: var(--jp-notebook-scroll-padding);
}

.jp-MainAreaWidget-ContainStrict .jp-Notebook * {
  contain: strict;
}

.jp-Notebook .jp-Cell {
  overflow: visible;
}

.jp-Notebook .jp-Cell .jp-InputPrompt {
  cursor: move;
}

/*-----------------------------------------------------------------------------
| Notebook state related styling
|
| The notebook and cells each have states, here are the possibilities:
|
| - Notebook
|   - Command
|   - Edit
| - Cell
|   - None
|   - Active (only one can be active)
|   - Selected (the cells actions are applied to)
|   - Multiselected (when multiple selected, the cursor)
|   - No outputs
|----------------------------------------------------------------------------*/

/* Command or edit modes */

.jp-Notebook .jp-Cell:not(.jp-mod-active) .jp-InputPrompt {
  opacity: var(--jp-cell-prompt-not-active-opacity);
  color: var(--jp-cell-prompt-not-active-font-color);
}

.jp-Notebook .jp-Cell:not(.jp-mod-active) .jp-OutputPrompt {
  opacity: var(--jp-cell-prompt-not-active-opacity);
  color: var(--jp-cell-prompt-not-active-font-color);
}

/* cell is active */
.jp-Notebook .jp-Cell.jp-mod-active .jp-Collapser {
  background: var(--jp-brand-color1);
}

/* cell is dirty */
.jp-Notebook .jp-Cell.jp-mod-dirty .jp-InputPrompt {
  color: var(--jp-warn-color1);
}

.jp-Notebook .jp-Cell.jp-mod-dirty .jp-InputPrompt::before {
  color: var(--jp-warn-color1);
  content: '';
}

.jp-Notebook .jp-Cell.jp-mod-active.jp-mod-dirty .jp-Collapser {
  background: var(--jp-warn-color1);
}

/* collapser is hovered */
.jp-Notebook .jp-Cell .jp-Collapser:hover {
  box-shadow: var(--jp-elevation-z2);
  background: var(--jp-brand-color1);
  opacity: var(--jp-cell-collapser-not-active-hover-opacity);
}

/* cell is active and collapser is hovered */
.jp-Notebook .jp-Cell.jp-mod-active .jp-Collapser:hover {
  background: var(--jp-brand-color0);
  opacity: 1;
}

/* Command mode */

.jp-Notebook.jp-mod-commandMode .jp-Cell.jp-mod-selected {
  background: var(--jp-notebook-multiselected-color);
}

.jp-Notebook.jp-mod-commandMode
  .jp-Cell.jp-mod-active.jp-mod-selected:not(.jp-mod-multiSelected) {
  background: transparent;
}

/* Edit mode */

.jp-Notebook.jp-mod-editMode .jp-Cell.jp-mod-active .jp-InputArea-editor {
  border: var(--jp-border-width) solid var(--jp-cell-editor-active-border-color);
  box-shadow: var(--jp-input-box-shadow);
  background-color: var(--jp-cell-editor-active-background);
}

/*-----------------------------------------------------------------------------
| Notebook drag and drop
|----------------------------------------------------------------------------*/

.jp-Notebook-cell.jp-mod-dropSource {
  opacity: 0.5;
}

.jp-Notebook-cell.jp-mod-dropTarget,
.jp-Notebook.jp-mod-commandMode
  .jp-Notebook-cell.jp-mod-active.jp-mod-selected.jp-mod-dropTarget {
  border-top-color: var(--jp-private-notebook-selected-color);
  border-top-style: solid;
  border-top-width: 2px;
}

.jp-dragImage {
  display: block;
  flex-direction: row;
  width: var(--jp-private-notebook-dragImage-width);
  height: var(--jp-private-notebook-dragImage-height);
  border: var(--jp-border-width) solid var(--jp-cell-editor-border-color);
  background: var(--jp-cell-editor-background);
  overflow: visible;
}

.jp-dragImage-singlePrompt {
  box-shadow: 2px 2px 4px 0 rgba(0, 0, 0, 0.12);
}

.jp-dragImage .jp-dragImage-content {
  flex: 1 1 auto;
  z-index: 2;
  font-size: var(--jp-code-font-size);
  font-family: var(--jp-code-font-family);
  line-height: var(--jp-code-line-height);
  padding: var(--jp-code-padding);
  border: var(--jp-border-width) solid var(--jp-cell-editor-border-color);
  background: var(--jp-cell-editor-background-color);
  color: var(--jp-content-font-color3);
  text-align: left;
  margin: 4px 4px 4px 0;
}

.jp-dragImage .jp-dragImage-prompt {
  flex: 0 0 auto;
  min-width: 36px;
  color: var(--jp-cell-inprompt-font-color);
  padding: var(--jp-code-padding);
  padding-left: 12px;
  font-family: var(--jp-cell-prompt-font-family);
  letter-spacing: var(--jp-cell-prompt-letter-spacing);
  line-height: 1.9;
  font-size: var(--jp-code-font-size);
  border: var(--jp-border-width) solid transparent;
}

.jp-dragImage-multipleBack {
  z-index: -1;
  position: absolute;
  height: 32px;
  width: 300px;
  top: 8px;
  left: 8px;
  background: var(--jp-layout-color2);
  border: var(--jp-border-width) solid var(--jp-input-border-color);
  box-shadow: 2px 2px 4px 0 rgba(0, 0, 0, 0.12);
}

/*-----------------------------------------------------------------------------
| Cell toolbar
|----------------------------------------------------------------------------*/

.jp-NotebookTools {
  display: block;
  min-width: var(--jp-sidebar-min-width);
  color: var(--jp-ui-font-color1);
  background: var(--jp-layout-color1);

  /* This is needed so that all font sizing of children done in ems is
    * relative to this base size */
  font-size: var(--jp-ui-font-size1);
  overflow: auto;
}

.jp-ActiveCellTool {
  padding: 12px 0;
  display: flex;
}

.jp-ActiveCellTool-Content {
  flex: 1 1 auto;
}

.jp-ActiveCellTool .jp-ActiveCellTool-CellContent {
  background: var(--jp-cell-editor-background);
  border: var(--jp-border-width) solid var(--jp-cell-editor-border-color);
  border-radius: 0;
  min-height: 29px;
}

.jp-ActiveCellTool .jp-InputPrompt {
  min-width: calc(var(--jp-cell-prompt-width) * 0.75);
}

.jp-ActiveCellTool-CellContent > pre {
  padding: 5px 4px;
  margin: 0;
  white-space: normal;
}

.jp-MetadataEditorTool {
  flex-direction: column;
  padding: 12px 0;
}

.jp-RankedPanel > :not(:first-child) {
  margin-top: 12px;
}

.jp-KeySelector select.jp-mod-styled {
  font-size: var(--jp-ui-font-size1);
  color: var(--jp-ui-font-color0);
  border: var(--jp-border-width) solid var(--jp-border-color1);
}

.jp-KeySelector label,
.jp-MetadataEditorTool label,
.jp-NumberSetter label {
  line-height: 1.4;
}

.jp-NotebookTools .jp-select-wrapper {
  margin-top: 4px;
  margin-bottom: 0;
}

.jp-NumberSetter input {
  width: 100%;
  margin-top: 4px;
}

.jp-NotebookTools .jp-Collapse {
  margin-top: 16px;
}

/*-----------------------------------------------------------------------------
| Presentation Mode (.jp-mod-presentationMode)
|----------------------------------------------------------------------------*/

.jp-mod-presentationMode .jp-Notebook {
  --jp-content-font-size1: var(--jp-content-presentation-font-size1);
  --jp-code-font-size: var(--jp-code-presentation-font-size);
}

.jp-mod-presentationMode .jp-Notebook .jp-Cell .jp-InputPrompt,
.jp-mod-presentationMode .jp-Notebook .jp-Cell .jp-OutputPrompt {
  flex: 0 0 110px;
}

/*-----------------------------------------------------------------------------
| Side-by-side Mode (.jp-mod-sideBySide)
|----------------------------------------------------------------------------*/
.jp-mod-sideBySide.jp-Notebook .jp-Notebook-cell {
  margin-top: 3em;
  margin-bottom: 3em;
  margin-left: 5%;
  margin-right: 5%;
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell {
  display: grid;
  grid-template-columns: minmax(0, 1fr) min-content minmax(
      0,
      var(--jp-side-by-side-output-size)
    );
  grid-template-rows: auto minmax(0, 1fr) auto;
  grid-template-areas:
    'header header header'
    'input handle output'
    'footer footer footer';
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell.jp-mod-resizedCell {
  grid-template-columns: minmax(0, 1fr) min-content minmax(
      0,
      var(--jp-side-by-side-resized-cell)
    );
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell .jp-CellHeader {
  grid-area: header;
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell .jp-Cell-inputWrapper {
  grid-area: input;
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell .jp-Cell-outputWrapper {
  /* overwrite the default margin (no vertical separation needed in side by side move */
  margin-top: 0;
  grid-area: output;
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell .jp-CellFooter {
  grid-area: footer;
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell .jp-CellResizeHandle {
  grid-area: handle;
  user-select: none;
  display: block;
  height: 100%;
  cursor: ew-resize;
  padding: 0 var(--jp-cell-padding);
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell .jp-CellResizeHandle::after {
  content: '';
  display: block;
  background: var(--jp-border-color2);
  height: 100%;
  width: 5px;
}

.jp-mod-sideBySide.jp-Notebook
  .jp-CodeCell.jp-mod-resizedCell
  .jp-CellResizeHandle::after {
  background: var(--jp-border-color0);
}

.jp-CellResizeHandle {
  display: none;
}

/*-----------------------------------------------------------------------------
| Placeholder
|----------------------------------------------------------------------------*/

.jp-Cell-Placeholder {
  padding-left: 55px;
}

.jp-Cell-Placeholder-wrapper {
  background: #fff;
  border: 1px solid;
  border-color: #e5e6e9 #dfe0e4 #d0d1d5;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  margin: 10px 15px;
}

.jp-Cell-Placeholder-wrapper-inner {
  padding: 15px;
  position: relative;
}

.jp-Cell-Placeholder-wrapper-body {
  background-repeat: repeat;
  background-size: 50% auto;
}

.jp-Cell-Placeholder-wrapper-body div {
  background: #f6f7f8;
  background-image: -webkit-linear-gradient(
    left,
    #f6f7f8 0%,
    #edeef1 20%,
    #f6f7f8 40%,
    #f6f7f8 100%
  );
  background-repeat: no-repeat;
  background-size: 800px 104px;
  height: 104px;
  position: absolute;
  right: 15px;
  left: 15px;
  top: 15px;
}

div.jp-Cell-Placeholder-h1 {
  top: 20px;
  height: 20px;
  left: 15px;
  width: 150px;
}

div.jp-Cell-Placeholder-h2 {
  left: 15px;
  top: 50px;
  height: 10px;
  width: 100px;
}

div.jp-Cell-Placeholder-content-1,
div.jp-Cell-Placeholder-content-2,
div.jp-Cell-Placeholder-content-3 {
  left: 15px;
  right: 15px;
  height: 10px;
}

div.jp-Cell-Placeholder-content-1 {
  top: 100px;
}

div.jp-Cell-Placeholder-content-2 {
  top: 120px;
}

div.jp-Cell-Placeholder-content-3 {
  top: 140px;
}

</style>
<style type="text/css">
/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*
The following CSS variables define the main, public API for styling JupyterLab.
These variables should be used by all plugins wherever possible. In other
words, plugins should not define custom colors, sizes, etc unless absolutely
necessary. This enables users to change the visual theme of JupyterLab
by changing these variables.

Many variables appear in an ordered sequence (0,1,2,3). These sequences
are designed to work well together, so for example, `--jp-border-color1` should
be used with `--jp-layout-color1`. The numbers have the following meanings:

* 0: super-primary, reserved for special emphasis
* 1: primary, most important under normal situations
* 2: secondary, next most important under normal situations
* 3: tertiary, next most important under normal situations

Throughout JupyterLab, we are mostly following principles from Google's
Material Design when selecting colors. We are not, however, following
all of MD as it is not optimized for dense, information rich UIs.
*/

:root {
  /* Elevation
   *
   * We style box-shadows using Material Design's idea of elevation. These particular numbers are taken from here:
   *
   * https://github.com/material-components/material-components-web
   * https://material-components-web.appspot.com/elevation.html
   */

  --jp-shadow-base-lightness: 0;
  --jp-shadow-umbra-color: rgba(
    var(--jp-shadow-base-lightness),
    var(--jp-shadow-base-lightness),
    var(--jp-shadow-base-lightness),
    0.2
  );
  --jp-shadow-penumbra-color: rgba(
    var(--jp-shadow-base-lightness),
    var(--jp-shadow-base-lightness),
    var(--jp-shadow-base-lightness),
    0.14
  );
  --jp-shadow-ambient-color: rgba(
    var(--jp-shadow-base-lightness),
    var(--jp-shadow-base-lightness),
    var(--jp-shadow-base-lightness),
    0.12
  );
  --jp-elevation-z0: none;
  --jp-elevation-z1: 0 2px 1px -1px var(--jp-shadow-umbra-color),
    0 1px 1px 0 var(--jp-shadow-penumbra-color),
    0 1px 3px 0 var(--jp-shadow-ambient-color);
  --jp-elevation-z2: 0 3px 1px -2px var(--jp-shadow-umbra-color),
    0 2px 2px 0 var(--jp-shadow-penumbra-color),
    0 1px 5px 0 var(--jp-shadow-ambient-color);
  --jp-elevation-z4: 0 2px 4px -1px var(--jp-shadow-umbra-color),
    0 4px 5px 0 var(--jp-shadow-penumbra-color),
    0 1px 10px 0 var(--jp-shadow-ambient-color);
  --jp-elevation-z6: 0 3px 5px -1px var(--jp-shadow-umbra-color),
    0 6px 10px 0 var(--jp-shadow-penumbra-color),
    0 1px 18px 0 var(--jp-shadow-ambient-color);
  --jp-elevation-z8: 0 5px 5px -3px var(--jp-shadow-umbra-color),
    0 8px 10px 1px var(--jp-shadow-penumbra-color),
    0 3px 14px 2px var(--jp-shadow-ambient-color);
  --jp-elevation-z12: 0 7px 8px -4px var(--jp-shadow-umbra-color),
    0 12px 17px 2px var(--jp-shadow-penumbra-color),
    0 5px 22px 4px var(--jp-shadow-ambient-color);
  --jp-elevation-z16: 0 8px 10px -5px var(--jp-shadow-umbra-color),
    0 16px 24px 2px var(--jp-shadow-penumbra-color),
    0 6px 30px 5px var(--jp-shadow-ambient-color);
  --jp-elevation-z20: 0 10px 13px -6px var(--jp-shadow-umbra-color),
    0 20px 31px 3px var(--jp-shadow-penumbra-color),
    0 8px 38px 7px var(--jp-shadow-ambient-color);
  --jp-elevation-z24: 0 11px 15px -7px var(--jp-shadow-umbra-color),
    0 24px 38px 3px var(--jp-shadow-penumbra-color),
    0 9px 46px 8px var(--jp-shadow-ambient-color);

  /* Borders
   *
   * The following variables, specify the visual styling of borders in JupyterLab.
   */

  --jp-border-width: 1px;
  --jp-border-color0: var(--md-grey-400);
  --jp-border-color1: var(--md-grey-400);
  --jp-border-color2: var(--md-grey-300);
  --jp-border-color3: var(--md-grey-200);
  --jp-inverse-border-color: var(--md-grey-600);
  --jp-border-radius: 2px;

  /* UI Fonts
   *
   * The UI font CSS variables are used for the typography all of the JupyterLab
   * user interface elements that are not directly user generated content.
   *
   * The font sizing here is done assuming that the body font size of --jp-ui-font-size1
   * is applied to a parent element. When children elements, such as headings, are sized
   * in em all things will be computed relative to that body size.
   */

  --jp-ui-font-scale-factor: 1.2;
  --jp-ui-font-size0: 0.83333em;
  --jp-ui-font-size1: 13px; /* Base font size */
  --jp-ui-font-size2: 1.2em;
  --jp-ui-font-size3: 1.44em;
  --jp-ui-font-family: system-ui, -apple-system, blinkmacsystemfont, 'Segoe UI',
    helvetica, arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji',
    'Segoe UI Symbol';

  /*
   * Use these font colors against the corresponding main layout colors.
   * In a light theme, these go from dark to light.
   */

  /* Defaults use Material Design specification */
  --jp-ui-font-color0: rgba(0, 0, 0, 1);
  --jp-ui-font-color1: rgba(0, 0, 0, 0.87);
  --jp-ui-font-color2: rgba(0, 0, 0, 0.54);
  --jp-ui-font-color3: rgba(0, 0, 0, 0.38);

  /*
   * Use these against the brand/accent/warn/error colors.
   * These will typically go from light to darker, in both a dark and light theme.
   */

  --jp-ui-inverse-font-color0: rgba(255, 255, 255, 1);
  --jp-ui-inverse-font-color1: rgba(255, 255, 255, 1);
  --jp-ui-inverse-font-color2: rgba(255, 255, 255, 0.7);
  --jp-ui-inverse-font-color3: rgba(255, 255, 255, 0.5);

  /* Content Fonts
   *
   * Content font variables are used for typography of user generated content.
   *
   * The font sizing here is done assuming that the body font size of --jp-content-font-size1
   * is applied to a parent element. When children elements, such as headings, are sized
   * in em all things will be computed relative to that body size.
   */

  --jp-content-line-height: 1.6;
  --jp-content-font-scale-factor: 1.2;
  --jp-content-font-size0: 0.83333em;
  --jp-content-font-size1: 14px; /* Base font size */
  --jp-content-font-size2: 1.2em;
  --jp-content-font-size3: 1.44em;
  --jp-content-font-size4: 1.728em;
  --jp-content-font-size5: 2.0736em;

  /* This gives a magnification of about 125% in presentation mode over normal. */
  --jp-content-presentation-font-size1: 17px;
  --jp-content-heading-line-height: 1;
  --jp-content-heading-margin-top: 1.2em;
  --jp-content-heading-margin-bottom: 0.8em;
  --jp-content-heading-font-weight: 500;

  /* Defaults use Material Design specification */
  --jp-content-font-color0: rgba(0, 0, 0, 1);
  --jp-content-font-color1: rgba(0, 0, 0, 0.87);
  --jp-content-font-color2: rgba(0, 0, 0, 0.54);
  --jp-content-font-color3: rgba(0, 0, 0, 0.38);
  --jp-content-link-color: var(--md-blue-900);
  --jp-content-font-family: system-ui, -apple-system, blinkmacsystemfont,
    'Segoe UI', helvetica, arial, sans-serif, 'Apple Color Emoji',
    'Segoe UI Emoji', 'Segoe UI Symbol';

  /*
   * Code Fonts
   *
   * Code font variables are used for typography of code and other monospaces content.
   */

  --jp-code-font-size: 13px;
  --jp-code-line-height: 1.3077; /* 17px for 13px base */
  --jp-code-padding: 5px; /* 5px for 13px base, codemirror highlighting needs integer px value */
  --jp-code-font-family-default: menlo, consolas, 'DejaVu Sans Mono', monospace;
  --jp-code-font-family: var(--jp-code-font-family-default);

  /* This gives a magnification of about 125% in presentation mode over normal. */
  --jp-code-presentation-font-size: 16px;

  /* may need to tweak cursor width if you change font size */
  --jp-code-cursor-width0: 1.4px;
  --jp-code-cursor-width1: 2px;
  --jp-code-cursor-width2: 4px;

  /* Layout
   *
   * The following are the main layout colors use in JupyterLab. In a light
   * theme these would go from light to dark.
   */

  --jp-layout-color0: white;
  --jp-layout-color1: white;
  --jp-layout-color2: var(--md-grey-200);
  --jp-layout-color3: var(--md-grey-400);
  --jp-layout-color4: var(--md-grey-600);

  /* Inverse Layout
   *
   * The following are the inverse layout colors use in JupyterLab. In a light
   * theme these would go from dark to light.
   */

  --jp-inverse-layout-color0: #111;
  --jp-inverse-layout-color1: var(--md-grey-900);
  --jp-inverse-layout-color2: var(--md-grey-800);
  --jp-inverse-layout-color3: var(--md-grey-700);
  --jp-inverse-layout-color4: var(--md-grey-600);

  /* Brand/accent */

  --jp-brand-color0: var(--md-blue-900);
  --jp-brand-color1: var(--md-blue-700);
  --jp-brand-color2: var(--md-blue-300);
  --jp-brand-color3: var(--md-blue-100);
  --jp-brand-color4: var(--md-blue-50);
  --jp-accent-color0: var(--md-green-900);
  --jp-accent-color1: var(--md-green-700);
  --jp-accent-color2: var(--md-green-300);
  --jp-accent-color3: var(--md-green-100);

  /* State colors (warn, error, success, info) */

  --jp-warn-color0: var(--md-orange-900);
  --jp-warn-color1: var(--md-orange-700);
  --jp-warn-color2: var(--md-orange-300);
  --jp-warn-color3: var(--md-orange-100);
  --jp-error-color0: var(--md-red-900);
  --jp-error-color1: var(--md-red-700);
  --jp-error-color2: var(--md-red-300);
  --jp-error-color3: var(--md-red-100);
  --jp-success-color0: var(--md-green-900);
  --jp-success-color1: var(--md-green-700);
  --jp-success-color2: var(--md-green-300);
  --jp-success-color3: var(--md-green-100);
  --jp-info-color0: var(--md-cyan-900);
  --jp-info-color1: var(--md-cyan-700);
  --jp-info-color2: var(--md-cyan-300);
  --jp-info-color3: var(--md-cyan-100);

  /* Cell specific styles */

  --jp-cell-padding: 5px;
  --jp-cell-collapser-width: 8px;
  --jp-cell-collapser-min-height: 20px;
  --jp-cell-collapser-not-active-hover-opacity: 0.6;
  --jp-cell-editor-background: var(--md-grey-100);
  --jp-cell-editor-border-color: var(--md-grey-300);
  --jp-cell-editor-box-shadow: inset 0 0 2px var(--md-blue-300);
  --jp-cell-editor-active-background: var(--jp-layout-color0);
  --jp-cell-editor-active-border-color: var(--jp-brand-color1);
  --jp-cell-prompt-width: 64px;
  --jp-cell-prompt-font-family: var(--jp-code-font-family-default);
  --jp-cell-prompt-letter-spacing: 0;
  --jp-cell-prompt-opacity: 1;
  --jp-cell-prompt-not-active-opacity: 0.5;
  --jp-cell-prompt-not-active-font-color: var(--md-grey-700);

  /* A custom blend of MD grey and blue 600
   * See https://meyerweb.com/eric/tools/color-blend/#546E7A:1E88E5:5:hex */
  --jp-cell-inprompt-font-color: #307fc1;

  /* A custom blend of MD grey and orange 600
   * https://meyerweb.com/eric/tools/color-blend/#546E7A:F4511E:5:hex */
  --jp-cell-outprompt-font-color: #bf5b3d;

  /* Notebook specific styles */

  --jp-notebook-padding: 10px;
  --jp-notebook-select-background: var(--jp-layout-color1);
  --jp-notebook-multiselected-color: var(--md-blue-50);

  /* The scroll padding is calculated to fill enough space at the bottom of the
  notebook to show one single-line cell (with appropriate padding) at the top
  when the notebook is scrolled all the way to the bottom. We also subtract one
  pixel so that no scrollbar appears if we have just one single-line cell in the
  notebook. This padding is to enable a 'scroll past end' feature in a notebook.
  */
  --jp-notebook-scroll-padding: calc(
    100% - var(--jp-code-font-size) * var(--jp-code-line-height) -
      var(--jp-code-padding) - var(--jp-cell-padding) - 1px
  );

  /* Rendermime styles */

  --jp-rendermime-error-background: #fdd;
  --jp-rendermime-table-row-background: var(--md-grey-100);
  --jp-rendermime-table-row-hover-background: var(--md-light-blue-50);

  /* Dialog specific styles */

  --jp-dialog-background: rgba(0, 0, 0, 0.25);

  /* Console specific styles */

  --jp-console-padding: 10px;

  /* Toolbar specific styles */

  --jp-toolbar-border-color: var(--jp-border-color1);
  --jp-toolbar-micro-height: 8px;
  --jp-toolbar-background: var(--jp-layout-color1);
  --jp-toolbar-box-shadow: 0 0 2px 0 rgba(0, 0, 0, 0.24);
  --jp-toolbar-header-margin: 4px 4px 0 4px;
  --jp-toolbar-active-background: var(--md-grey-300);

  /* Statusbar specific styles */

  --jp-statusbar-height: 24px;

  /* Input field styles */

  --jp-input-box-shadow: inset 0 0 2px var(--md-blue-300);
  --jp-input-active-background: var(--jp-layout-color1);
  --jp-input-hover-background: var(--jp-layout-color1);
  --jp-input-background: var(--md-grey-100);
  --jp-input-border-color: var(--jp-inverse-border-color);
  --jp-input-active-border-color: var(--jp-brand-color1);
  --jp-input-active-box-shadow-color: rgba(19, 124, 189, 0.3);

  /* General editor styles */

  --jp-editor-selected-background: #d9d9d9;
  --jp-editor-selected-focused-background: #d7d4f0;
  --jp-editor-cursor-color: var(--jp-ui-font-color0);

  /* Code mirror specific styles */

  --jp-mirror-editor-keyword-color: #008000;
  --jp-mirror-editor-atom-color: #88f;
  --jp-mirror-editor-number-color: #080;
  --jp-mirror-editor-def-color: #00f;
  --jp-mirror-editor-variable-color: var(--md-grey-900);
  --jp-mirror-editor-variable-2-color: rgb(0, 54, 109);
  --jp-mirror-editor-variable-3-color: #085;
  --jp-mirror-editor-punctuation-color: #05a;
  --jp-mirror-editor-property-color: #05a;
  --jp-mirror-editor-operator-color: #a2f;
  --jp-mirror-editor-comment-color: #408080;
  --jp-mirror-editor-string-color: #ba2121;
  --jp-mirror-editor-string-2-color: #708;
  --jp-mirror-editor-meta-color: #a2f;
  --jp-mirror-editor-qualifier-color: #555;
  --jp-mirror-editor-builtin-color: #008000;
  --jp-mirror-editor-bracket-color: #997;
  --jp-mirror-editor-tag-color: #170;
  --jp-mirror-editor-attribute-color: #00c;
  --jp-mirror-editor-header-color: blue;
  --jp-mirror-editor-quote-color: #090;
  --jp-mirror-editor-link-color: #00c;
  --jp-mirror-editor-error-color: #f00;
  --jp-mirror-editor-hr-color: #999;

  /*
    RTC user specific colors.
    These colors are used for the cursor, username in the editor,
    and the icon of the user.
  */

  --jp-collaborator-color1: #ffad8e;
  --jp-collaborator-color2: #dac83d;
  --jp-collaborator-color3: #72dd76;
  --jp-collaborator-color4: #00e4d0;
  --jp-collaborator-color5: #45d4ff;
  --jp-collaborator-color6: #e2b1ff;
  --jp-collaborator-color7: #ff9de6;

  /* Vega extension styles */

  --jp-vega-background: white;

  /* Sidebar-related styles */

  --jp-sidebar-min-width: 250px;

  /* Search-related styles */

  --jp-search-toggle-off-opacity: 0.5;
  --jp-search-toggle-hover-opacity: 0.8;
  --jp-search-toggle-on-opacity: 1;
  --jp-search-selected-match-background-color: rgb(245, 200, 0);
  --jp-search-selected-match-color: black;
  --jp-search-unselected-match-background-color: var(
    --jp-inverse-layout-color0
  );
  --jp-search-unselected-match-color: var(--jp-ui-inverse-font-color0);

  /* Icon colors that work well with light or dark backgrounds */
  --jp-icon-contrast-color0: var(--md-purple-600);
  --jp-icon-contrast-color1: var(--md-green-600);
  --jp-icon-contrast-color2: var(--md-pink-600);
  --jp-icon-contrast-color3: var(--md-blue-600);

  /* Button colors */
  --jp-accept-color-normal: var(--md-blue-700);
  --jp-accept-color-hover: var(--md-blue-800);
  --jp-accept-color-active: var(--md-blue-900);
  --jp-warn-color-normal: var(--md-red-700);
  --jp-warn-color-hover: var(--md-red-800);
  --jp-warn-color-active: var(--md-red-900);
  --jp-reject-color-normal: var(--md-grey-600);
  --jp-reject-color-hover: var(--md-grey-700);
  --jp-reject-color-active: var(--md-grey-800);

  /* File or activity icons and switch semantic variables */
  --jp-jupyter-icon-color: #f37626;
  --jp-notebook-icon-color: #f37626;
  --jp-json-icon-color: var(--md-orange-700);
  --jp-console-icon-background-color: var(--md-blue-700);
  --jp-console-icon-color: white;
  --jp-terminal-icon-background-color: var(--md-grey-800);
  --jp-terminal-icon-color: var(--md-grey-200);
  --jp-text-editor-icon-color: var(--md-grey-700);
  --jp-inspector-icon-color: var(--md-grey-700);
  --jp-switch-color: var(--md-grey-400);
  --jp-switch-true-position-color: var(--md-orange-900);
}
</style>
<style type="text/css">
/* Force rendering true colors when outputing to pdf */
* {
  -webkit-print-color-adjust: exact;
}

/* Misc */
a.anchor-link {
  display: none;
}

/* Input area styling */
.jp-InputArea {
  overflow: hidden;
}

.jp-InputArea-editor {
  overflow: hidden;
}

.cm-editor.cm-s-jupyter .highlight pre {
/* weird, but --jp-code-padding defined to be 5px but 4px horizontal padding is hardcoded for pre.cm-line */
  padding: var(--jp-code-padding) 4px;
  margin: 0;

  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
  color: inherit;

}

.jp-OutputArea-output pre {
  line-height: inherit;
  font-family: inherit;
}

.jp-RenderedText pre {
  color: var(--jp-content-font-color1);
  font-size: var(--jp-code-font-size);
}

/* Hiding the collapser by default */
.jp-Collapser {
  display: none;
}

@page {
    margin: 0.5in; /* Margin for each printed piece of paper */
}

@media print {
  .jp-Cell-inputWrapper,
  .jp-Cell-outputWrapper {
    display: block;
  }
}
</style>
<!-- Load mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML-full,Safe"> </script>
<!-- MathJax configuration -->
<script type="text/x-mathjax-config">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: {
                    automatic: true
                    }
                }
            });

            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
<!-- End of mathjax configuration --><script type="module">
  document.addEventListener("DOMContentLoaded", async () => {
    const diagrams = document.querySelectorAll(".jp-Mermaid > pre.mermaid");
    // do not load mermaidjs if not needed
    if (!diagrams.length) {
      return;
    }
    const mermaid = (await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs")).default;
    const parser = new DOMParser();

    mermaid.initialize({
      maxTextSize: 100000,
      maxEdges: 100000,
      startOnLoad: false,
      fontFamily: window
        .getComputedStyle(document.body)
        .getPropertyValue("--jp-ui-font-family"),
      theme: document.querySelector("body[data-jp-theme-light='true']")
        ? "default"
        : "dark",
    });

    let _nextMermaidId = 0;

    function makeMermaidImage(svg) {
      const img = document.createElement("img");
      const doc = parser.parseFromString(svg, "image/svg+xml");
      const svgEl = doc.querySelector("svg");
      const { maxWidth } = svgEl?.style || {};
      const firstTitle = doc.querySelector("title");
      const firstDesc = doc.querySelector("desc");

      img.setAttribute("src", `data:image/svg+xml,${encodeURIComponent(svg)}`);
      if (maxWidth) {
        img.width = parseInt(maxWidth);
      }
      if (firstTitle) {
        img.setAttribute("alt", firstTitle.textContent);
      }
      if (firstDesc) {
        const caption = document.createElement("figcaption");
        caption.className = "sr-only";
        caption.textContent = firstDesc.textContent;
        return [img, caption];
      }
      return [img];
    }

    async function makeMermaidError(text) {
      let errorMessage = "";
      try {
        await mermaid.parse(text);
      } catch (err) {
        errorMessage = `${err}`;
      }

      const result = document.createElement("details");
      result.className = 'jp-RenderedMermaid-Details';
      const summary = document.createElement("summary");
      summary.className = 'jp-RenderedMermaid-Summary';
      const pre = document.createElement("pre");
      const code = document.createElement("code");
      code.innerText = text;
      pre.appendChild(code);
      summary.appendChild(pre);
      result.appendChild(summary);

      const warning = document.createElement("pre");
      warning.innerText = errorMessage;
      result.appendChild(warning);
      return [result];
    }

    async function renderOneMarmaid(src) {
      const id = `jp-mermaid-${_nextMermaidId++}`;
      const parent = src.parentNode;
      let raw = src.textContent.trim();
      const el = document.createElement("div");
      el.style.visibility = "hidden";
      document.body.appendChild(el);
      let results = null;
      let output = null;
      try {
        let { svg } = await mermaid.render(id, raw, el);
        svg = cleanMermaidSvg(svg);
        results = makeMermaidImage(svg);
        output = document.createElement("figure");
        results.map(output.appendChild, output);
      } catch (err) {
        parent.classList.add("jp-mod-warning");
        results = await makeMermaidError(raw);
        output = results[0];
      } finally {
        el.remove();
      }
      parent.classList.add("jp-RenderedMermaid");
      parent.appendChild(output);
    }


    /**
     * Post-process to ensure mermaid diagrams contain only valid SVG and XHTML.
     */
    function cleanMermaidSvg(svg) {
      return svg.replace(RE_VOID_ELEMENT, replaceVoidElement);
    }


    /**
     * A regular expression for all void elements, which may include attributes and
     * a slash.
     *
     * @see https://developer.mozilla.org/en-US/docs/Glossary/Void_element
     *
     * Of these, only `<br>` is generated by Mermaid in place of `\n`,
     * but _any_ "malformed" tag will break the SVG rendering entirely.
     */
    const RE_VOID_ELEMENT =
      /<\s*(area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)\s*([^>]*?)\s*>/gi;

    /**
     * Ensure a void element is closed with a slash, preserving any attributes.
     */
    function replaceVoidElement(match, tag, rest) {
      rest = rest.trim();
      if (!rest.endsWith('/')) {
        rest = `${rest} /`;
      }
      return `<${tag} ${rest}>`;
    }

    void Promise.all([...diagrams].map(renderOneMarmaid));
  });
</script>
<style>
  .jp-Mermaid:not(.jp-RenderedMermaid) {
    display: none;
  }

  .jp-RenderedMermaid {
    overflow: auto;
    display: flex;
  }

  .jp-RenderedMermaid.jp-mod-warning {
    width: auto;
    padding: 0.5em;
    margin-top: 0.5em;
    border: var(--jp-border-width) solid var(--jp-warn-color2);
    border-radius: var(--jp-border-radius);
    color: var(--jp-ui-font-color1);
    font-size: var(--jp-ui-font-size1);
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .jp-RenderedMermaid figure {
    margin: 0;
    overflow: auto;
    max-width: 100%;
  }

  .jp-RenderedMermaid img {
    max-width: 100%;
  }

  .jp-RenderedMermaid-Details > pre {
    margin-top: 1em;
  }

  .jp-RenderedMermaid-Summary {
    color: var(--jp-warn-color2);
  }

  .jp-RenderedMermaid:not(.jp-mod-warning) pre {
    display: none;
  }

  .jp-RenderedMermaid-Summary > pre {
    display: inline-block;
    white-space: normal;
  }
</style>
<!-- End of mermaid configuration --></head>
<body class="jp-Notebook" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light">
<main>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><font size="8"><b>Homework 2: AirBnB Document Database</b></font></p>
<p><strong>Group number:</strong> <strong><code>5</code></strong></p>
<p><strong>Group members:</strong></p>
<center>
<table>
<thead>
<tr>
<th style="text-align:center">STUDENT NAME</th>
<th style="text-align:center">STUDENT NUMBER</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Alexandre Gonalves</td>
<td style="text-align:center">20240738</td>
</tr>
<tr>
<td style="text-align:center">Andr Silvestre</td>
<td style="text-align:center">20240502</td>
</tr>
<tr>
<td style="text-align:center">Filipa Pereira</td>
<td style="text-align:center">20240509</td>
</tr>
<tr>
<td style="text-align:center">Joo Henriques</td>
<td style="text-align:center">20240499</td>
</tr>
<tr>
<td style="text-align:center">Umeima Mahomed</td>
<td style="text-align:center">20240543</td>
</tr>
</tbody>
</table>
</center>
<p><strong>The Homework 2 is comprised of two parts:</strong></p>
<ol>
<li>Data modelling (15 points - $37.5\%$).</li>
<li>Queries to database to answer the questions (25 points - $62.5\%$).</li>
</ol>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p style="text-align: center !important;">
<!-- AirBnB Logo  -->
<img alt="No description has been provided for this image" src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/Airbnb_Logo_B%C3%A9lo.svg/1280px-Airbnb_Logo_B%C3%A9lo.svg.png" style="height: 100px !important;"/>
<br/>
<!-- Style Text with same style as AirBnB -->
<span style="color: #FF5A5F !important; font-size: 30px !important; font-weight: bold !important;">Document Database</span><span style="color: #484848 !important; font-size: 30px !important; font-weight: bold !important;"> MongoDB - Group 5</span>
</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><font size="6"><b>1. Data Modelling</b></font></p>
<p><font size="4">Congratulations! Youve been hired as part of the new Data Engineering and Management team in the AirBNB Business Intelligence department. The company is restructuring due to unsatisfactory performance from the previous teams.</font></p>
<p>Before leaving, the head of the Data Modelling department highlighted several issues:</p>
<p><strong>Data Storage</strong>: A lot of data about AirBNB listings is stored in a single document. While this approach has some advantages, it has also caused performance issues. Queries are slow, and the team didnt apply patterns, which could improve performance by optimizing the data model. Indexes were also not used.</p>
<p><strong>Reviews Growth</strong>: The number of reviews for AirBNB is growing rapidly. Currently, we overwrite reviews regularly, but the Business Intelligence department will benefit from storing all reviews and analyzing them over time.</p>
<p><strong>Data Errors</strong>: There are errors in the data collection, such as duplicate data entries and incorrect timestamps for transactions. The new team will need to decide how to fix these issues.</p>
<p><strong>Your Role</strong>: In your new role, youll need to consider how each database query is used, how often it is needed, and its impact on reads and writes. You should update the database schema to optimize for business use cases. Use tools like embedding, linking, indexes, and patterns to improve the data model. You may need to create new fields, documents, or collections. Be sure to document the pattern youre applying and the reasons behind your decisions, especially when dealing with duplication and risks of outdated data.</p>
<p><strong>Key tasks include</strong>:</p>
<ol>
<li>Streamlining the data collection process.</li>
<li>Cleaning up the data and optimizing what will be returned for each use case.</li>
<li>Applying the correct patterns to speed up common queries.</li>
<li>Ensuring departments get accurate and relevant information from the database.</li>
<li>Sharing the updated data model schema with other departments.</li>
</ol>
<p><strong>Good Practices</strong>: [Check Chapter 6, Mastering MongoDB]</p>
<ol>
<li>All newly created fields should have capitalized names.</li>
<li>New queries should work with the most up-to-date database version. If you make multiple changes, all queries should still work after the final updates.</li>
<li>For some queries, you may need to change the database schema.</li>
<li>When you are applying specific patterns, like polymorphic, subset, or bucket, name them accordingly.</li>
<li>Document each major transformation using this format:</li>
</ol>
<p><em>We applied {transformation name} because {reasoning behind it}. We expect {change/result} based on {observable measure, such as query speed, number of documents returned, index use, etc.}.</em></p>

</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Data Cleanup and Schema Adjustments:</strong> [9 points in total]</p>
<ol>
<li>Before working on the queries below, review the data and adjust the schema based on the typical use case described.</li>
</ol>
<p><strong>Typical Use Case</strong>: The most common use of the database is to show property listing information to customers. A query retrieves a listing document from the database. Currently, retrieving a listing takes too long. Decide what information should be included in a typical query and optimize the structure accordingly. For example, customers usually only need a sample of reviews, not all reviews (even though all reviews are stored). They also dont need past transaction data. Update the document schema to fit this use case. This might involve creating new collections or documents.</p>
<p><strong>Data Cleanup</strong>: Review the data for any errors (such as transactions that dont belong to the listing) or unnecessary duplication, and clean it up where needed.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><font size="6"><b>2. Uses for the database</b></font></p>
<p><font size="4">Different AirBNB departments require different analytics from our common database.
Below are the specific questions from various departments:</font></p>
<p><strong>Standard Difficulty Questions:</strong> [2 points per question]</p>
<ol start="2">
<li><p>Once a month, we reward hosts with recognition. Select three superhosts with at least two listings that can accommodate more than four people.</p>
</li>
<li><p>The company considers inevsting into property to rent. Which bed type is most common in listings with a waterfront and a dishwasher in New York?</p>
</li>
<li><p>We're considering hiring someone to write reviews professionally. Who wrote the longest review in New York?</p>
</li>
<li><p>To assess the security of different areas, what is the biggest and smallest (price-security deposit) difference per number of visitors at a property?</p>
</li>
<li><p>Identify areas by whether they are typically used for short breaks, like weekend mini breaks, or whether they are more suitable for long trips. This information support targeted advertising of different customer types. It is not expected to change much over time so we wont look to update it, we just require current view. What is the average duration of stay (in nights) per type of property per city (you can use the maximum_nights to measure length of stays)? For each property type return the city with the highest and lowest average value.</p>
</li>
</ol>
<p><strong>Advanced Difficulty Questions (Consider database optimization for these queries):</strong> [3 points per question]</p>
<ol start="7">
<li><p>We are creating a new webpage for hosts when setting up their account. It will list suggested typical amenities. This data will need to be available every time a host registers a property but is not expected to change very much. The starting point for the list will be all unique amenities currently listed in properties (across all documents). Optimise the database for this use case and show how the data should be queried.</p>
</li>
<li><p>We plan to rtack our reviewers better. We want to create a webpage that shows the top 20 reviewers and the count of the number of reviews of each of these reviewers. This webpage should be kept up to date. It should also have a link to return the number of reviews for a given reviewer ID or Name (show how to query for number of reviews by ID or query quickly).</p>
</li>
<li><p>For each property we store review scores across different metrics (accuracy, check-in, cleanliness etc). We consider adding more metrics, although there is no clarity on what these will be. We want to be able to easily query the average score across all of these metrics, including any new metrics that might be added without changing the query. Adjust the data model so this can be done and show the query for an example property.</p>
</li>
<li><p>We aim to have better access to information about transaction, we wish to develop a search engine that can calculate the average value of transactions in a given period of time quickly for a given property.</p>
</li>
<li><p>We wish to have a summary webpage that displays information about our top destinations. This webpage should display for each of the top 10 cities some basic information about our operations in the area (number of properties by type for example, average price by type) but you can choose the metrics. For each of the top 10 cities it should also provide some basic information about the top 3 properties in each city (price, number of review, whatever you think useful) to show an example of the properties available in the area. We would like to keep this webpage up to date as information changes.</p>
</li>
</ol>
<p><strong>Database updates:</strong> [2 points per question]</p>
<p>After optimizing the database, show how to complete the following updates. You can create fictional data. Ensure that previous data does not become stale:</p>
<ol start="12">
<li><p>Add a new property with a new host in one of the top 10 cities. The host selects the top 10 most common amenities to list.</p>
</li>
<li><p>Add a new review from one of our top 20 reviewers for this new property.</p>
</li>
<li><p>Add a new review metric called 'x_factor' with a score of 10. Show that the average score across all metrics is correctly calculated for this listing, using the previously developed query.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Setup"><strong>Setup</strong><a class="anchor-link" href="#Setup"></a></h3><ol>
<li><p>run Jupyter</p>
</li>
<li><p>run Docker</p>
</li>
<li><p>create MongoDB container in Command Prompt: make sure you don't have 'leftover' container from previous runs</p>
<pre><code> docker run --name mongodb -d -e MONGO_INITDB_ROOT_USERNAME=AzureDiamond -e MONGO_INITDB_ROOT_PASSWORD=hunter2 -p 27017:27017 mongo

</code></pre>
</li>
<li><p>run Studio3T</p>
</li>
<li><p>create New Connection OR reconnect to existing Connection:</p>
<p>5.A	In Studio3T create Connection:
         a.	Press Connection -&gt; New Connection
         b.	Insert credentials into URI field: mongodb://AzureDiamond:hunter2@localhost:27017
         c.	Press Test Connection
         d.	Assign a name to the Connection (top empty line) -&gt; Save
         e.	Press Connect</p>
<p>5.B In Studio3T reconnect to Connection:
         a. press Connect (top left corner)
         b. choose MongoDB connection  -&gt; press Connect (MongoDB container must be runnning by this time)</p>
</li>
<li><p>In Studio3T import the Database:
      a.	Press Import
      b.	Choose BSON mongodump archive 
      c.	Find your database path
      d.	Select All file formats and choose the database file sampledata.archive
      e.	Press Run: be patient while the database loads
      f.	Inspect the collections and documents</p>
</li>
</ol>
<p>Done!</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<div class="alert alert-block alert-warning">
<h2 id="Important"><strong>Important</strong><a class="anchor-link" href="#Important"></a></h2><p><strong>NOTE</strong> To avoid confusion between the <strong><code>sample_airbnb</code></strong> dataset from class and the one from <strong>HW2</strong>, we rename this collection to <strong><code>listingsAndReviews_HW2</code></strong> in <strong>Studio 3T</strong>.</p>
<p>Left Side Menu &gt; Open the <em>sample_airbnb</em> database &gt; Click on the collections (you should see <strong><code>(2)</code></strong>) &gt; Right-click on the <strong><code>listingsAndReviews_HW2</code></strong> collection &gt; Right-click &gt; *<strong>Rename Collection</strong>* &gt; <strong><code>listingsAndReviews_HW2</code></strong></p>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[191]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Python Connector</span>

<span class="c1"># !pip install pymongo</span>
<span class="c1"># or #!conda install -y pymongo</span>

<span class="kn">import</span> <span class="nn">re</span>                                       <span class="c1"># Regular Expressions</span>
<span class="kn">import</span> <span class="nn">time</span>                                     <span class="c1"># For calculating time of execution</span>
<span class="kn">import</span> <span class="nn">json</span>                                     <span class="c1"># For JSON operations</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>                              <span class="c1"># For numerical operations</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>                             <span class="c1"># For data manipulation</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_rows'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>         <span class="c1"># Display all rows</span>

<span class="c1"># Disable FutureWarning messages</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">'ignore'</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>                           <span class="c1"># Progress bar</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>                       <span class="c1"># Pretty print</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>                   <span class="c1"># Datetime operations</span>

<span class="c1"># MongoDB</span>
<span class="kn">import</span> <span class="nn">bson</span>
<span class="kn">from</span> <span class="nn">bson.objectid</span> <span class="kn">import</span> <span class="n">ObjectId</span>
<span class="kn">from</span> <span class="nn">bson.decimal128</span> <span class="kn">import</span> <span class="n">Decimal128</span>
<span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>

<span class="c1"># Connection</span>
<span class="n">user</span><span class="o">=</span><span class="s2">"AzureDiamond"</span>
<span class="n">password</span><span class="o">=</span><span class="s2">"hunter2"</span>
<span class="n">host</span><span class="o">=</span><span class="s2">"localhost"</span>
<span class="n">port</span><span class="o">=</span><span class="s2">"27017"</span>
<span class="n">protocol</span><span class="o">=</span><span class="s2">"mongodb"</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Database check</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">sample_airbnb</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Database info: </span><span class="si">{</span><span class="n">db</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">name</span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Database info: Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=True), 'sample_airbnb')

</pre>
</div>
</div>
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[191]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>'sample_airbnb'</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1 id="Loading-and-Inspecting-database"><strong>Loading and Inspecting database</strong><a class="anchor-link" href="#Loading-and-Inspecting-database"></a></h1>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[192]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Collections are inside our Database 'sample_analytics'</span>

<span class="n">collection_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">list_collection_names</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The database contains </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">collection_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> collections"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"All collections: </span><span class="si">{</span><span class="n">collection_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Collection </span><span class="si">{</span><span class="n">collection_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> contains </span><span class="si">{</span><span class="n">db</span><span class="p">[</span><span class="n">collection_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span><span class="si">}</span><span class="s2"> documents"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>The database contains 2 collections
All collections: ['listingsAndReviews_HW2', 'listingsAndReviews']
Collection listingsAndReviews_HW2 contains 5555 documents
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><a href="https://pymongo.readthedocs.io/en/stable/api/pymongo/collection.html">PyMongo documentation</a></p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[193]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Estimate average document size</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>                   <span class="c1"># Cursor to iterate over documents</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">bson</span><span class="o">.</span><span class="n">BSON</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>      <span class="c1"># Calculate size of each document</span>
<span class="n">avg_size_kb</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span>                <span class="c1"># Average size in KB</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mAverage document size:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">avg_size_kb</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> KB"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre><span class="ansi-bold">Average document size:</span> 67.09 KB
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1 id="%F0%9F%93%9A-Database-Schema"><strong> Database Schema</strong><a class="anchor-link" href="#%F0%9F%93%9A-Database-Schema"></a></h1>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-1"><strong>Question 1</strong><a class="anchor-link" href="#Question-1"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[194]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># **Data Cleanup and Schema Adjustments:** [9 points in total]</span>

<span class="c1"># 1) Before working on the queries below, review the data and adjust the schema based on the typical use case described.</span>

<span class="c1"># **Typical Use Case**: The most common use of the database is to show property listing information to customers. </span>
<span class="c1">#                       A query retrieves a listing document from the database. Currently, retrieving a listing takes too long. </span>
<span class="c1">#                       Decide what information should be included in a typical query and optimize the structure accordingly.  </span>
<span class="c1">#                       For example, customers usually only need a sample of reviews, not all reviews (even though all reviews are stored). </span>
<span class="c1">#                       They also dont need past transaction data. </span>
<span class="c1">#                       Update the document schema to fit this use case. </span>
<span class="c1">#                       This might involve creating new collections or documents.</span>

<span class="c1"># **Data Cleanup**: Review the data for any errors (such as transactions that don't belong to the listing) or unnecessary duplication, and clean it up where needed.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[195]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Find one document in the collection 'listingsAndReviews'</span>
<span class="n">document</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find_one</span><span class="p">()</span>
<span class="c1"># pprint(document)                                                                     # Large output, uncomment to see or open "airbnb_document.json" file</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">In total, the first document contains </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="si">}</span><span class="s2"> top-level fields"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
In total, the first document contains 64 top-level fields
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[196]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># EXTRA: Save the document to a JSON file (to see the structure more clearly)</span>
<span class="k">def</span> <span class="nf">convert_to_serializable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Converts non-serializable objects (like Decimal128 and datetime) to strings.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Decimal128</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Object of type '</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">' is not JSON serializable"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_to_json_file</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">"airbnb_document.json"</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Saves a MongoDB document to a JSON file, handling non-serializable data types.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">convert_to_serializable</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Document saved to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error saving to JSON file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[197]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Save the document from 'listingsAndReviews_HW2' Collection to a JSON file</span>
<span class="n">save_to_json_file</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Document saved to airbnb_document.json
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[198]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Query to retrieve all fields names from the collection 'listingsAndReviews' (Using aggregation)</span>
<span class="c1"># Define the aggregation pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"fields"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$objectToArray"</span><span class="p">:</span> <span class="s2">"$$ROOT"</span><span class="p">}}},</span>  <span class="c1"># Convert document to key-value pairs          | Source: https://www.mongodb.com/docs/manual/reference/aggregation-variables/#mongodb-variable-variable.ROOT</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$fields"</span><span class="p">},</span>                                  <span class="c1"># Flatten the fields array                     | Source: https://www.mongodb.com/docs/manual/reference/operator/aggregation/unwind/</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$fields.k"</span><span class="p">}}</span>                         <span class="c1"># Group by field names to get distinct fields  | Source: https://www.mongodb.com/docs/manual/reference/operator/aggregation/group/</span>
<span class="p">]</span>

<span class="c1"># Execute the aggregation</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>

<span class="c1"># Extract distinct fields from the result</span>
<span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="s2">"_id"</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>

<span class="c1"># Print the list of unique fields</span>
<span class="n">pprint</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">In total, the collection contains </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique top-level fields"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>['_id',
 'access',
 'accommodates',
 'address',
 'amenities',
 'availability',
 'bathrooms',
 'bed_type',
 'bedrooms',
 'beds',
 'calendar_last_scraped',
 'cancellation_policy',
 'cleaning_fee',
 'description',
 'extra_people',
 'first_review',
 'guests_included',
 'host_about',
 'host_has_profile_pic',
 'host_id',
 'host_identity_verified',
 'host_is_superhost',
 'host_listings_count',
 'host_location',
 'host_name',
 'host_neighbourhood',
 'host_picture_url',
 'host_response_rate',
 'host_response_time',
 'host_thumbnail_url',
 'host_total_listings_count',
 'host_url',
 'host_verifications',
 'house_rules',
 'images',
 'interaction',
 'last_review',
 'last_scraped',
 'listing_url',
 'maximum_nights',
 'minimum_nights',
 'monthly_price',
 'name',
 'neighborhood_overview',
 'notes',
 'number_of_reviews',
 'price',
 'property_type',
 'review_scores_checkin',
 'review_scores_cleanliness',
 'review_scores_communication',
 'review_scores_location',
 'review_scores_rating',
 'review_scores_value',
 'reviews',
 'reviews_copy1',
 'reviews_copy2',
 'reviews_copy3',
 'reviews_copy4',
 'reviews_per_month',
 'room_type',
 'security_deposit',
 'space',
 'summary',
 'transactions',
 'transit',
 'weekly_price']

In total, the collection contains 67 unique top-level fields
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li>The code above just return the <strong>"top-level" fields</strong> of the document.</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[199]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Function to recursively extract all fields from a document (nested dictionaries and lists)</span>
<span class="k">def</span> <span class="nf">extract_fields</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">""</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Recursively extract all fields from a document.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj: The object to process (dict, list, or other type). </span>
<span class="sd">        prefix (str, optional): String prefix for nested fields (e.g., "address" becomes "address.country"). Defaults to "".</span>

<span class="sd">    Returns:</span>
<span class="sd">        fields: A set of unique field names found in the document.</span>
<span class="sd">    """</span>
    
    <span class="c1"># Initialize an empty set to store unique fields</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    
    <span class="c1"># Check if the object is a dictionary (e.g., a MongoDB document or subdocument)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># Iterate over field:value pairs in the dictionary</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Construct the full field name; no dot if prefix is empty, otherwise add dot separator</span>
            <span class="n">full_field</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">k</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">"</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">full_field</span><span class="p">)</span>                                                      <span class="c1"># Add the full field to the set</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extract_fields</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">full_field</span><span class="p">))</span>                                <span class="c1"># Recursively extract fields from the value, using the current field as prefix</span>
            
    <span class="c1"># Check if the object is a list (e.g., an array like 'reviews' or 'amenities')</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c1"># Iterate over each item in the list</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
            <span class="c1"># Recursively extract fields from the item, keeping the same prefix</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extract_fields</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">prefix</span><span class="p">))</span>
            
    <span class="k">return</span> <span class="n">fields</span>

<span class="c1"># Aggregate to get all documents and process them</span>
<span class="n">all_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">():</span>
    <span class="n">doc_fields</span> <span class="o">=</span> <span class="n">extract_fields</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="n">all_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">doc_fields</span><span class="p">)</span>

<span class="c1"># Convert to sorted list for readability</span>
<span class="n">unique_fields</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">all_fields</span><span class="p">))</span>

<span class="c1"># Print the list of unique fields</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">unique_fields</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"In total, there are </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_fields</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique fields</span><span class="se">\033</span><span class="s2">[0m in the collection 'listingsAndReviews_HW2'"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>['_id',
 'access',
 'accommodates',
 'address',
 'address.country',
 'address.country_code',
 'address.government_area',
 'address.location',
 'address.location.coordinates',
 'address.location.is_location_exact',
 'address.location.type',
 'address.market',
 'address.street',
 'address.suburb',
 'amenities',
 'availability',
 'availability.availability_30',
 'availability.availability_365',
 'availability.availability_60',
 'availability.availability_90',
 'bathrooms',
 'bed_type',
 'bedrooms',
 'beds',
 'calendar_last_scraped',
 'cancellation_policy',
 'cleaning_fee',
 'description',
 'extra_people',
 'first_review',
 'guests_included',
 'host_about',
 'host_has_profile_pic',
 'host_id',
 'host_identity_verified',
 'host_is_superhost',
 'host_listings_count',
 'host_location',
 'host_name',
 'host_neighbourhood',
 'host_picture_url',
 'host_response_rate',
 'host_response_time',
 'host_thumbnail_url',
 'host_total_listings_count',
 'host_url',
 'host_verifications',
 'house_rules',
 'images',
 'images.medium_url',
 'images.picture_url',
 'images.thumbnail_url',
 'images.xl_picture_url',
 'interaction',
 'last_review',
 'last_scraped',
 'listing_url',
 'maximum_nights',
 'minimum_nights',
 'monthly_price',
 'name',
 'neighborhood_overview',
 'notes',
 'number_of_reviews',
 'price',
 'property_type',
 'review_scores_checkin',
 'review_scores_cleanliness',
 'review_scores_communication',
 'review_scores_location',
 'review_scores_rating',
 'review_scores_value',
 'reviews',
 'reviews._id',
 'reviews.comments',
 'reviews.date',
 'reviews.listing_id',
 'reviews.reviewer_id',
 'reviews.reviewer_name',
 'reviews_copy1',
 'reviews_copy1._id',
 'reviews_copy1.comments',
 'reviews_copy1.date',
 'reviews_copy1.listing_id',
 'reviews_copy1.reviewer_id',
 'reviews_copy1.reviewer_name',
 'reviews_copy2',
 'reviews_copy2._id',
 'reviews_copy2.comments',
 'reviews_copy2.date',
 'reviews_copy2.listing_id',
 'reviews_copy2.reviewer_id',
 'reviews_copy2.reviewer_name',
 'reviews_copy3',
 'reviews_copy3._id',
 'reviews_copy3.comments',
 'reviews_copy3.date',
 'reviews_copy3.listing_id',
 'reviews_copy3.reviewer_id',
 'reviews_copy3.reviewer_name',
 'reviews_copy4',
 'reviews_copy4._id',
 'reviews_copy4.comments',
 'reviews_copy4.date',
 'reviews_copy4.listing_id',
 'reviews_copy4.reviewer_id',
 'reviews_copy4.reviewer_name',
 'reviews_per_month',
 'room_type',
 'security_deposit',
 'space',
 'summary',
 'transactions',
 'transactions.bucket_end_date',
 'transactions.bucket_start_date',
 'transactions.transaction_count',
 'transactions.transactions',
 'transactions.transactions.date',
 'transactions.transactions.price',
 'transit',
 'weekly_price']
In total, there are <span class="ansi-bold">121 unique fields</span> in the collection 'listingsAndReviews_HW2'
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Initial-Data-Inspection-and-Findings"><strong>Initial Data Inspection and Findings</strong><a class="anchor-link" href="#Initial-Data-Inspection-and-Findings"></a></h5><p>The initial inspection of a sample document and the extraction of all unique field paths (both top-level and nested) reveal a complex structure within the <code>listingsAndReviews_HW2</code> collection. We identified <strong>121 unique field paths</strong>, indicating potentially large documents and complexity.</p>
<p>Key findings align with the issues mentioned in the homework brief:</p>
<ol>
<li><strong>Embedded Data &amp; Large Documents:</strong> Significant data is embedded:<ul>
<li><strong>Host Information:</strong> Details like <code>host_name</code>, <code>host_about</code>, <code>host_location</code> are repeated for every listing by the same host.</li>
<li><strong>Reviews:</strong> The <code>reviews</code> array (and redundant <code>reviews_copy*</code> fields) can be very large, directly contributing to the identified performance issues (slow queries) and violating MongoDB's recommendation against unbounded arrays. The average document size is initially ~67 KB, but listings with many reviews are likely much larger.</li>
<li><strong>Transactions:</strong> Transaction data is also embedded within a subdocument.</li>
</ul>
</li>
<li><strong>Redundancy:</strong> The <code>reviews_copy1</code> through <code>reviews_copy4</code> fields are clear indicators of unnecessary data duplication, wasting storage and complicating updates.</li>
<li><strong>Potential Data Type Issues:</strong> Initial inspection suggests potential inconsistencies (e.g., numbers stored as strings, inconsistent use of <code>Decimal128</code>).</li>
<li><strong>Lack of Indexing:</strong> Only the default <code>_id</code> index exists, meaning queries filtering or sorting on other fields will require inefficient collection scans.</li>
</ol>
<p>These points confirm the need for schema refactoring to improve performance, scalability, and data integrity. We will address redundancy, data types, and then apply appropriate modeling patterns.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[200]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Count listings with large number of reviews</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"reviews"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}},</span>                                         <span class="c1"># Filter documents with 'reviews' field</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"reviewCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$size"</span><span class="p">:</span> <span class="s2">"$reviews"</span><span class="p">}}},</span>                               <span class="c1"># Project the size of 'reviews' array</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"reviewCount"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>                                                     <span class="c1"># Sort by review count</span>
    <span class="p">{</span><span class="s2">"$limit"</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>                                                                       <span class="c1"># Limit to top 5</span>
<span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Top 5 listings with the most reviews:"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
Top 5 listings with the most reviews:
[{'_id': '4069429', 'reviewCount': 533},
 {'_id': '12954762', 'reviewCount': 469},
 {'_id': '95560', 'reviewCount': 463},
 {'_id': '476983', 'reviewCount': 420},
 {'_id': '5283892', 'reviewCount': 408}]
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[201]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check current indexes</span>
<span class="c1"># Source: https://pymongo.readthedocs.io/en/stable/tutorial.html#indexing</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">index_information</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[201]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>{'_id_': {'v': 2, 'key': [('_id', 1)]}}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li>No fields indexed besides the key <code>_id</code></li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="%F0%9F%92%AC-1.1-%7C-Confirm-if-All-Reviews**-are-in-the-same-collection**"><strong> 1.1 | Confirm if All </strong><code>Reviews</code>** are in the same collection**<a class="anchor-link" href="#%F0%9F%92%AC-1.1-%7C-Confirm-if-All-Reviews**-are-in-the-same-collection**"></a></h4><p>We first address the obvious data redundancy issue. We suspect the <code>reviews_copy*</code> fields are duplicates of the main <code>reviews</code> array. We will verify this and then remove them.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[202]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Identify if all copies of reviews contain the same data as 'reviews'</span>
<span class="k">def</span> <span class="nf">compare_reviews_per_document</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Compares the 'reviews' array with all 'reviews_copy*' arrays for each document in the collection.</span>
<span class="sd">    Checks if 'reviews' contains all reviews from the copies (by content) on a per-document basis.</span>

<span class="sd">    Args:</span>
<span class="sd">        verbose (bool): If True, prints detailed results for each document as they are processed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Summary of the comparison, including counts of mismatches and execution time.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Dynamically detects all fields matching 'reviews_copy*' using $objectToArray.</span>
<span class="sd">        - Compares full review content (e.g., _id, date, comments) using $setEquals.</span>
<span class="sd">        - Retains counts for additional insight.</span>
<span class="sd">        - Uses tqdm for progress tracking.</span>

<span class="sd">    Sources:</span>
<span class="sd">        - $group: https://www.mongodb.com/docs/manual/reference/operator/aggregation/group/</span>
<span class="sd">        - $project: https://www.mongodb.com/docs/manual/reference/operator/aggregation/project/</span>
<span class="sd">        - $unwind: https://www.mongodb.com/docs/manual/reference/operator/aggregation/unwind/</span>
<span class="sd">        - $objectToArray: https://www.mongodb.com/docs/manual/reference/operator/aggregation/objectToArray/</span>
<span class="sd">        - $setEquals: https://www.mongodb.com/docs/manual/reference/operator/aggregation/setEquals/</span>
<span class="sd">        - $filter: https://www.mongodb.com/docs/manual/reference/operator/aggregation/filter/</span>
<span class="sd">        - $map: https://www.mongodb.com/docs/manual/reference/operator/aggregation/map/</span>
<span class="sd">        - $reduce: https://www.mongodb.com/docs/manual/reference/operator/aggregation/reduce/</span>
<span class="sd">        - $concatArrays: https://www.mongodb.com/docs/manual/reference/operator/aggregation/concatArrays/</span>
<span class="sd">        - $regexMatch: https://www.mongodb.com/docs/manual/reference/operator/aggregation/regexMatch/</span>
<span class="sd">        - $size: https://www.mongodb.com/docs/manual/reference/operator/aggregation/size/</span>
<span class="sd">        - $ifNull: https://www.mongodb.com/docs/manual/reference/operator/aggregation/ifNull/</span>
<span class="sd">    """</span>
    <span class="c1"># Start timing the entire process</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Count total documents for tqdm progress bar</span>
    <span class="n">total_docs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span>

    <span class="c1"># Pipeline to process each document individually</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
        
        <span class="c1"># Step 1: Group by _id to process each document separately</span>
        <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>
            <span class="s2">"all_fields"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$first"</span><span class="p">:</span> <span class="s2">"$$ROOT"</span><span class="p">}</span>  <span class="c1"># Keep the entire document</span>
        <span class="p">}},</span>
        
        <span class="c1"># Step 2: Convert document fields to an array to find reviews_copy* dynamically</span>
        <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">"reviews"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$all_fields.reviews"</span><span class="p">,</span> <span class="p">[]]},</span>
            <span class="s2">"copy_fields"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"$filter"</span><span class="p">:</span> <span class="p">{</span>                                                       <span class="c1"># Filter fields that start with 'reviews_copy'</span>
                    <span class="s2">"input"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$objectToArray"</span><span class="p">:</span> <span class="s2">"$all_fields"</span><span class="p">},</span>
                    <span class="s2">"cond"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$regexMatch"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$$this.k"</span><span class="p">,</span> <span class="s2">"regex"</span><span class="p">:</span> <span class="s2">"^reviews_copy"</span><span class="p">}}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}},</span>
        
        <span class="c1"># Step 3: Extract and compare content</span>
        <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"reviews_content"</span><span class="p">:</span> <span class="s2">"$reviews"</span><span class="p">,</span>                                          <span class="c1"># Full content of reviews</span>
            <span class="s2">"copy_contents"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"$map"</span><span class="p">:</span> <span class="p">{</span>                                                           <span class="c1"># Extract the value (array) from each reviews_copy* field</span>
                    <span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$copy_fields"</span><span class="p">,</span> <span class="s2">"in"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$$this.v"</span><span class="p">,</span> <span class="p">[]]}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">"reviews_count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$size"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews"</span><span class="p">,</span> <span class="p">[]]}},</span>
            <span class="s2">"copy_counts"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"$map"</span><span class="p">:</span> <span class="p">{</span>                                                           <span class="c1"># Count reviews in each copy</span>
                    <span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$copy_fields"</span><span class="p">,</span>
                    <span class="s2">"in"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"$$this.k"</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$size"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$$this.v"</span><span class="p">,</span> <span class="p">[]]}}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}},</span>
        
        <span class="c1"># Step 4: Compare content and check containment </span>
        <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"all_copies_match_reviews"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"$reduce"</span><span class="p">:</span> <span class="p">{</span>                                                         <span class="c1"># Iterate over all copy arrays to compare with reviews</span>
                    <span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$copy_contents"</span><span class="p">,</span>
                    <span class="s2">"initialValue"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">"in"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"$and"</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">"$$value"</span><span class="p">,</span>                                               <span class="c1"># Previous comparison result</span>
                            <span class="p">{</span><span class="s2">"$setEquals"</span><span class="p">:</span> <span class="p">[</span>                                         <span class="c1"># Compare full content</span>
                                <span class="s2">"$reviews_content"</span><span class="p">,</span>
                                <span class="p">{</span><span class="s2">"$concatArrays"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews_content"</span><span class="p">,</span> <span class="s2">"$$this"</span><span class="p">]}</span>
                            <span class="p">]}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">"reviews_count"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>                                                     <span class="c1"># Return/Project counts for additional insight</span>
            <span class="s2">"copy_counts"</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}}</span>
    <span class="p">]</span>

    <span class="c1"># Execute pipeline and iterate with tqdm</span>
    <span class="n">mismatches</span> <span class="o">=</span> <span class="mi">0</span>                                              <span class="c1"># Initialize mismatch counter</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>      <span class="c1"># Execute the aggregation pipeline</span>

    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">"Comparing reviews per document"</span><span class="p">):</span>
        <span class="n">doc_id</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">"_id"</span><span class="p">]</span>
        <span class="n">all_match</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">"all_copies_match_reviews"</span><span class="p">]</span>
        <span class="n">reviews_count</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">"reviews_count"</span><span class="p">]</span>
        <span class="n">copy_counts</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]:</span> <span class="n">item</span><span class="p">[</span><span class="s2">"count"</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="s2">"copy_counts"</span><span class="p">]}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_match</span><span class="p">:</span>
            <span class="n">mismatches</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Mismatch found in document _id: </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Review counts - reviews: </span><span class="si">{</span><span class="n">reviews_count</span><span class="si">}</span><span class="s2">, copies: </span><span class="si">{</span><span class="n">copy_counts</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"Content in 'reviews' does not fully match all 'reviews_copy*' arrays."</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Document _id: </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2"> - All 'reviews_copy*' arrays match 'reviews'."</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Review counts - reviews: </span><span class="si">{</span><span class="n">reviews_count</span><span class="si">}</span><span class="s2">, copies: </span><span class="si">{</span><span class="n">copy_counts</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>


    <span class="c1"># Calculate total execution time</span>
    <span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="c1"># Summary of results</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"total_documents"</span><span class="p">:</span> <span class="n">total_docs</span><span class="p">,</span>
        <span class="s2">"mismatches_found"</span><span class="p">:</span> <span class="n">mismatches</span><span class="p">,</span>
        <span class="s2">"execution_time_seconds"</span><span class="p">:</span> <span class="n">execution_time</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">summary</span>

<span class="c1"># Run the function</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">compare_reviews_per_document</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Summary:"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>Comparing reviews per document: 5555it [00:02, 2024.08it/s]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
Summary:
{'execution_time_seconds': 2.8220977783203125,
 'mismatches_found': 0,
 'total_documents': 5555}
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li><strong>Result:</strong> The query confirms that for all documents, the content within <code>reviews_copy*</code> arrays is identical to the main <code>reviews</code> array. This confirms they are redundant.<ul>
<li><strong>Action:</strong> We will remove the <code>reviews_copy*</code> fields from all documents in the collection.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[203]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 1.1.1. Delete all 'reviews_copy*' fields from the collection 'listingsAndReviews_HW2'</span>

<span class="c1"># MongoDB update operation to remove specific 'reviews_copy*' fields</span>
<span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/method/db.collection.updateMany/</span>

<span class="c1"># Update operation to unset the specified fields</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>                                    <span class="c1"># Record start time</span>
<span class="n">update_result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
    <span class="nb">filter</span><span class="o">=</span><span class="p">{},</span>                                              <span class="c1"># Apply to all documents</span>
    <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">"$unset"</span><span class="p">:</span> <span class="p">{</span>                                     <span class="c1"># Unset the specified fields</span>
        <span class="s2">"reviews_copy1"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
        <span class="s2">"reviews_copy2"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
        <span class="s2">"reviews_copy3"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
        <span class="s2">"reviews_copy4"</span><span class="p">:</span> <span class="s2">""</span>
    <span class="p">}}</span>
<span class="p">)</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>                   <span class="c1"># Calculate execution time</span>

<span class="c1"># Print the update result</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of documents matched: </span><span class="si">{</span><span class="n">update_result</span><span class="o">.</span><span class="n">matched_count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of documents modified (fields eliminated): </span><span class="si">{</span><span class="n">update_result</span><span class="o">.</span><span class="n">modified_count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Fields deleted: ['reviews_copy1', 'reviews_copy2', 'reviews_copy3', 'reviews_copy4']"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Number of documents matched: 5555
Number of documents modified (fields eliminated): 5555
Fields deleted: ['reviews_copy1', 'reviews_copy2', 'reviews_copy3', 'reviews_copy4']
Execution time: 0.991 seconds
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We applied <strong>data cleanup by removing redundant fields</strong> (<code>reviews_copy1</code> to <code>reviews_copy4</code>) because the verification query confirmed they contained identical data to the <code>reviews</code> field, leading to unnecessary storage consumption and potential update anomalies. We expect a <strong>reduction in the total collection size and average document size</strong>, leading to <strong>faster reads and writes</strong> when accessing listing documents, as less data needs to be processed or transferred.</p>
<ul>
<li>The successful removal of these fields is confirmed by the verification query showing <strong>0 documents containing them.</strong></li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[204]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check to confirm removal</span>
<span class="n">remaining</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({</span>
    <span class="s2">"$or"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">"reviews_copy1"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
        <span class="p">{</span><span class="s2">"reviews_copy2"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
        <span class="p">{</span><span class="s2">"reviews_copy3"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
        <span class="p">{</span><span class="s2">"reviews_copy4"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>
    <span class="p">]</span>
<span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Documents with any 'reviews_copy1-4' fields remaining: </span><span class="si">{</span><span class="n">remaining</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">remaining</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Success: All specified 'reviews_copy*' fields were eliminated."</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Warning: Some 'reviews_copy1-4' fields may still exist."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Documents with any 'reviews_copy1-4' fields remaining: 0
Success: All specified 'reviews_copy*' fields were eliminated.
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="%F0%9F%94%A2%F0%9F%94%A0-1.2-%7C-Inconsistent-Data-Types"><strong> 1.2 | Inconsistent Data Types</strong><a class="anchor-link" href="#%F0%9F%94%A2%F0%9F%94%A0-1.2-%7C-Inconsistent-Data-Types"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[205]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check data types of all fields in the collection 'listingsAndReviews_HW2'</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Step 1: Extract all top-level fields and their data types (reuse the 'extract_fields' function)</span>

<span class="c1"># Aggregate to get all documents and process them</span>
<span class="n">all_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">():</span>
    <span class="n">doc_fields</span> <span class="o">=</span> <span class="n">extract_fields</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="n">all_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">doc_fields</span><span class="p">)</span>

<span class="c1"># Convert to sorted list for readability</span>
<span class="n">unique_fields</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">all_fields</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unique_fields</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>['_id', 'access', 'accommodates', 'address', 'address.country', 'address.country_code', 'address.government_area', 'address.location', 'address.location.coordinates', 'address.location.is_location_exact', 'address.location.type', 'address.market', 'address.street', 'address.suburb', 'amenities', 'availability', 'availability.availability_30', 'availability.availability_365', 'availability.availability_60', 'availability.availability_90', 'bathrooms', 'bed_type', 'bedrooms', 'beds', 'calendar_last_scraped', 'cancellation_policy', 'cleaning_fee', 'description', 'extra_people', 'first_review', 'guests_included', 'host_about', 'host_has_profile_pic', 'host_id', 'host_identity_verified', 'host_is_superhost', 'host_listings_count', 'host_location', 'host_name', 'host_neighbourhood', 'host_picture_url', 'host_response_rate', 'host_response_time', 'host_thumbnail_url', 'host_total_listings_count', 'host_url', 'host_verifications', 'house_rules', 'images', 'images.medium_url', 'images.picture_url', 'images.thumbnail_url', 'images.xl_picture_url', 'interaction', 'last_review', 'last_scraped', 'listing_url', 'maximum_nights', 'minimum_nights', 'monthly_price', 'name', 'neighborhood_overview', 'notes', 'number_of_reviews', 'price', 'property_type', 'review_scores_checkin', 'review_scores_cleanliness', 'review_scores_communication', 'review_scores_location', 'review_scores_rating', 'review_scores_value', 'reviews', 'reviews._id', 'reviews.comments', 'reviews.date', 'reviews.listing_id', 'reviews.reviewer_id', 'reviews.reviewer_name', 'reviews_per_month', 'room_type', 'security_deposit', 'space', 'summary', 'transactions', 'transactions.bucket_end_date', 'transactions.bucket_start_date', 'transactions.transaction_count', 'transactions.transactions', 'transactions.transactions.date', 'transactions.transactions.price', 'transit', 'weekly_price']
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[206]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Function to Recursively Extract Paths and Types</span>
<span class="c1"># Source: X. (2025). Grok 3 Beta  The Age of Reasoning Agents (Mar 07 version)[Large Language Model]. X.ai. https://x.ai/blog/grok-3</span>
<span class="c1">#         Google. (2025). Gemini 2.5 Pro - Gemini Pro. Google DeepMind. https://deepmind.google/technologies/gemini/pro/</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">def</span> <span class="nf">get_paths_and_types_simple</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">path_types_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Recursively finds all field paths and their Python types in a document.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">path_types_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path_types_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># Handle dictionary (subdocument)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">current_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">prefix</span> <span class="k">else</span> <span class="n">key</span>
            <span class="c1"># Add the Python type name to the set for this path</span>
            <span class="n">path_types_dict</span><span class="p">[</span><span class="n">current_path</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="c1"># Recurse if the value is complex (dict or list)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="n">get_paths_and_types_simple</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">current_path</span><span class="p">,</span> <span class="n">path_types_dict</span><span class="p">)</span>
                
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c1"># Handle list (array)</span>
        <span class="c1"># Indicate the path exists and contains a list</span>
        <span class="n">path_types_dict</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">'list'</span><span class="p">)</span> <span class="c1"># Add 'list' type for the path itself</span>
        <span class="c1"># Recurse into list elements if they are complex</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="c1"># Pass the array's prefix to find types *within* its elements</span>
                <span class="n">get_paths_and_types_simple</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">path_types_dict</span><span class="p">)</span>

<span class="c1"># --- Process All Documents ---</span>
<span class="n">all_field_types_summary</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
<span class="n">total_docs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Analyzing types across </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">total_docs</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m documents..."</span><span class="p">)</span>

<span class="c1"># Using find() iterates through documents directly</span>
<span class="c1"># Add tqdm progress bar if desired: from tqdm import tqdm</span>
<span class="c1"># for document in tqdm(db.listingsAndReviews_HW2.find(), total=total_docs, desc="Analyzing docs"):</span>
<span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">():</span>
    <span class="n">get_paths_and_types_simple</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">path_types_dict</span><span class="o">=</span><span class="n">all_field_types_summary</span><span class="p">)</span>

<span class="c1"># --- Create DataFrame ---</span>
<span class="n">df_data_list_simple</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Sort fields alphabetically for consistent output</span>
<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_field_types_summary</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="c1"># Join multiple types found for a field into a single string</span>
    <span class="n">type_str</span> <span class="o">=</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">all_field_types_summary</span><span class="p">[</span><span class="n">field</span><span class="p">])))</span>
    <span class="n">df_data_list_simple</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">"field"</span><span class="p">:</span> <span class="n">field</span><span class="p">,</span> <span class="s2">"datatypes"</span><span class="p">:</span> <span class="n">type_str</span><span class="p">})</span>

<span class="n">df_types_simple</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_data_list_simple</span><span class="p">)</span>
<span class="n">df_types_simple</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">"field"</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_types_simple</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique field paths</span><span class="se">\033</span><span class="s2">[0m. DataFrame created with data types.</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">df_types_simple</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Analyzing types across <span class="ansi-bold">5555</span> documents...
Found <span class="ansi-bold">93 unique field paths</span>. DataFrame created with data types.

</pre>
</div>
</div>
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[206]:</div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html" tabindex="0">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>datatypes</th>
</tr>
<tr>
<th>field</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>_id</th>
<td>str</td>
</tr>
<tr>
<th>access</th>
<td>str</td>
</tr>
<tr>
<th>accommodates</th>
<td>int</td>
</tr>
<tr>
<th>address</th>
<td>dict</td>
</tr>
<tr>
<th>address.country</th>
<td>str</td>
</tr>
<tr>
<th>address.country_code</th>
<td>str</td>
</tr>
<tr>
<th>address.government_area</th>
<td>str</td>
</tr>
<tr>
<th>address.location</th>
<td>dict</td>
</tr>
<tr>
<th>address.location.coordinates</th>
<td>list</td>
</tr>
<tr>
<th>address.location.is_location_exact</th>
<td>bool</td>
</tr>
<tr>
<th>address.location.type</th>
<td>str</td>
</tr>
<tr>
<th>address.market</th>
<td>str</td>
</tr>
<tr>
<th>address.street</th>
<td>str</td>
</tr>
<tr>
<th>address.suburb</th>
<td>str</td>
</tr>
<tr>
<th>amenities</th>
<td>list</td>
</tr>
<tr>
<th>availability</th>
<td>dict</td>
</tr>
<tr>
<th>availability.availability_30</th>
<td>int</td>
</tr>
<tr>
<th>availability.availability_365</th>
<td>int</td>
</tr>
<tr>
<th>availability.availability_60</th>
<td>int</td>
</tr>
<tr>
<th>availability.availability_90</th>
<td>int</td>
</tr>
<tr>
<th>bathrooms</th>
<td>Decimal128</td>
</tr>
<tr>
<th>bed_type</th>
<td>str</td>
</tr>
<tr>
<th>bedrooms</th>
<td>int</td>
</tr>
<tr>
<th>beds</th>
<td>int</td>
</tr>
<tr>
<th>calendar_last_scraped</th>
<td>datetime</td>
</tr>
<tr>
<th>cancellation_policy</th>
<td>str</td>
</tr>
<tr>
<th>cleaning_fee</th>
<td>Decimal128</td>
</tr>
<tr>
<th>description</th>
<td>str</td>
</tr>
<tr>
<th>extra_people</th>
<td>Decimal128</td>
</tr>
<tr>
<th>first_review</th>
<td>datetime</td>
</tr>
<tr>
<th>guests_included</th>
<td>Decimal128</td>
</tr>
<tr>
<th>host_about</th>
<td>str</td>
</tr>
<tr>
<th>host_has_profile_pic</th>
<td>bool</td>
</tr>
<tr>
<th>host_id</th>
<td>str</td>
</tr>
<tr>
<th>host_identity_verified</th>
<td>bool</td>
</tr>
<tr>
<th>host_is_superhost</th>
<td>bool</td>
</tr>
<tr>
<th>host_listings_count</th>
<td>int</td>
</tr>
<tr>
<th>host_location</th>
<td>str</td>
</tr>
<tr>
<th>host_name</th>
<td>str</td>
</tr>
<tr>
<th>host_neighbourhood</th>
<td>str</td>
</tr>
<tr>
<th>host_picture_url</th>
<td>str</td>
</tr>
<tr>
<th>host_response_rate</th>
<td>int</td>
</tr>
<tr>
<th>host_response_time</th>
<td>str</td>
</tr>
<tr>
<th>host_thumbnail_url</th>
<td>str</td>
</tr>
<tr>
<th>host_total_listings_count</th>
<td>int</td>
</tr>
<tr>
<th>host_url</th>
<td>str</td>
</tr>
<tr>
<th>host_verifications</th>
<td>list</td>
</tr>
<tr>
<th>house_rules</th>
<td>str</td>
</tr>
<tr>
<th>images</th>
<td>dict</td>
</tr>
<tr>
<th>images.medium_url</th>
<td>str</td>
</tr>
<tr>
<th>images.picture_url</th>
<td>str</td>
</tr>
<tr>
<th>images.thumbnail_url</th>
<td>str</td>
</tr>
<tr>
<th>images.xl_picture_url</th>
<td>str</td>
</tr>
<tr>
<th>interaction</th>
<td>str</td>
</tr>
<tr>
<th>last_review</th>
<td>datetime</td>
</tr>
<tr>
<th>last_scraped</th>
<td>datetime</td>
</tr>
<tr>
<th>listing_url</th>
<td>str</td>
</tr>
<tr>
<th>maximum_nights</th>
<td>str</td>
</tr>
<tr>
<th>minimum_nights</th>
<td>str</td>
</tr>
<tr>
<th>monthly_price</th>
<td>Decimal128</td>
</tr>
<tr>
<th>name</th>
<td>str</td>
</tr>
<tr>
<th>neighborhood_overview</th>
<td>str</td>
</tr>
<tr>
<th>notes</th>
<td>str</td>
</tr>
<tr>
<th>number_of_reviews</th>
<td>int</td>
</tr>
<tr>
<th>price</th>
<td>Decimal128</td>
</tr>
<tr>
<th>property_type</th>
<td>str</td>
</tr>
<tr>
<th>review_scores_checkin</th>
<td>int</td>
</tr>
<tr>
<th>review_scores_cleanliness</th>
<td>int</td>
</tr>
<tr>
<th>review_scores_communication</th>
<td>int</td>
</tr>
<tr>
<th>review_scores_location</th>
<td>int</td>
</tr>
<tr>
<th>review_scores_rating</th>
<td>int</td>
</tr>
<tr>
<th>review_scores_value</th>
<td>int</td>
</tr>
<tr>
<th>reviews</th>
<td>list</td>
</tr>
<tr>
<th>reviews._id</th>
<td>str</td>
</tr>
<tr>
<th>reviews.comments</th>
<td>str</td>
</tr>
<tr>
<th>reviews.date</th>
<td>datetime</td>
</tr>
<tr>
<th>reviews.listing_id</th>
<td>str</td>
</tr>
<tr>
<th>reviews.reviewer_id</th>
<td>str</td>
</tr>
<tr>
<th>reviews.reviewer_name</th>
<td>str</td>
</tr>
<tr>
<th>reviews_per_month</th>
<td>int</td>
</tr>
<tr>
<th>room_type</th>
<td>str</td>
</tr>
<tr>
<th>security_deposit</th>
<td>Decimal128</td>
</tr>
<tr>
<th>space</th>
<td>str</td>
</tr>
<tr>
<th>summary</th>
<td>str</td>
</tr>
<tr>
<th>transactions</th>
<td>dict</td>
</tr>
<tr>
<th>transactions.bucket_end_date</th>
<td>datetime</td>
</tr>
<tr>
<th>transactions.bucket_start_date</th>
<td>datetime</td>
</tr>
<tr>
<th>transactions.transaction_count</th>
<td>int</td>
</tr>
<tr>
<th>transactions.transactions</th>
<td>list</td>
</tr>
<tr>
<th>transactions.transactions.date</th>
<td>datetime</td>
</tr>
<tr>
<th>transactions.transactions.price</th>
<td>str</td>
</tr>
<tr>
<th>transit</th>
<td>str</td>
</tr>
<tr>
<th>weekly_price</th>
<td>Decimal128</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Data-Types-Adjustments"><strong>Data Types Adjustments</strong><a class="anchor-link" href="#Data-Types-Adjustments"></a></h5><p>Based on the data inspection (<strong>code above</strong> and <strong>Studio3T</strong>), we will make the following adjustments to ensure data consistency and improve query performance:</p>
<ul>
<li><strong><code>maximum_nights</code></strong> and <strong><code>minimum_nights</code></strong>: Convert from <code>string</code> to <code>int</code> if they represent numerical values.</li>
<li><strong><code>bathrooms</code></strong>: Ensure it is consistently typed as <code>int</code>.</li>
<li><strong><code>accommodates</code></strong>: Ensure it is consistently typed as <code>int</code>.</li>
<li><strong><code>price</code></strong>, <strong><code>security_deposit</code></strong>, <strong><code>cleaning_fee</code></strong>, <strong><code>extra_people</code></strong>, <strong><code>guests_included</code></strong>, <strong><code>weekly_price</code></strong>, <strong><code>monthly_price</code></strong>: Ensure these are consistently typed as <code>decimal</code>.</li>
<li><strong><code>transactions.transactions.price</code></strong>: Convert from <code>string</code> to <code>decimal</code>.</li>
<li><strong><code>transit</code></strong>: If it always contains multiple values that can be separated by a delimiter, we can split it into an array of strings for easier querying.</li>
</ul>
<p>.</p>
<ul>
<li><strong><code>reviews._id</code></strong>, <strong><code>reviews.listing_id</code></strong>, <strong><code>reviews.reviewer_id</code></strong>: Ensure these are consistently typed as <code>ObjectId</code>.</li>
<li><strong><code>address.location.coordinates</code></strong>: Confirm <code>array</code>, subfields <code>float</code></li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[207]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 1.1.2. Convert all fields to the correct data types in the collection 'listingsAndReviews_HW2'</span>
<span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/operator/aggregation/convert/</span>
<span class="c1">#         https://stackoverflow.com/a/56570099</span>

<span class="c1"># Convert 'maximum_nights' and 'minimum_nights' to int</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
    <span class="p">{},</span>                                                                                         <span class="c1"># Update all documents</span>
    <span class="p">[{</span><span class="s2">"$set"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"maximum_nights"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"$convert"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$maximum_nights"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">:</span> <span class="s2">"int"</span> <span class="p">}</span> <span class="p">}}},</span>
     <span class="p">{</span><span class="s2">"$set"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"minimum_nights"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"$convert"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$minimum_nights"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">:</span> <span class="s2">"int"</span> <span class="p">}</span> <span class="p">}}}</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[207]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>UpdateResult({'n': 5555, 'nModified': 5555, 'ok': 1.0, 'updatedExisting': True}, acknowledged=True)</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[208]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Confirm the data type conversion</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"maximum_nights"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"minimum_nights"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="p">])</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[208]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>{'minimum_nights': 2, 'maximum_nights': 30}</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[209]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check if all 'bathrooms' are integers</span>
<span class="n">bathrooms_all</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="c1"># Return all 'bathrooms' values</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"bathrooms"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$addToSet"</span><span class="p">:</span> <span class="s2">"$bathrooms"</span><span class="p">}}}</span>
<span class="p">]))</span>

<span class="c1"># Extract the result</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">bathrooms_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[{'_id': None,
  'bathrooms': [Decimal128('0.0'),
                Decimal128('8.0'),
                Decimal128('2.0'),
                Decimal128('1.0'),
                Decimal128('7.0'),
                Decimal128('16.0'),
                Decimal128('3.0'),
                Decimal128('2.5'),
                Decimal128('5.0'),
                Decimal128('9.0'),
                Decimal128('3.5'),
                Decimal128('5.5'),
                Decimal128('4.5'),
                Decimal128('4.0'),
                Decimal128('0.5'),
                Decimal128('1.5'),
                Decimal128('6.0')]}]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li><p><strong>Analysis:</strong> The <code>bathrooms</code> field contains <code>Decimal128</code> values, including halves (e.g., $0.5$, $1.5$, $2.5$).</p>
<ul>
<li>According to Airbnb's help center and community discussions (e.g, <a href="https://community.withairbnb.com/t5/Advice-on-your-space/How-to-calculate-Bathrooms/td-p/1437848">https://community.withairbnb.com/t5/Advice-on-your-space/How-to-calculate-Bathrooms/td-p/1437848</a>), a value of $0.5$ typically represents a half-bath (toilet only, no shower/bath).</li>
</ul>
</li>
<li><p><strong>Decision:</strong> We will <strong>keep <code>bathrooms</code> as <code>Decimal128</code></strong> as the fractional values hold specific meaning within the Airbnb context and represent valid data points. We will not convert it to <code>int</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[210]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check if all 'guests_included' and 'extra_people' are integers</span>
<span class="n">guests_extra_all</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="c1"># Return all 'guests_included' and 'extra_people' values</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"guests_included"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$addToSet"</span><span class="p">:</span> <span class="s2">"$guests_included"</span><span class="p">},</span> <span class="s2">"extra_people"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$addToSet"</span><span class="p">:</span> <span class="s2">"$extra_people"</span><span class="p">}}}</span>
<span class="p">]))</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">guests_extra_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[{'_id': None,
  'extra_people': [Decimal128('542.00'),
                   Decimal128('90.00'),
                   Decimal128('28.00'),
                   Decimal128('59.00'),
                   Decimal128('1119.00'),
                   Decimal128('200.00'),
                   Decimal128('107.00'),
                   Decimal128('14.00'),
                   Decimal128('45.00'),
                   Decimal128('76.00'),
                   Decimal128('149.00'),
                   Decimal128('87.00'),
                   Decimal128('600.00'),
                   Decimal128('25.00'),
                   Decimal128('118.00'),
                   Decimal128('73.00'),
                   Decimal128('11.00'),
                   Decimal128('42.00'),
                   Decimal128('220.00'),
                   Decimal128('158.00'),
                   Decimal128('34.00'),
                   Decimal128('65.00'),
                   Decimal128('127.00'),
                   Decimal128('392.00'),
                   Decimal128('175.00'),
                   Decimal128('20.00'),
                   Decimal128('186.00'),
                   Decimal128('31.00'),
                   Decimal128('93.00'),
                   Decimal128('0.00'),
                   Decimal128('530.00'),
                   Decimal128('48.00'),
                   Decimal128('79.00'),
                   Decimal128('110.00'),
                   Decimal128('17.00'),
                   Decimal128('16.00'),
                   Decimal128('250.00'),
                   Decimal128('95.00'),
                   Decimal128('157.00'),
                   Decimal128('112.00'),
                   Decimal128('44.00'),
                   Decimal128('13.00'),
                   Decimal128('30.00'),
                   Decimal128('264.00'),
                   Decimal128('560.00'),
                   Decimal128('140.00'),
                   Decimal128('53.00'),
                   Decimal128('84.00'),
                   Decimal128('22.00'),
                   Decimal128('70.00'),
                   Decimal128('769.00'),
                   Decimal128('101.00'),
                   Decimal128('8.00'),
                   Decimal128('39.00'),
                   Decimal128('132.00'),
                   Decimal128('800.00'),
                   Decimal128('211.00'),
                   Decimal128('19.00'),
                   Decimal128('50.00'),
                   Decimal128('180.00'),
                   Decimal128('1000.00'),
                   Decimal128('160.00'),
                   Decimal128('36.00'),
                   Decimal128('98.00'),
                   Decimal128('5.00'),
                   Decimal128('270.00'),
                   Decimal128('208.00'),
                   Decimal128('300.00'),
                   Decimal128('393.00'),
                   Decimal128('145.00'),
                   Decimal128('21.00'),
                   Decimal128('83.00'),
                   Decimal128('52.00'),
                   Decimal128('255.00'),
                   Decimal128('131.00'),
                   Decimal128('7.00'),
                   Decimal128('100.00'),
                   Decimal128('968.00'),
                   Decimal128('80.00'),
                   Decimal128('500.00'),
                   Decimal128('49.00'),
                   Decimal128('18.00'),
                   Decimal128('314.00'),
                   Decimal128('97.00'),
                   Decimal128('4.00'),
                   Decimal128('35.00'),
                   Decimal128('66.00'),
                   Decimal128('10.00'),
                   Decimal128('89.00'),
                   Decimal128('120.00'),
                   Decimal128('58.00'),
                   Decimal128('27.00'),
                   Decimal128('230.00'),
                   Decimal128('199.00'),
                   Decimal128('75.00'),
                   Decimal128('179.00'),
                   Decimal128('506.00'),
                   Decimal128('55.00'),
                   Decimal128('24.00'),
                   Decimal128('117.00'),
                   Decimal128('134.00'),
                   Decimal128('72.00'),
                   Decimal128('584.00'),
                   Decimal128('102.00'),
                   Decimal128('9.00'),
                   Decimal128('40.00'),
                   Decimal128('119.00'),
                   Decimal128('150.00'),
                   Decimal128('26.00'),
                   Decimal128('223.00'),
                   Decimal128('550.00'),
                   Decimal128('130.00'),
                   Decimal128('68.00'),
                   Decimal128('37.00'),
                   Decimal128('6.00'),
                   Decimal128('240.00'),
                   Decimal128('85.00'),
                   Decimal128('350.00'),
                   Decimal128('23.00'),
                   Decimal128('54.00'),
                   Decimal128('170.00'),
                   Decimal128('77.00'),
                   Decimal128('46.00'),
                   Decimal128('590.00'),
                   Decimal128('15.00'),
                   Decimal128('280.00'),
                   Decimal128('187.00'),
                   Decimal128('63.00'),
                   Decimal128('125.00'),
                   Decimal128('32.00'),
                   Decimal128('198.00'),
                   Decimal128('900.00'),
                   Decimal128('12.00'),
                   Decimal128('105.00'),
                   Decimal128('2346.00'),
                   Decimal128('277.00'),
                   Decimal128('60.00'),
                   Decimal128('29.00')],
  'guests_included': [Decimal128('6'),
                      Decimal128('3'),
                      Decimal128('2'),
                      Decimal128('8'),
                      Decimal128('4'),
                      Decimal128('1'),
                      Decimal128('5'),
                      Decimal128('7'),
                      Decimal128('9'),
                      Decimal128('16'),
                      Decimal128('10'),
                      Decimal128('13'),
                      Decimal128('15'),
                      Decimal128('12')]}]
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[211]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Convert 'guests_included' and 'extra_people' to int (since they are all integers but in wrong format - Decimal128)</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
    <span class="p">{},</span>                                                                                         <span class="c1"># Update all documents</span>
    <span class="p">[{</span><span class="s2">"$set"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"guests_included"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"$convert"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$guests_included"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">:</span> <span class="s2">"int"</span> <span class="p">}</span> <span class="p">}}},</span>
    <span class="c1">#  {"$set": {"extra_people": { "$convert": { "input": "$extra_people", "to": "int" } }}}    # If u want to convert 'extra_people' as well</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[211]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>UpdateResult({'n': 5555, 'nModified': 5555, 'ok': 1.0, 'updatedExisting': True}, acknowledged=True)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li><p><strong>Analysis:</strong> The <code>guests_included</code> field represents the number of guests included in the base price, which should logically be an integer. The <code>extra_people</code> field represents the <em>monetary charge</em> for additional guests, making <code>Decimal128</code> the appropriate type to handle currency values precisely.</p>
</li>
<li><p><strong>Decision &amp; Transformation:</strong></p>
<ul>
<li>We applied <strong>data type conversion</strong> to the <code>guests_included</code> field, changing it from <code>Decimal128</code> to <code>int</code>, because it represents a count of people, which is inherently an integer. We expect <strong>improved type consistency and potentially slightly more efficient storage and querying</strong> for this field.</li>
<li>The <code>extra_people</code> field remains <code>Decimal128</code> as it can represents a monetary value, although in the observations in this database they are coincidentally all integers</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[212]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Confirm price-related fields are decimal</span>
<span class="n">price_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"price"</span><span class="p">,</span> <span class="s2">"security_deposit"</span><span class="p">,</span> <span class="s2">"cleaning_fee"</span><span class="p">,</span> <span class="s2">"weekly_price"</span><span class="p">,</span> <span class="s2">"monthly_price"</span><span class="p">]</span>
<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">price_fields</span><span class="p">:</span>
    <span class="n">non_decimal</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({</span><span class="n">field</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$not"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$type"</span><span class="p">:</span> <span class="s2">"decimal"</span><span class="p">}}})</span>
    <span class="k">if</span> <span class="n">non_decimal</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Warning: </span><span class="si">{</span><span class="n">non_decimal</span><span class="si">}</span><span class="s2"> documents have '</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">' not as decimal."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Warning: 2084 documents have 'security_deposit' not as decimal.
Warning: 1531 documents have 'cleaning_fee' not as decimal.
Warning: 4841 documents have 'weekly_price' not as decimal.
Warning: 4899 documents have 'monthly_price' not as decimal.
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[213]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Convert price-related fields to decimal</span>
<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">price_fields</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
        <span class="p">{},</span>                                                                                     <span class="c1"># Update all documents</span>
        <span class="p">[{</span><span class="s2">"$set"</span><span class="p">:</span> <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"$convert"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"input"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">:</span> <span class="s2">"decimal"</span> <span class="p">}</span> <span class="p">}}}]</span>
    <span class="p">)</span>
    
<span class="c1"># Confirm the data type conversion</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"price"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"security_deposit"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"cleaning_fee"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"weekly_price"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"monthly_price"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="p">])</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[213]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>{'price': Decimal128('80.00'),
 'security_deposit': Decimal128('200.00'),
 'cleaning_fee': Decimal128('35.00'),
 'weekly_price': None,
 'monthly_price': None}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li>We applied <strong>data type conversion</strong> to the price-related fields (<code>price</code>, <code>security_deposit</code>, <code>cleaning_fee</code>, <code>weekly_price</code>, <code>monthly_price</code>), ensuring they are consistently stored as <code>Decimal128</code> (or <code>double</code>), because these represent monetary values. Handling <code>null</code> or missing values appropriately during conversion (e.g., defaulting to <code>null</code> or <code>0.0</code> if applicable) ensures accurate financial calculations. We expect <strong>improved query performance for range/comparison queries on prices and reliable aggregation results (like averages)</strong>.</li>
</ul>
<p><strong>Note:</strong> <code>weekly_price</code> and <code>monthly_price</code> often appear as <code>None</code> after conversion, indicating they were originally missing or <code>null</code>, which is expected.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[214]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Convert 'transactions.transactions.price' to decimal</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
    <span class="p">{},</span>
    <span class="p">[{</span><span class="s2">"$set"</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># Update the 'transactions.transactions.price' field</span>
        <span class="s2">"transactions.transactions"</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># Check if 'transactions.transactions' is an array</span>
            <span class="s2">"$cond"</span><span class="p">:</span> <span class="p">{</span>
                <span class="c1"># If it is an array, convert the 'price' field to decimal</span>
                <span class="s2">"if"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$isArray"</span><span class="p">:</span> <span class="s2">"$transactions.transactions"</span><span class="p">},</span>
                <span class="s2">"then"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="c1"># Map over the array and convert the 'price' field to decimal</span>
                    <span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/operator/aggregation/map/</span>
                    <span class="s2">"$map"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$transactions.transactions"</span><span class="p">,</span>
                        <span class="s2">"as"</span><span class="p">:</span> <span class="s2">"t"</span><span class="p">,</span>
                        <span class="s2">"in"</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">"date"</span><span class="p">:</span> <span class="s2">"$$t.date"</span><span class="p">,</span>
                            <span class="s2">"price"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$convert"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$$t.price"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">:</span> <span class="s2">"decimal"</span><span class="p">}}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="c1"># If not an array, set to empty array</span>
                <span class="s2">"else"</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">}</span>
        <span class="p">}}}])</span>

<span class="c1"># Confirm the data type conversion</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"transactions.transactions"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$slice"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$transactions.transactions"</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}}}</span>
<span class="p">])</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[214]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>{'transactions': {'transactions': [{'date': datetime.datetime(2008, 8, 12, 0, 0),
    'price': Decimal128('132.1063781684291313922585686668753')}]}}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li>We applied <strong>data type conversion</strong> within the nested <code>transactions.transactions</code> array, converting the <code>price</code> field from <code>string</code> to <code>Decimal128</code>, because it represents a monetary value. This requires iterating through the array using <code>$map</code> within an update pipeline. We expect <strong>accurate financial aggregations (like averages in Q10) and consistent data types</strong> across all transaction records.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong><code>transit</code></strong></p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[215]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check all possible values for 'transit' field</span>
<span class="n">transit_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$transit"</span><span class="p">}}</span>
<span class="p">]))</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">transit_values</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># Display the first few values</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[{'_id': 'We are located closest to the M, F, Z and J train. Walking distance '
         'to the N, Q,R,W,4,5, 6, AND L'},
 {'_id': 'Sim, nibus com destino ao centro da cidade e bondinho. Alm de '
         'ponto de txi e Uber.'},
 {'_id': 'Havaalanna 5 dk (arabayla) Otobs durana 1 dk(yryerek) Tm '
         'otobslerin olduu ana duraa 2 dk )(yryerek)'},
 {'_id': 'My condo comes with a parking spot for your exclusive use at no '
         'extra charge. To get to the University or the business district '
         "centre in downtown, you either take the bus or subway. You don't "
         'actually need a car as the bus stop is conveniently located outside '
         "our condo while the subway is a 10min walk. There's is a flea market "
         'for fresh produce and a variety of shops close by.'},
 {'_id': 'Estacionamento fcil na via pblica, em frente a casa. Fcil acesso '
         'a transportes pblicos regulares, nomeadamente autocarro e Metro.   '
         'Autocarro 602. Estao de Metro mais prxima - Lidador ( Linha B) A '
         'cerca de 3 km do Aeroporto do Porto.'}]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li><strong>Analysis:</strong> The <code>transit</code> field contains free-form text describing transportation options. It's unstructured and varies significantly in length and detail.<ul>
<li><strong>Decision:</strong> For the primary use case (displaying listing info quickly), structuring this field (e.g., splitting into an array) adds complexity without a clear, immediate benefit for the defined queries.<ul>
<li><strong>Action:</strong> We will <strong>leave the <code>transit</code> field as a string</strong>. If future requirements necessitate searching specific transit types (e.g., "metro", "bus"), further refinement or indexing (like a text index) could be considered then.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="%E2%81%89%EF%B8%8F-1.3-%7C-Missing-Data"><strong> 1.3 | Missing Data</strong><a class="anchor-link" href="#%E2%81%89%EF%B8%8F-1.3-%7C-Missing-Data"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[216]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check 'n' and '%' of missing values for all fields in the collection and subdocuments</span>
<span class="c1"># Source: X. (2025). Grok 3 Beta  The Age of Reasoning Agents (Mar 07 version)[Large Language Model]. X.ai. https://x.ai/blog/grok-3</span>
<span class="c1">#         Google. (2025). Gemini 2.5 Pro - Gemini Pro. Google DeepMind. https://deepmind.google/technologies/gemini/pro/</span>

<span class="c1"># --- Code for Non-Array Fields ---</span>

<span class="c1"># Step 1 &amp; 2: Get unique non-array field paths (simplified from your original)</span>
<span class="c1"># We'll focus on fields NOT starting with 'reviews' or 'transactions.transactions'</span>
<span class="c1"># A more robust way is needed if nested structures are complex, but this covers the main fields.</span>
<span class="n">all_field_paths_orig</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">pipeline_get_fields</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"fields"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$objectToArray"</span><span class="p">:</span> <span class="s2">"$$ROOT"</span><span class="p">}}},</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$fields"</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$fields.k"</span><span class="p">}}</span>
<span class="p">]</span>
<span class="n">cursor_fields</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline_get_fields</span><span class="p">)</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cursor_fields</span><span class="p">:</span>
     <span class="c1"># Exclude the array fields themselves and fields starting with host_</span>
     <span class="k">if</span> <span class="ow">not</span> <span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'reviews'</span><span class="p">)</span> <span class="ow">and</span> \
        <span class="ow">not</span> <span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'transactions'</span><span class="p">):</span>                            <span class="c1"># Keep only non-array fields</span>
        <span class="n">all_field_paths_orig</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">])</span>

<span class="c1"># Manually add known nested non-array fields if needed (adjust based on schema)</span>
<span class="n">all_field_paths_orig</span><span class="o">.</span><span class="n">update</span><span class="p">([</span>
    <span class="s1">'address.country'</span><span class="p">,</span> <span class="s1">'address.country_code'</span><span class="p">,</span> <span class="s1">'address.government_area'</span><span class="p">,</span> <span class="s1">'address.location.is_location_exact'</span><span class="p">,</span> <span class="s1">'address.location.type'</span><span class="p">,</span> <span class="s1">'address.market'</span><span class="p">,</span> <span class="s1">'address.street'</span><span class="p">,</span> <span class="s1">'address.suburb'</span><span class="p">,</span>
    <span class="s1">'availability.availability_30'</span><span class="p">,</span> <span class="s1">'availability.availability_365'</span><span class="p">,</span> <span class="s1">'availability.availability_60'</span><span class="p">,</span> <span class="s1">'availability.availability_90'</span><span class="p">,</span>
    <span class="s1">'images.picture_url'</span><span class="p">,</span> <span class="s1">'images.medium_url'</span><span class="p">,</span> <span class="s1">'images.thumbnail_url'</span><span class="p">,</span> <span class="s1">'images.xl_picture_url'</span>
<span class="p">])</span>
<span class="n">unique_fields_orig</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">all_field_paths_orig</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Checking </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_fields_orig</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique non-array field paths..."</span><span class="p">)</span>

<span class="c1"># Step 3: Count missing values for these non-array fields</span>
<span class="n">missing_counts_orig</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">total_docs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span>
<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">unique_fields_orig</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">"Checking non-array fields"</span><span class="p">):</span>
    <span class="c1"># Count documents where field is missing, null, or empty string</span>
    <span class="c1"># Note: This check might be slow without indexes on every field</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({</span>
        <span class="s2">"$or"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">False</span><span class="p">}},</span>
            <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
            <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="s2">""</span><span class="p">},</span>
            <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="p">[]},</span> <span class="c1"># Check for empty arrays if applicable</span>
            <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="p">{}},</span> <span class="c1"># Check for empty objects if applicable</span>
        <span class="p">]</span>
    <span class="p">})</span>
    <span class="n">missing_counts_orig</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">missing</span>

<span class="c1"># Step 4: Create DataFrame for non-array fields</span>
<span class="n">df_data_orig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"n"</span><span class="p">:</span> <span class="p">[</span><span class="n">missing_counts_orig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">unique_fields_orig</span><span class="p">],</span>
    <span class="s2">"%"</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">((</span><span class="n">missing_counts_orig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_docs</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_docs</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">unique_fields_orig</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">df_orig</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_data_orig</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">unique_fields_orig</span><span class="p">)</span>
<span class="n">df_orig</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"field"</span>

<span class="c1"># --- Code for Array Subfields ---</span>

<span class="c1"># 1. Analyze 'reviews' subfields</span>
<span class="n">reviews_analysis_pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"reviews"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"$ne"</span><span class="p">:</span> <span class="p">[]}}},</span> <span class="c1"># Only docs with non-empty reviews</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$reviews"</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>                    <span class="c1"># Group across all unwound reviews</span>
        <span class="s2">"TotalReviews"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>    <span class="c1"># Count total reviews</span>
        <span class="c1"># Check each relevant subfield within the review object</span>
        <span class="s2">"MissingComments"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$cond"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$or"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews.comments"</span><span class="p">,</span> <span class="kc">None</span><span class="p">]},</span> <span class="p">{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews.comments"</span><span class="p">,</span> <span class="s2">""</span><span class="p">]}]},</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}},</span>
        <span class="s2">"MissingReviewerId"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$cond"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$or"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews.reviewer_id"</span><span class="p">,</span> <span class="kc">None</span><span class="p">]},</span> <span class="p">{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews.reviewer_id"</span><span class="p">,</span> <span class="s2">""</span><span class="p">]}]},</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}},</span>
        <span class="s2">"MissingReviewerName"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$cond"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$or"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews.reviewer_name"</span><span class="p">,</span> <span class="kc">None</span><span class="p">]},</span> <span class="p">{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews.reviewer_name"</span><span class="p">,</span> <span class="s2">""</span><span class="p">]}]},</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}},</span>
        <span class="s2">"MissingDate"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$cond"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews.date"</span><span class="p">,</span> <span class="kc">None</span><span class="p">]},</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}},</span>                                             <span class="c1"># Date usually only check for null</span>
        <span class="s2">"MissingListingId"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$cond"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$or"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews.listing_id"</span><span class="p">,</span> <span class="kc">None</span><span class="p">]},</span> <span class="p">{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews.listing_id"</span><span class="p">,</span> <span class="s2">""</span><span class="p">]}]},</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}},</span>
        <span class="s2">"MissingReviewId"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$cond"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$or"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews._id"</span><span class="p">,</span> <span class="kc">None</span><span class="p">]},</span> <span class="p">{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews._id"</span><span class="p">,</span> <span class="s2">""</span><span class="p">]}]},</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}}</span> <span class="c1"># Check review _id</span>
    <span class="p">}},</span>
    <span class="c1"># Project into a more readable format for combining later</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"TotalElements"</span><span class="p">:</span> <span class="s2">"$TotalReviews"</span><span class="p">,</span>
        <span class="s2">"field_stats"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">"field"</span><span class="p">:</span> <span class="s2">"reviews.comments"</span><span class="p">,</span> <span class="s2">"n"</span><span class="p">:</span> <span class="s2">"$MissingComments"</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">"field"</span><span class="p">:</span> <span class="s2">"reviews.reviewer_id"</span><span class="p">,</span> <span class="s2">"n"</span><span class="p">:</span> <span class="s2">"$MissingReviewerId"</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">"field"</span><span class="p">:</span> <span class="s2">"reviews.reviewer_name"</span><span class="p">,</span> <span class="s2">"n"</span><span class="p">:</span> <span class="s2">"$MissingReviewerName"</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">"field"</span><span class="p">:</span> <span class="s2">"reviews.date"</span><span class="p">,</span> <span class="s2">"n"</span><span class="p">:</span> <span class="s2">"$MissingDate"</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">"field"</span><span class="p">:</span> <span class="s2">"reviews.listing_id"</span><span class="p">,</span> <span class="s2">"n"</span><span class="p">:</span> <span class="s2">"$MissingListingId"</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">"field"</span><span class="p">:</span> <span class="s2">"reviews._id"</span><span class="p">,</span> <span class="s2">"n"</span><span class="p">:</span> <span class="s2">"$MissingReviewId"</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}}</span>
<span class="p">]</span>
<span class="n">reviews_missing_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">reviews_analysis_pipeline</span><span class="p">))</span>

<span class="c1"># 2. Analyze 'transactions.transactions' subfields</span>
<span class="n">transactions_analysis_pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"transactions.transactions"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"$ne"</span><span class="p">:</span> <span class="p">[]}}},</span> <span class="c1"># Only docs with non-empty transactions array</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$transactions.transactions"</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># Group across all unwound transactions</span>
        <span class="s2">"TotalTransactions"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="s2">"MissingDate"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$cond"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$transactions.transactions.date"</span><span class="p">,</span> <span class="kc">None</span><span class="p">]},</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}},</span>
        <span class="s2">"MissingPrice"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$cond"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$or"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$transactions.transactions.price"</span><span class="p">,</span> <span class="kc">None</span><span class="p">]},</span>
            <span class="c1"># Add check for empty string ONLY if price was ever a string</span>
            <span class="p">{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$transactions.transactions.price"</span><span class="p">,</span> <span class="s2">""</span><span class="p">]}</span>
        <span class="p">]},</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}}</span>
    <span class="p">}},</span>
     <span class="c1"># Project into a more readable format</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"TotalElements"</span><span class="p">:</span> <span class="s2">"$TotalTransactions"</span><span class="p">,</span>
        <span class="s2">"field_stats"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">"field"</span><span class="p">:</span> <span class="s2">"transactions.transactions.date"</span><span class="p">,</span> <span class="s2">"n"</span><span class="p">:</span> <span class="s2">"$MissingDate"</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">"field"</span><span class="p">:</span> <span class="s2">"transactions.transactions.price"</span><span class="p">,</span> <span class="s2">"n"</span><span class="p">:</span> <span class="s2">"$MissingPrice"</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}}</span>
<span class="p">]</span>
<span class="n">transactions_missing_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">transactions_analysis_pipeline</span><span class="p">))</span>

<span class="c1"># 3. Combine results into DataFrame</span>
<span class="n">missing_data_combined</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Add non-array results</span>
<span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_orig</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">missing_data_combined</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"n"</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">'n'</span><span class="p">],</span> <span class="s2">"TotalElements"</span><span class="p">:</span> <span class="n">total_docs</span><span class="p">}</span>

<span class="c1"># Add reviews results</span>
<span class="k">if</span> <span class="n">reviews_missing_result</span><span class="p">:</span>
    <span class="n">total_reviews</span> <span class="o">=</span> <span class="n">reviews_missing_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"TotalElements"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">reviews_missing_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"field_stats"</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">missing_data_combined</span><span class="p">[</span><span class="n">stat</span><span class="p">[</span><span class="s2">"field"</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"n"</span><span class="p">:</span> <span class="n">stat</span><span class="p">[</span><span class="s2">"n"</span><span class="p">],</span> <span class="s2">"TotalElements"</span><span class="p">:</span> <span class="n">total_reviews</span><span class="p">}</span>

<span class="c1"># Add transactions results</span>
<span class="k">if</span> <span class="n">transactions_missing_result</span><span class="p">:</span>
    <span class="n">total_transactions</span> <span class="o">=</span> <span class="n">transactions_missing_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"TotalElements"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">transactions_missing_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"field_stats"</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">missing_data_combined</span><span class="p">[</span><span class="n">stat</span><span class="p">[</span><span class="s2">"field"</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"n"</span><span class="p">:</span> <span class="n">stat</span><span class="p">[</span><span class="s2">"n"</span><span class="p">],</span> <span class="s2">"TotalElements"</span><span class="p">:</span> <span class="n">total_transactions</span><span class="p">}</span>

<span class="c1"># Create final DataFrame</span>
<span class="n">df_combined_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">missing_data_combined</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">n_missing</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"n"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">total_elements</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"TotalElements"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># Use specific total for arrays</span>
    <span class="n">percent_missing</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">n_missing</span> <span class="o">/</span> <span class="n">total_elements</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_elements</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">df_combined_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">"field"</span><span class="p">:</span> <span class="n">field</span><span class="p">,</span> <span class="s2">"n"</span><span class="p">:</span> <span class="n">n_missing</span><span class="p">,</span> <span class="s2">"%"</span><span class="p">:</span> <span class="n">percent_missing</span><span class="p">})</span>

<span class="n">missing_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_combined_data</span><span class="p">)</span>
<span class="n">missing_counts</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">"field"</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">missing_counts</span><span class="p">[</span><span class="s2">"n"</span><span class="p">]</span> <span class="o">=</span> <span class="n">missing_counts</span><span class="p">[</span><span class="s2">"n"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># Ensure 'n' is integer type</span>
<span class="n">missing_counts</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">"n"</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Combined Missing Value Analysis (Including Array Subfields) ---"</span><span class="p">)</span>
<span class="n">missing_counts</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Checking 76 unique non-array field paths...
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>Checking non-array fields: 100%|| 76/76 [00:01&lt;00:00, 68.40it/s]
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
--- Combined Missing Value Analysis (Including Array Subfields) ---
</pre>
</div>
</div>
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[216]:</div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html" tabindex="0">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>n</th>
<th>%</th>
</tr>
<tr>
<th>field</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>images.medium_url</th>
<td>5555</td>
<td>100.00</td>
</tr>
<tr>
<th>images.thumbnail_url</th>
<td>5555</td>
<td>100.00</td>
</tr>
<tr>
<th>images.xl_picture_url</th>
<td>5555</td>
<td>100.00</td>
</tr>
<tr>
<th>monthly_price</th>
<td>4899</td>
<td>88.19</td>
</tr>
<tr>
<th>weekly_price</th>
<td>4841</td>
<td>87.15</td>
</tr>
<tr>
<th>notes</th>
<td>3080</td>
<td>55.45</td>
</tr>
<tr>
<th>interaction</th>
<td>2478</td>
<td>44.61</td>
</tr>
<tr>
<th>access</th>
<td>2453</td>
<td>44.16</td>
</tr>
<tr>
<th>house_rules</th>
<td>2285</td>
<td>41.13</td>
</tr>
<tr>
<th>neighborhood_overview</th>
<td>2241</td>
<td>40.34</td>
</tr>
<tr>
<th>transit</th>
<td>2232</td>
<td>40.18</td>
</tr>
<tr>
<th>host_about</th>
<td>2219</td>
<td>39.95</td>
</tr>
<tr>
<th>security_deposit</th>
<td>2084</td>
<td>37.52</td>
</tr>
<tr>
<th>host_neighbourhood</th>
<td>1923</td>
<td>34.62</td>
</tr>
<tr>
<th>space</th>
<td>1626</td>
<td>29.27</td>
</tr>
<tr>
<th>cleaning_fee</th>
<td>1531</td>
<td>27.56</td>
</tr>
<tr>
<th>review_scores_checkin</th>
<td>1475</td>
<td>26.55</td>
</tr>
<tr>
<th>review_scores_value</th>
<td>1475</td>
<td>26.55</td>
</tr>
<tr>
<th>review_scores_communication</th>
<td>1474</td>
<td>26.53</td>
</tr>
<tr>
<th>review_scores_location</th>
<td>1474</td>
<td>26.53</td>
</tr>
<tr>
<th>review_scores_rating</th>
<td>1474</td>
<td>26.53</td>
</tr>
<tr>
<th>review_scores_cleanliness</th>
<td>1473</td>
<td>26.52</td>
</tr>
<tr>
<th>last_review</th>
<td>1388</td>
<td>24.99</td>
</tr>
<tr>
<th>host_response_rate</th>
<td>1388</td>
<td>24.99</td>
</tr>
<tr>
<th>first_review</th>
<td>1388</td>
<td>24.99</td>
</tr>
<tr>
<th>host_response_time</th>
<td>1388</td>
<td>24.99</td>
</tr>
<tr>
<th>address.suburb</th>
<td>887</td>
<td>15.97</td>
</tr>
<tr>
<th>summary</th>
<td>258</td>
<td>4.64</td>
</tr>
<tr>
<th>description</th>
<td>95</td>
<td>1.71</td>
</tr>
<tr>
<th>reviews.comments</th>
<td>42</td>
<td>0.03</td>
</tr>
<tr>
<th>amenities</th>
<td>30</td>
<td>0.54</td>
</tr>
<tr>
<th>beds</th>
<td>13</td>
<td>0.23</td>
</tr>
<tr>
<th>bathrooms</th>
<td>10</td>
<td>0.18</td>
</tr>
<tr>
<th>host_location</th>
<td>8</td>
<td>0.14</td>
</tr>
<tr>
<th>name</th>
<td>8</td>
<td>0.14</td>
</tr>
<tr>
<th>host_verifications</th>
<td>7</td>
<td>0.13</td>
</tr>
<tr>
<th>address.market</th>
<td>6</td>
<td>0.11</td>
</tr>
<tr>
<th>bedrooms</th>
<td>5</td>
<td>0.09</td>
</tr>
<tr>
<th>availability.availability_60</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>availability.availability_90</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>availability</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>availability.availability_30</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>address.location.type</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>availability.availability_365</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>address.country_code</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>address.country</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>address.government_area</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>address.location.is_location_exact</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>accommodates</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>_id</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>address</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>address.street</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>bed_type</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>images</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>host_total_listings_count</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>host_name</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>host_picture_url</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>host_thumbnail_url</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>host_url</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>calendar_last_scraped</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>extra_people</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>cancellation_policy</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>host_has_profile_pic</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>guests_included</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>host_id</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>host_identity_verified</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>host_is_superhost</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>host_listings_count</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>images.picture_url</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>price</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>property_type</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>number_of_reviews</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>maximum_nights</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>listing_url</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>last_scraped</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>minimum_nights</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>room_type</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>reviews.reviewer_id</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>reviews.reviewer_name</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>reviews.date</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>reviews.listing_id</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>reviews._id</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>transactions.transactions.date</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<th>transactions.transactions.price</th>
<td>0</td>
<td>0.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[217]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Clean up - Remove fields with "" or None from individual documents</span>
<span class="n">fields_to_clean</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">unique_fields_orig</span> <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">missing_counts</span><span class="o">.</span><span class="n">index</span> <span class="ow">and</span> <span class="n">missing_counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">field</span><span class="p">,</span> <span class="s1">'n'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields_to_clean</span><span class="p">:</span>
    <span class="c1"># Remove field where it's "" or None</span>
    <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">"$or"</span><span class="p">:</span> <span class="p">[{</span><span class="n">field</span><span class="p">:</span> <span class="s2">""</span><span class="p">},</span> <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span> <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="p">[]},</span> <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="p">{}}]},</span>     <span class="c1"># Check for empty strings, None, empty arrays, or empty objects</span>
        <span class="p">{</span><span class="s2">"$unset"</span><span class="p">:</span> <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="s2">""</span><span class="p">}}</span>                                              <span class="c1"># Unset the field from the document if it matches the criteria</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Cleaned '</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">' from </span><span class="si">{</span><span class="n">missing_counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">field</span><span class="p">,</span><span class="w"> </span><span class="s1">'n'</span><span class="p">]</span><span class="si">}</span><span class="s2"> documents."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Cleaned 'access' from 2453 documents.
Cleaned 'address.market' from 6 documents.
Cleaned 'address.suburb' from 887 documents.
Cleaned 'amenities' from 30 documents.
Cleaned 'bathrooms' from 10 documents.
Cleaned 'bedrooms' from 5 documents.
Cleaned 'beds' from 13 documents.
Cleaned 'cleaning_fee' from 1531 documents.
Cleaned 'description' from 95 documents.
Cleaned 'first_review' from 1388 documents.
Cleaned 'host_about' from 2219 documents.
Cleaned 'host_location' from 8 documents.
Cleaned 'host_neighbourhood' from 1923 documents.
Cleaned 'host_response_rate' from 1388 documents.
Cleaned 'host_response_time' from 1388 documents.
Cleaned 'host_verifications' from 7 documents.
Cleaned 'house_rules' from 2285 documents.
Cleaned 'images.medium_url' from 5555 documents.
Cleaned 'images.thumbnail_url' from 5555 documents.
Cleaned 'images.xl_picture_url' from 5555 documents.
Cleaned 'interaction' from 2478 documents.
Cleaned 'last_review' from 1388 documents.
Cleaned 'monthly_price' from 4899 documents.
Cleaned 'name' from 8 documents.
Cleaned 'neighborhood_overview' from 2241 documents.
Cleaned 'notes' from 3080 documents.
Cleaned 'review_scores_checkin' from 1475 documents.
Cleaned 'review_scores_cleanliness' from 1473 documents.
Cleaned 'review_scores_communication' from 1474 documents.
Cleaned 'review_scores_location' from 1474 documents.
Cleaned 'review_scores_rating' from 1474 documents.
Cleaned 'review_scores_value' from 1475 documents.
Cleaned 'security_deposit' from 2084 documents.
Cleaned 'space' from 1626 documents.
Cleaned 'summary' from 258 documents.
Cleaned 'transit' from 2232 documents.
Cleaned 'weekly_price' from 4841 documents.
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li><p>We do not treat the <code>reviews</code> and <code>transactions</code> fields as missing data because they are <strong>arrays of subdocuments</strong>, not simple scalar fields. Analyzing them as "missing" at the top level would be misleading  the field may exist and simply contain an empty array.</p>
<ul>
<li>Instead, we evaluate the <strong>completeness of the data inside</strong> these arrays by unwinding them and checking for missing values within each subdocument (e.g., <code>review.date</code>, <code>transaction.price</code>). This allows us to capture cases where fields are either null, missing entirely, or empty strings.</li>
</ul>
</li>
<li><p>Our analysis showed that all <code>transactions</code> (n = $311 \;093$) are fully populated, with <strong>no missing values</strong> in the inspected fields. Among the <code>reviews</code> (n = $149\;793$), we found <strong>42 missing values</strong> in the <code>comments</code> field (i.e., either <code>null</code> or empty).</p>
</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[218]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Verify cleanup</span>
<span class="n">post_cleanup_counts</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields_to_clean</span><span class="p">:</span>
    
    <span class="c1"># Count remaining documents with field as None</span>
    <span class="n">remaining</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({</span>
        <span class="n">field</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="p">})</span>
    <span class="n">post_cleanup_counts</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">remaining</span>
    <span class="k">if</span> <span class="n">remaining</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Warning: </span><span class="si">{</span><span class="n">remaining</span><span class="si">}</span><span class="s2"> documents still have '</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">' as None and explicitly exist."</span><span class="p">)</span>
    
    <span class="c1"># Check for empty strings </span>
    <span class="n">empty_str_count</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({</span>
        <span class="n">field</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$eq"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="p">})</span>
    <span class="k">if</span> <span class="n">empty_str_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Note: </span><span class="si">{</span><span class="n">empty_str_count</span><span class="si">}</span><span class="s2"> documents still have '</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">' as empty string and explicitly exist."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li><p><strong>Analysis:</strong> The initial check revealed numerous fields with missing (<code>null</code>) or empty string (<code>""</code>) values, particularly for optional details like <code>notes</code>, <code>interaction</code>, <code>host_about</code>, <code>security_deposit</code>, and pricing fields (<code>weekly_price</code>, <code>monthly_price</code>).</p>
</li>
<li><p><strong>Decision &amp; Transformation:</strong></p>
<ul>
<li>We applied <strong>data cleanup by removing missing/empty fields</strong> using <code>$unset</code> for fields identified with <code>null</code> or <code>""</code> values, because these values often provide no information and can interfere with queries (e.g., type checking, <code>$exists</code>). We expect <strong>cleaner data, slightly reduced document size, and more predictable query behavior</strong> when filtering or checking for field existence.</li>
</ul>
</li>
</ul>
<p>The verification confirms that <code>null</code> and <code>""</code> values were successfully unset from the documents. Fields listed as having <code>0</code> remaining <code>null</code> or <code>""</code> values (where <code>$exists: true</code>) are now clean in that regard.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="%E2%99%A8%EF%B8%8F-1.4-%7C-Data-Cleanup---Invalid/Outliers-Data"><strong> 1.4 | Data Cleanup - Invalid/Outliers Data</strong><a class="anchor-link" href="#%E2%99%A8%EF%B8%8F-1.4-%7C-Data-Cleanup---Invalid/Outliers-Data"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[219]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">unique_fields</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>['_id', 'access', 'accommodates', 'address', 'address.country', 'address.country_code', 'address.government_area', 'address.location', 'address.location.coordinates', 'address.location.is_location_exact', 'address.location.type', 'address.market', 'address.street', 'address.suburb', 'amenities', 'availability', 'availability.availability_30', 'availability.availability_365', 'availability.availability_60', 'availability.availability_90', 'bathrooms', 'bed_type', 'bedrooms', 'beds', 'calendar_last_scraped', 'cancellation_policy', 'cleaning_fee', 'description', 'extra_people', 'first_review', 'guests_included', 'host_about', 'host_has_profile_pic', 'host_id', 'host_identity_verified', 'host_is_superhost', 'host_listings_count', 'host_location', 'host_name', 'host_neighbourhood', 'host_picture_url', 'host_response_rate', 'host_response_time', 'host_thumbnail_url', 'host_total_listings_count', 'host_url', 'host_verifications', 'house_rules', 'images', 'images.medium_url', 'images.picture_url', 'images.thumbnail_url', 'images.xl_picture_url', 'interaction', 'last_review', 'last_scraped', 'listing_url', 'maximum_nights', 'minimum_nights', 'monthly_price', 'name', 'neighborhood_overview', 'notes', 'number_of_reviews', 'price', 'property_type', 'review_scores_checkin', 'review_scores_cleanliness', 'review_scores_communication', 'review_scores_location', 'review_scores_rating', 'review_scores_value', 'reviews', 'reviews._id', 'reviews.comments', 'reviews.date', 'reviews.listing_id', 'reviews.reviewer_id', 'reviews.reviewer_name', 'reviews_per_month', 'room_type', 'security_deposit', 'space', 'summary', 'transactions', 'transactions.bucket_end_date', 'transactions.bucket_start_date', 'transactions.transaction_count', 'transactions.transactions', 'transactions.transactions.date', 'transactions.transactions.price', 'transit', 'weekly_price']
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[220]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Create a statistical summary for all fields in the collection</span>
<span class="c1"># Source: Google. (2025). Gemini 2.5 Pro - Gemini Pro. Google DeepMind. https://deepmind.google/technologies/gemini/pro/</span>
<span class="c1">#         X. (2025). Grok 3 Beta  The Age of Reasoning Agents (Mar 07 version)[Large Language Model]. X.ai. https://x.ai/blog/grok-3</span>

<span class="c1"># --- Configuration ---</span>
<span class="c1"># Fields within arrays to analyze individually</span>
<span class="n">review_subfields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"comments"</span><span class="p">,</span> <span class="s2">"date"</span><span class="p">,</span> <span class="s2">"listing_id"</span><span class="p">,</span> <span class="s2">"reviewer_id"</span><span class="p">,</span> <span class="s2">"reviewer_name"</span><span class="p">,</span> <span class="s2">"_id"</span><span class="p">]</span>
<span class="n">transaction_subfields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"date"</span><span class="p">,</span> <span class="s2">"price"</span><span class="p">]</span>
<span class="n">amenity_subfield</span> <span class="o">=</span> <span class="s2">"amenities"</span>                      <span class="c1"># The array itself contains the strings</span>
<span class="n">verification_subfield</span> <span class="o">=</span> <span class="s2">"host_verifications"</span>        <span class="c1"># The array itself contains the strings</span>

<span class="c1"># Fields to exclude from the main document analysis (handled separately or irrelevant)</span>
<span class="n">exclude_from_main</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"reviews"</span><span class="p">,</span> <span class="s2">"transactions"</span><span class="p">,</span> <span class="s2">"amenities"</span><span class="p">,</span> <span class="s2">"host_verifications"</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"--- Starting Statistical Summary Generation ---"</span><span class="p">)</span>

<span class="c1"># --- 1. Analyze Non-Array Fields ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Analyzing non-array fields..."</span><span class="p">)</span>

<span class="c1"># Get unique top-level and simple nested fields first</span>
<span class="n">all_main_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">pipeline_get_main_fields</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"fields"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$objectToArray"</span><span class="p">:</span> <span class="s2">"$$ROOT"</span><span class="p">}}},</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$fields"</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"fields.k"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$nin"</span><span class="p">:</span> <span class="n">exclude_from_main</span><span class="p">}}},</span> <span class="c1"># Exclude array roots</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$fields.k"</span><span class="p">}}</span>
<span class="p">]</span>
<span class="n">cursor_main_fields</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline_get_main_fields</span><span class="p">)</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cursor_main_fields</span><span class="p">:</span>
    <span class="n">all_main_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">])</span>

<span class="c1"># Add known nested fields (adjust as needed based on actual schema)</span>
<span class="n">all_main_fields</span><span class="o">.</span><span class="n">update</span><span class="p">([</span>
    <span class="s1">'address.country'</span><span class="p">,</span> <span class="s1">'address.country_code'</span><span class="p">,</span> <span class="s1">'address.government_area'</span><span class="p">,</span>
    <span class="s1">'address.location.is_location_exact'</span><span class="p">,</span> <span class="s1">'address.location.type'</span><span class="p">,</span>
    <span class="s1">'address.market'</span><span class="p">,</span> <span class="s1">'address.street'</span><span class="p">,</span> <span class="s1">'address.suburb'</span><span class="p">,</span>
    <span class="s1">'availability.availability_30'</span><span class="p">,</span> <span class="s1">'availability.availability_365'</span><span class="p">,</span>
    <span class="s1">'availability.availability_60'</span><span class="p">,</span> <span class="s1">'availability.availability_90'</span><span class="p">,</span>
    <span class="s1">'images.picture_url'</span><span class="p">,</span> <span class="s1">'images.thumbnail_url'</span><span class="p">,</span> <span class="s1">'images.medium_url'</span><span class="p">,</span> <span class="s1">'images.xl_picture_url'</span><span class="p">,</span>
    <span class="s1">'transactions.bucket_end_date'</span><span class="p">,</span> <span class="s1">'transactions.bucket_start_date'</span><span class="p">,</span> <span class="s1">'transactions.transaction_count'</span> <span class="c1"># Keep transaction summaries</span>
<span class="p">])</span>
<span class="c1"># Remove parent keys if sub-keys exist to avoid double counting structure vs values</span>
<span class="n">fields_to_remove</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'address'</span><span class="p">,</span> <span class="s1">'availability'</span><span class="p">,</span> <span class="s1">'images'</span><span class="p">,</span> <span class="s1">'address.location'</span><span class="p">,</span> <span class="s1">'transactions'</span><span class="p">}</span>
<span class="n">unique_main_fields</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">all_main_fields</span> <span class="o">-</span> <span class="n">fields_to_remove</span><span class="p">))</span>

<span class="n">summary_main</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">total_docs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span>

<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">unique_main_fields</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">"Processing main fields"</span><span class="p">):</span>
    <span class="c1"># Determine field type from a sample document</span>
    <span class="n">sample_doc</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="n">field</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span> <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
    <span class="n">field_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">field_value_sample</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">sample_doc</span> <span class="ow">and</span> <span class="n">field</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">sample_doc</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">field_value_sample</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_value_sample</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Decimal128</span><span class="p">)):</span>
                <span class="n">field_type</span> <span class="o">=</span> <span class="s1">'numeric'</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_value_sample</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
                <span class="n">field_type</span> <span class="o">=</span> <span class="s1">'date'</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_value_sample</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">field_type</span> <span class="o">=</span> <span class="s1">'boolean'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field_type</span> <span class="o">=</span> <span class="s1">'categorical'</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">field_type</span> <span class="o">=</span> <span class="s1">'mixed_or_missing'</span>

    <span class="n">group_stage</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">"Count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$addToSet"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s1">'numeric'</span><span class="p">:</span>
        <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MinValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
        <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MaxValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
        <span class="n">group_stage</span><span class="p">[</span><span class="s2">"AvgValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$convert"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"input"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">:</span> <span class="s2">"double"</span><span class="p">,</span> <span class="s2">"onError"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"onNull"</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}}</span>
    <span class="k">elif</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s1">'date'</span><span class="p">:</span>
        <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MinValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
        <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MaxValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
    <span class="k">elif</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s1">'boolean'</span><span class="p">:</span>
        <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MinValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
        <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MaxValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
    <span class="k">elif</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s1">'categorical'</span><span class="p">:</span>
        <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MinValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
        <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MaxValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>

    <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"$ne"</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}},</span> <span class="c1"># Ensure field exists and is not null</span>
        <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="n">group_stage</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">"Count"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$size"</span><span class="p">:</span> <span class="s2">"$DistinctCount"</span><span class="p">},</span>
            <span class="s2">"Mean"</span><span class="p">:</span> <span class="s2">"$AvgValue"</span><span class="p">,</span>
            <span class="s2">"Min"</span><span class="p">:</span> <span class="s2">"$MinValue"</span><span class="p">,</span>
            <span class="s2">"Max"</span><span class="p">:</span> <span class="s2">"$MaxValue"</span>
        <span class="p">}}</span>
    <span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"Min"</span><span class="p">,</span> <span class="s2">"Max"</span><span class="p">,</span> <span class="s2">"Mean"</span><span class="p">]:</span>
             <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span>
                 <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">Decimal128</span><span class="p">):</span>
                     <span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">())</span>
                 <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
                     <span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">summary_main</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">summary_main</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Count"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="c1"># --- 2. Analyze 'reviews' Subfields ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Analyzing 'reviews' subfields..."</span><span class="p">)</span>
<span class="n">summary_reviews</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">pipeline_reviews_base</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"reviews"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}},</span>  <span class="c1"># Filter for docs with reviews array</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$reviews"</span><span class="p">}</span>                      <span class="c1"># Unwind the reviews array</span>
<span class="p">]</span>

<span class="c1"># Count total review elements first</span>
<span class="n">pipeline_reviews_count</span> <span class="o">=</span> <span class="n">pipeline_reviews_base</span> <span class="o">+</span> <span class="p">[{</span><span class="s2">"$count"</span><span class="p">:</span> <span class="s2">"TotalReviews"</span><span class="p">}]</span>
<span class="n">total_reviews_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline_reviews_count</span><span class="p">))</span>
<span class="n">total_reviews</span> <span class="o">=</span> <span class="n">total_reviews_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'TotalReviews'</span><span class="p">]</span> <span class="k">if</span> <span class="n">total_reviews_result</span> <span class="k">else</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Total review elements to analyze: </span><span class="si">{</span><span class="n">total_reviews</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">total_reviews</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">subfield</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">review_subfields</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">"Processing review fields"</span><span class="p">):</span>
        <span class="n">field_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"reviews.</span><span class="si">{</span><span class="n">subfield</span><span class="si">}</span><span class="s2">"</span> <span class="c1"># Path within the unwound document</span>

        <span class="c1"># Determine type from sample (using the original collection)</span>
        <span class="n">sample_review_doc</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"reviews"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"$ne"</span><span class="p">:</span> <span class="p">[]}},</span> <span class="p">{</span><span class="s2">"reviews"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$slice"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}})</span>
        <span class="n">field_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sample_review_doc</span> <span class="ow">and</span> <span class="n">sample_review_doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'reviews'</span><span class="p">):</span>
             <span class="n">review_item</span> <span class="o">=</span> <span class="n">sample_review_doc</span><span class="p">[</span><span class="s1">'reviews'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
             <span class="k">if</span> <span class="n">subfield</span> <span class="ow">in</span> <span class="n">review_item</span><span class="p">:</span>
                 <span class="n">field_value_sample</span> <span class="o">=</span> <span class="n">review_item</span><span class="p">[</span><span class="n">subfield</span><span class="p">]</span>
                 <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_value_sample</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Decimal128</span><span class="p">)):</span> <span class="n">field_type</span> <span class="o">=</span> <span class="s1">'numeric'</span>
                 <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_value_sample</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span> <span class="n">field_type</span> <span class="o">=</span> <span class="s1">'date'</span>
                 <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_value_sample</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span> <span class="n">field_type</span> <span class="o">=</span> <span class="s1">'boolean'</span>
                 <span class="k">else</span><span class="p">:</span> <span class="n">field_type</span> <span class="o">=</span> <span class="s1">'categorical'</span>

        <span class="n">group_stage</span> <span class="o">=</span> <span class="p">{</span>
             <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
             <span class="s2">"Count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="c1"># Count matching unwound documents</span>
             <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$addToSet"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s1">'date'</span><span class="p">:</span>
             <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MinValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
             <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MaxValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s1">'categorical'</span><span class="p">:</span> <span class="c1"># Get Min/Max strings</span>
            <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MinValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
            <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MaxValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_reviews_base</span> <span class="o">+</span> <span class="p">[</span>
             <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="n">field_path</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"$ne"</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}},</span> <span class="c1"># Only where subfield exists and is not null</span>
             <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="n">group_stage</span><span class="p">},</span>
             <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
                 <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$size"</span><span class="p">:</span> <span class="s2">"$DistinctCount"</span><span class="p">},</span>
                 <span class="s2">"Min"</span><span class="p">:</span> <span class="s2">"$MinValue"</span><span class="p">,</span> <span class="s2">"Max"</span><span class="p">:</span> <span class="s2">"$MaxValue"</span>
             <span class="p">}}</span>
        <span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">stats</span><span class="p">[</span><span class="s2">"TotalElements"</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_reviews</span>
            <span class="c1"># Clean up Min/Max if they weren't added</span>
            <span class="k">if</span> <span class="s2">"Min"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="s2">"Min"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s2">"Max"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="s2">"Max"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">summary_reviews</span><span class="p">[</span><span class="n">field_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">summary_reviews</span><span class="p">[</span><span class="n">field_path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Count"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"TotalElements"</span><span class="p">:</span> <span class="n">total_reviews</span><span class="p">}</span>

<span class="c1"># --- 3. Analyze 'transactions.transactions' Subfields ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Analyzing 'transactions.transactions' subfields..."</span><span class="p">)</span>
<span class="n">summary_tx</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">pipeline_tx_base</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"transactions.transactions"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}},</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$transactions.transactions"</span><span class="p">}</span>
<span class="p">]</span>

<span class="c1"># Count total transaction elements</span>
<span class="n">pipeline_tx_count</span> <span class="o">=</span> <span class="n">pipeline_tx_base</span> <span class="o">+</span> <span class="p">[{</span><span class="s2">"$count"</span><span class="p">:</span> <span class="s2">"TotalTransactions"</span><span class="p">}]</span>
<span class="n">total_tx_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline_tx_count</span><span class="p">))</span>
<span class="n">total_transactions</span> <span class="o">=</span> <span class="n">total_tx_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'TotalTransactions'</span><span class="p">]</span> <span class="k">if</span> <span class="n">total_tx_result</span> <span class="k">else</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Total transaction elements to analyze: </span><span class="si">{</span><span class="n">total_transactions</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">total_transactions</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">subfield</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">transaction_subfields</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">"Processing transaction fields"</span><span class="p">):</span>
        <span class="n">field_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"transactions.transactions.</span><span class="si">{</span><span class="n">subfield</span><span class="si">}</span><span class="s2">"</span>

        <span class="c1"># Determine type from sample</span>
        <span class="n">sample_tx_doc</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"transactions.transactions"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"$ne"</span><span class="p">:</span> <span class="p">[]}},</span> <span class="p">{</span><span class="s2">"transactions.transactions"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$slice"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}})</span>
        <span class="n">field_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sample_tx_doc</span> <span class="ow">and</span> <span class="n">sample_tx_doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'transactions'</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'transactions'</span><span class="p">):</span>
             <span class="n">tx_item</span> <span class="o">=</span> <span class="n">sample_tx_doc</span><span class="p">[</span><span class="s1">'transactions'</span><span class="p">][</span><span class="s1">'transactions'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
             <span class="k">if</span> <span class="n">subfield</span> <span class="ow">in</span> <span class="n">tx_item</span><span class="p">:</span>
                 <span class="n">field_value_sample</span> <span class="o">=</span> <span class="n">tx_item</span><span class="p">[</span><span class="n">subfield</span><span class="p">]</span>
                 <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_value_sample</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Decimal128</span><span class="p">)):</span> <span class="n">field_type</span> <span class="o">=</span> <span class="s1">'numeric'</span>
                 <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_value_sample</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span> <span class="n">field_type</span> <span class="o">=</span> <span class="s1">'date'</span>
                 <span class="k">else</span><span class="p">:</span> <span class="n">field_type</span> <span class="o">=</span> <span class="s1">'categorical'</span>

        <span class="n">group_stage</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">"Count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$addToSet"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s1">'numeric'</span><span class="p">:</span>
            <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MinValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
            <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MaxValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
            <span class="n">group_stage</span><span class="p">[</span><span class="s2">"AvgValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$convert"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"input"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">:</span> <span class="s2">"double"</span><span class="p">,</span> <span class="s2">"onError"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"onNull"</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}}</span>
        <span class="k">elif</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s1">'date'</span><span class="p">:</span>
            <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MinValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
            <span class="n">group_stage</span><span class="p">[</span><span class="s2">"MaxValue"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_tx_base</span> <span class="o">+</span> <span class="p">[</span>
             <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="n">field_path</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"$ne"</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}},</span>
             <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="n">group_stage</span><span class="p">},</span>
             <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
                 <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$size"</span><span class="p">:</span> <span class="s2">"$DistinctCount"</span><span class="p">},</span>
                 <span class="s2">"Mean"</span><span class="p">:</span> <span class="s2">"$AvgValue"</span><span class="p">,</span> <span class="s2">"Min"</span><span class="p">:</span> <span class="s2">"$MinValue"</span><span class="p">,</span> <span class="s2">"Max"</span><span class="p">:</span> <span class="s2">"$MaxValue"</span>
             <span class="p">}}</span>
        <span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">stats</span><span class="p">[</span><span class="s2">"TotalElements"</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_transactions</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"Min"</span><span class="p">,</span> <span class="s2">"Max"</span><span class="p">,</span> <span class="s2">"Mean"</span><span class="p">]:</span>
                 <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span>
                     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">Decimal128</span><span class="p">):</span>
                         <span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">())</span>
                     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
                         <span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># Clean up missing keys</span>
            <span class="k">if</span> <span class="s2">"Min"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="s2">"Min"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s2">"Max"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="s2">"Max"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s2">"Mean"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="s2">"Mean"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">summary_tx</span><span class="p">[</span><span class="n">field_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">summary_tx</span><span class="p">[</span><span class="n">field_path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Count"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"TotalElements"</span><span class="p">:</span> <span class="n">total_transactions</span><span class="p">}</span>

<span class="c1"># --- 4. Analyze 'amenities' ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Analyzing 'amenities'..."</span><span class="p">)</span>
<span class="n">summary_amen</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">pipeline_amen_base</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"amenities"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}},</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$amenities"</span><span class="p">}</span>
<span class="p">]</span>
<span class="n">pipeline_amen_count</span> <span class="o">=</span> <span class="n">pipeline_amen_base</span> <span class="o">+</span> <span class="p">[{</span><span class="s2">"$count"</span><span class="p">:</span> <span class="s2">"TotalAmenities"</span><span class="p">}]</span>
<span class="n">total_amen_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline_amen_count</span><span class="p">))</span>
<span class="n">total_amenities</span> <span class="o">=</span> <span class="n">total_amen_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'TotalAmenities'</span><span class="p">]</span> <span class="k">if</span> <span class="n">total_amen_result</span> <span class="k">else</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Total amenity elements to analyze: </span><span class="si">{</span><span class="n">total_amenities</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">total_amenities</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_amen_base</span> <span class="o">+</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">"Count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$addToSet"</span><span class="p">:</span> <span class="s2">"$amenities"</span><span class="p">},</span>
            <span class="s2">"MinValue"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="s2">"$amenities"</span><span class="p">},</span>
            <span class="s2">"MaxValue"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="s2">"$amenities"</span><span class="p">}</span>
        <span class="p">}},</span>
        <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$size"</span><span class="p">:</span> <span class="s2">"$DistinctCount"</span><span class="p">},</span>
            <span class="s2">"Min"</span><span class="p">:</span> <span class="s2">"$MinValue"</span><span class="p">,</span> <span class="s2">"Max"</span><span class="p">:</span> <span class="s2">"$MaxValue"</span>
        <span class="p">}}</span>
    <span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">"TotalElements"</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_amenities</span>
        <span class="n">summary_amen</span><span class="p">[</span><span class="s2">"amenities"</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">summary_amen</span><span class="p">[</span><span class="s2">"amenities"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Count"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"TotalElements"</span><span class="p">:</span> <span class="n">total_amenities</span><span class="p">}</span>

<span class="c1"># --- 5. Analyze 'host_verifications' ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Analyzing 'host_verifications'..."</span><span class="p">)</span>
<span class="n">summary_verif</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">pipeline_verif_base</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"host_verifications"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}},</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$host_verifications"</span><span class="p">}</span>
<span class="p">]</span>
<span class="n">pipeline_verif_count</span> <span class="o">=</span> <span class="n">pipeline_verif_base</span> <span class="o">+</span> <span class="p">[{</span><span class="s2">"$count"</span><span class="p">:</span> <span class="s2">"TotalVerifications"</span><span class="p">}]</span>
<span class="n">total_verif_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline_verif_count</span><span class="p">))</span>
<span class="n">total_verifications</span> <span class="o">=</span> <span class="n">total_verif_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'TotalVerifications'</span><span class="p">]</span> <span class="k">if</span> <span class="n">total_verif_result</span> <span class="k">else</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Total verification elements to analyze: </span><span class="si">{</span><span class="n">total_verifications</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">total_verifications</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_verif_base</span> <span class="o">+</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">"Count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$addToSet"</span><span class="p">:</span> <span class="s2">"$host_verifications"</span><span class="p">},</span>
            <span class="s2">"MinValue"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="s2">"$host_verifications"</span><span class="p">},</span>
            <span class="s2">"MaxValue"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="s2">"$host_verifications"</span><span class="p">}</span>
        <span class="p">}},</span>
        <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$size"</span><span class="p">:</span> <span class="s2">"$DistinctCount"</span><span class="p">},</span>
            <span class="s2">"Min"</span><span class="p">:</span> <span class="s2">"$MinValue"</span><span class="p">,</span> <span class="s2">"Max"</span><span class="p">:</span> <span class="s2">"$MaxValue"</span>
        <span class="p">}}</span>
    <span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">"TotalElements"</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_verifications</span>
        <span class="n">summary_verif</span><span class="p">[</span><span class="s2">"host_verifications"</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">summary_verif</span><span class="p">[</span><span class="s2">"host_verifications"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Count"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"DistinctCount"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"TotalElements"</span><span class="p">:</span> <span class="n">total_verifications</span><span class="p">}</span>

<span class="c1"># --- 6. Combine and Create Final DataFrame ---</span>
<span class="n">summary_combined</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">summary_main</span><span class="p">,</span> <span class="o">**</span><span class="n">summary_reviews</span><span class="p">,</span> <span class="o">**</span><span class="n">summary_tx</span><span class="p">,</span> <span class="o">**</span><span class="n">summary_amen</span><span class="p">,</span> <span class="o">**</span><span class="n">summary_verif</span><span class="p">}</span>

<span class="n">df_data_combined</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">summary_combined</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">df_data_combined</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s2">"field"</span><span class="p">:</span> <span class="n">field</span><span class="p">,</span>
        <span class="s2">"Count"</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"Count"</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s2">"Distinct Count"</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"DistinctCount"</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s2">"Mean"</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"Mean"</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">),</span>
        <span class="s2">"Min"</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"Min"</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">),</span>
        <span class="s2">"Max"</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"Max"</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">)</span>
    <span class="p">})</span>

<span class="n">df_stats_final</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_data_combined</span><span class="p">)</span>
<span class="n">df_stats_final</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">"field"</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_stats_final</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_stats_final</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Final Statistical Summary (Original Collection) ---"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Total fields:"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_stats_final</span><span class="p">))</span>
<span class="n">df_stats_final</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>--- Starting Statistical Summary Generation ---
Analyzing non-array fields...
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>Processing main fields: 100%|| 75/75 [00:01&lt;00:00, 41.42it/s]
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Analyzing 'reviews' subfields...
Total review elements to analyze: 149792
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>Processing review fields: 100%|| 6/6 [00:01&lt;00:00,  3.18it/s]
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Analyzing 'transactions.transactions' subfields...
Total transaction elements to analyze: 311093
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>Processing transaction fields: 100%|| 2/2 [00:01&lt;00:00,  1.81it/s]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Analyzing 'amenities'...
Total amenity elements to analyze: 121372
Analyzing 'host_verifications'...
Total verification elements to analyze: 27593

--- Final Statistical Summary (Original Collection) ---
Total fields: 85
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>
</pre>
</div>
</div>
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[220]:</div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html" tabindex="0">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>Count</th>
<th>Distinct Count</th>
<th>Mean</th>
<th>Min</th>
<th>Max</th>
</tr>
<tr>
<th>field</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>_id</th>
<td>5555</td>
<td>5555</td>
<td>-</td>
<td>10006546</td>
<td>9993190</td>
</tr>
<tr>
<th>access</th>
<td>3102</td>
<td>2988</td>
<td>-</td>
<td>Everything is located in a beautiful and spac...</td>
<td>! Share kitchen is located on 2nd ...</td>
</tr>
<tr>
<th>accommodates</th>
<td>5555</td>
<td>16</td>
<td>3.51</td>
<td>1</td>
<td>16</td>
</tr>
<tr>
<th>address.country</th>
<td>5555</td>
<td>9</td>
<td>-</td>
<td>Australia</td>
<td>United States</td>
</tr>
<tr>
<th>address.country_code</th>
<td>5555</td>
<td>9</td>
<td>-</td>
<td>AU</td>
<td>US</td>
</tr>
<tr>
<th>address.government_area</th>
<td>5555</td>
<td>418</td>
<td>-</td>
<td>AVer-o-Mar, Amorim e Terroso</td>
<td>rvore</td>
</tr>
<tr>
<th>address.location.is_location_exact</th>
<td>5555</td>
<td>2</td>
<td>0.67</td>
<td>False</td>
<td>True</td>
</tr>
<tr>
<th>address.location.type</th>
<td>5555</td>
<td>1</td>
<td>-</td>
<td>Point</td>
<td>Point</td>
</tr>
<tr>
<th>address.market</th>
<td>5549</td>
<td>14</td>
<td>-</td>
<td>Barcelona</td>
<td>The Big Island</td>
</tr>
<tr>
<th>address.street</th>
<td>5555</td>
<td>677</td>
<td>-</td>
<td>ADALAR, Istanbul, Turkey</td>
<td>, , Hong Kong</td>
</tr>
<tr>
<th>address.suburb</th>
<td>4668</td>
<td>409</td>
<td>-</td>
<td>Abbotsford/Wareemba</td>
<td>ili</td>
</tr>
<tr>
<th>amenities</th>
<td>121372</td>
<td>185</td>
<td>-</td>
<td>24-hour check-in</td>
<td>translation missing: en.hosting_amenity_50</td>
</tr>
<tr>
<th>availability.availability_30</th>
<td>5555</td>
<td>31</td>
<td>11.82</td>
<td>0</td>
<td>30</td>
</tr>
<tr>
<th>availability.availability_365</th>
<td>5555</td>
<td>366</td>
<td>173.11</td>
<td>0</td>
<td>365</td>
</tr>
<tr>
<th>availability.availability_60</th>
<td>5555</td>
<td>61</td>
<td>26.45</td>
<td>0</td>
<td>60</td>
</tr>
<tr>
<th>availability.availability_90</th>
<td>5555</td>
<td>91</td>
<td>42.76</td>
<td>0</td>
<td>90</td>
</tr>
<tr>
<th>bathrooms</th>
<td>5545</td>
<td>17</td>
<td>1.29</td>
<td>0.0</td>
<td>16.0</td>
</tr>
<tr>
<th>bed_type</th>
<td>5555</td>
<td>5</td>
<td>-</td>
<td>Airbed</td>
<td>Real Bed</td>
</tr>
<tr>
<th>bedrooms</th>
<td>5550</td>
<td>13</td>
<td>1.41</td>
<td>0</td>
<td>20</td>
</tr>
<tr>
<th>beds</th>
<td>5542</td>
<td>19</td>
<td>2.07</td>
<td>0</td>
<td>25</td>
</tr>
<tr>
<th>calendar_last_scraped</th>
<td>5555</td>
<td>7</td>
<td>-</td>
<td>2019-02-11 05:00:00</td>
<td>2019-03-11 04:00:00</td>
</tr>
<tr>
<th>cancellation_policy</th>
<td>5555</td>
<td>5</td>
<td>-</td>
<td>flexible</td>
<td>super_strict_60</td>
</tr>
<tr>
<th>cleaning_fee</th>
<td>4024</td>
<td>291</td>
<td>94.07</td>
<td>0.0</td>
<td>2000.0</td>
</tr>
<tr>
<th>description</th>
<td>5460</td>
<td>5441</td>
<td>-</td>
<td>Cozy room! It has a double bed, cable ...</td>
<td>  . tv,      ...</td>
</tr>
<tr>
<th>extra_people</th>
<td>5555</td>
<td>138</td>
<td>22.79</td>
<td>0.0</td>
<td>2346.0</td>
</tr>
<tr>
<th>first_review</th>
<td>4167</td>
<td>1686</td>
<td>-</td>
<td>2009-10-27 04:00:00</td>
<td>2019-03-10 05:00:00</td>
</tr>
<tr>
<th>guests_included</th>
<td>5555</td>
<td>14</td>
<td>1.75</td>
<td>1</td>
<td>16</td>
</tr>
<tr>
<th>host_about</th>
<td>3336</td>
<td>2949</td>
<td>-</td>
<td>\n</td>
<td></td>
</tr>
<tr>
<th>host_has_profile_pic</th>
<td>5555</td>
<td>2</td>
<td>1.0</td>
<td>False</td>
<td>True</td>
</tr>
<tr>
<th>host_id</th>
<td>5555</td>
<td>5104</td>
<td>-</td>
<td>10002884</td>
<td>99997584</td>
</tr>
<tr>
<th>host_identity_verified</th>
<td>5555</td>
<td>2</td>
<td>0.36</td>
<td>False</td>
<td>True</td>
</tr>
<tr>
<th>host_is_superhost</th>
<td>5555</td>
<td>2</td>
<td>0.2</td>
<td>False</td>
<td>True</td>
</tr>
<tr>
<th>host_listings_count</th>
<td>5555</td>
<td>132</td>
<td>14.41</td>
<td>0</td>
<td>1198</td>
</tr>
<tr>
<th>host_location</th>
<td>5547</td>
<td>675</td>
<td>-</td>
<td>New South Wales, Australia</td>
<td>, </td>
</tr>
<tr>
<th>host_name</th>
<td>5555</td>
<td>3140</td>
<td>-</td>
<td>(Email hidden by Airbnb)</td>
<td></td>
</tr>
<tr>
<th>host_neighbourhood</th>
<td>3632</td>
<td>446</td>
<td>-</td>
<td>Abbotsford</td>
<td>ili</td>
</tr>
<tr>
<th>host_picture_url</th>
<td>5555</td>
<td>5086</td>
<td>-</td>
<td>https://a0.muscache.com/defaults/user_pic-225x...</td>
<td>https://a0.muscache.com/im/users/9997988/profi...</td>
</tr>
<tr>
<th>host_response_rate</th>
<td>4167</td>
<td>62</td>
<td>93.12</td>
<td>0</td>
<td>100</td>
</tr>
<tr>
<th>host_response_time</th>
<td>4167</td>
<td>4</td>
<td>-</td>
<td>a few days or more</td>
<td>within an hour</td>
</tr>
<tr>
<th>host_thumbnail_url</th>
<td>5555</td>
<td>5086</td>
<td>-</td>
<td>https://a0.muscache.com/defaults/user_pic-50x5...</td>
<td>https://a0.muscache.com/im/users/9997988/profi...</td>
</tr>
<tr>
<th>host_total_listings_count</th>
<td>5555</td>
<td>132</td>
<td>14.41</td>
<td>0</td>
<td>1198</td>
</tr>
<tr>
<th>host_url</th>
<td>5555</td>
<td>5104</td>
<td>-</td>
<td>https://www.airbnb.com/users/show/10002884</td>
<td>https://www.airbnb.com/users/show/99997584</td>
</tr>
<tr>
<th>host_verifications</th>
<td>27593</td>
<td>19</td>
<td>-</td>
<td>email</td>
<td>zhima_selfie</td>
</tr>
<tr>
<th>house_rules</th>
<td>3270</td>
<td>3112</td>
<td>-</td>
<td>"Mi casa es su casa".  When you leave please t...</td>
<td>No Smoking, No Pet, No Party, No Children ...</td>
</tr>
<tr>
<th>images.medium_url</th>
<td>0</td>
<td>0</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<th>images.picture_url</th>
<td>5555</td>
<td>5553</td>
<td>-</td>
<td>https://a0.muscache.com/4ea/air/v2//pictures/0...</td>
<td>https://a0.muscache.com/im/pictures/fff8056a-c...</td>
</tr>
<tr>
<th>images.thumbnail_url</th>
<td>0</td>
<td>0</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<th>images.xl_picture_url</th>
<td>0</td>
<td>0</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<th>interaction</th>
<td>3077</td>
<td>2916</td>
<td>-</td>
<td>'Ohana Nui means Big Family, which is what we ...</td>
<td> ..</td>
</tr>
<tr>
<th>last_review</th>
<td>4167</td>
<td>809</td>
<td>-</td>
<td>2012-01-06 05:00:00</td>
<td>2019-03-11 04:00:00</td>
</tr>
<tr>
<th>last_scraped</th>
<td>5555</td>
<td>7</td>
<td>-</td>
<td>2019-02-11 05:00:00</td>
<td>2019-03-11 04:00:00</td>
</tr>
<tr>
<th>listing_url</th>
<td>5555</td>
<td>5555</td>
<td>-</td>
<td>https://www.airbnb.com/rooms/10006546</td>
<td>https://www.airbnb.com/rooms/9993190</td>
</tr>
<tr>
<th>maximum_nights</th>
<td>5555</td>
<td>140</td>
<td>1382776.32</td>
<td>1</td>
<td>2147483647</td>
</tr>
<tr>
<th>minimum_nights</th>
<td>5555</td>
<td>45</td>
<td>5.56</td>
<td>1</td>
<td>1250</td>
</tr>
<tr>
<th>monthly_price</th>
<td>656</td>
<td>309</td>
<td>5391.37</td>
<td>250.0</td>
<td>253384.0</td>
</tr>
<tr>
<th>name</th>
<td>5547</td>
<td>5537</td>
<td>-</td>
<td>!5 mins from MTR! Ideal for biz travel / family</td>
<td>Townhouse</td>
</tr>
<tr>
<th>neighborhood_overview</th>
<td>3314</td>
<td>3227</td>
<td>-</td>
<td>"Be happy in Porto"  offers a quality accommod...</td>
<td>...</td>
</tr>
<tr>
<th>notes</th>
<td>2475</td>
<td>2381</td>
<td>-</td>
<td>!!!Sejam muito bem vindos!!!</td>
<td>  Feel free to smoke in our outdoor area, but...</td>
</tr>
<tr>
<th>number_of_reviews</th>
<td>5555</td>
<td>259</td>
<td>27.61</td>
<td>0</td>
<td>533</td>
</tr>
<tr>
<th>price</th>
<td>5555</td>
<td>649</td>
<td>278.77</td>
<td>9.0</td>
<td>48842.0</td>
</tr>
<tr>
<th>property_type</th>
<td>5555</td>
<td>36</td>
<td>-</td>
<td>Aparthotel</td>
<td>Villa</td>
</tr>
<tr>
<th>review_scores_checkin</th>
<td>4080</td>
<td>9</td>
<td>9.7</td>
<td>2</td>
<td>10</td>
</tr>
<tr>
<th>review_scores_cleanliness</th>
<td>4082</td>
<td>8</td>
<td>9.32</td>
<td>2</td>
<td>10</td>
</tr>
<tr>
<th>review_scores_communication</th>
<td>4081</td>
<td>9</td>
<td>9.69</td>
<td>2</td>
<td>10</td>
</tr>
<tr>
<th>review_scores_location</th>
<td>4081</td>
<td>8</td>
<td>9.6</td>
<td>2</td>
<td>10</td>
</tr>
<tr>
<th>review_scores_rating</th>
<td>4081</td>
<td>41</td>
<td>93.1</td>
<td>20</td>
<td>100</td>
</tr>
<tr>
<th>review_scores_value</th>
<td>4080</td>
<td>9</td>
<td>9.31</td>
<td>2</td>
<td>10</td>
</tr>
<tr>
<th>reviews._id</th>
<td>149792</td>
<td>149792</td>
<td>-</td>
<td>10000121</td>
<td>99999615</td>
</tr>
<tr>
<th>reviews.comments</th>
<td>149784</td>
<td>146782</td>
<td>-</td>
<td></td>
<td>DFSABC...</td>
</tr>
<tr>
<th>reviews.date</th>
<td>149792</td>
<td>2778</td>
<td>-</td>
<td>2009-10-27 04:00:00</td>
<td>2019-03-11 04:00:00</td>
</tr>
<tr>
<th>reviews.listing_id</th>
<td>149792</td>
<td>3923</td>
<td>-</td>
<td>10006546</td>
<td>9993190</td>
</tr>
<tr>
<th>reviews.reviewer_id</th>
<td>149792</td>
<td>146640</td>
<td>-</td>
<td>10000032</td>
<td>99998112</td>
</tr>
<tr>
<th>reviews.reviewer_name</th>
<td>149791</td>
<td>32901</td>
<td>-</td>
<td>'Dea</td>
<td></td>
</tr>
<tr>
<th>reviews_per_month</th>
<td>94</td>
<td>8</td>
<td>1.71</td>
<td>1</td>
<td>10</td>
</tr>
<tr>
<th>room_type</th>
<td>5555</td>
<td>3</td>
<td>-</td>
<td>Entire home/apt</td>
<td>Shared room</td>
</tr>
<tr>
<th>security_deposit</th>
<td>3471</td>
<td>213</td>
<td>509.43</td>
<td>0.0</td>
<td>39228.0</td>
</tr>
<tr>
<th>space</th>
<td>3929</td>
<td>3887</td>
<td>-</td>
<td>Cozy room! It has a double bed, cable ...</td>
<td> Second floor studio (you must climb 2 flight...</td>
</tr>
<tr>
<th>summary</th>
<td>5297</td>
<td>5259</td>
<td>-</td>
<td>Simply Hostel is, a brand new Licensed ...</td>
<td>  . tv,      ...</td>
</tr>
<tr>
<th>transactions.bucket_end_date</th>
<td>5555</td>
<td>208</td>
<td>-</td>
<td>2002-03-05 00:00:00</td>
<td>2017-01-09 00:00:00</td>
</tr>
<tr>
<th>transactions.bucket_start_date</th>
<td>5555</td>
<td>1362</td>
<td>-</td>
<td>1962-01-08 00:00:00</td>
<td>2015-11-28 00:00:00</td>
</tr>
<tr>
<th>transactions.transaction_count</th>
<td>5555</td>
<td>100</td>
<td>56.0</td>
<td>1</td>
<td>100</td>
</tr>
<tr>
<th>transactions.transactions.date</th>
<td>311093</td>
<td>8651</td>
<td>-</td>
<td>1962-03-08 00:00:00</td>
<td>2017-01-09 00:00:00</td>
</tr>
<tr>
<th>transactions.transactions.price</th>
<td>311093</td>
<td>73190</td>
<td>83.0</td>
<td>0.02</td>
<td>845.8</td>
</tr>
<tr>
<th>transit</th>
<td>3323</td>
<td>3230</td>
<td>-</td>
<td>it is less than 5 minutes walk from Taksim an...</td>
<td>       5 -7  ,   ...</td>
</tr>
<tr>
<th>weekly_price</th>
<td>714</td>
<td>323</td>
<td>1530.9</td>
<td>60.0</td>
<td>59123.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Analysing-the-results"><strong>Analysing the results</strong><a class="anchor-link" href="#Analysing-the-results"></a></h5><p><strong>Introduction</strong></p>
<p>The table above provides a statistical summary of the fields in the collection <code>listingsAndReviews_HW2</code> including the count of documents, distinct values, mean, minimum, and maximum values for each field.</p>
<ul>
<li>From the analysis, we can verify that most fields are consistent with our expectations, with the exception of a few fields: <code>maximum_nights</code>, <code>bathrooms</code>, <code>bedrooms</code>, and <code>price.</code></li>
</ul>
<br/>
<p><strong><code>maximum_nights</code></strong></p>
<ul>
<li>As shown in the results above, the maximum value for the field <strong><code>maximum_nights</code> is extremely high</strong>  specifically, $2\;147\;483\;647$. While we know with certainty that no guest will ever book a stay for this many nights, this value appears in the dataset.<ul>
<li>After reviewing Airbnbs official guidelines (<strong>Source:</strong> <a href="https://www.airbnb.pt/help/article/880?">https://www.airbnb.pt/help/article/880?</a>), it is confirmed that hosts have full freedom to define any number for the <code>maximum_nights</code> field. Therefore, such high values are permitted by Airbnb.</li>
<li>It is likely that some hosts intentionally set extremely high values to signal that there is effectively no maximum stay limit. These values, although unusually large, are still valid in the context of Airbnbs platform.</li>
<li>While these values are valid, in a different context  such as modeling guest behavior or predicting average stay length  they could be treated as statistical outliers. However, since that is not the goal of our current work, we will not perform any data cleaning or transformation for these records.</li>
</ul>
</li>
</ul>
<p><strong><code>bathrooms</code></strong></p>
<ul>
<li>As shown in the results above, the minimum value for the field <strong><code>bathrooms</code></strong> is $0$. In some cases this value makes total sense (<strong>Source:</strong> <a href="https://community.withairbnb.com/t5/Advice-on-your-space/bathroom-classification/m-p/1652130">https://community.withairbnb.com/t5/Advice-on-your-space/bathroom-classification/m-p/1652130</a>) while in others it doesn't.<ul>
<li>Properties with types like *<strong>Camper/RV</strong><em>, </em><strong>Tent</strong>* and *<strong>Shared Room</strong>* may not have private bathrooms indicating that the value $0$ makes sense. On the other hand property types like *<strong>Apartment</strong>* and House are unlikely to have $0$ bathrooms.</li>
</ul>
</li>
</ul>
<p><strong><code>bedrooms</code></strong></p>
<ul>
<li>As shown in the results above, the minimum value for the field <strong><code>bedrooms</code></strong> is $0$.<ul>
<li>For properties with types like *<strong>Apartment</strong>* that are <strong>Studios</strong> or <strong>Lofts</strong> this value makes sense potentially reflecting that they share a single open space.</li>
<li>On the other hand property types like *<strong>House</strong>* are unlikely to have <strong>$0$ bedrooms</strong>.</li>
</ul>
</li>
</ul>
<p><strong><code>price</code></strong></p>
<ul>
<li>As shown in the results above, the maximum value for the field <strong><code>price</code></strong> is $48\;842.0$. The field price indicates the price per night for a listing.<ul>
<li>This value is extremely high and seems unrealistic for a single night stay.</li>
<li>It is possible that this value is a result of data entry errors or outliers in the dataset.</li>
<li>To further investigate, we can check the distribution of prices and identify any potential outliers.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="maximum_nights"><strong><code>maximum_nights</code></strong><a class="anchor-link" href="#maximum_nights"></a></h5>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[221]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check cases with 'maximum_nights' more that 1 000 000</span>
<span class="n">large_maximum_nights</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">"maximum_nights"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$gt"</span><span class="p">:</span> <span class="mi">1_000_000</span><span class="p">}})</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">large_maximum_nights</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Document with _id: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span><span class="si">}</span><span class="s2"> has maximum_nights: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'maximum_nights'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> | Host URL: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'host_url'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Document with _id: 10911771 has maximum_nights: 2147483647           | Host URL: https://www.airbnb.com/users/show/52473150
Document with _id: 19550563 has maximum_nights: 1234567890           | Host URL: https://www.airbnb.com/users/show/137344895
Document with _id: 6357527 has maximum_nights: 2147483647           | Host URL: https://www.airbnb.com/users/show/18762837
Document with _id: 744242 has maximum_nights: 2147483647           | Host URL: https://www.airbnb.com/users/show/4334558
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="bathrooms"><strong><code>bathrooms</code></strong><a class="anchor-link" href="#bathrooms"></a></h5>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[222]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Number of listings where number of bathrooms is 0</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s2">"bathrooms"</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[222]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>14</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li>There are a total of $14$ listings with $0$ <code>bathrooms</code>. We will investigate the property types of these listings to see if they are valid.</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[223]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check cases with 'bathrooms' = 0</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">"bathrooms"</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"bathrooms"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"property_type"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"host_url"</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>{'property_type': 'House', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/6250742'}
{'property_type': 'Apartment', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/27201583'}
{'property_type': 'Hostel', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/30098437'}
{'property_type': 'Camper/RV', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/36714324'}
{'property_type': 'Serviced apartment', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/14861546'}
{'property_type': 'Apartment', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/51198195'}
{'property_type': 'Apartment', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/219415974'}
{'property_type': 'Bed and breakfast', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/98135964'}
{'property_type': 'Apartment', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/221016656'}
{'property_type': 'Apartment', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/226980154'}
{'property_type': 'House', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/283136'}
{'property_type': 'House', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/34682013'}
{'property_type': 'Apartment', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/494228'}
{'property_type': 'Serviced apartment', 'bathrooms': Decimal128('0.0'), 'host_url': 'https://www.airbnb.com/users/show/38468501'}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li>As we can from the results above, there are some listings with $0$ <code>bathrooms</code> with property types that do not make sense (e.g *<strong>House</strong><em>, </em><strong>Apartment</strong>*, etc.).<ul>
<li>To further investigate, we would need more information about each listings, access to the databases's metadata and to the host_url (links to the listings don't seem to work).</li>
<li>Hence no changes will be made</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="bedrooms"><strong><code>bedrooms</code></strong><a class="anchor-link" href="#bedrooms"></a></h5>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[224]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Count listings with 0 bedrooms</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s2">"bedrooms"</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[224]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>496</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li>As we can see there a total of $496$ listings with $0$ <code>bedrooms</code>.<ul>
<li>As they represent almost $10\%$ of total listings we will analyse the distribution of property types with $0$ <code>bedrooms</code> to understand which are correctly described with $0$ <code>bedrooms</code> and which aren't</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[225]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check distribution of property types with 0 bedrooms</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"bedrooms"</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$property_type"</span><span class="p">,</span>
        <span class="s2">"count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"count"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}}</span>  
<span class="p">]</span>

<span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Apartment: 305
Condominium: 52
Loft: 33
Serviced apartment: 25
House: 19
Guest suite: 14
Guesthouse: 9
Bed and breakfast: 6
Boutique hotel: 5
Other: 4
Townhouse: 3
Cottage: 3
Hostel: 3
Cabin: 3
Camper/RV: 2
Tiny house: 2
Bungalow: 2
Pension (South Korea): 1
Aparthotel: 1
Resort: 1
Farm stay: 1
Hotel: 1
Casa particular (Cuba): 1
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li>As we can from the results above, there are some listings with $0$ <code>bedrooms</code> with property types that do not make sense (e.g *<strong>House</strong>* etc.).<ul>
<li>As explained in the case of bathrooms, to further investigate these cases, we would need more information about each listings, access to the databases's metadata and to the <strong><code>host_url</code></strong> (links to the listings don't seem to work).</li>
<li>Hence no changes will be made</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="price"><strong><code>price</code></strong><a class="anchor-link" href="#price"></a></h5>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[226]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Find properties that have a price equal to 48842.0 and project _id, property_type, price and host_url</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">"price"</span><span class="p">:</span> <span class="mf">48842.0</span><span class="p">},</span> <span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"property_type"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"price"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"host_url"</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>{'property_type': 'Apartment', 'price': Decimal128('48842.00'), 'host_url': 'https://www.airbnb.com/users/show/118695718'}
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[227]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Distribution of prices across multiple price ranges (bins)</span>
<span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/operator/aggregation/bucket/</span>

<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">50000</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"0-100"</span><span class="p">,</span> <span class="s2">"101-500"</span><span class="p">,</span> <span class="s2">"501-1000"</span><span class="p">,</span> <span class="s2">"1001-5000"</span><span class="p">,</span> <span class="s2">"5001-10000"</span><span class="p">,</span> <span class="s2">"10001-20000"</span><span class="p">,</span> <span class="s2">"20001-50000"</span><span class="p">]</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$bucket"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"groupBy"</span><span class="p">:</span> <span class="s2">"$price"</span><span class="p">,</span>
        <span class="s2">"boundaries"</span><span class="p">:</span> <span class="n">bins</span><span class="p">,</span>
        <span class="s2">"default"</span><span class="p">:</span> <span class="s2">"50001+"</span><span class="p">,</span>  <span class="c1"># Default bucket for values above the last boundary</span>
        <span class="s2">"output"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="s2">"average_price"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="s2">"$price"</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}}</span>
<span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"50001+"</span><span class="p">:</span>  <span class="c1"># Handle the default bucket</span>
        <span class="n">price_range</span> <span class="o">=</span> <span class="s2">"50001+"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Map the bucket index to the corresponding label</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">bins</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">])</span>
        <span class="n">price_range</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    
    <span class="n">avg_price</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">'average_price'</span><span class="p">]))</span>  <span class="c1"># Convert Decimal128 to string, then to float</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Price Range: </span><span class="si">{</span><span class="n">price_range</span><span class="si">}</span><span class="s2">, Count: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="si">}</span><span class="s2">, Average Price: </span><span class="si">{</span><span class="n">avg_price</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Price Range: 0-100, Count: 2181, Average Price: 59.24
Price Range: 101-500, Count: 2627, Average Price: 213.11
Price Range: 501-1000, Count: 528, Average Price: 686.03
Price Range: 1001-5000, Count: 207, Average Price: 1724.65
Price Range: 5001-10000, Count: 6, Average Price: 6149.83
Price Range: 10001-20000, Count: 5, Average Price: 10910.80
Price Range: 20001-50000, Count: 1, Average Price: 48842.00
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li>From the results above, we can see that we only have $6$ listings with <code>price</code> over $10\;000$ <em>per night</em><ul>
<li>These most likely correspond to outliers or luxury listings.</li>
<li>Since we lack the metadata, working <code>host_url</code> links to these properties to determine if they are valid, <strong>we will not remove them</strong>.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="number_of_reviews"><strong><code>number_of_reviews</code></strong><a class="anchor-link" href="#number_of_reviews"></a></h5>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[228]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check if 'number_of_reviews' is equal to the length of 'reviews' array</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>                                                       <span class="c1"># Exclude _id from output</span>
        <span class="s2">"number_of_reviews"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>                                         <span class="c1"># Include number_of_reviews field</span>
        <span class="s2">"reviews_length"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$size"</span><span class="p">:</span> <span class="s2">"$reviews"</span><span class="p">}</span>                         <span class="c1"># Calculate length of reviews array</span>
    <span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"$expr"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ne"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$number_of_reviews"</span><span class="p">,</span> <span class="s2">"$reviews_length"</span><span class="p">]}</span>     <span class="c1"># Check if number_of_reviews is not equal to length of reviews array</span>
    <span class="p">}}</span>
<span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mNumber of documents with mismatch: </span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">/</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%)"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="c1"># for doc in results:</span>
<span class="c1">#     print(f"Number of reviews: {doc['number_of_reviews']}, Reviews array length: {doc['reviews_length']}")</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre><span class="ansi-bold">Number of documents with mismatch: </span> 244 (4.39%)
[{'_id': '17915459', 'number_of_reviews': 7, 'reviews_length': 0},
 {'_id': '17951038', 'number_of_reviews': 100, 'reviews_length': 0},
 {'_id': '18040680', 'number_of_reviews': 5, 'reviews_length': 0},
 {'_id': '18121163', 'number_of_reviews': 47, 'reviews_length': 0},
 {'_id': '18219254', 'number_of_reviews': 99, 'reviews_length': 0},
 {'_id': '18220498', 'number_of_reviews': 22, 'reviews_length': 0},
 {'_id': '18353952', 'number_of_reviews': 59, 'reviews_length': 0},
 {'_id': '18439011', 'number_of_reviews': 35, 'reviews_length': 0},
 {'_id': '18611535', 'number_of_reviews': 32, 'reviews_length': 0},
 {'_id': '18712467', 'number_of_reviews': 13, 'reviews_length': 0},
 {'_id': '18730346', 'number_of_reviews': 42, 'reviews_length': 0},
 {'_id': '18748105', 'number_of_reviews': 8, 'reviews_length': 0},
 {'_id': '18809312', 'number_of_reviews': 8, 'reviews_length': 0},
 {'_id': '19028601', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '19036802', 'number_of_reviews': 87, 'reviews_length': 0},
 {'_id': '19044796', 'number_of_reviews': 92, 'reviews_length': 0},
 {'_id': '19061599', 'number_of_reviews': 202, 'reviews_length': 0},
 {'_id': '19100444', 'number_of_reviews': 32, 'reviews_length': 0},
 {'_id': '19172215', 'number_of_reviews': 4, 'reviews_length': 0},
 {'_id': '19217460', 'number_of_reviews': 13, 'reviews_length': 0},
 {'_id': '19304849', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '19380085', 'number_of_reviews': 76, 'reviews_length': 0},
 {'_id': '19486889', 'number_of_reviews': 7, 'reviews_length': 0},
 {'_id': '19499999', 'number_of_reviews': 8, 'reviews_length': 0},
 {'_id': '19536693', 'number_of_reviews': 40, 'reviews_length': 0},
 {'_id': '19550665', 'number_of_reviews': 8, 'reviews_length': 0},
 {'_id': '19677006', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '19692712', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '19694143', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '19704903', 'number_of_reviews': 61, 'reviews_length': 0},
 {'_id': '19741944', 'number_of_reviews': 17, 'reviews_length': 0},
 {'_id': '19760228', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '19779316', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '19780732', 'number_of_reviews': 12, 'reviews_length': 0},
 {'_id': '19781115', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '19803430', 'number_of_reviews': 7, 'reviews_length': 0},
 {'_id': '19820634', 'number_of_reviews': 14, 'reviews_length': 0},
 {'_id': '19821682', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '19828489', 'number_of_reviews': 49, 'reviews_length': 0},
 {'_id': '19865003', 'number_of_reviews': 25, 'reviews_length': 0},
 {'_id': '19866204', 'number_of_reviews': 15, 'reviews_length': 0},
 {'_id': '19928786', 'number_of_reviews': 42, 'reviews_length': 0},
 {'_id': '20049287', 'number_of_reviews': 14, 'reviews_length': 0},
 {'_id': '20071436', 'number_of_reviews': 20, 'reviews_length': 0},
 {'_id': '20260320', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '20276192', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '20312675', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '20353402', 'number_of_reviews': 53, 'reviews_length': 0},
 {'_id': '20511510', 'number_of_reviews': 21, 'reviews_length': 0},
 {'_id': '20567444', 'number_of_reviews': 5, 'reviews_length': 0},
 {'_id': '20611485', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '20669488', 'number_of_reviews': 42, 'reviews_length': 0},
 {'_id': '20724431', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '20735001', 'number_of_reviews': 30, 'reviews_length': 0},
 {'_id': '20807522', 'number_of_reviews': 10, 'reviews_length': 0},
 {'_id': '20809200', 'number_of_reviews': 76, 'reviews_length': 0},
 {'_id': '20829122', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '21006757', 'number_of_reviews': 30, 'reviews_length': 0},
 {'_id': '21055635', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '21056118', 'number_of_reviews': 42, 'reviews_length': 0},
 {'_id': '21103245', 'number_of_reviews': 5, 'reviews_length': 0},
 {'_id': '21180955', 'number_of_reviews': 12, 'reviews_length': 0},
 {'_id': '21322869', 'number_of_reviews': 7, 'reviews_length': 0},
 {'_id': '21389251', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '21522442', 'number_of_reviews': 11, 'reviews_length': 0},
 {'_id': '21563508', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '21844137', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '21976308', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '21992735', 'number_of_reviews': 10, 'reviews_length': 0},
 {'_id': '22005538', 'number_of_reviews': 22, 'reviews_length': 0},
 {'_id': '22042206', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '22094381', 'number_of_reviews': 37, 'reviews_length': 0},
 {'_id': '22155071', 'number_of_reviews': 19, 'reviews_length': 0},
 {'_id': '22182637', 'number_of_reviews': 35, 'reviews_length': 0},
 {'_id': '22199234', 'number_of_reviews': 30, 'reviews_length': 0},
 {'_id': '22204642', 'number_of_reviews': 34, 'reviews_length': 0},
 {'_id': '22370001', 'number_of_reviews': 53, 'reviews_length': 0},
 {'_id': '22382752', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '22891830', 'number_of_reviews': 7, 'reviews_length': 0},
 {'_id': '22919250', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '22978545', 'number_of_reviews': 28, 'reviews_length': 0},
 {'_id': '23003772', 'number_of_reviews': 13, 'reviews_length': 0},
 {'_id': '23115849', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '23121270', 'number_of_reviews': 4, 'reviews_length': 0},
 {'_id': '23122981', 'number_of_reviews': 27, 'reviews_length': 0},
 {'_id': '23160633', 'number_of_reviews': 4, 'reviews_length': 0},
 {'_id': '23178393', 'number_of_reviews': 70, 'reviews_length': 0},
 {'_id': '23180898', 'number_of_reviews': 64, 'reviews_length': 0},
 {'_id': '23187368', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '23211669', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '23211754', 'number_of_reviews': 5, 'reviews_length': 0},
 {'_id': '23217617', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '23282173', 'number_of_reviews': 40, 'reviews_length': 0},
 {'_id': '23284399', 'number_of_reviews': 23, 'reviews_length': 0},
 {'_id': '23300467', 'number_of_reviews': 21, 'reviews_length': 0},
 {'_id': '23303574', 'number_of_reviews': 10, 'reviews_length': 0},
 {'_id': '23321866', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '23479384', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '23553008', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '23611001', 'number_of_reviews': 8, 'reviews_length': 0},
 {'_id': '23759457', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '23797007', 'number_of_reviews': 15, 'reviews_length': 0},
 {'_id': '23803557', 'number_of_reviews': 50, 'reviews_length': 0},
 {'_id': '23809500', 'number_of_reviews': 13, 'reviews_length': 0},
 {'_id': '23887963', 'number_of_reviews': 29, 'reviews_length': 0},
 {'_id': '23896389', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '23953865', 'number_of_reviews': 34, 'reviews_length': 0},
 {'_id': '23989053', 'number_of_reviews': 24, 'reviews_length': 0},
 {'_id': '24004679', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '24026688', 'number_of_reviews': 49, 'reviews_length': 0},
 {'_id': '24032849', 'number_of_reviews': 23, 'reviews_length': 0},
 {'_id': '24049135', 'number_of_reviews': 16, 'reviews_length': 0},
 {'_id': '24052553', 'number_of_reviews': 40, 'reviews_length': 0},
 {'_id': '24267275', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '24322799', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '24324367', 'number_of_reviews': 22, 'reviews_length': 0},
 {'_id': '24340252', 'number_of_reviews': 10, 'reviews_length': 0},
 {'_id': '24348022', 'number_of_reviews': 24, 'reviews_length': 0},
 {'_id': '24426527', 'number_of_reviews': 8, 'reviews_length': 0},
 {'_id': '24448278', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '24461559', 'number_of_reviews': 5, 'reviews_length': 0},
 {'_id': '24486669', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '24528857', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '24693627', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '24740074', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '24748967', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '24800927', 'number_of_reviews': 11, 'reviews_length': 0},
 {'_id': '24819150', 'number_of_reviews': 23, 'reviews_length': 0},
 {'_id': '24903500', 'number_of_reviews': 13, 'reviews_length': 0},
 {'_id': '25070327', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '25117844', 'number_of_reviews': 11, 'reviews_length': 0},
 {'_id': '25185445', 'number_of_reviews': 41, 'reviews_length': 0},
 {'_id': '25217878', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '25233509', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '25418032', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '25448375', 'number_of_reviews': 15, 'reviews_length': 0},
 {'_id': '25453308', 'number_of_reviews': 4, 'reviews_length': 0},
 {'_id': '25564284', 'number_of_reviews': 19, 'reviews_length': 0},
 {'_id': '25831839', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '25832582', 'number_of_reviews': 19, 'reviews_length': 0},
 {'_id': '25996203', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '26113123', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '26120284', 'number_of_reviews': 4, 'reviews_length': 0},
 {'_id': '26120851', 'number_of_reviews': 15, 'reviews_length': 0},
 {'_id': '26263467', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '26313671', 'number_of_reviews': 15, 'reviews_length': 0},
 {'_id': '26319639', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '26348233', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '26380958', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '26444105', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '26488006', 'number_of_reviews': 22, 'reviews_length': 0},
 {'_id': '26488387', 'number_of_reviews': 25, 'reviews_length': 0},
 {'_id': '26521403', 'number_of_reviews': 8, 'reviews_length': 0},
 {'_id': '26549962', 'number_of_reviews': 9, 'reviews_length': 0},
 {'_id': '26892349', 'number_of_reviews': 18, 'reviews_length': 0},
 {'_id': '26916776', 'number_of_reviews': 4, 'reviews_length': 0},
 {'_id': '26942581', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '27011219', 'number_of_reviews': 5, 'reviews_length': 0},
 {'_id': '27020282', 'number_of_reviews': 25, 'reviews_length': 0},
 {'_id': '27044783', 'number_of_reviews': 4, 'reviews_length': 0},
 {'_id': '27045941', 'number_of_reviews': 5, 'reviews_length': 0},
 {'_id': '27083634', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '27183245', 'number_of_reviews': 20, 'reviews_length': 0},
 {'_id': '27193598', 'number_of_reviews': 34, 'reviews_length': 0},
 {'_id': '27270555', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '27298515', 'number_of_reviews': 12, 'reviews_length': 0},
 {'_id': '27347264', 'number_of_reviews': 29, 'reviews_length': 0},
 {'_id': '27378937', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '27400392', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '27588189', 'number_of_reviews': 8, 'reviews_length': 0},
 {'_id': '27594466', 'number_of_reviews': 9, 'reviews_length': 0},
 {'_id': '27667701', 'number_of_reviews': 23, 'reviews_length': 0},
 {'_id': '27784079', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '27899421', 'number_of_reviews': 7, 'reviews_length': 0},
 {'_id': '27978908', 'number_of_reviews': 31, 'reviews_length': 0},
 {'_id': '27983911', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '28004169', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '28121603', 'number_of_reviews': 11, 'reviews_length': 0},
 {'_id': '28283159', 'number_of_reviews': 12, 'reviews_length': 0},
 {'_id': '28335993', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '28378574', 'number_of_reviews': 10, 'reviews_length': 0},
 {'_id': '28429941', 'number_of_reviews': 14, 'reviews_length': 0},
 {'_id': '28598597', 'number_of_reviews': 21, 'reviews_length': 0},
 {'_id': '28632184', 'number_of_reviews': 11, 'reviews_length': 0},
 {'_id': '28680187', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '28750603', 'number_of_reviews': 8, 'reviews_length': 0},
 {'_id': '28795425', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '28825704', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '28858840', 'number_of_reviews': 5, 'reviews_length': 0},
 {'_id': '28904599', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '28926167', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '28956363', 'number_of_reviews': 18, 'reviews_length': 0},
 {'_id': '28957367', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '29115387', 'number_of_reviews': 5, 'reviews_length': 0},
 {'_id': '29115877', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '29121570', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '29147263', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '29150428', 'number_of_reviews': 12, 'reviews_length': 0},
 {'_id': '29407312', 'number_of_reviews': 7, 'reviews_length': 0},
 {'_id': '29535104', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '29552477', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '29674795', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '29676608', 'number_of_reviews': 4, 'reviews_length': 0},
 {'_id': '29682985', 'number_of_reviews': 7, 'reviews_length': 0},
 {'_id': '29799437', 'number_of_reviews': 7, 'reviews_length': 0},
 {'_id': '29840058', 'number_of_reviews': 5, 'reviews_length': 0},
 {'_id': '29870769', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '29872103', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '29879141', 'number_of_reviews': 12, 'reviews_length': 0},
 {'_id': '29957113', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '30055339', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '30364518', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '30365974', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '30366799', 'number_of_reviews': 14, 'reviews_length': 0},
 {'_id': '30501335', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '30522015', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '30573409', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '30759793', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '30763079', 'number_of_reviews': 13, 'reviews_length': 0},
 {'_id': '30832921', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '30842723', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '31101349', 'number_of_reviews': 3, 'reviews_length': 0},
 {'_id': '31217862', 'number_of_reviews': 4, 'reviews_length': 0},
 {'_id': '31352359', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '31408169', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '31460245', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '31510270', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '31582808', 'number_of_reviews': 8, 'reviews_length': 0},
 {'_id': '31666595', 'number_of_reviews': 4, 'reviews_length': 0},
 {'_id': '31827679', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '31845112', 'number_of_reviews': 6, 'reviews_length': 0},
 {'_id': '31867873', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '31941328', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '31951516', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '32102597', 'number_of_reviews': 9, 'reviews_length': 0},
 {'_id': '32104830', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '32160778', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '32178403', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '32287835', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '32362812', 'number_of_reviews': 2, 'reviews_length': 0},
 {'_id': '32401490', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '32459348', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '32481559', 'number_of_reviews': 1, 'reviews_length': 0},
 {'_id': '32537967', 'number_of_reviews': 1, 'reviews_length': 0}]
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[229]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check specific document with _id = 17951038</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"17951038"</span><span class="p">},</span> <span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"reviews"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"number_of_reviews"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"reviews_length"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$size"</span><span class="p">:</span> <span class="s2">"$reviews"</span><span class="p">}})</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[229]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>{'number_of_reviews': 100, 'reviews': [], 'reviews_length': 0}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li><p>We noticed that $245$ ($4.41\%$) listings have a <strong><code>number_of_reviews</code></strong> that doesnt match the actual number of reviews in the reviews array. <strong>For now, were not doing anything</strong> about it because this field is probably just a leftover helper or display field from the past. Since its not causing any issues and fixing it would take extra time and processing, were choosing to leave it as is. If it ever becomes important later, we can clean it up in the background without affecting the system.</p>
</li>
<li><p>Additionally, due to the lack of metadata, we don't know if this mismatch is due to a problem during the web scraping process or due to an out of sync issue.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="review_scores_rating"><strong><code>review_scores_rating</code></strong><a class="anchor-link" href="#review_scores_rating"></a></h5>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[230]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check all cases with 'review_scores_rating' more that 10</span>
<span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">'review_scores_rating'</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$gt"</span><span class="p">:</span> <span class="mi">10</span><span class="p">}},</span>      <span class="c1"># Query to find documents with 'review_scores_rating' &gt; 10</span>
                                    <span class="p">{</span><span class="s1">'_id'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'review_scores_rating'</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>      <span class="c1"># Projection to include only '_id' and 'review_scores_rating'</span>
     <span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>  <span class="c1"># Display first 10 documents with 'review_scores_rating' &gt; 10</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[230]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>[{'_id': '10006546', 'review_scores_rating': 89},
 {'_id': '1001265', 'review_scores_rating': 84},
 {'_id': '10021707', 'review_scores_rating': 100},
 {'_id': '1003530', 'review_scores_rating': 94},
 {'_id': '10038496', 'review_scores_rating': 98},
 {'_id': '10047964', 'review_scores_rating': 100},
 {'_id': '10051164', 'review_scores_rating': 80},
 {'_id': '10057826', 'review_scores_rating': 88},
 {'_id': '10059872', 'review_scores_rating': 100},
 {'_id': '10083468', 'review_scores_rating': 97}]</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[231]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mNumber of documents with 'review_scores_rating' greater than 10:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">'review_scores_rating'</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s1">'$gt'</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">}})))</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre><span class="ansi-bold">Number of documents with 'review_scores_rating' greater than 10:</span> 4081
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[232]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Normalize 'review_scores_rating' to be between 0 and 10</span>
<span class="c1"># We consider that the range of all values is between 0 and 100, so we divide by 10 to normalize the values</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
    <span class="p">{},</span>
    <span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/operator/aggregation/divide/</span>
    <span class="p">[{</span><span class="s2">"$set"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"review_scores_rating"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$divide"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$review_scores_rating"</span><span class="p">,</span> <span class="mi">10</span><span class="p">]}}}]</span>
<span class="p">)</span>

<span class="c1"># Check all cases with 'review_scores_rating' more that 10</span>
<span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">'review_scores_rating'</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$gt"</span><span class="p">:</span> <span class="mi">10</span><span class="p">}},</span> <span class="p">{</span><span class="s1">'_id'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'review_scores_rating'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[232]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>[]</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[233]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check if 'review_scores_rating' is decimal after the change</span>
<span class="n">review_scores_rating_type</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="c1"># Only consider documents where the field exists</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"review_scores_rating"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}},</span>
    
    <span class="c1"># Group by the BSON type of the field</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$type"</span><span class="p">:</span> <span class="s2">"$review_scores_rating"</span><span class="p">}}},</span>
    
    <span class="c1"># Project the type name </span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"BSONType"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">}}</span>
<span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Data type of 'review_scores_rating': </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">review_scores_rating_type</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Data type of 'review_scores_rating': [{'BSONType': 'double'}, {'BSONType': 'null'}]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li><p><strong>Analysis:</strong> The <code>review_scores_rating</code> field shows values up to 100, while other <code>review_scores_*</code> fields (checkin, cleanliness, etc.) are consistently between 0-10. This suggests <code>review_scores_rating</code> uses a different scale (0-100).</p>
</li>
<li><p><strong>Decision &amp; Transformation:</strong></p>
<ul>
<li>We applied <strong>data normalization</strong> to the <code>review_scores_rating</code> field by dividing its value by $10$, because its range ($0-100$) was inconsistent with other review scores ($0-10$). Unlike the other scores, this one will be kept in decimal format after normalization, in order to preserve more detailed information. We expect <strong>consistent scaling across all review score metrics</strong>, enabling meaningful calculation of averages (as required in <strong>Q9</strong>).</li>
</ul>
</li>
</ul>
<p>The verification query confirms that no <code>review_scores_rating</code> values are now greater than 10.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="amenities"><strong><code>amenities</code></strong><a class="anchor-link" href="#amenities"></a></h5>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[234]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check if 'amenities' only appears in the array once</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">"amenities"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}})</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">'amenities'</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">'amenities'</span><span class="p">])):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Duplicate amenities found in document with _id: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">break</span>

<span class="c1"># Check 'amenities' for duplicates</span>
<span class="n">pprint</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"1001265"</span><span class="p">},</span> <span class="p">{</span><span class="s2">"amenities"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}))[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'amenities'</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Duplicate amenities found in document with _id: 1001265
['Air conditioning',
 'BBQ grill',
 'Bed linens',
 'Cable TV',
 'Coffee maker',
 'Cooking basics',
 'Disabled parking spot',
 'Dishes and silverware',
 'Dryer',
 'Elevator',
 'Essentials',
 'Ethernet connection',
 'Extra pillows and blankets',
 'Free parking on premises',
 'Garden or backyard',
 'Hair dryer',
 'Hangers',
 'Hot tub',
 'Hot water',
 'Iron',
 'Kitchen',
 'Laptop friendly workspace',
 'Lockbox',
 'Microwave',
 'Pool',
 'Refrigerator',
 'Self check-in',
 'Shampoo',
 'Step-free access',
 'Step-free access',
 'Stove',
 'TV',
 'Washer',
 'Well-lit path to entrance',
 'Wide clearance to bed',
 'Wifi']
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[235]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Remove duplicates from 'amenities' array</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
    <span class="p">{},</span>
    <span class="p">[{</span><span class="s2">"$set"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"amenities"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$setUnion"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$amenities"</span><span class="p">,</span> <span class="p">[]]}</span>  <span class="c1"># Remove duplicates</span>
    <span class="p">}}]</span>
<span class="p">)</span>

<span class="c1"># Check 'amenities' for duplicates again</span>
<span class="n">pprint</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"1001265"</span><span class="p">},</span> <span class="p">{</span><span class="s2">"amenities"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}))[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'amenities'</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>['Air conditioning',
 'BBQ grill',
 'Bed linens',
 'Cable TV',
 'Coffee maker',
 'Cooking basics',
 'Disabled parking spot',
 'Dishes and silverware',
 'Dryer',
 'Elevator',
 'Essentials',
 'Ethernet connection',
 'Extra pillows and blankets',
 'Free parking on premises',
 'Garden or backyard',
 'Hair dryer',
 'Hangers',
 'Hot tub',
 'Hot water',
 'Iron',
 'Kitchen',
 'Laptop friendly workspace',
 'Lockbox',
 'Microwave',
 'Pool',
 'Refrigerator',
 'Self check-in',
 'Shampoo',
 'Step-free access',
 'Stove',
 'TV',
 'Washer',
 'Well-lit path to entrance',
 'Wide clearance to bed',
 'Wifi']
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="host_verifications"><strong><code>host_verifications</code></strong><a class="anchor-link" href="#host_verifications"></a></h5>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[236]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check if 'host_verifications' only appears in the array once</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">"host_verifications"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}})</span>
<span class="n">len_host_verifications_duplicates</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">'host_verifications'</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">'host_verifications'</span><span class="p">])):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Duplicate host_verifications found in document with _id: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">len_host_verifications_duplicates</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">if</span> <span class="n">len_host_verifications_duplicates</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mTotal documents with duplicate host_verifications: </span><span class="si">{</span><span class="n">len_host_verifications_duplicates</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"No duplicate </span><span class="se">\033</span><span class="s2">[1mhost_verifications</span><span class="se">\033</span><span class="s2">[0m found"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>No duplicate <span class="ansi-bold">host_verifications</span> found
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="transactions"><strong><code>transactions</code></strong><a class="anchor-link" href="#transactions"></a></h5><ul>
<li>We want to check the number of transactions registered before <strong>Airbnb</strong> was founded in <strong>11 August 2008</strong> (Source: <a href="https://www.airbnb.pt/about/about-us">https://www.airbnb.pt/about/about-us</a> &amp; <a href="https://www.businessofapps.com/data/airbnb-statistics/">https://www.businessofapps.com/data/airbnb-statistics/</a>).</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[237]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Date of foundation of Airbnb - 11 August 2008</span>
<span class="n">airbnb_foundation_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>

<span class="c1"># Check if 'transactions.transactions.date' is before the foundation date</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"transactions.transactions"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"$elemMatch"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"date"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$lt"</span><span class="p">:</span> <span class="n">airbnb_foundation_date</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Count documents with transactions before the foundation date</span>
<span class="n">count_before_foundation</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mNumber of transactions before Airbnb's foundation date:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">count_before_foundation</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">count_before_foundation</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total_docs</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">)</span><span class="se">\033</span><span class="s2">[1m of all documents</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre><span class="ansi-bold">Number of transactions before Airbnb's foundation date:</span> 5467 (98.42%)<span class="ansi-bold"> of all documents</span>
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[238]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Pipeline to count the total number of transactions in the collection</span>
<span class="n">pipeline_total</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"transactions.transactions"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"$ne"</span><span class="p">:</span> <span class="p">[]}}},</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$transactions.transactions"</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"totalTransactions"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}}</span>
<span class="p">]</span>
<span class="n">total_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline_total</span><span class="p">))</span>
<span class="n">total_transactions</span> <span class="o">=</span> <span class="n">total_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"totalTransactions"</span><span class="p">]</span> <span class="k">if</span> <span class="n">total_result</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1"># Pipeline to count transactions with a date before the foundation date</span>
<span class="n">pipeline_before</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"transactions.transactions"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"$ne"</span><span class="p">:</span> <span class="p">[]}}},</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$transactions.transactions"</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"transactions.transactions.date"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$lt"</span><span class="p">:</span> <span class="n">airbnb_foundation_date</span><span class="p">}}},</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"countBefore"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}}</span>
<span class="p">]</span>
<span class="n">before_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline_before</span><span class="p">))</span>
<span class="n">count_before</span> <span class="o">=</span> <span class="n">before_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"countBefore"</span><span class="p">]</span> <span class="k">if</span> <span class="n">before_result</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1"># Calculate the percentage of transactions that occurred before the foundation date</span>
<span class="n">percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">count_before</span> <span class="o">/</span> <span class="n">total_transactions</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_transactions</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mNumber of transactions before Airbnb's foundation date:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">count_before</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">percentage</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%)"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre><span class="ansi-bold">Number of transactions before Airbnb's foundation date:</span> 110837 (35.63%)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li>Approximately $35.63\%$ of the transactions were performed before Airbnbs foundation date. This significant proportion indicates that these records represent a considerable amount of historical data, and removing them could result in the loss of valuable information. Additionally, the lack of metadata or context for these transactions makes it difficult to determine their relevance or accuracy.</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[239]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Verify that each transaction occurs within the 'bucket_start_date' and 'bucket_end_date'</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"listing_id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">"BucketStart"</span><span class="p">:</span> <span class="s2">"$transactions.bucket_start_date"</span><span class="p">,</span>
            <span class="s2">"BucketEnd"</span><span class="p">:</span> <span class="s2">"$transactions.bucket_end_date"</span><span class="p">,</span>
            <span class="s2">"OutOfRangeTransactions"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"$filter"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$transactions.transactions"</span><span class="p">,</span>
                    <span class="s2">"as"</span><span class="p">:</span> <span class="s2">"t"</span><span class="p">,</span>
                    <span class="s2">"cond"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"$or"</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span> <span class="s2">"$lt"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$$t.date"</span><span class="p">,</span> <span class="s2">"$transactions.bucket_start_date"</span><span class="p">]</span> <span class="p">},</span>
                            <span class="p">{</span> <span class="s2">"$gt"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$$t.date"</span><span class="p">,</span> <span class="s2">"$transactions.bucket_end_date"</span><span class="p">]</span> <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="c1"># Only return documents with at least one out-of-range transaction</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"OutOfRangeTransactions.0"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span> <span class="p">}</span> <span class="p">}}</span>
<span class="p">]</span>

<span class="c1"># Execute the pipeline</span>
<span class="n">out_of_range_docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mNumber of transactions within the specified date range:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">out_of_range_docs</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\033</span><span class="s2">[1mtransactions</span><span class="se">\033</span><span class="s2">[0m (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">out_of_range_docs</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total_docs</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2"> of all documents)"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre><span class="ansi-bold">Number of transactions within the specified date range:</span> 0 <span class="ansi-bold">transactions</span> (0.00% of all documents)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Invalid-Dates"><strong>Invalid Dates</strong><a class="anchor-link" href="#Invalid-Dates"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[240]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check if 'last_scraped' &lt; 'last_review' (Invalid data)</span>
<span class="n">invalid_dates</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span>
    <span class="s2">"$expr"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"$lt"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$last_scraped"</span><span class="p">,</span> <span class="s2">"$last_review"</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">})</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">invalid_dates</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">invalid_dates</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Document with _id: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span><span class="si">}</span><span class="s2"> has last_scraped: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'last_scraped'</span><span class="p">]</span><span class="si">}</span><span class="s2"> &lt; last_review: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'last_review'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"No documents found with last_scraped &lt; last_review."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>No documents found with last_scraped &lt; last_review.
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[241]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check if 'first_review' &gt; 'last_review' (Invalid data)</span>
<span class="n">invalid_dates</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span>
    <span class="s2">"$expr"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"$gt"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$first_review"</span><span class="p">,</span> <span class="s2">"$last_review"</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">})</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">invalid_dates</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">invalid_dates</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Document with _id: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span><span class="si">}</span><span class="s2"> has first_review: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'first_review'</span><span class="p">]</span><span class="si">}</span><span class="s2"> &gt; last_review: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'last_review'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"No documents found with first_review &gt; last_review."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>No documents found with first_review &gt; last_review.
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[242]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check if 'first_review' &lt; 'transactions.transactions.date' (Invalid data)</span>
<span class="n">invalid_dates</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find</span><span class="p">({</span>
    <span class="s2">"$expr"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"$lt"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$first_review"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"$arrayElemAt"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$transactions.transactions.date"</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}]</span>
    <span class="p">}</span>
<span class="p">})</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">invalid_dates</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">invalid_dates</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Document with _id: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span><span class="si">}</span><span class="s2"> has first_review: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'first_review'</span><span class="p">]</span><span class="si">}</span><span class="s2"> &lt; transactions.transactions.date: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'transactions'</span><span class="p">][</span><span class="s1">'transactions'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">'date'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"No documents found with first_review &lt; transactions.transactions.date."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%F0%9F%93%9A-1.5-%7C-Data-Model-Adjustments"><strong> 1.5 | Data Model Adjustments</strong><a class="anchor-link" href="#%F0%9F%93%9A-1.5-%7C-Data-Model-Adjustments"></a></h3>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Three stage approach for data model and final schema design</strong></p>
<ol>
<li>Workload stage</li>
<li>Relationship assessment</li>
<li>Patterns</li>
</ol>
<p style="text-align: center !important;">
<!-- Data Model Design Process  -->
<img alt="Data Model Design Process" height="400" src="./img/DataModels&amp;Schema.png">
</img></p>
<br/>
<p>Based on the <strong>Workload</strong>, <strong>Relationships</strong>, and <strong>Patterns</strong> analysis, we will now implement the new schema design by creating separate collections for <code>Hosts</code>, <code>Reviews</code>, and <code>Transactions</code>, and restructuring the <code>Listings</code> collection.</p>
<p><strong>Overall Strategy:</strong> Move large, unbounded, or independently accessed data (<strong>reviews</strong>, <strong>host details</strong>, <strong>transactions</strong>) out of the main listing document into their own collections, using references (<code>Host_ID</code>, <code>Listing_ID</code>, <code>Reviewer_ID</code>) to link them.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="1.-Workload-Stage"><strong>1. Workload Stage</strong><a class="anchor-link" href="#1.-Workload-Stage"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[243]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Determine total number of documents and total size</span>
<span class="n">total_documents</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span>

<span class="n">stats</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">"collstats"</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">total_size</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s2">"size"</span><span class="p">]</span>  <span class="c1"># Total document data size in bytes</span>
<span class="n">total_size_gb</span> <span class="o">=</span> <span class="n">total_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mTotal documents in the collection 'listingsAndReviews_HW2':</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">total_documents</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mTotal size of the collection 'listingsAndReviews_HW2':</span><span class="se">\033</span><span class="s2">[0m      </span><span class="si">{</span><span class="n">total_size</span><span class="si">}</span><span class="s2"> bytes (</span><span class="si">{</span><span class="n">total_size_gb</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> GB)"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre><span class="ansi-bold">Total documents in the collection 'listingsAndReviews_HW2':</span> 5555
<span class="ansi-bold">Total size of the collection 'listingsAndReviews_HW2':</span>      108183825 bytes (0.101 GB)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="%F0%9F%A7%A0-Workload-Stage-Summary"><strong> Workload Stage Summary</strong><a class="anchor-link" href="#%F0%9F%A7%A0-Workload-Stage-Summary"></a></h5><center>
<table>
<thead>
<tr>
<th style="text-align:left">#</th>
<th style="text-align:left">Step / Question</th>
<th style="text-align:left">What it Entails</th>
<th style="text-align:left">Entities Involved</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>1</strong></td>
<td style="text-align:left"><strong>Assess Data Size</strong></td>
<td style="text-align:left">Determine current collection volume and size</td>
<td style="text-align:left"><code>listingsAndReviews_HW2</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>2a</strong></td>
<td style="text-align:left"><strong>Most Common Use Case</strong></td>
<td style="text-align:left">Show property info to customers (core details + sample reviews)</td>
<td style="text-align:left"><code>Listings</code>, <code>Reviews</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>2b (Q7)</strong></td>
<td style="text-align:left">Unique amenities list for host registration</td>
<td style="text-align:left">Show all unique amenities; rarely changes</td>
<td style="text-align:left"><code>Listings</code>, <code>Amenities</code> (New)</td>
</tr>
<tr>
<td style="text-align:left"><strong>2c (Q8)</strong></td>
<td style="text-align:left">Top 20 reviewers and fast review count lookup</td>
<td style="text-align:left">Rank reviewers and return count per reviewer</td>
<td style="text-align:left"><code>Reviews</code>, <code>Reviewers</code> (New)</td>
</tr>
<tr>
<td style="text-align:left"><strong>2d (Q9)</strong></td>
<td style="text-align:left">Average of review scores (dynamic metrics)</td>
<td style="text-align:left">Compute average across all review metrics</td>
<td style="text-align:left"><code>Listings</code>, <code>Review_Scores</code> (Subdoc)</td>
</tr>
<tr>
<td style="text-align:left"><strong>2e (Q10)</strong></td>
<td style="text-align:left">Avg transaction value per property for time period</td>
<td style="text-align:left">Time-based aggregation on transactions</td>
<td style="text-align:left"><code>Transactions</code> (New), <code>Listings</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>2f (Q11)</strong></td>
<td style="text-align:left">Summary page of top 10 cities + top listings</td>
<td style="text-align:left">Show city-level stats and example listings</td>
<td style="text-align:left"><code>Listings</code>, <code>Reviews</code>, <code>CitySummary</code> (New)</td>
</tr>
</tbody>
</table>
</center>
<br/>
<blockquote>
<p><strong>Note:</strong> All the operations that we will do are mostly <em>reads</em>, but in real-world cenarios, *<strong>AirBnB</strong>* would have to do a lot of <em>writes</em> as well. So, we will try to optimize the database for both reads and writes.</p>
</blockquote>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="2.-Relationships-Assessment-Stage"><strong>2. Relationships Assessment Stage</strong><a class="anchor-link" href="#2.-Relationships-Assessment-Stage"></a></h4><ol>
<li>Identify which entities are related</li>
<li>Measure quantity of related data (<strong>1:1</strong>, <strong>1:N</strong>, <strong>N:N</strong>)</li>
<li>Decide whether to embed data or reference  it<ul>
<li>Embed for fast reads &amp; tightly coupled data</li>
<li>Reference for flexibility &amp; loosely coupled data</li>
</ul>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="%F0%9F%94%97-Relationships-Phase-Table-(with-Correct-Embed/Reference-Direction)"><strong> Relationships Phase Table (with Correct Embed/Reference Direction)</strong><a class="anchor-link" href="#%F0%9F%94%97-Relationships-Phase-Table-(with-Correct-Embed/Reference-Direction)"></a></h5><center>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>Entities</strong></th>
<th style="text-align:left"><strong>Relationship Type</strong></th>
<th style="text-align:left"><strong>Cardinality</strong></th>
<th style="text-align:left"><strong>Embed or Reference?</strong></th>
<th style="text-align:left"><strong>Reasoning</strong></th>
<th style="text-align:left"><strong>Context in Project</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>Listings</code></td>
<td style="text-align:left"><code>Hosts</code></td>
<td style="text-align:left">Listing has one Host</td>
<td style="text-align:left">N:1</td>
<td style="text-align:left"><strong>Reference <code>Hosts</code> in <code>Listings</code></strong></td>
<td style="text-align:left">Avoid duplication; host info reused/updated</td>
</tr>
<tr>
<td style="text-align:left"><code>Listings</code></td>
<td style="text-align:left"><code>Reviews</code></td>
<td style="text-align:left">Listing has many Reviews</td>
<td style="text-align:left">1:N</td>
<td style="text-align:left"><strong>Reference <code>Listings</code>  in <code>Reviews</code></strong></td>
<td style="text-align:left">Reviews grow; keeps listing doc lean</td>
</tr>
<tr>
<td style="text-align:left"><code>Reviews</code></td>
<td style="text-align:left"><code>Reviewers</code></td>
<td style="text-align:left">Review written by one Reviewer</td>
<td style="text-align:left">N:1</td>
<td style="text-align:left"><strong>Reference <code>Reviewers</code> in <code>Reviews</code></strong></td>
<td style="text-align:left">Reviewers write multiple reviews; enables reviewer tracking</td>
</tr>
<tr>
<td style="text-align:left"><code>Listings</code></td>
<td style="text-align:left"><code>Transactions</code></td>
<td style="text-align:left">Listing has many Transactions</td>
<td style="text-align:left">1:N</td>
<td style="text-align:left"><strong>Reference <code>Listing</code> in <code>Transactions</code></strong></td>
<td style="text-align:left">Time-series data; accessed separately</td>
</tr>
<tr>
<td style="text-align:left"><code>Listings</code></td>
<td style="text-align:left"><code>Amenities</code> (array)</td>
<td style="text-align:left">Listing has many amenities</td>
<td style="text-align:left">1:N</td>
<td style="text-align:left"><strong>Embed <code>Amenities</code> in <code>Listing</code></strong></td>
<td style="text-align:left">Small, static data; needed for listing reads</td>
</tr>
<tr>
<td style="text-align:left"><code>City</code> (Optional)</td>
<td style="text-align:left"><code>Listings</code></td>
<td style="text-align:left">City has many listings</td>
<td style="text-align:left">1:N</td>
<td style="text-align:left"><strong>Both sides</strong></td>
<td style="text-align:left">City identified via <code>Listing.Address.market</code>; enables grouping/aggregation</td>
</tr>
<tr>
<td style="text-align:left"><code>Listings</code></td>
<td style="text-align:left"><code>ReviewScores</code></td>
<td style="text-align:left">Listing has one set of review scores</td>
<td style="text-align:left">1:1</td>
<td style="text-align:left"><strong>Embed <code>Review Scores</code> in <code>Listings</code></strong></td>
<td style="text-align:left">Small, core data;</td>
</tr>
</tbody>
</table>
</center>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="3.-Patterns-Phase"><strong>3. Patterns Phase</strong><a class="anchor-link" href="#3.-Patterns-Phase"></a></h4><ol>
<li>Recognize common access or structure patterns in data</li>
<li>Apply modeling patterns (e.g., bucket, subset, outlier) to optimize for performance, scalability, and simplicity</li>
</ol>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="%E2%9C%85-Patterns-Phase-Table"><strong> Patterns Phase Table</strong><a class="anchor-link" href="#%E2%9C%85-Patterns-Phase-Table"></a></h5><center>
<table>
<thead>
<tr>
<th><strong>Use Case / Entity</strong></th>
<th><strong>Entity Requirements</strong></th>
<th><strong>Applied Pattern (Allowed)</strong></th>
<th><strong>Why This Pattern?</strong></th>
<th><strong>Context in Project</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Host registration: show common <code>Amenities</code></strong></td>
<td>Read-heavy, rarely changing list of distinct values</td>
<td><strong>Computed Pattern</strong></td>
<td>Precompute into <code>Amenities</code> collection; avoids scans</td>
<td><strong>Q7</strong></td>
</tr>
<tr>
<td><strong>Track top reviewers + <code>ReviewCount</code></strong></td>
<td>Aggregate reviews per reviewer; fast lookup needed</td>
<td><strong>Computed Pattern</strong></td>
<td>Maintain count in <code>Reviewers</code> collection; fast access</td>
<td><strong>Q8</strong></td>
</tr>
<tr>
<td><strong>Dynamic review metrics per listing</strong></td>
<td>New score fields added without fixed schema</td>
<td><strong>Attribute Pattern</strong></td>
<td>Store scores as key-value pairs; flexible querying</td>
<td><strong>Q9</strong></td>
</tr>
<tr>
<td><strong>Calculate average <code>ReviewsScores</code></strong></td>
<td>Average multiple, potentially dynamic, score fields</td>
<td><strong>Computed  Pattern</strong></td>
<td>Store scores as key-value; allows fast reading</td>
<td><strong>Q9</strong></td>
</tr>
<tr>
<td><strong>Summary of top cities/listings</strong></td>
<td>Repeated aggregated reads across many documents</td>
<td><strong>Computed Pattern</strong></td>
<td>Store precomputed summaries in <code>CitySummary</code>; fast reads</td>
<td><strong>Q11</strong></td>
</tr>
</tbody>
</table>
</center>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Final-Schema-Design"><strong>Final Schema Design</strong><a class="anchor-link" href="#Final-Schema-Design"></a></h4><h5 id="List-of-All-Collections-Required"><strong>List of All Collections Required</strong><a class="anchor-link" href="#List-of-All-Collections-Required"></a></h5><center>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>Collection Name</strong></th>
<th style="text-align:left"><strong>Purpose</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>Listings</code></td>
<td style="text-align:left">Core listing info (<code>title</code>, <code>price</code>, <code>amenities</code>, <code>scores</code>, etc.)</td>
</tr>
<tr>
<td style="text-align:left"><code>Reviews</code></td>
<td style="text-align:left">Full detailed reviews (referenced from <strong><code>Listings</code></strong>)</td>
</tr>
<tr>
<td style="text-align:left"><code>Reviewers</code></td>
<td style="text-align:left">Reviewer profiles with computed review count (referenced from <strong><code>Reviews</code></strong>)</td>
</tr>
<tr>
<td style="text-align:left"><code>Transactions</code></td>
<td style="text-align:left">Kept on the <strong><code>Listings</code></strong> collection the metadata information and included in the <strong><code>Transactions</code></strong> collection the history of the transactions</td>
</tr>
<tr>
<td style="text-align:left"><code>Hosts</code></td>
<td style="text-align:left">Host information (referenced from <strong><code>Listings</code></strong>)</td>
</tr>
<tr>
<td style="text-align:left"><code>CitySummary</code> (Optional)</td>
<td style="text-align:left">Precomputed metrics for top 10 cities</td>
</tr>
<tr>
<td style="text-align:left"><code>Amenities</code> (Optional)</td>
<td style="text-align:left">List of unique amenities with frequency</td>
</tr>
</tbody>
</table>
</center>
<h5 id="Overview"><strong>Overview</strong><a class="anchor-link" href="#Overview"></a></h5><p style="text-align: center !important;">
<!-- Final Schema Design  -->
<img alt="Final Schema Design" src="./img/FinalSchemaDesign.png" with="400"/>
</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[244]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Drop new collections if they exist to start fresh</span>
<span class="n">db</span><span class="o">.</span><span class="n">drop_collection</span><span class="p">(</span><span class="s2">"Listings"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">drop_collection</span><span class="p">(</span><span class="s2">"Reviews"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">drop_collection</span><span class="p">(</span><span class="s2">"Reviewers"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">drop_collection</span><span class="p">(</span><span class="s2">"Transactions"</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">drop_collection</span><span class="p">(</span><span class="s2">"Hosts"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[244]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>{'ok': 1.0}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Reviews-Collection"><strong><code>Reviews</code> Collection</strong><a class="anchor-link" href="#Reviews-Collection"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[245]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Print one example document of 'reviews' array</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"1022200"</span><span class="p">},</span> <span class="p">{</span><span class="s2">"reviews"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>{'_id': '1022200',
 'reviews': [{'_id': '277195899',
              'date': datetime.datetime(2018, 6, 15, 4, 0),
              'listing_id': '1022200',
              'reviewer_id': '710109',
              'reviewer_name': 'Sylvia',
              'comments': 'Great location and lovely facility overall.  A '
                          'great deal!'}]}
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[246]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 1: Create Reviews collection</span>
<span class="n">reviews_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"_id"</span><span class="p">,</span> <span class="s2">"reviews"</span><span class="p">]</span>

<span class="c1"># Aggregate to extract reviews and their corresponding listing IDs</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$reviews"</span><span class="p">},</span>                                                        <span class="c1"># Unwind the 'reviews' array to create a document for each review</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                                                                   <span class="c1"># Will create a ObjectId for each review</span>
        <span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>                                                       <span class="c1"># Include the listing ID</span>
        <span class="s2">"Review_ID"</span><span class="p">:</span> <span class="s2">"$reviews._id"</span><span class="p">,</span>                                                <span class="c1"># Include the review ID</span>
        <span class="s2">"Review_Comments"</span><span class="p">:</span> <span class="s2">"$reviews.comments"</span><span class="p">,</span>                                     <span class="c1"># Include the review comments</span>
        <span class="s2">"Review_Date"</span><span class="p">:</span> <span class="s2">"$reviews.date"</span><span class="p">,</span>                                             <span class="c1"># Include the review date</span>
        <span class="s2">"Reviewer_ID"</span><span class="p">:</span> <span class="s2">"$reviews.reviewer_id"</span><span class="p">,</span>                                      <span class="c1"># Include the reviewer ID</span>
    <span class="p">}},</span>
    <span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/operator/aggregation/out/</span>
    <span class="p">{</span><span class="s2">"$out"</span><span class="p">:</span> <span class="s2">"Reviews"</span><span class="p">}</span>                                                             <span class="c1"># Output directly to 'Reviews' collection in the same database</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[246]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>&lt;pymongo.synchronous.command_cursor.CommandCursor at 0x2603702c4a0&gt;</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[247]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 2: Check the new Reviews collection</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mNumber of documents in 'Reviews' collection:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">Reviews</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span><span class="w">  </span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>   <span class="c1"># Count the number of documents in the Reviews collection</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mSample document from 'Reviews' collection:</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Reviews</span><span class="o">.</span><span class="n">find_one</span><span class="p">(),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>                                                             <span class="c1"># Print one example document from the Reviews collection</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Number of documents in 'Reviews' collection:</span> 149792
<span class="ansi-bold">Sample document from 'Reviews' collection:</span>
{'_id': ObjectId('67fea80ca6298d01ad052272'),
 'Listing_ID': '10006546',
 'Review_ID': '58663741',
 'Review_Comments': 'A casa da Ana e do Gonalo foram o local escolhido para a '
                    'passagem de ano com um grupo de amigos. Fomos super bem '
                    'recebidos com uma grande simpatia e predisposio a '
                    'ajudar com qualquer coisa que fosse necessrio.\r\n'
                    'A casa era ainda melhor do que parecia nas fotos, '
                    'totalmente equipada, com mantas, aquecedor e tudo o que '
                    'pudessemos precisar.\r\n'
                    'A localizao no podia ser melhor! No h melhor do que '
                    'acordar de manh e ao virar da esquina estar a ribeira do '
                    'Porto.',
 'Review_Date': datetime.datetime(2016, 1, 3, 5, 0),
 'Reviewer_ID': '51483096'}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p>We applied the <strong>Referencing</strong> by creating a separate <code>Reviews</code> collection. This addresses the issue of the potentially large and unbounded <code>reviews</code> array embedded within the original listing documents, which negatively impacted performance. We expect <strong>smaller, faster-loading listing documents</strong>, <strong>improved scalability</strong> as reviews can grow independently, and <strong>efficient querying of reviews</strong> using the indexed <code>Listing_ID</code> and <code>Review_ID</code> fields. Each document in this collection represents a single review and links back to its corresponding listing.</p>
</blockquote>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[248]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 3: Create Review.Listing_ID and Review.Review_ID indexes for faster queries ("Foreign Key")</span>
<span class="n">db</span><span class="o">.</span><span class="n">Reviews</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Listing_ID"</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[248]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>'Listing_ID_1'</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[249]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">Reviews</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Review_ID"</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[249]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>'Review_ID_1'</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Reviewers-Collection"><strong><code>Reviewers</code> Collection</strong><a class="anchor-link" href="#Reviewers-Collection"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[250]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">drop_collection</span><span class="p">(</span><span class="s2">"Reviewers"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[250]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>{'ok': 1.0}</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[251]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 1: Create Reviewers collection</span>
<span class="n">reviewers_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"_id"</span><span class="p">,</span> <span class="s2">"reviews.reviewer_id"</span><span class="p">,</span> <span class="s2">"reviews.reviewer_name"</span><span class="p">]</span>

<span class="c1"># Aggregate to extract unique reviewers and their corresponding review IDs</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$reviews"</span><span class="p">},</span>                                        <span class="c1"># Unwind the 'reviews' array to create a document for each review</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$reviews.reviewer_id"</span><span class="p">,</span>                              <span class="c1"># Group by reviewer ID</span>
        <span class="s2">"Reviewer_Name"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$first"</span><span class="p">:</span> <span class="s2">"$reviews.reviewer_name"</span><span class="p">},</span>      <span class="c1"># Take the first name (assumes consistency)</span>
    <span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                                                   <span class="c1"># Will create a ObjectId for each reviewer</span>
        <span class="s2">"Reviewer_ID"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>                                      <span class="c1"># Include reviewer ID</span>
        <span class="s2">"Reviewer_Name"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>                                         <span class="c1"># Include reviewer name</span>
        <span class="c1"># "Reviews_Count"                                           # Computed Pattern that will be create in Q8</span>
    <span class="p">}},</span>
    <span class="c1"># Output directly to 'Reviewers' collection</span>
    <span class="p">{</span><span class="s2">"$out"</span><span class="p">:</span> <span class="s2">"Reviewers"</span><span class="p">}</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[251]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>&lt;pymongo.synchronous.command_cursor.CommandCursor at 0x2603702f260&gt;</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[252]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 2: Check the new Reviewers collection</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mNumber of documents in 'Reviewers' collection:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">Reviewers</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>        <span class="c1"># Count the number of documents in the Reviewers collection</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mSample document from 'Reviewers' collection:</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Reviewers</span><span class="o">.</span><span class="n">find_one</span><span class="p">(),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>                                                                  <span class="c1"># Print one example document from the Reviewers collection</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Number of documents in 'Reviewers' collection:</span> 146640
<span class="ansi-bold">Sample document from 'Reviewers' collection:</span>
{'_id': ObjectId('67fea80ea6298d01ad076b92'),
 'Reviewer_Name': 'Frank',
 'Reviewer_ID': '99803988'}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p>We applied <strong>Normalization/Referencing</strong> by creating a separate <code>Reviewers</code> collection. This addresses the need to efficiently track reviewers and their activity (<strong>Q8</strong>) without duplicating reviewer names across potentially numerous reviews in the main <code>Reviews</code> collection. Each document in <code>Reviewers</code> represents a unique reviewer, identified by <code>Reviewer_ID</code>. We expect <strong>improved data consistency</strong> (reviewer names stored once) and <strong>efficient lookups for reviewer-specific information</strong>, especially when combined with the <code>Reviewer_ID</code> index.</p>
</blockquote>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[253]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 3: Create Reviewers.Reviewer_ID and Reviews.Reviewer_ID indexes for faster queries ("Foreign Key")</span>
<span class="n">db</span><span class="o">.</span><span class="n">Reviewers</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Reviewer_ID"</span><span class="p">)])</span>                                        <span class="c1"># Create index on Reviewer_ID field in Reviewers collection</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[253]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>'Reviewer_ID_1'</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[254]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">Reviews</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Reviewer_ID"</span><span class="p">)])</span>                                          <span class="c1"># Create index on Reviewer_ID field in Reviews collection</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[254]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>'Reviewer_ID_1'</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Hosts-Collection"><strong><code>Hosts</code> Collection</strong><a class="anchor-link" href="#Hosts-Collection"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[255]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 1: Create Hosts collection</span>
<span class="c1"># Extract all fields with "host_" prefix</span>
<span class="n">host_fields</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"fields"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$objectToArray"</span><span class="p">:</span> <span class="s2">"$$ROOT"</span><span class="p">}}},</span>             <span class="c1"># Convert document to key-value pairs</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$fields"</span><span class="p">},</span>                                             <span class="c1"># Flatten the fields array</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"fields.k"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$regex"</span><span class="p">:</span> <span class="s2">"^host_"</span><span class="p">}}},</span>                     <span class="c1"># Match fields starting with 'host_'</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$fields.k"</span><span class="p">}},</span>                                   <span class="c1"># Group by field names to get distinct fields</span>
<span class="p">])</span>

<span class="c1"># Convert the aggregation result to a list with only field names</span>
<span class="n">host_fields</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">doc</span><span class="p">[</span><span class="s2">"_id"</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">host_fields</span><span class="p">])</span>

<span class="c1"># Add "_id" field to host_fields in first position</span>
<span class="n">host_fields</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">"_id"</span><span class="p">)</span>  <span class="c1"># Add "_id" field to the beginning of the list</span>

<span class="c1"># Print the list of host fields</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">host_fields</span><span class="p">)</span><span class="si">}</span><span class="s2"> host_* fields</span><span class="se">\033</span><span class="s2">[0m: </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">host_fields</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Found <span class="ansi-bold">17 host_* fields</span>: 

['_id',
 'host_about',
 'host_has_profile_pic',
 'host_id',
 'host_identity_verified',
 'host_is_superhost',
 'host_listings_count',
 'host_location',
 'host_name',
 'host_neighbourhood',
 'host_picture_url',
 'host_response_rate',
 'host_response_time',
 'host_thumbnail_url',
 'host_total_listings_count',
 'host_url',
 'host_verifications']
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[256]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 2: Aggregate to extract hosts and their corresponding listing IDs</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    
    <span class="c1"># Group documents by host ID to create a document for each host</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$host_id"</span><span class="p">,</span>                                                         <span class="c1"># Group by host ID</span>
        <span class="s2">"host_fields"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$first"</span><span class="p">:</span> <span class="s2">"$$ROOT"</span><span class="p">},</span>                                       <span class="c1"># Keep the entire document</span>
    <span class="p">}},</span>
    
    <span class="c1"># Project the desired fields into the new Hosts collection    </span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                                                                              <span class="c1"># Will create a ObjectId for each host</span>
        <span class="s2">"Host_ID"</span><span class="p">:</span> <span class="s2">"$host_fields.host_id"</span><span class="p">,</span>                                                     <span class="c1"># Include the host ID</span>
        <span class="s2">"Host_Name"</span><span class="p">:</span> <span class="s2">"$host_fields.host_name"</span><span class="p">,</span>                                                 <span class="c1"># Include the host name</span>
        <span class="s2">"Host_About"</span><span class="p">:</span> <span class="s2">"$host_fields.host_about"</span><span class="p">,</span>                                               <span class="c1"># Include the host about</span>
        <span class="s2">"Host_Location"</span><span class="p">:</span> <span class="s2">"$host_fields.host_location"</span><span class="p">,</span>                                         <span class="c1"># Include the host location</span>
        <span class="s2">"Host_Neighbourhood"</span><span class="p">:</span> <span class="s2">"$host_fields.host_neighbourhood"</span><span class="p">,</span>                               <span class="c1"># Include the host neighbourhood</span>
        <span class="s2">"Host_Picture_URL"</span><span class="p">:</span> <span class="s2">"$host_fields.host_picture_url"</span><span class="p">,</span>                                   <span class="c1"># Include the host picture URL</span>
        <span class="s2">"Host_Thumbnail_URL"</span><span class="p">:</span> <span class="s2">"$host_fields.host_thumbnail_url"</span><span class="p">,</span>                               <span class="c1"># Include the host thumbnail URL</span>
        <span class="s2">"Host_Response_Rate"</span><span class="p">:</span> <span class="s2">"$host_fields.host_response_rate"</span><span class="p">,</span>                               <span class="c1"># Include the host response rate</span>
        <span class="s2">"Host_Response_Time"</span><span class="p">:</span> <span class="s2">"$host_fields.host_response_time"</span><span class="p">,</span>                               <span class="c1"># Include the host response time</span>
        <span class="s2">"Host_Verifications"</span><span class="p">:</span> <span class="s2">"$host_fields.host_verifications"</span><span class="p">,</span>                               <span class="c1"># Include the host verifications</span>
        <span class="s2">"Host_Has_Profile_Pic"</span><span class="p">:</span> <span class="s2">"$host_fields.host_has_profile_pic"</span><span class="p">,</span>                           <span class="c1"># Include the host has profile pic</span>
        <span class="s2">"Host_Identity_Verified"</span><span class="p">:</span> <span class="s2">"$host_fields.host_identity_verified"</span><span class="p">,</span>                       <span class="c1"># Include the host identity verified</span>
        <span class="s2">"Host_Is_Superhost"</span><span class="p">:</span> <span class="s2">"$host_fields.host_is_superhost"</span><span class="p">,</span>                                 <span class="c1"># Include the host is superhost</span>
        <span class="s2">"Host_Listings_Count"</span><span class="p">:</span> <span class="s2">"$host_fields.host_listings_count"</span><span class="p">,</span>                             <span class="c1"># Include the host listings count</span>
        <span class="s2">"Host_Total_Listings_Count"</span><span class="p">:</span> <span class="s2">"$host_fields.host_total_listings_count"</span><span class="p">,</span>                 <span class="c1"># Include the host total listings count</span>
        <span class="s2">"Host_URL"</span><span class="p">:</span> <span class="s2">"$host_fields.host_url"</span><span class="p">,</span>                                                   <span class="c1"># Include the host URL</span>
    <span class="p">}},</span>   
    <span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/operator/aggregation/out/</span>
    <span class="p">{</span><span class="s2">"$out"</span><span class="p">:</span> <span class="s2">"Hosts"</span><span class="p">}</span>                                                             <span class="c1"># Output directly to 'Hosts' collection in the same database</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[256]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>&lt;pymongo.synchronous.command_cursor.CommandCursor at 0x2603cc92090&gt;</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[257]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 3: Check the new Hosts collection</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mNumber of documents in 'Hosts' collection:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">Hosts</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>  <span class="c1"># Count the number of documents in the Hosts collection</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mSample document from 'Hosts' collection:</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Hosts</span><span class="o">.</span><span class="n">find_one</span><span class="p">(),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>                                                        <span class="c1"># Print one example document from the Hosts collection</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Number of documents in 'Hosts' collection:</span> 5104
<span class="ansi-bold">Sample document from 'Hosts' collection:</span>
{'_id': ObjectId('67fea811a6298d01ad09a862'),
 'Host_ID': '10002884',
 'Host_Name': 'Han',
 'Host_About': 'Welcome to my room!',
 'Host_Location': 'HK',
 'Host_Neighbourhood': 'Mong Kok',
 'Host_Picture_URL': 'https://a0.muscache.com/im/users/10002884/profile_pic/1387359746/original.jpg?aki_policy=profile_x_medium',
 'Host_Thumbnail_URL': 'https://a0.muscache.com/im/users/10002884/profile_pic/1387359746/original.jpg?aki_policy=profile_small',
 'Host_Response_Rate': 100,
 'Host_Response_Time': 'within an hour',
 'Host_Verifications': ['email', 'phone', 'reviews', 'jumio', 'government_id'],
 'Host_Has_Profile_Pic': True,
 'Host_Identity_Verified': True,
 'Host_Is_Superhost': False,
 'Host_Listings_Count': 1,
 'Host_Total_Listings_Count': 1,
 'Host_URL': 'https://www.airbnb.com/users/show/10002884'}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p>We applied <strong>Data Normalization/Reference</strong> by creating a separate <code>Hosts</code> collection. This eliminates the duplication of host information previously embedded in each listing document. Each document in <code>Hosts</code> represents a unique host, identified by <code>Host_ID</code>, and is referenced from the <code>Listings</code> collection. We expect <strong>improved data integrity (updates to host info only need to happen in one place), reduced overall storage</strong>, and <strong>efficient querying of host-specific information</strong> using the indexed <code>Host_ID</code>.</p>
</blockquote>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[258]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 3.1: Check if all host IDs are unique</span>
<span class="n">host_ids</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Hosts</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$Host_ID"</span><span class="p">,</span>
        <span class="s2">"count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$gt"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">}}</span>
<span class="p">])</span>
<span class="n">duplicates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">host_ids</span><span class="p">)</span>
<span class="k">if</span> <span class="n">duplicates</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Warning: Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span><span class="si">}</span><span class="s2"> duplicate host IDs."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Host ID: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span><span class="si">}</span><span class="s2"> appears </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="si">}</span><span class="s2"> times."</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"All host IDs are unique."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>All host IDs are unique.
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[259]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 4: Create Hosts.Host_ID index for faster queries ("Foreign Key")</span>
<span class="n">db</span><span class="o">.</span><span class="n">Hosts</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Host_ID"</span><span class="p">)])</span>  <span class="c1"># Create index on Host_ID field</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[259]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>'Host_ID_1'</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Transactions-Collection"><strong><code>Transactions</code> Collection</strong><a class="anchor-link" href="#Transactions-Collection"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[260]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Print one example document of 'transactions' array</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"1022200"</span><span class="p">},</span> <span class="p">{</span><span class="s2">"transactions"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>{'_id': '1022200',
 'transactions': {'bucket_end_date': datetime.datetime(2016, 11, 21, 0, 0),
                  'bucket_start_date': datetime.datetime(1972, 6, 6, 0, 0),
                  'transaction_count': 45,
                  'transactions': [{'date': datetime.datetime(2015, 12, 1, 0, 0),
                                    'price': Decimal128('29.15849659079999511845926463138312')},
                                   {'date': datetime.datetime(1989, 12, 14, 0, 0),
                                    'price': Decimal128('0.7724161292822024904580757720395922')},
                                   {'date': datetime.datetime(1998, 12, 31, 0, 0),
                                    'price': Decimal128('1.295972012182961652371204763767309')},
                                   {'date': datetime.datetime(2009, 3, 30, 0, 0),
                                    'price': Decimal128('31.52850186521098763137160858605057')},
                                   {'date': datetime.datetime(2000, 5, 31, 0, 0),
                                    'price': Decimal128('49.18051651563923343246642616577446')},
                                   {'date': datetime.datetime(2009, 7, 7, 0, 0),
                                    'price': Decimal128('34.65621723737613280036384821869432')},
                                   {'date': datetime.datetime(2015, 7, 8, 0, 0),
                                    'price': Decimal128('86.22352514753742980246897786855697')},
                                   {'date': datetime.datetime(2011, 6, 16, 0, 0),
                                    'price': Decimal128('54.43494403571661877094811643473803')},
                                   {'date': datetime.datetime(2016, 10, 18, 0, 0),
                                    'price': Decimal128('115.5600242040379441732511622831225')},
                                   {'date': datetime.datetime(1998, 10, 12, 0, 0),
                                    'price': Decimal128('1.206638616530141705496248505369294')},
                                   {'date': datetime.datetime(1991, 1, 2, 0, 0),
                                    'price': Decimal128('1.361862142742455317190319874498527')},
                                   {'date': datetime.datetime(2016, 5, 17, 0, 0),
                                    'price': Decimal128('118.1858096895133769521635258570313')},
                                   {'date': datetime.datetime(2015, 5, 15, 0, 0),
                                    'price': Decimal128('30.67717643739939248348491673823446')},
                                   {'date': datetime.datetime(2003, 4, 28, 0, 0),
                                    'price': Decimal128('14.79466170541391356607618945417925')},
                                   {'date': datetime.datetime(2012, 12, 27, 0, 0),
                                    'price': Decimal128('16.81818592088138331064328667707741')},
                                   {'date': datetime.datetime(2003, 6, 17, 0, 0),
                                    'price': Decimal128('15.01234189362955007140953966882079')},
                                   {'date': datetime.datetime(1988, 3, 2, 0, 0),
                                    'price': Decimal128('0.7181873554933055903148897414212115')},
                                   {'date': datetime.datetime(2015, 10, 30, 0, 0),
                                    'price': Decimal128('76.44256410019895042751159053295850')},
                                   {'date': datetime.datetime(2007, 12, 17, 0, 0),
                                    'price': Decimal128('20.63278087075391198368379264138638')},
                                   {'date': datetime.datetime(2011, 7, 13, 0, 0),
                                    'price': Decimal128('13.58544794397653809880921471631154')},
                                   {'date': datetime.datetime(2015, 6, 22, 0, 0),
                                    'price': Decimal128('73.46376878396031884221883956342935')},
                                   {'date': datetime.datetime(2015, 2, 11, 0, 0),
                                    'price': Decimal128('75.90495979706304296996677294373512')},
                                   {'date': datetime.datetime(1979, 4, 20, 0, 0),
                                    'price': Decimal128('0.1779933743016186287189128734098630')},
                                   {'date': datetime.datetime(1973, 8, 6, 0, 0),
                                    'price': Decimal128('0.0561500005424022674560546875')},
                                   {'date': datetime.datetime(2004, 7, 28, 0, 0),
                                    'price': Decimal128('2.043086696201633412073306317324750')},
                                   {'date': datetime.datetime(1985, 5, 14, 0, 0),
                                    'price': Decimal128('0.4646852238595403083998292004253016')},
                                   {'date': datetime.datetime(2014, 11, 7, 0, 0),
                                    'price': Decimal128('19.45859800790097438039083499461412')},
                                   {'date': datetime.datetime(2006, 12, 12, 0, 0),
                                    'price': Decimal128('13.39928664879049691194268234539777')},
                                   {'date': datetime.datetime(2016, 7, 13, 0, 0),
                                    'price': Decimal128('33.58402622979829743599111679941415')},
                                   {'date': datetime.datetime(1998, 9, 23, 0, 0),
                                    'price': Decimal128('16.96044890308613162233086768537759')},
                                   {'date': datetime.datetime(2002, 9, 26, 0, 0),
                                    'price': Decimal128('9.793800762771049051025329390540719')},
                                   {'date': datetime.datetime(2016, 5, 26, 0, 0),
                                    'price': Decimal128('118.5466676311641691654585883952677')},
                                   {'date': datetime.datetime(1997, 9, 11, 0, 0),
                                    'price': Decimal128('6.445615410792042254684020008426159')},
                                   {'date': datetime.datetime(2005, 1, 14, 0, 0),
                                    'price': Decimal128('21.96567254190052764784013561438769')},
                                   {'date': datetime.datetime(2009, 7, 24, 0, 0),
                                    'price': Decimal128('9.000573985989589687051193322986364')},
                                   {'date': datetime.datetime(2016, 2, 11, 0, 0),
                                    'price': Decimal128('21.73591227836645600746123818680644')},
                                   {'date': datetime.datetime(2012, 9, 20, 0, 0),
                                    'price': Decimal128('68.06032346689130463346373289823532')},
                                   {'date': datetime.datetime(2016, 6, 9, 0, 0),
                                    'price': Decimal128('30.60337968896972782317789096850901')},
                                   {'date': datetime.datetime(2013, 3, 1, 0, 0),
                                    'price': Decimal128('11.92923913679549308142213703831657')},
                                   {'date': datetime.datetime(2016, 6, 2, 0, 0),
                                    'price': Decimal128('80.15773522778474102779000531882047')},
                                   {'date': datetime.datetime(2012, 12, 3, 0, 0),
                                    'price': Decimal128('16.79925040549669645884023339021950')},
                                   {'date': datetime.datetime(1991, 1, 30, 0, 0),
                                    'price': Decimal128('1.112550641097352244202056681388057')},
                                   {'date': datetime.datetime(2012, 12, 3, 0, 0),
                                    'price': Decimal128('16.76913728179111018334879190661013')},
                                   {'date': datetime.datetime(2015, 9, 2, 0, 0),
                                    'price': Decimal128('63.59945944469900780404714168980717')},
                                   {'date': datetime.datetime(2016, 4, 12, 0, 0),
                                    'price': Decimal128('35.33423154808716759589515277184545')}]}}
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[261]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 1: Create Transactions collection</span>
<span class="n">transactions_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"_id"</span><span class="p">,</span> 
                       <span class="c1"># "transactions.bucket_end_date", "transactions.bucket_start_date", "transactions.transaction_count", </span>
                       <span class="s2">"transactions.transactions"</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[262]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Aggregate to extract transactions and their corresponding listing IDs</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"transactions.transactions"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}},</span>                        <span class="c1"># Match documents where 'transactions.transactions' exists</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$transactions.transactions"</span><span class="p">},</span>                                           <span class="c1"># Unwind the 'transactions' array to create a document for each transaction</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                                                                        <span class="c1"># Will create a ObjectId for each transaction</span>
        <span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>                                                            <span class="c1"># Include the listing ID</span>
        <span class="s2">"Transaction_ID"</span><span class="p">:</span> <span class="s2">"$transactions.transactions._id"</span><span class="p">,</span>                              <span class="c1"># Include the transaction ID</span>
        <span class="s2">"Transaction_Date"</span><span class="p">:</span> <span class="s2">"$transactions.transactions.date"</span><span class="p">,</span>                           <span class="c1"># Include the transaction date</span>
        <span class="s2">"Transaction_Price"</span><span class="p">:</span> <span class="s2">"$transactions.transactions.price"</span>                          <span class="c1"># Include the transaction price</span>
    <span class="p">}},</span>
    <span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/operator/aggregation/out/</span>
    <span class="p">{</span><span class="s2">"$out"</span><span class="p">:</span> <span class="s2">"Transactions"</span><span class="p">}</span>                                                             <span class="c1"># Output directly to 'Transactions' collection in the same database</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[262]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>&lt;pymongo.synchronous.command_cursor.CommandCursor at 0x2603ddda690&gt;</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[263]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 2: Check the new Transactions collection</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mNumber of documents in 'Transactions' collection:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">Transactions</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span> <span class="c1"># Count the number of documents in the Transactions collection</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mSample document from 'Transactions' collection:</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Transactions</span><span class="o">.</span><span class="n">find_one</span><span class="p">(),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>                                                              <span class="c1"># Print one example document from the Transactions collection</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Number of documents in 'Transactions' collection:</span> 311093
<span class="ansi-bold">Sample document from 'Transactions' collection:</span>
{'_id': ObjectId('67fea811a6298d01ad09bc52'),
 'Listing_ID': '10006546',
 'Transaction_Date': datetime.datetime(2008, 8, 12, 0, 0),
 'Transaction_Price': Decimal128('132.1063781684291313922585686668753')}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p>We applied <strong>Referencing</strong> by creating a separate <code>Transactions</code> collection, moving the potentially large and time-sensitive <code>transactions.transactions</code> array out of the main listing document. This isolates transaction data for focused querying (like in <strong>Q10</strong>). Each document represents a single transaction and includes a <code>Listing_ID</code> reference. We expect <strong>faster reads for the main <code>Listings</code> collection</strong>, <strong>improved performance for time-based queries on transactions</strong> (especially with the index on <code>Listing_ID</code> and potentially <code>Transaction_Date</code>), and <strong>better scalability for transaction data</strong> (as it can grow independently of the listing document and we have limit of 16MB per document).</p>
</blockquote>
<p><strong>Note:</strong> We decided to <em>keep</em> the <code>transactions.bucket_end_date</code>, <code>transactions.bucket_start_date</code>, and <code>transactions.transaction_count</code> fields within the main <code>Listings</code> collection (under the <code>Transactions</code> subdocument, but without the nested <code>transactions</code> array). These fields provide a useful summary about the transaction history associated with the listing, which might be needed for display without querying the full <code>Transactions</code> collection.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[264]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 2.1: Check if all (Listing_ID, Transaction_Date, Transaction_Price) pairs are unique</span>
<span class="n">transactions_ids</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Transactions</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"$Listing_ID"</span><span class="p">,</span> <span class="s2">"Transaction_Date"</span><span class="p">:</span> <span class="s2">"$Transaction_Date"</span><span class="p">,</span> <span class="s2">"Transaction_Price"</span><span class="p">:</span> <span class="s2">"$Transaction_Price"</span><span class="p">},</span>
        <span class="s2">"count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$gt"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">}}</span>
<span class="p">])</span>
<span class="n">duplicates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">transactions_ids</span><span class="p">)</span>
<span class="k">if</span> <span class="n">duplicates</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Warning: Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span><span class="si">}</span><span class="s2"> duplicate (Listing_ID, Transaction_Date, Transaction_Price) pairs."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Pair: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span><span class="si">}</span><span class="s2"> appears </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="si">}</span><span class="s2"> times."</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"All (Listing_ID, Transaction_Date, Transaction_Price) pairs are unique."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>All (Listing_ID, Transaction_Date, Transaction_Price) pairs are unique.
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[265]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 3: Create Transactions.Listing_ID index for faster queries ("Foreign Key")</span>
<span class="n">db</span><span class="o">.</span><span class="n">Transactions</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Listing_ID"</span><span class="p">)])</span>  <span class="c1"># Create index on Listing_ID field</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[265]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>'Listing_ID_1'</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Listings-Collection"><strong><code>Listings</code> Collection</strong><a class="anchor-link" href="#Listings-Collection"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[266]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">drop_collection</span><span class="p">(</span><span class="s2">"Listings"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[266]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>{'ok': 1.0}</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[267]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 1: Create Listings collection</span>
<span class="c1"># Extract all fields except for "reviews", "transactions.transactions" array, and "host_" fields</span>
<span class="n">listings_fields</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"fields"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$objectToArray"</span><span class="p">:</span> <span class="s2">"$$ROOT"</span><span class="p">}}},</span>             <span class="c1"># Convert document to key-value pairs</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$fields"</span><span class="p">},</span>                                             <span class="c1"># Flatten the fields array</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"fields.k"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"$not"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"$regex"</span><span class="p">:</span> <span class="s2">"^reviews|^transactions</span><span class="se">\\</span><span class="s2">.transactions|^host_"</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$fields.k"</span><span class="p">}}</span>                                    <span class="c1"># Group by field names to get distinct fields</span>
<span class="p">])</span>

<span class="c1"># Convert the aggregation result to a list with only field names</span>
<span class="n">listings_fields</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">doc</span><span class="p">[</span><span class="s2">"_id"</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">listings_fields</span><span class="p">])</span>

<span class="c1"># Print the list of listings fields</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">listings_fields</span><span class="p">)</span><span class="si">}</span><span class="s2"> listings fields</span><span class="se">\033</span><span class="s2">[0m: </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">listings_fields</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Found <span class="ansi-bold">45 listings fields</span>: 

['_id',
 'access',
 'accommodates',
 'address',
 'amenities',
 'availability',
 'bathrooms',
 'bed_type',
 'bedrooms',
 'beds',
 'calendar_last_scraped',
 'cancellation_policy',
 'cleaning_fee',
 'description',
 'extra_people',
 'first_review',
 'guests_included',
 'house_rules',
 'images',
 'interaction',
 'last_review',
 'last_scraped',
 'listing_url',
 'maximum_nights',
 'minimum_nights',
 'monthly_price',
 'name',
 'neighborhood_overview',
 'notes',
 'number_of_reviews',
 'price',
 'property_type',
 'review_scores_checkin',
 'review_scores_cleanliness',
 'review_scores_communication',
 'review_scores_location',
 'review_scores_rating',
 'review_scores_value',
 'room_type',
 'security_deposit',
 'space',
 'summary',
 'transactions',
 'transit',
 'weekly_price']
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[268]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 2: Aggregate to extract listings and their corresponding listing IDs</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                                                                   <span class="c1"># Will create a ObjectId for each listing</span>
        <span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>                                                       <span class="c1"># Include the listing ID</span>
        <span class="s2">"Host_ID"</span><span class="p">:</span> <span class="s2">"$host_id"</span><span class="p">,</span>                                                      <span class="c1"># Include the host ID</span>
        <span class="s2">"Name"</span><span class="p">:</span> <span class="s2">"$name"</span><span class="p">,</span>                                                            <span class="c1"># Name of the listing</span>
        <span class="s2">"Description"</span><span class="p">:</span> <span class="s2">"$description"</span><span class="p">,</span>                                              <span class="c1"># Description of the listing</span>
        <span class="s2">"Summary"</span><span class="p">:</span> <span class="s2">"$summary"</span><span class="p">,</span>                                                      <span class="c1"># Summary of the listing</span>
        <span class="s2">"Space"</span><span class="p">:</span> <span class="s2">"$space"</span><span class="p">,</span>                                                          <span class="c1"># Space details</span>
        <span class="s2">"Property_Type"</span><span class="p">:</span> <span class="s2">"$property_type"</span><span class="p">,</span>                                          <span class="c1"># Type of property</span>
        <span class="s2">"Room_Type"</span><span class="p">:</span> <span class="s2">"$room_type"</span><span class="p">,</span>                                                  <span class="c1"># Type of room</span>
        <span class="s2">"Accommodates"</span><span class="p">:</span> <span class="s2">"$accommodates"</span><span class="p">,</span>                                            <span class="c1"># Number of guests accommodated</span>
        <span class="s2">"Bedrooms"</span><span class="p">:</span> <span class="s2">"$bedrooms"</span><span class="p">,</span>                                                    <span class="c1"># Number of bedrooms</span>
        <span class="s2">"Beds"</span><span class="p">:</span> <span class="s2">"$beds"</span><span class="p">,</span>                                                            <span class="c1"># Number of beds</span>
        <span class="s2">"Bathrooms"</span><span class="p">:</span> <span class="s2">"$bathrooms"</span><span class="p">,</span>                                                  <span class="c1"># Number of bathrooms</span>
        <span class="s2">"Bed_Type"</span><span class="p">:</span> <span class="s2">"$bed_type"</span><span class="p">,</span>                                                    <span class="c1"># Type of bed</span>
        <span class="s2">"Price"</span><span class="p">:</span> <span class="s2">"$price"</span><span class="p">,</span>                                                          <span class="c1"># Price per night</span>
        <span class="s2">"Cleaning_Fee"</span><span class="p">:</span> <span class="s2">"$cleaning_fee"</span><span class="p">,</span>                                            <span class="c1"># Cleaning fee</span>
        <span class="s2">"Security_Deposit"</span><span class="p">:</span> <span class="s2">"$security_deposit"</span><span class="p">,</span>                                    <span class="c1"># Security deposit</span>
        <span class="s2">"Extra_People"</span><span class="p">:</span> <span class="s2">"$extra_people"</span><span class="p">,</span>                                            <span class="c1"># Extra charges for additional people</span>
        <span class="s2">"Weekly_Price"</span><span class="p">:</span> <span class="s2">"$weekly_price"</span><span class="p">,</span>                                            <span class="c1"># Weekly price</span>
        <span class="s2">"Monthly_Price"</span><span class="p">:</span> <span class="s2">"$monthly_price"</span><span class="p">,</span>                                          <span class="c1"># Monthly price</span>
        <span class="s2">"Minimum_Nights"</span><span class="p">:</span> <span class="s2">"$minimum_nights"</span><span class="p">,</span>                                        <span class="c1"># Minimum nights for booking</span>
        <span class="s2">"Maximum_Nights"</span><span class="p">:</span> <span class="s2">"$maximum_nights"</span><span class="p">,</span>                                        <span class="c1"># Maximum nights for booking</span>
        <span class="s2">"Guests_Included"</span><span class="p">:</span> <span class="s2">"$guests_included"</span><span class="p">,</span>                                      <span class="c1"># Number of guests included in the price</span>
        <span class="s2">"Address"</span><span class="p">:</span> <span class="s2">"$address"</span><span class="p">,</span>                                                      <span class="c1"># Address details</span>
        <span class="s2">"Access"</span><span class="p">:</span> <span class="s2">"$access"</span><span class="p">,</span>                                                        <span class="c1"># Access details</span>
        <span class="s2">"Interaction"</span><span class="p">:</span> <span class="s2">"$interaction"</span><span class="p">,</span>                                              <span class="c1"># Interaction details</span>
        <span class="s2">"House_Rules"</span><span class="p">:</span> <span class="s2">"$house_rules"</span><span class="p">,</span>                                              <span class="c1"># House rules</span>
        <span class="s2">"Amenities"</span><span class="p">:</span> <span class="s2">"$amenities"</span><span class="p">,</span>                                                  <span class="c1"># Amenities provided</span>
        <span class="s2">"Availability"</span><span class="p">:</span> <span class="s2">"$availability"</span><span class="p">,</span>                                            <span class="c1"># Availability details</span>
        <span class="s2">"Calendar_Last_Scraped"</span><span class="p">:</span> <span class="s2">"$calendar_last_scraped"</span><span class="p">,</span>                          <span class="c1"># Last scraped date of the calendar</span>
        <span class="s2">"Last_Scraped"</span><span class="p">:</span> <span class="s2">"$last_scraped"</span><span class="p">,</span>                                            <span class="c1"># Last scraped date of the listing</span>
        <span class="s2">"Cancellation_Policy"</span><span class="p">:</span> <span class="s2">"$cancellation_policy"</span><span class="p">,</span>                              <span class="c1"># Cancellation policy</span>
        <span class="s2">"Neighborhood_Overview"</span><span class="p">:</span> <span class="s2">"$neighborhood_overview"</span><span class="p">,</span>                          <span class="c1"># Overview of the neighborhood</span>
        <span class="s2">"Transit"</span><span class="p">:</span> <span class="s2">"$transit"</span><span class="p">,</span>                                                      <span class="c1"># Transit information</span>
        <span class="s2">"Notes"</span><span class="p">:</span> <span class="s2">"$notes"</span><span class="p">,</span>                                                          <span class="c1"># Additional notes</span>
        <span class="s2">"Images"</span><span class="p">:</span> <span class="s2">"$images"</span><span class="p">,</span>                                                        <span class="c1"># Images of the listing</span>
        <span class="s2">"Listing_URL"</span><span class="p">:</span> <span class="s2">"$listing_url"</span><span class="p">,</span>                                              <span class="c1"># URL of the listing</span>
        <span class="s2">"First_Review"</span><span class="p">:</span> <span class="s2">"$first_review"</span><span class="p">,</span>                                            <span class="c1"># Date of the first review</span>
        <span class="s2">"Last_Review"</span><span class="p">:</span> <span class="s2">"$last_review"</span><span class="p">,</span>                                              <span class="c1"># Date of the last review</span>
        <span class="s2">"Number_of_Reviews"</span><span class="p">:</span> <span class="s2">"$number_of_reviews"</span><span class="p">,</span>                                  <span class="c1"># Total number of reviews</span>
        <span class="s2">"Review_Scores_Rating"</span><span class="p">:</span> <span class="s2">"$review_scores_rating"</span><span class="p">,</span>                            <span class="c1"># Review scores rating</span>
        
        <span class="c1"># Review scores for subdocument | Capitalize and prefix the score name (e.g., "review_scores__checkin" -&gt; "Checkin")</span>
        <span class="s2">"Review_Scores"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"Checkin"</span><span class="p">:</span> <span class="s2">"$review_scores_checkin"</span><span class="p">,</span>                                    <span class="c1"># Check-in rating</span>
            <span class="s2">"Cleanliness"</span><span class="p">:</span> <span class="s2">"$review_scores_cleanliness"</span><span class="p">,</span>                            <span class="c1"># Cleanliness rating</span>
            <span class="s2">"Communication"</span><span class="p">:</span> <span class="s2">"$review_scores_communication"</span><span class="p">,</span>                        <span class="c1"># Communication rating</span>
            <span class="s2">"Location"</span><span class="p">:</span> <span class="s2">"$review_scores_location"</span><span class="p">,</span>                                  <span class="c1"># Location rating</span>
            <span class="s2">"Rating"</span><span class="p">:</span> <span class="s2">"$review_scores_rating"</span><span class="p">,</span>                                      <span class="c1"># Overall rating</span>
            <span class="s2">"Value"</span><span class="p">:</span> <span class="s2">"$review_scores_value"</span>                                         <span class="c1"># Value rating</span>
        <span class="p">},</span>
        
        <span class="s2">"Transactions"</span><span class="p">:</span> <span class="s2">"$transactions"</span>                                             <span class="c1"># Transactions details</span>
    <span class="p">}},</span>
    <span class="c1"># Drop the 'transactions.transactions' field from the listings collection</span>
    <span class="p">{</span><span class="s2">"$unset"</span><span class="p">:</span> <span class="s2">"Transactions.transactions"</span><span class="p">},</span>
    
    <span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/operator/aggregation/out/</span>
    <span class="p">{</span><span class="s2">"$out"</span><span class="p">:</span> <span class="s2">"Listings"</span><span class="p">}</span>                                                            <span class="c1"># Output directly to 'Listings' collection in the same database</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[268]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>&lt;pymongo.synchronous.command_cursor.CommandCursor at 0x2603ddda720&gt;</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[269]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 3: Check the new Listings collection</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mNumber of documents in 'Listings' collection:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>     <span class="c1"># Count the number of documents in the Listings collection</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mSample document from 'Listings' collection:</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">find_one</span><span class="p">(),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>                                                               <span class="c1"># Print one example document from the Listings collection</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Number of documents in 'Listings' collection:</span> 5555
<span class="ansi-bold">Sample document from 'Listings' collection:</span>
{'_id': ObjectId('67fea816a6298d01ad0e7b87'),
 'Listing_ID': '10006546',
 'Host_ID': '51399391',
 'Name': 'Ribeira Charming Duplex',
 'Description': 'Fantastic duplex apartment with three bedrooms, located in '
                'the historic area of Porto, Ribeira (Cube) - UNESCO World '
                'Heritage Site. Centenary building fully rehabilitated, '
                'without losing their original character. Privileged views of '
                'the Douro River and Ribeira square, our apartment offers the '
                'perfect conditions to discover the history and the charm of '
                'Porto. Apartment comfortable, charming, romantic and cozy in '
                'the heart of Ribeira. Within walking distance of all the most '
                'emblematic places of the city of Porto. The apartment is '
                'fully equipped to host 8 people, with cooker, oven, washing '
                'machine, dishwasher, microwave, coffee machine (Nespresso) '
                'and kettle. The apartment is located in a very typical area '
                'of the city that allows to cross with the most picturesque '
                'population of the city, welcoming, genuine and happy people '
                'that fills the streets with his outspoken speech and '
                'contagious with your sincere generosity, wrapped in a only '
                'parochial spirit. We are always available to help guests',
 'Summary': 'Fantastic duplex apartment with three bedrooms, located in the '
            'historic area of Porto, Ribeira (Cube) - UNESCO World Heritage '
            'Site. Centenary building fully rehabilitated, without losing '
            'their original character.',
 'Space': 'Privileged views of the Douro River and Ribeira square, our '
          'apartment offers the perfect conditions to discover the history and '
          'the charm of Porto. Apartment comfortable, charming, romantic and '
          'cozy in the heart of Ribeira. Within walking distance of all the '
          'most emblematic places of the city of Porto. The apartment is fully '
          'equipped to host 8 people, with cooker, oven, washing machine, '
          'dishwasher, microwave, coffee machine (Nespresso) and kettle. The '
          'apartment is located in a very typical area of the city that allows '
          'to cross with the most picturesque population of the city, '
          'welcoming, genuine and happy people that fills the streets with his '
          'outspoken speech and contagious with your sincere generosity, '
          'wrapped in a only parochial spirit.',
 'Property_Type': 'House',
 'Room_Type': 'Entire home/apt',
 'Accommodates': 8,
 'Bedrooms': 3,
 'Beds': 5,
 'Bathrooms': Decimal128('1.0'),
 'Bed_Type': 'Real Bed',
 'Price': Decimal128('80.00'),
 'Cleaning_Fee': Decimal128('35.00'),
 'Security_Deposit': Decimal128('200.00'),
 'Extra_People': Decimal128('15.00'),
 'Minimum_Nights': 2,
 'Maximum_Nights': 30,
 'Guests_Included': 6,
 'Address': {'street': 'Porto, Porto, Portugal',
             'government_area': 'Cedofeita, Ildefonso, S, Miragaia, Nicolau, '
                                'Vitria',
             'market': 'Porto',
             'country': 'Portugal',
             'country_code': 'PT',
             'location': {'type': 'Point',
                          'coordinates': [-8.61308, 41.1413],
                          'is_location_exact': False}},
 'Access': 'We are always available to help guests. The house is fully '
           'available to guests. We are always ready to assist guests. when '
           'possible we pick the guests at the airport.  This service transfer '
           'have a cost per person. We will also have service "meal at home" '
           'with a diverse menu and the taste of each. Enjoy the moment!',
 'Interaction': 'Cot - 10  / night Dog -  7,5 / night',
 'House_Rules': 'Make the house your home...',
 'Amenities': ['Bed linens',
               'Buzzer/wireless intercom',
               'Cable TV',
               'Cleaning before checkout',
               'Coffee maker',
               'Cooking basics',
               'Dishes and silverware',
               'Dishwasher',
               'Essentials',
               'Extra pillows and blankets',
               'Family/kid friendly',
               'Fire extinguisher',
               'First aid kit',
               'Hair dryer',
               'Hangers',
               'Heating',
               'Hot water',
               'Iron',
               'Kitchen',
               'Microwave',
               'Oven',
               'Pack n Play/travel crib',
               'Paid parking off premises',
               'Pets allowed',
               'Refrigerator',
               'Room-darkening shades',
               'Smoking allowed',
               'Stove',
               'TV',
               'Washer',
               'Waterfront',
               'Wifi'],
 'Availability': {'availability_30': 28,
                  'availability_60': 47,
                  'availability_90': 74,
                  'availability_365': 239},
 'Calendar_Last_Scraped': datetime.datetime(2019, 2, 16, 5, 0),
 'Last_Scraped': datetime.datetime(2019, 2, 16, 5, 0),
 'Cancellation_Policy': 'moderate',
 'Neighborhood_Overview': 'In the neighborhood of the river, you can find '
                          'several restaurants as varied flavors, but without '
                          'forgetting the so traditional northern food. You '
                          'can also find several bars and pubs to unwind after '
                          "a day's visit to the magnificent Port. To enjoy the "
                          'Douro River can board the boats that daily make the '
                          'ride of six bridges. You can also embark towards '
                          "Rgua, Barca d'Alva, Pinho, etc and enjoy the "
                          'Douro Wine Region, World Heritage of Humanity. The '
                          "Infante's house is a few meters and no doubt it "
                          'deserves a visit. They abound grocery stores, '
                          'bakeries, etc. to make your meals. Souvenir shop, '
                          'wine cellars, etc. to bring some souvenirs.',
 'Transit': 'Transport:  Metro station and S. Bento railway 5min;  Bus stop '
            'a 50 meters;  Lift Guindais (Funicular) 50 meters;  Tuc Tuc-to '
            'get around the city;  Buses tourist;  Cycling through the '
            'marginal drive;  Cable car in Gaia, overlooking the Port (just '
            'cross the bridge).',
 'Notes': 'Lose yourself in the narrow streets and staircases zone, have lunch '
          'in pubs and typical restaurants, and find the renovated cafes and '
          'shops in town. If you like exercise, rent a bicycle in the area and '
          'ride along the river to the sea, where it will enter beautiful '
          'beaches and terraces for everyone. The area is safe, find the bus '
          'stops 1min and metro line 5min. The bustling nightlife is a 10 min '
          'walk, where the streets are filled with people and entertainment '
          'for all. But Porto is much more than the historical center, here is '
          'modern museums, concert halls, clean and cared for beaches and surf '
          'all year round. Walk through the Ponte D. Luis and visit the '
          'different Caves of Port wine, where you will enjoy the famous port '
          'wine. Porto is a spoken city everywhere in the world as the best to '
          'be visited and savored by all ... natural beauty, culture, '
          'tradition, river, sea, beach, single people, typical food, and we '
          'are among those who best receive tourists, confirm! Come visit us '
          'and feel at ho',
 'Images': {'picture_url': 'https://a0.muscache.com/im/pictures/e83e702f-ef49-40fb-8fa0-6512d7e26e9b.jpg?aki_policy=large'},
 'Listing_URL': 'https://www.airbnb.com/rooms/10006546',
 'First_Review': datetime.datetime(2016, 1, 3, 5, 0),
 'Last_Review': datetime.datetime(2019, 1, 20, 5, 0),
 'Number_of_Reviews': 51,
 'Review_Scores_Rating': 8.9,
 'Review_Scores': {'Checkin': 10,
                   'Cleanliness': 9,
                   'Communication': 10,
                   'Location': 10,
                   'Rating': 8.9,
                   'Value': 9},
 'Transactions': {'bucket_end_date': datetime.datetime(2016, 11, 23, 0, 0),
                  'bucket_start_date': datetime.datetime(1979, 10, 4, 0, 0),
                  'transaction_count': 21}}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p>We applied <strong>schema restructuring</strong> to create the final <code>Listings</code> collection. This involved <strong>removing embedded host details, the full reviews array, and the detailed transactions array</strong>, replacing them with references (<code>Host_ID</code>). We <strong>restructured the <code>review_scores_*</code> fields into a <code>Review_Scores</code> subdocument</strong>, applying the <strong>Attribute Pattern</strong> for flexibility (<strong>Q9</strong>). Key identifying information (<code>Listing_ID</code>), frequently accessed data (<code>Name</code>, <code>Price</code>, <code>Address</code>, <code>Amenities</code>, etc.), and summary transaction info remain embedded. We expect <strong>significantly faster retrieval of core listing information</strong> for the primary customer-facing use case (<strong>Q1</strong>), as documents are much smaller. The restructured <code>Review_Scores</code> allows for flexible querying of score averages.</p>
</blockquote>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[270]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 3.1: Check if all listing IDs are unique</span>
<span class="n">listings_ids</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$Listing_ID"</span><span class="p">,</span>
        <span class="s2">"count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$gt"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">}}</span>
<span class="p">])</span>
<span class="n">duplicates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">listings_ids</span><span class="p">)</span>
<span class="k">if</span> <span class="n">duplicates</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Warning: Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span><span class="si">}</span><span class="s2"> duplicate listing IDs."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Listing ID: </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'_id'</span><span class="p">]</span><span class="si">}</span><span class="s2"> appears </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="si">}</span><span class="s2"> times."</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"All listing IDs are unique."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>All listing IDs are unique.
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[271]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Step 4: Create Listings.Listing_ID and Listings.Host_ID indexes for faster queries ("Foreign Key")</span>
<span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Listing_ID"</span><span class="p">)])</span>                                      <span class="c1"># Create index on Listing_ID field</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[271]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>'Listing_ID_1'</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[272]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Host_ID"</span><span class="p">)])</span>                                         <span class="c1"># Create index on Host_ID field</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[272]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>'Host_ID_1'</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1 id="%F0%9F%94%8D-Queries"><strong> Queries</strong><a class="anchor-link" href="#%F0%9F%94%8D-Queries"></a></h1>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="%F0%9F%9B%8B%EF%B8%8FStandard-Difficulty-Questions-%5B2-points-per-question%5D"><strong>Standard Difficulty Questions</strong> [2 points per question]<a class="anchor-link" href="#%F0%9F%9B%8B%EF%B8%8FStandard-Difficulty-Questions-%5B2-points-per-question%5D"></a></h2>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-2"><strong>Question 2</strong><a class="anchor-link" href="#Question-2"></a></h3>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[273]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 2)	Once a month, we reward hosts with recognition. </span>
<span class="c1">#       Select three superhosts with at least two listings that can accommodate more than four people.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[274]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Start the timer</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Filter for superhosts and listings accommodating &gt; 4</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"host_is_superhost"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"accommodates"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$gt"</span><span class="p">:</span> <span class="mi">4</span><span class="p">}}},</span>
    <span class="c1"># Group by host_id to count listings and collect accommodates values</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$host_id"</span><span class="p">,</span>
        <span class="s2">"HostName"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$first"</span><span class="p">:</span> <span class="s2">"$host_name"</span><span class="p">},</span>
        <span class="s2">"ListingCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="s2">"AccommodatesList"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$push"</span><span class="p">:</span> <span class="s2">"$accommodates"</span><span class="p">}</span>  <span class="c1"># Collect all accommodates values</span>
    <span class="p">}},</span>
    <span class="c1"># Filter for hosts with at least 2 listings</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ListingCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$gte"</span><span class="p">:</span> <span class="mi">2</span><span class="p">}}},</span>
    <span class="c1"># Sort by host name for consistency</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"HostName"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
    
    <span class="c1"># Limit to 3 superhosts</span>
    <span class="c1"># {"$limit": 3},</span>
    
    <span class="c1"># Project output without _id</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"HostName"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"ListingCount"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"AccommodatesList"</span><span class="p">:</span> <span class="mi">1</span>                           <span class="c1"># Include the list of accommodation capacities</span>
    <span class="p">}}</span>
<span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Found </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2"> superhosts</span><span class="se">\033</span><span class="s2">[0m with at least 2 listings that can accommodate more than 4 people.</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mHost Name</span><span class="se">\033</span><span class="s2">[0m: </span><span class="si">{</span><span class="n">host</span><span class="p">[</span><span class="s1">'HostName'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mListing Count:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">host</span><span class="p">[</span><span class="s1">'ListingCount'</span><span class="p">]</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mAccommodates List:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">host</span><span class="p">[</span><span class="s1">'AccommodatesList'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0209 seconds

Found <span class="ansi-bold">14 superhosts</span> with at least 2 listings that can accommodate more than 4 people.

<span class="ansi-bold">Host Name</span>: Aj                        | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [16, 16]
<span class="ansi-bold">Host Name</span>: Aline                     | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [5, 12]
<span class="ansi-bold">Host Name</span>: Assuno De Fatima        | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [5, 8]
<span class="ansi-bold">Host Name</span>: Daniel                    | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [5, 16]
<span class="ansi-bold">Host Name</span>: Elite                     | <span class="ansi-bold">Listing Count:</span> 3 | <span class="ansi-bold">Accommodates List:</span> [14, 6, 6]
<span class="ansi-bold">Host Name</span>: Great Vacation Retreats   | <span class="ansi-bold">Listing Count:</span> 3 | <span class="ansi-bold">Accommodates List:</span> [5, 6, 6]
<span class="ansi-bold">Host Name</span>: Jane                      | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [6, 9]
<span class="ansi-bold">Host Name</span>: Liiiving                  | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [6, 8]
<span class="ansi-bold">Host Name</span>: Miguel &amp; Joo             | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [5, 5]
<span class="ansi-bold">Host Name</span>: Mindy                     | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [6, 6]
<span class="ansi-bold">Host Name</span>: Patty And Beckett         | <span class="ansi-bold">Listing Count:</span> 3 | <span class="ansi-bold">Accommodates List:</span> [8, 8, 8]
<span class="ansi-bold">Host Name</span>: Resortica                 | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [8, 8]
<span class="ansi-bold">Host Name</span>: Wilson&amp;Shan               | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [9, 8]
<span class="ansi-bold">Host Name</span>: Yaiza                     | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [8, 6]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema"><strong>Query with New Schema</strong><a class="anchor-link" href="#Query-with-New-Schema"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[275]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">query2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Hosts</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    
    <span class="c1"># Start with Hosts collection to filter superhosts</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Host_Is_Superhost"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
    
    <span class="c1"># Lookup listings for each host</span>
    <span class="p">{</span><span class="s2">"$lookup"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"from"</span><span class="p">:</span> <span class="s2">"Listings"</span><span class="p">,</span>
        <span class="s2">"localField"</span><span class="p">:</span> <span class="s2">"Host_ID"</span><span class="p">,</span>
        <span class="s2">"foreignField"</span><span class="p">:</span> <span class="s2">"Host_ID"</span><span class="p">,</span>
        <span class="s2">"as"</span><span class="p">:</span> <span class="s2">"listings"</span>
    <span class="p">}},</span>
    
    <span class="c1"># Filter listings accommodating &gt; 4</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"HostName"</span><span class="p">:</span> <span class="s2">"$Host_Name"</span><span class="p">,</span>
        <span class="s2">"listings"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"$filter"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$listings"</span><span class="p">,</span>
                <span class="s2">"cond"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$gt"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$$this.Accommodates"</span><span class="p">,</span> <span class="mi">4</span><span class="p">]}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Group to count listings per host</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"HostName"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"ListingCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$size"</span><span class="p">:</span> <span class="s2">"$listings"</span><span class="p">},</span>
        <span class="s2">"AccommodatesList"</span><span class="p">:</span> <span class="s2">"$listings.Accommodates"</span>
    <span class="p">}},</span>
    
    <span class="c1"># Filter hosts with at least 2 listings</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ListingCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$gte"</span><span class="p">:</span> <span class="mi">2</span><span class="p">}}},</span>
    
    <span class="c1"># Sort by name for consistency</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"HostName"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="p">]))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Found </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">query2</span><span class="p">)</span><span class="si">}</span><span class="s2"> superhosts</span><span class="se">\033</span><span class="s2">[0m with at least 2 listings accommodating &gt; 4 people.</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="n">query2</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mHost Name</span><span class="se">\033</span><span class="s2">[0m: </span><span class="si">{</span><span class="n">host</span><span class="p">[</span><span class="s1">'HostName'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mListing Count:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">host</span><span class="p">[</span><span class="s1">'ListingCount'</span><span class="p">]</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mAccommodates List:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">host</span><span class="p">[</span><span class="s1">'AccommodatesList'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0379 seconds

Found <span class="ansi-bold">14 superhosts</span> with at least 2 listings accommodating &gt; 4 people.

<span class="ansi-bold">Host Name</span>: Aj                        | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [16, 16]
<span class="ansi-bold">Host Name</span>: Aline                     | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [5, 12]
<span class="ansi-bold">Host Name</span>: Assuno De Fatima        | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [5, 8]
<span class="ansi-bold">Host Name</span>: Daniel                    | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [5, 16]
<span class="ansi-bold">Host Name</span>: Elite                     | <span class="ansi-bold">Listing Count:</span> 3 | <span class="ansi-bold">Accommodates List:</span> [14, 6, 6]
<span class="ansi-bold">Host Name</span>: Great Vacation Retreats   | <span class="ansi-bold">Listing Count:</span> 3 | <span class="ansi-bold">Accommodates List:</span> [5, 6, 6]
<span class="ansi-bold">Host Name</span>: Jane                      | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [6, 9]
<span class="ansi-bold">Host Name</span>: Liiiving                  | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [6, 8]
<span class="ansi-bold">Host Name</span>: Miguel &amp; Joo             | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [5, 5]
<span class="ansi-bold">Host Name</span>: Mindy                     | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [6, 6]
<span class="ansi-bold">Host Name</span>: Patty And Beckett         | <span class="ansi-bold">Listing Count:</span> 3 | <span class="ansi-bold">Accommodates List:</span> [8, 8, 8]
<span class="ansi-bold">Host Name</span>: Resortica                 | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [8, 8]
<span class="ansi-bold">Host Name</span>: Wilson&amp;Shan               | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [9, 8]
<span class="ansi-bold">Host Name</span>: Yaiza                     | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [8, 6]
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[276]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Select three superhosts with at least two listings that can accommodate more than four people</span>
<span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="n">query2</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mHost Name</span><span class="se">\033</span><span class="s2">[0m: </span><span class="si">{</span><span class="n">host</span><span class="p">[</span><span class="s1">'HostName'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mListing Count:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">host</span><span class="p">[</span><span class="s1">'ListingCount'</span><span class="p">]</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mAccommodates List:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">host</span><span class="p">[</span><span class="s1">'AccommodatesList'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre><span class="ansi-bold">Host Name</span>: Aj                        | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [16, 16]
<span class="ansi-bold">Host Name</span>: Aline                     | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [5, 12]
<span class="ansi-bold">Host Name</span>: Assuno De Fatima        | <span class="ansi-bold">Listing Count:</span> 2 | <span class="ansi-bold">Accommodates List:</span> [5, 8]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Comparison (Q2):</strong> The new schema query uses a <code>$lookup</code> to join <code>Hosts</code> and <code>Listings</code>. While lookups can introduce overhead compared to querying a single collection, this approach maintains normalized data by avoiding host information duplication. The execution time in the new schema (0.038s) is slightly slower than the original (0.021s) for this specific query. This is expected due to the left outer join operation (<strong><code>$lookup</code></strong>). However, the <strong>trade-off ensures data integrity and avoids redundancy across the dataset</strong>.</p>
</blockquote>
<p><strong>Note:</strong> The Top 3 superhosts presented were selected based on alphabetical order of the host names.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-3"><strong>Question 3</strong><a class="anchor-link" href="#Question-3"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[277]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 3)	The company considers investing into property to rent. </span>
<span class="c1">#       Which bed type is most common in listings with a waterfront and a dishwasher in New York?</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[278]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 3. Most common bed type in New York listings with waterfront and dishwasher</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Filter for New York, waterfront, and dishwasher (case-insensitive)</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"address.market"</span><span class="p">:</span> <span class="s2">"New York"</span><span class="p">,</span>
        <span class="s2">"amenities"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"$elemMatch"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$regex"</span><span class="p">:</span> <span class="s2">"waterfront"</span><span class="p">,</span> <span class="s2">"$options"</span><span class="p">:</span> <span class="s2">"i"</span><span class="p">}</span>  <span class="c1"># Matches any waterfront variant (case-insensitive)</span>
        <span class="p">},</span>
        <span class="s2">"amenities"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"$elemMatch"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$regex"</span><span class="p">:</span> <span class="s2">"dishwasher"</span><span class="p">,</span> <span class="s2">"$options"</span><span class="p">:</span> <span class="s2">"i"</span><span class="p">}</span>  <span class="c1"># Matches any dishwasher variant (case-insensitive)</span>
        <span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Group by bed_type and count occurrences</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$bed_type"</span><span class="p">,</span>
        <span class="s2">"Count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Sort by count descending</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Count"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
    
    <span class="c1"># Limit to 1 (most common)</span>
    <span class="p">{</span><span class="s2">"$limit"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    
    <span class="c1"># Project output</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"BedType"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>
        <span class="s2">"Count"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}}</span>
<span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Most common bed type in New York listings with waterfront and dishwasher is </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'BedType'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m with </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'Count'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m occurrences."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0497 seconds

Most common bed type in New York listings with waterfront and dishwasher is <span class="ansi-bold">Real Bed</span> with <span class="ansi-bold">75</span> occurrences.
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema"><strong>Query with New Schema</strong><a class="anchor-link" href="#Query-with-New-Schema"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[279]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">query3</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    
    <span class="c1"># Filter for New York, waterfront, and dishwasher (case-insensitive)</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"Address.market"</span><span class="p">:</span> <span class="s2">"New York"</span><span class="p">,</span>
        <span class="s2">"Amenities"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$elemMatch"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$regex"</span><span class="p">:</span> <span class="s2">"waterfront"</span><span class="p">,</span> <span class="s2">"$options"</span><span class="p">:</span> <span class="s2">"i"</span><span class="p">}},</span>  <span class="c1"># Matches any waterfront variant (case-insensitive)</span>
        <span class="s2">"Amenities"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$elemMatch"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$regex"</span><span class="p">:</span> <span class="s2">"dishwasher"</span><span class="p">,</span> <span class="s2">"$options"</span><span class="p">:</span> <span class="s2">"i"</span><span class="p">}},</span>  <span class="c1"># Matches any dishwasher variant (case-insensitive)</span>
        <span class="s2">"Bed_Type"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>                                            <span class="c1"># Ensure Bed_Type field exists</span>
    <span class="p">}},</span>
    
    <span class="c1"># Group by bed_type and count occurrences</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$Bed_Type"</span><span class="p">,</span>
        <span class="s2">"Count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Sort by count descending</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Count"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
    
    <span class="c1"># Limit to 1 (most common)</span>
    <span class="p">{</span><span class="s2">"$limit"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    
    <span class="c1"># Project output</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"BedType"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>
        <span class="s2">"Count"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}}</span>
<span class="p">]))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Most common bed type in New York listings with waterfront and dishwasher is </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">query3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'BedType'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m with </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">query3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'Count'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m occurrences."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0410 seconds

Most common bed type in New York listings with waterfront and dishwasher is <span class="ansi-bold">Real Bed</span> with <span class="ansi-bold">75</span> occurrences.
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Comparison (Q3):</strong> Both queries yield the same result (<strong>"Real Bed"</strong>, count <strong>75</strong>). The new schema query targets the optimized <code>Listings</code> collection. Performance is comparable (0.041s vs 0.050s in the original). This indicates that querying the leaner <code>Listings</code> collection, even with similar filtering logic on embedded arrays (<code>Amenities</code>), maintains performance while offering better overall structure. After adding indexes, the new schema query becomes faster (0.027s). Indexing <code>Address.market</code> and <code>Amenities</code> provides a clear benefit for this query pattern.</p>
</blockquote>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[280]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Indexing 'Address.market' and 'Amenities' fields for faster queries (Single Field Indexes - Text)</span>
<span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Address.market"</span><span class="p">)])</span>  <span class="c1"># Create index on Address.market field</span>
<span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Amenities"</span><span class="p">)])</span>       <span class="c1"># Create index on Amenities field</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[280]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>'Amenities_1'</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[281]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Re-run the query with indexes</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">query3</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    
    <span class="c1"># Filter for New York, waterfront, and dishwasher (case-insensitive)</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"Address.market"</span><span class="p">:</span> <span class="s2">"New York"</span><span class="p">,</span>
        <span class="s2">"Amenities"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$elemMatch"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$regex"</span><span class="p">:</span> <span class="s2">"waterfront"</span><span class="p">,</span> <span class="s2">"$options"</span><span class="p">:</span> <span class="s2">"i"</span><span class="p">}},</span>  <span class="c1"># Matches any waterfront variant (case-insensitive)</span>
        <span class="s2">"Amenities"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$elemMatch"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$regex"</span><span class="p">:</span> <span class="s2">"dishwasher"</span><span class="p">,</span> <span class="s2">"$options"</span><span class="p">:</span> <span class="s2">"i"</span><span class="p">}},</span>  <span class="c1"># Matches any dishwasher variant (case-insensitive)</span>
        <span class="s2">"Bed_Type"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>                                            <span class="c1"># Ensure Bed_Type field exists</span>
    <span class="p">}},</span>
    
    <span class="c1"># Group by bed_type and count occurrences</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$Bed_Type"</span><span class="p">,</span>
        <span class="s2">"Count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Sort by count descending</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Count"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
    
    <span class="c1"># Limit to 1 (most common)</span>
    <span class="p">{</span><span class="s2">"$limit"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    
    <span class="c1"># Project output</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"BedType"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>
        <span class="s2">"Count"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}}</span>
<span class="p">]))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Most common bed type in New York listings with waterfront and dishwasher is </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">query3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'BedType'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m with </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">query3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'Count'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m occurrences."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0268 seconds

Most common bed type in New York listings with waterfront and dishwasher is <span class="ansi-bold">Real Bed</span> with <span class="ansi-bold">75</span> occurrences.
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li>As we expected, the new schema query with indexing on <code>Address.market</code> and <code>Amenities</code> is faster than the original query, because in this case we are searching for a specific value in the <code>Amenities</code> array and <code>Address.market</code> field.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-4"><strong>Question 4</strong><a class="anchor-link" href="#Question-4"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[282]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 4)	We're considering hiring someone to write reviews professionally. </span>
<span class="c1">#       Who wrote the longest review in New York?</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[283]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 4. Reviewer who wrote the longest review in New York</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Filter for New York</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"address.market"</span><span class="p">:</span> <span class="s2">"New York"</span><span class="p">}},</span>
    <span class="c1"># Unwind reviews array</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$reviews"</span><span class="p">},</span>
    <span class="c1"># Project review length and reviewer, handling null comments</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"ReviewerName"</span><span class="p">:</span> <span class="s2">"$reviews.reviewer_name"</span><span class="p">,</span>
        <span class="s2">"ReviewLength"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$strLenCP"</span><span class="p">:</span>                <span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/operator/aggregation/strLenCP/</span>
            <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$reviews.comments"</span><span class="p">,</span> <span class="s2">""</span><span class="p">]}}</span>  <span class="c1"># Default to empty string if null</span>
    <span class="p">}},</span>
    <span class="c1"># Sort by length descending</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ReviewLength"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
    <span class="c1"># Limit to 1</span>
    <span class="p">{</span><span class="s2">"$limit"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span> <span class="c1"># [{'ReviewLength': 4665, 'ReviewerName': 'Angela'}]</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Reviewer who wrote the longest review in New York is: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'ReviewerName'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m with </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'ReviewLength'</span><span class="p">]</span><span class="si">}</span><span class="s2"> characters</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0690 seconds

Reviewer who wrote the longest review in New York is: <span class="ansi-bold">Angela</span> with <span class="ansi-bold">4665 characters</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema"><strong>Query with New Schema</strong><a class="anchor-link" href="#Query-with-New-Schema"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[284]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">query4</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Reviews</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="c1"># Join Reviews with Listings to filter by New York</span>
    <span class="p">{</span><span class="s2">"$lookup"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"from"</span><span class="p">:</span> <span class="s2">"Listings"</span><span class="p">,</span>
        <span class="s2">"localField"</span><span class="p">:</span> <span class="s2">"Listing_ID"</span><span class="p">,</span>
        <span class="s2">"foreignField"</span><span class="p">:</span> <span class="s2">"Listing_ID"</span><span class="p">,</span>
        <span class="s2">"as"</span><span class="p">:</span> <span class="s2">"listing"</span>
    <span class="p">}},</span>
    
    <span class="c1"># Unwind the listings array to create a document for each review</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$listing"</span><span class="p">},</span>
    
    <span class="c1"># Filter for New York listings</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"listing.Address.market"</span><span class="p">:</span> <span class="s2">"New York"</span><span class="p">}},</span>
    
    <span class="c1"># Project review length and reviewer, handling null comments</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"Reviewer_ID"</span><span class="p">:</span> <span class="s2">"$Reviewer_ID"</span><span class="p">,</span>                                          <span class="c1"># Include Reviewer_ID</span>
        <span class="s2">"ReviewLength"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$strLenCP"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$Review_Comments"</span><span class="p">,</span> <span class="s2">""</span><span class="p">]}}</span>    <span class="c1"># Calculate length of review comments (handling nulls)</span>
    <span class="p">}},</span>
    
    <span class="c1"># Join Reviews with Reviewers to get reviewer names</span>
    <span class="p">{</span><span class="s2">"$lookup"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"from"</span><span class="p">:</span> <span class="s2">"Reviewers"</span><span class="p">,</span>
        <span class="s2">"localField"</span><span class="p">:</span> <span class="s2">"Reviewer_ID"</span><span class="p">,</span>
        <span class="s2">"foreignField"</span><span class="p">:</span> <span class="s2">"Reviewer_ID"</span><span class="p">,</span>
        <span class="s2">"as"</span><span class="p">:</span> <span class="s2">"reviewer"</span>
    <span class="p">}},</span>
    
    <span class="c1"># Unwind the reviewers array to create a document for each review</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$reviewer"</span><span class="p">},</span>
    
    <span class="c1"># Project reviewer name</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"ReviewerName"</span><span class="p">:</span> <span class="s2">"$reviewer.Reviewer_Name"</span><span class="p">,</span>
        <span class="s2">"ReviewLength"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}},</span>
    
    <span class="c1"># Sort by length descending</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ReviewLength"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
    
    <span class="c1"># Limit to 1 (reviewer with longest review)</span>
    <span class="p">{</span><span class="s2">"$limit"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">]))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># pprint(query4)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">query4</span><span class="p">,</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Reviewer who wrote the longest review in New York is: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">query4</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'ReviewerName'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m with </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">query4</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'ReviewLength'</span><span class="p">]</span><span class="si">}</span><span class="s2"> characters</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 14.0446 seconds
[{'ReviewLength': 4665, 'ReviewerName': 'Angela'}]

Reviewer who wrote the longest review in New York is: <span class="ansi-bold">Angela</span> with <span class="ansi-bold">4665 characters</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Comparison (Q4):</strong> The new schema query involves lookups between <code>Reviews</code>, <code>Listings</code> (for the market filter), and <code>Reviewers</code>. Although separating collections often improves performance for targeted reads, the multiple <code>$lookup</code> stages required here introduce significant overhead compared to the original query which only needed to unwind the embedded <code>reviews</code> array. This resulted in a considerably longer execution time (14.04s vs 0.069s). While indexing helps, the cost of joining large collections for <em>this specific aggregation</em> outweighs the benefit of smaller individual documents in the <code>Reviews</code> collection.</p>
</blockquote>
<blockquote>
<p>If this query was part of the queries list to consider for optimization (not part of queries to "consider for database optimization" - <strong>Q7</strong> to <strong>Q11</strong>),  further optimization (like denormalizing the reviewer name into the <strong><code>Reviews</code></strong> collection - <strong>Extended Reference Pattern</strong>) might be considered in a real-world scenario. However, the current schema prioritises scalability and avoids data duplication.</p>
</blockquote>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-5"><strong>Question 5</strong><a class="anchor-link" href="#Question-5"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[285]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 5)	To assess the security of different areas, what is the biggest and smallest (price-security deposit) difference per number of visitors at a property?</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[286]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 5. Biggest and smallest (price - security deposit) difference per number of visitors</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Filter for listings with price and security deposit</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"price"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"$ne"</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>                                  <span class="c1"># Price exists and is not null</span>
        <span class="s2">"security_deposit"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"$ne"</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>                        <span class="c1"># Security deposit exists and is not null</span>
    <span class="p">}},</span>
    
    <span class="c1"># Calculate difference per visitor, converting strings to numbers</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"DifferencePerVisitor"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"$divide"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">"$abs"</span><span class="p">:</span>                                                        <span class="c1"># Absolute value of difference</span>
                    <span class="p">{</span><span class="s2">"$subtract"</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">"$toDouble"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$price"</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">]}},</span>            <span class="c1"># Convert price to double, default 0</span>
                        <span class="p">{</span><span class="s2">"$toDouble"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$security_deposit"</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">]}}</span>  <span class="c1"># Convert security_deposit, default 0</span>
                    <span class="p">]}</span>
                <span class="p">}</span>
                <span class="p">,</span> <span class="s2">"$accommodates"</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}},</span>
    <span class="c1"># Group to find min and max</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">"MaxDifference"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="s2">"$DifferencePerVisitor"</span><span class="p">},</span>
        <span class="s2">"MinDifference"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="s2">"$DifferencePerVisitor"</span><span class="p">}</span>
    <span class="p">}},</span>
    <span class="c1"># Project output with rounding</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"MaxDifference"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$MaxDifference"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
        <span class="s2">"MinDifference"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$MinDifference"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
    <span class="p">}}</span>
<span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Biggest difference (price - security deposit) per number of visitors: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'MaxDifference'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Smallest difference (price - security deposit) per number of visitors: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'MinDifference'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0317 seconds

Biggest difference (price - security deposit) per number of visitors: <span class="ansi-bold">19229.5</span>
Smallest difference (price - security deposit) per number of visitors: <span class="ansi-bold">0.0</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema"><strong>Query with New Schema</strong><a class="anchor-link" href="#Query-with-New-Schema"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[287]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">query5</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="c1"># Filter for listings with security deposit and accommodates fields</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"Security_Deposit"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>             <span class="c1"># Security deposit exists</span>
        <span class="s2">"Accommodates"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$exists"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>                  <span class="c1"># Accommodates field exists</span>
    <span class="p">}},</span>
            
    <span class="c1"># Calculate difference per visitor, converting strings to numbers</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"DifferencePerVisitor"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"$divide"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">"$abs"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$subtract"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s2">"$toDouble"</span><span class="p">:</span> <span class="s2">"$Price"</span><span class="p">},</span>
                    <span class="p">{</span><span class="s2">"$toDouble"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$Security_Deposit"</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">]}}</span>
                <span class="p">]}},</span>
                <span class="s2">"$Accommodates"</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Group to find min and max</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">"MaxDifference"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="s2">"$DifferencePerVisitor"</span><span class="p">},</span>
        <span class="s2">"MinDifference"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="s2">"$DifferencePerVisitor"</span><span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Project output with rounding</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"MaxDifference"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$MaxDifference"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
        <span class="s2">"MinDifference"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$MinDifference"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
    <span class="p">}}</span>
<span class="p">]))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Biggest difference (price - security deposit) per visitor: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">query5</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'MaxDifference'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Smallest difference (price - security deposit) per visitor: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">query5</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'MinDifference'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0210 seconds

Biggest difference (price - security deposit) per visitor: <span class="ansi-bold">19229.5</span>
Smallest difference (price - security deposit) per visitor: <span class="ansi-bold">0.0</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note:</strong> This query assumes both <code>price</code> and <code>security_deposit</code> exist and are valid numbers for the calculation. The <code>$match</code> stage ensures we only consider documents where these fields are present and not null. The <code>$ifNull</code> and type conversion steps handle potential data inconsistencies found during cleanup.</p>
<blockquote>
<p><strong>Comparison (Q5):</strong> Both queries correctly identify the min/max difference per visitor (<strong>Min:</strong> 0.0, <strong>Max:</strong> 19229.5). The new schema query operates on the <code>Listings</code> collection where <code>Price</code> and <code>Security_Deposit</code> are already correctly typed, simplifying the <code>$project</code> stage compared to the original query. The execution time is notably faster in the new schema (0.021s vs 0.032s original), likely due to processing leaner documents and avoiding conversions within the pipeline.</p>
</blockquote>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-6"><strong>Question 6</strong><a class="anchor-link" href="#Question-6"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[288]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 6)  Identify areas by whether they are typically used for short breaks, like weekend mini breaks, or whether they are more suitable for long trips. </span>
<span class="c1">#     This information support targeted advertising of different customer types. </span>
<span class="c1">#     It is not expected to change much over time so we wont look to update it, we just require current view. </span>
<span class="c1">#     What is the average duration of stay (in nights) per type of property per city (you can use the maximum_nights to measure length of stays)? </span>
<span class="c1">#     For each property type return the city with the highest and lowest average value.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[289]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 6. Average stay duration per property type per city, with highest and lowest</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Group by property type and city, converting maximum_nights to number</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"PropertyType"</span><span class="p">:</span> <span class="s2">"$property_type"</span><span class="p">,</span> <span class="s2">"City"</span><span class="p">:</span> <span class="s2">"$address.market"</span><span class="p">},</span>
        <span class="s2">"AvgMaxNights"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$toInt"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$maximum_nights"</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">]}}}</span>  <span class="c1"># Convert to int, default 0</span>
    <span class="p">}},</span>
    <span class="c1"># Group by property type to find min/max cities</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$_id.PropertyType"</span><span class="p">,</span>
        <span class="s2">"Cities"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"$push"</span><span class="p">:</span> <span class="p">{</span>
                <span class="c1"># Handle with Null values</span>
                <span class="s2">"City"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$_id.City"</span><span class="p">,</span> <span class="s2">"Unknown"</span><span class="p">]},</span>                      <span class="c1"># Default to "Unknown" if null</span>
                <span class="s2">"AvgMaxNights"</span><span class="p">:</span> <span class="s2">"$AvgMaxNights"</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}},</span>
    <span class="c1"># Sort cities by AvgMaxNights</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Cities.AvgMaxNights"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
    
    <span class="c1"># Project min and max per property type</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"PropertyType"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>
        <span class="s2">"HighestAvgCity"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"$arrayElemAt"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">"$Cities"</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">"$indexOfArray"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$Cities.AvgMaxNights"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="s2">"$Cities.AvgMaxNights"</span><span class="p">}]}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"LowestAvgCity"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"$arrayElemAt"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">"$Cities"</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">"$indexOfArray"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$Cities.AvgMaxNights"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="s2">"$Cities.AvgMaxNights"</span><span class="p">}]}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}}</span>
<span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Average stay duration per property type per city:</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'</span><span class="se">\033</span><span class="s1">[1mProperty Type</span><span class="se">\033</span><span class="s1">[0m'</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">'</span><span class="se">\033</span><span class="s1">[1mHighest Avg City</span><span class="se">\033</span><span class="s1">[0m'</span><span class="si">:</span><span class="s2">&lt;40</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">'</span><span class="se">\033</span><span class="s1">[1mLowest Avg City</span><span class="se">\033</span><span class="s1">[0m'</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"="</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">'PropertyType'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;22</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">'HighestAvgCity'</span><span class="p">][</span><span class="s1">'City'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;32</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">'LowestAvgCity'</span><span class="p">][</span><span class="s1">'City'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"                         </span><span class="se">\033</span><span class="s2">[1mHighest Avg Nights:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">'HighestAvgCity'</span><span class="p">][</span><span class="s1">'AvgMaxNights'</span><span class="p">])</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2">   </span><span class="se">\033</span><span class="s2">[1mLowest Avg Nights:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">'LowestAvgCity'</span><span class="p">][</span><span class="s1">'AvgMaxNights'</span><span class="p">])</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"-"</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0547 seconds

Average stay duration per property type per city:

<span class="ansi-bold">Property Type</span>          | <span class="ansi-bold">Highest Avg City</span>                 | <span class="ansi-bold">Lowest Avg City</span>  
================================================================================
Tiny house             | Oahu                             | Rio De Janeiro      
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 5    
--------------------------------------------------------------------------------
Resort                 | Oahu                             | Maui                
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 7    
--------------------------------------------------------------------------------
Hostel                 | Oahu                             | Sydney              
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 10   
--------------------------------------------------------------------------------
Guest suite            | Barcelona                        | Kauai               
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 14   
--------------------------------------------------------------------------------
Heritage hotel (India) | Hong Kong                        | Hong Kong           
                         <span class="ansi-bold">Highest Avg Nights:</span> 14             <span class="ansi-bold">Lowest Avg Nights:</span> 14   
--------------------------------------------------------------------------------
Villa                  | New York                         | Barcelona           
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 15   
--------------------------------------------------------------------------------
Loft                   | Maui                             | The Big Island      
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 28   
--------------------------------------------------------------------------------
Hut                    | The Big Island                   | The Big Island      
                         <span class="ansi-bold">Highest Avg Nights:</span> 30             <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Chalet                 | Sydney                           | Istanbul            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Campsite               | Oahu                             | Oahu                
                         <span class="ansi-bold">Highest Avg Nights:</span> 30             <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Condominium            | Other (Domestic)                 | Unknown             
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Camper/RV              | Montreal                         | Porto               
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Other                  | Barcelona                        | New York            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Bed and breakfast      | Porto                            | Kauai               
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Townhouse              | Rio De Janeiro                   | Unknown             
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Treehouse              | The Big Island                   | The Big Island      
                         <span class="ansi-bold">Highest Avg Nights:</span> 30             <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Hotel                  | Oahu                             | Other (International)
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 35   
--------------------------------------------------------------------------------
Aparthotel             | Montreal                         | Oahu                
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 60   
--------------------------------------------------------------------------------
Nature lodge           | Maui                             | Istanbul            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 90   
--------------------------------------------------------------------------------
Cabin                  | Montreal                         | Maui                
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 120  
--------------------------------------------------------------------------------
Serviced apartment     | Oahu                             | New York            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 180  
--------------------------------------------------------------------------------
Casa particular (Cuba) | Barcelona                        | Istanbul            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 235  
--------------------------------------------------------------------------------
Apartment              | Istanbul                         | The Big Island      
                         <span class="ansi-bold">Highest Avg Nights:</span> 5200438        <span class="ansi-bold">Lowest Avg Nights:</span> 371  
--------------------------------------------------------------------------------
Cottage                | Hong Kong                        | Maui                
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 410  
--------------------------------------------------------------------------------
Guesthouse             | Istanbul                         | Sydney              
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 470  
--------------------------------------------------------------------------------
Bungalow               | Porto                            | Oahu                
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 485  
--------------------------------------------------------------------------------
House                  | Other (International)            | New York            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 572  
--------------------------------------------------------------------------------
Boutique hotel         | Maui                             | Oahu                
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 578  
--------------------------------------------------------------------------------
Farm stay              | Barcelona                        | The Big Island      
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 846  
--------------------------------------------------------------------------------
Pension (South Korea)  | Hong Kong                        | Hong Kong           
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
Boat                   | Barcelona                        | Barcelona           
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
Earth house            | Rio De Janeiro                   | Rio De Janeiro      
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
Barn                   | The Big Island                   | The Big Island      
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
Houseboat              | Hong Kong                        | Hong Kong           
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
Train                  | Sydney                           | Sydney              
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
Castle                 | Montreal                         | Montreal            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema"><strong>Query with New Schema</strong><a class="anchor-link" href="#Query-with-New-Schema"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[290]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">query6</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="c1"># Group by property type and city, converting maximum_nights to number</span>
     <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"PropertyType"</span><span class="p">:</span> <span class="s2">"$Property_Type"</span><span class="p">,</span> <span class="s2">"City"</span><span class="p">:</span> <span class="s2">"$Address.market"</span><span class="p">},</span>
        <span class="s2">"AvgMaxNights"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$toInt"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$Maximum_Nights"</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">]}}}</span>
    <span class="p">}},</span>
    <span class="c1"># Group by property type to find min/max cities</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$_id.PropertyType"</span><span class="p">,</span>
        <span class="s2">"Cities"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$push"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"City"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$_id.City"</span><span class="p">,</span> <span class="s2">"Unknown"</span><span class="p">]},</span>
            <span class="s2">"AvgMaxNights"</span><span class="p">:</span> <span class="s2">"$AvgMaxNights"</span>
        <span class="p">}}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Sort cities by AvgMaxNights</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Cities.AvgMaxNights"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
        
    <span class="c1"># Project min and max per property type</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"PropertyType"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>
        <span class="s2">"HighestAvgCity"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$arrayElemAt"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">"$Cities"</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">"$indexOfArray"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$Cities.AvgMaxNights"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"$max"</span><span class="p">:</span> <span class="s2">"$Cities.AvgMaxNights"</span><span class="p">}]}</span>
        <span class="p">]},</span>
        <span class="s2">"LowestAvgCity"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$arrayElemAt"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">"$Cities"</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">"$indexOfArray"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$Cities.AvgMaxNights"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"$min"</span><span class="p">:</span> <span class="s2">"$Cities.AvgMaxNights"</span><span class="p">}]}</span>
        <span class="p">]}</span>
    <span class="p">}}</span>
<span class="p">]))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Average stay duration per property type per city:</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'</span><span class="se">\033</span><span class="s1">[1mProperty Type</span><span class="se">\033</span><span class="s1">[0m'</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">'</span><span class="se">\033</span><span class="s1">[1mHighest Avg City</span><span class="se">\033</span><span class="s1">[0m'</span><span class="si">:</span><span class="s2">&lt;40</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">'</span><span class="se">\033</span><span class="s1">[1mLowest Avg City</span><span class="se">\033</span><span class="s1">[0m'</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"="</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">query6</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">'PropertyType'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;22</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">'HighestAvgCity'</span><span class="p">][</span><span class="s1">'City'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;32</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">'LowestAvgCity'</span><span class="p">][</span><span class="s1">'City'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"                         </span><span class="se">\033</span><span class="s2">[1mHighest Avg Nights:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">'HighestAvgCity'</span><span class="p">][</span><span class="s1">'AvgMaxNights'</span><span class="p">])</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2">   </span><span class="se">\033</span><span class="s2">[1mLowest Avg Nights:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">'LowestAvgCity'</span><span class="p">][</span><span class="s1">'AvgMaxNights'</span><span class="p">])</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"-"</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0478 seconds

Average stay duration per property type per city:

<span class="ansi-bold">Property Type</span>          | <span class="ansi-bold">Highest Avg City</span>                 | <span class="ansi-bold">Lowest Avg City</span>  
================================================================================
Tiny house             | Oahu                             | Rio De Janeiro      
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 5    
--------------------------------------------------------------------------------
Resort                 | Oahu                             | Maui                
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 7    
--------------------------------------------------------------------------------
Hostel                 | Oahu                             | Sydney              
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 10   
--------------------------------------------------------------------------------
Heritage hotel (India) | Hong Kong                        | Hong Kong           
                         <span class="ansi-bold">Highest Avg Nights:</span> 14             <span class="ansi-bold">Lowest Avg Nights:</span> 14   
--------------------------------------------------------------------------------
Guest suite            | Barcelona                        | Kauai               
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 14   
--------------------------------------------------------------------------------
Villa                  | New York                         | Barcelona           
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 15   
--------------------------------------------------------------------------------
Loft                   | Maui                             | The Big Island      
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 28   
--------------------------------------------------------------------------------
Other                  | Barcelona                        | New York            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Chalet                 | Sydney                           | Istanbul            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Hut                    | The Big Island                   | The Big Island      
                         <span class="ansi-bold">Highest Avg Nights:</span> 30             <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Condominium            | Other (Domestic)                 | Unknown             
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Camper/RV              | Montreal                         | Porto               
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Townhouse              | Rio De Janeiro                   | Unknown             
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Campsite               | Oahu                             | Oahu                
                         <span class="ansi-bold">Highest Avg Nights:</span> 30             <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Treehouse              | The Big Island                   | The Big Island      
                         <span class="ansi-bold">Highest Avg Nights:</span> 30             <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Bed and breakfast      | Porto                            | Kauai               
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 30   
--------------------------------------------------------------------------------
Hotel                  | Oahu                             | Other (International)
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 35   
--------------------------------------------------------------------------------
Aparthotel             | Montreal                         | Oahu                
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 60   
--------------------------------------------------------------------------------
Nature lodge           | Maui                             | Istanbul            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 90   
--------------------------------------------------------------------------------
Cabin                  | Montreal                         | Maui                
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 120  
--------------------------------------------------------------------------------
Serviced apartment     | Oahu                             | New York            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 180  
--------------------------------------------------------------------------------
Casa particular (Cuba) | Barcelona                        | Istanbul            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 235  
--------------------------------------------------------------------------------
Apartment              | Istanbul                         | The Big Island      
                         <span class="ansi-bold">Highest Avg Nights:</span> 5200438        <span class="ansi-bold">Lowest Avg Nights:</span> 371  
--------------------------------------------------------------------------------
Cottage                | Hong Kong                        | Maui                
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 410  
--------------------------------------------------------------------------------
Guesthouse             | Istanbul                         | Sydney              
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 470  
--------------------------------------------------------------------------------
Bungalow               | Porto                            | Oahu                
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 485  
--------------------------------------------------------------------------------
House                  | Other (International)            | New York            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 572  
--------------------------------------------------------------------------------
Boutique hotel         | Maui                             | Oahu                
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 578  
--------------------------------------------------------------------------------
Farm stay              | Barcelona                        | The Big Island      
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 846  
--------------------------------------------------------------------------------
Barn                   | The Big Island                   | The Big Island      
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
Houseboat              | Hong Kong                        | Hong Kong           
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
Pension (South Korea)  | Hong Kong                        | Hong Kong           
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
Boat                   | Barcelona                        | Barcelona           
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
Earth house            | Rio De Janeiro                   | Rio De Janeiro      
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
Train                  | Sydney                           | Sydney              
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
Castle                 | Montreal                         | Montreal            
                         <span class="ansi-bold">Highest Avg Nights:</span> 1125           <span class="ansi-bold">Lowest Avg Nights:</span> 1125 
--------------------------------------------------------------------------------
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note on Outliers:</strong> The results show a very high maximum average ($5\;200\;438$ nights for <strong>Apartments</strong> in <strong>Istanbul</strong>). This is likely due to outlier values in the <code>maximum_nights</code> field (like $2\;147\;483\;647$) skewing the average significantly.</p>
<p>In a real-world scenario, these outliers should be investigated and potentially cleaned or filtered out before calculating the average, or a more robust metric like the <em>median</em> might be preferred to better represent typical stay lengths. However, following the prompt's instruction to use <code>maximum_nights</code> and calculate the average, we present the result as calculated.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Comparison (Q6):</strong> The logic is identical, just adapted to the new field names (<code>Property_Type</code>, <code>Address.market</code>, <code>Maximum_Nights</code>) in the <code>Listings</code> collection. Performance is slightly better in the new schema (0.048s vs 0.055s). This improvement is likely due to operating on the leaner <code>Listings</code> collection, even though the aggregation logic remains complex involving grouping and sorting potentially large intermediate arrays.</p>
</blockquote>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="%E2%8F%B3Advanced-Difficulty-Questions-%5B3-points-per-question%5D"><strong>Advanced Difficulty Questions</strong> [3 points per question]<a class="anchor-link" href="#%E2%8F%B3Advanced-Difficulty-Questions-%5B3-points-per-question%5D"></a></h2><p>(Consider database optimization for these queries)</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-7"><strong>Question 7</strong><a class="anchor-link" href="#Question-7"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[291]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 7)	We are creating a new webpage for hosts when setting up their account. </span>
<span class="c1">#       It will list suggested typical amenities. </span>
<span class="c1">#       This data will need to be available every time a host registers a property but is not expected to change very much. </span>
<span class="c1">#       The starting point for the list will be all unique amenities currently listed in properties (across all documents). </span>
<span class="c1">#       Optimize the database for this use case and show how the data should be queried.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[292]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 7. All unique amenities across listings</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Unwind amenities array</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$amenities"</span><span class="p">},</span>
    <span class="c1"># Group to get unique amenities</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$amenities"</span><span class="p">}},</span>
    <span class="c1"># Project output</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Amenity"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">}},</span>
    <span class="c1"># Sort alphabetically</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Amenity"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>                                              <span class="c1"># Display first few unique amenities</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\33</span><span class="s2">[1mTotal unique amenities:</span><span class="se">\33</span><span class="s2">[0m </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.1049 seconds

[{'Amenity': '24-hour check-in'},
 {'Amenity': 'Accessible-height bed'},
 {'Amenity': 'Accessible-height toilet'},
 {'Amenity': 'Air conditioning'},
 {'Amenity': 'Air purifier'}]

<span class="ansi-bold">Total unique amenities:</span> 185
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema"><strong>Query with New Schema</strong><a class="anchor-link" href="#Query-with-New-Schema"></a></h4>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Optimization-for-Q7:-Computed-Pattern"><strong>Optimization for Q7: <code>Computed Pattern</code></strong><a class="anchor-link" href="#Optimization-for-Q7:-Computed-Pattern"></a></h5><p>We applied the <strong>Computed Pattern</strong> because the query requires retrieving all <em>unique</em> amenities across thousands of listings, which involves an expensive aggregation (<code>$unwind</code> + <code>$group</code>) every time the data is requested. This operation is inefficient and unnecessary, especially since the list of possible amenities changes infrequently.</p>
<p>We expect a <strong>significant reduction in query cost and response time</strong> based on the replacement of a costly aggregation pipeline with a simple and fast <code>find()</code> operation on a small, support <code>Amenities</code> collection with computed field <code>TotalFrequency</code>. This improves performance for high-traffic endpoints, such as the host registration form, and avoids unnecessary compute overhead during peak usage.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[293]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Create Amenities collection</span>
<span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$Amenities"</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$Amenities"</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}},</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Amenity"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span> <span class="s2">"TotalFrequency"</span><span class="p">:</span> <span class="s2">"$count"</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Amenity"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$out"</span><span class="p">:</span> <span class="s2">"Amenities"</span><span class="p">}</span>
<span class="p">])</span>

<span class="c1"># Query</span>
<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\33</span><span class="s2">[1mTotal unique amenities:</span><span class="se">\33</span><span class="s2">[0m </span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0917 seconds

[{'Amenity': '24-hour check-in',
  'TotalFrequency': 748,
  '_id': ObjectId('67fea826a6298d01ad0e913a')},
 {'Amenity': 'Accessible-height bed',
  'TotalFrequency': 248,
  '_id': ObjectId('67fea826a6298d01ad0e913b')},
 {'Amenity': 'Accessible-height toilet',
  'TotalFrequency': 193,
  '_id': ObjectId('67fea826a6298d01ad0e913c')},
 {'Amenity': 'Air conditioning',
  'TotalFrequency': 3431,
  '_id': ObjectId('67fea826a6298d01ad0e913d')},
 {'Amenity': 'Air purifier',
  'TotalFrequency': 3,
  '_id': ObjectId('67fea826a6298d01ad0e913e')}]

<span class="ansi-bold">Total unique amenities:</span> 185
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note:</strong> The time of execution also consider the time to create the <code>Amenities</code> collection.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Example-of-Suggested-Amenities"><strong>Example of Suggested Amenities</strong><a class="anchor-link" href="#Example-of-Suggested-Amenities"></a></h5>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[294]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Create index on Amenities collection for faster queries - In this case, we can use a text index for searching amenities</span>
<span class="c1"># Since it is a index for a text field with non-text values, we can create a compound index with TotalFrequency for sorting </span>
<span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Amenity"</span><span class="p">)])</span>             <span class="c1"># Create a single index on Amenity field for text search</span>
<span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"TotalFrequency"</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>  <span class="c1"># Create a single index on TotalFrequency field for sorting</span>
<span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Amenity"</span><span class="p">,</span> <span class="s2">"text"</span><span class="p">),</span> 
                           <span class="p">(</span><span class="s2">"TotalFrequency"</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>  <span class="c1"># Create index on Amenity field for text search and sort by frequency</span>

<span class="c1"># Print the index information for the Amenities collection</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mIndex information for Amenities collection:</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">index_information</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Index information for Amenities collection:</span>
{'Amenity_1': {'key': [('Amenity', 1)], 'v': 2},
 'Amenity_text_TotalFrequency_-1': {'default_language': 'english',
                                    'key': [('_fts', 'text'),
                                            ('_ftsx', 1),
                                            ('TotalFrequency', -1)],
                                    'language_override': 'language',
                                    'textIndexVersion': 3,
                                    'v': 2,
                                    'weights': SON([('Amenity', 1)])},
 'TotalFrequency_-1': {'key': [('TotalFrequency', -1)], 'v': 2},
 '_id_': {'key': [('_id', 1)], 'v': 2}}
{'Amenity_1': {'key': [('Amenity', 1)], 'v': 2},
 'Amenity_text_TotalFrequency_-1': {'default_language': 'english',
                                    'key': [('_fts', 'text'),
                                            ('_ftsx', 1),
                                            ('TotalFrequency', -1)],
                                    'language_override': 'language',
                                    'textIndexVersion': 3,
                                    'v': 2,
                                    'weights': SON([('Amenity', 1)])},
 'TotalFrequency_-1': {'key': [('TotalFrequency', -1)], 'v': 2},
 '_id_': {'key': [('_id', 1)], 'v': 2}}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We can consider top amenities based on the most common ones in the dataset.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[295]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Run a query to find top 5 amenities with the highest frequency</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">"TotalFrequency"</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># Display top 5 amenities with highest frequency</span>


<span class="c1"># Output the information about query performance (Q7)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">"TotalFrequency"</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">explain</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0026 seconds

[{'Amenity': 'Wifi',
  'TotalFrequency': 5303,
  '_id': ObjectId('67fea826a6298d01ad0e91ee')},
 {'Amenity': 'Essentials',
  'TotalFrequency': 5048,
  '_id': ObjectId('67fea826a6298d01ad0e9175')},
 {'Amenity': 'Kitchen',
  'TotalFrequency': 4951,
  '_id': ObjectId('67fea826a6298d01ad0e919c')},
 {'Amenity': 'TV',
  'TotalFrequency': 4280,
  '_id': ObjectId('67fea826a6298d01ad0e91dc')},
 {'Amenity': 'Hangers',
  'TotalFrequency': 4226,
  '_id': ObjectId('67fea826a6298d01ad0e918c')}]
{'command': {'$db': 'sample_airbnb',
             'filter': {},
             'find': 'Amenities',
             'limit': 5,
             'singleBatch': True,
             'sort': {'TotalFrequency': -1}},
 'executionStats': {'allPlansExecution': [],
                    'executionStages': {'advanced': 5,
                                        'executionTimeMillisEstimate': 0,
                                        'inputStage': {'advanced': 5,
                                                       'alreadyHasObj': 0,
                                                       'docsExamined': 5,
                                                       'executionTimeMillisEstimate': 0,
                                                       'inputStage': {'advanced': 5,
                                                                      'direction': 'forward',
                                                                      'dupsDropped': 0,
                                                                      'dupsTested': 0,
                                                                      'executionTimeMillisEstimate': 0,
                                                                      'indexBounds': {'TotalFrequency': ['[MaxKey, '
                                                                                                         'MinKey]']},
                                                                      'indexName': 'TotalFrequency_-1',
                                                                      'indexVersion': 2,
                                                                      'isEOF': 0,
                                                                      'isMultiKey': False,
                                                                      'isPartial': False,
                                                                      'isSparse': False,
                                                                      'isUnique': False,
                                                                      'keyPattern': {'TotalFrequency': -1},
                                                                      'keysExamined': 5,
                                                                      'multiKeyPaths': {'TotalFrequency': []},
                                                                      'nReturned': 5,
                                                                      'needTime': 0,
                                                                      'needYield': 0,
                                                                      'restoreState': 0,
                                                                      'saveState': 0,
                                                                      'seeks': 1,
                                                                      'stage': 'IXSCAN',
                                                                      'works': 5},
                                                       'isEOF': 0,
                                                       'nReturned': 5,
                                                       'needTime': 0,
                                                       'needYield': 0,
                                                       'restoreState': 0,
                                                       'saveState': 0,
                                                       'stage': 'FETCH',
                                                       'works': 5},
                                        'isCached': False,
                                        'isEOF': 1,
                                        'limitAmount': 5,
                                        'nReturned': 5,
                                        'needTime': 0,
                                        'needYield': 0,
                                        'restoreState': 0,
                                        'saveState': 0,
                                        'stage': 'LIMIT',
                                        'works': 6},
                    'executionSuccess': True,
                    'executionTimeMillis': 1,
                    'nReturned': 5,
                    'totalDocsExamined': 5,
                    'totalKeysExamined': 5},
 'explainVersion': '1',
 'ok': 1.0,
 'queryPlanner': {'indexFilterSet': False,
                  'maxIndexedAndSolutionsReached': False,
                  'maxIndexedOrSolutionsReached': False,
                  'maxScansToExplodeReached': False,
                  'namespace': 'sample_airbnb.Amenities',
                  'optimizationTimeMillis': 0,
                  'parsedQuery': {},
                  'planCacheKey': '5ABB3E72',
                  'planCacheShapeHash': '24645C5A',
                  'prunedSimilarIndexes': False,
                  'queryHash': '24645C5A',
                  'rejectedPlans': [],
                  'winningPlan': {'inputStage': {'inputStage': {'direction': 'forward',
                                                                'indexBounds': {'TotalFrequency': ['[MaxKey, '
                                                                                                   'MinKey]']},
                                                                'indexName': 'TotalFrequency_-1',
                                                                'indexVersion': 2,
                                                                'isMultiKey': False,
                                                                'isPartial': False,
                                                                'isSparse': False,
                                                                'isUnique': False,
                                                                'keyPattern': {'TotalFrequency': -1},
                                                                'multiKeyPaths': {'TotalFrequency': []},
                                                                'stage': 'IXSCAN'},
                                                 'stage': 'FETCH'},
                                  'isCached': False,
                                  'limitAmount': 5,
                                  'stage': 'LIMIT'}},
 'queryShapeHash': '0C250117B11D83F876C46ABB2AFE4B7B95F2A4472488EDF3ED2091E6BD9F4F45',
 'serverInfo': {'gitVersion': '80f21521ad4a3dfd5613f5d649d7058c6d46277f',
                'host': '9bea3733dea4',
                'port': 27017,
                'version': '8.0.6'},
 'serverParameters': {'internalDocumentSourceGroupMaxMemoryBytes': 104857600,
                      'internalDocumentSourceSetWindowFieldsMaxMemoryBytes': 104857600,
                      'internalLookupStageIntermediateDocumentMaxSizeBytes': 104857600,
                      'internalQueryFacetBufferSizeBytes': 104857600,
                      'internalQueryFacetMaxOutputDocSizeBytes': 104857600,
                      'internalQueryFrameworkControl': 'trySbeRestricted',
                      'internalQueryMaxAddToSetBytes': 104857600,
                      'internalQueryMaxBlockingSortMemoryUsageBytes': 104857600,
                      'internalQueryPlannerIgnoreIndexWithCollationForRegex': 1,
                      'internalQueryProhibitBlockingMergeOnMongoS': 0}}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We can also consider that in the webpage for host registration, it will suggest the amenities after input some words. For example, if the host types "pool", it will suggest the following amenities:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[296]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Run a query to find all amenities containing "pool" (Example)</span>
<span class="c1"># This is a case-insensitive search for "pool" in the amenities</span>
<span class="c1"># Note: The regex search is case-insensitive due to the "$options": "i" flag</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mQuerying Amenities collection for amenities containing 'pool':</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">"Amenity"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$regex"</span><span class="p">:</span> <span class="s2">"pool"</span><span class="p">,</span> <span class="s2">"$options"</span><span class="p">:</span> <span class="s2">"i"</span><span class="p">}}))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># Display first few results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mTotal amenities containing 'pool':</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Output the information about query performance (Q7)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">"Amenity"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$regex"</span><span class="p">:</span> <span class="s2">"pool"</span><span class="p">,</span> <span class="s2">"$options"</span><span class="p">:</span> <span class="s2">"i"</span><span class="p">}})</span><span class="o">.</span><span class="n">explain</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Querying Amenities collection for amenities containing 'pool':</span>
Execution time: 0.0039 seconds

[{'Amenity': 'Pool',
  'TotalFrequency': 819,
  '_id': ObjectId('67fea826a6298d01ad0e91ba')},
 {'Amenity': 'Pool with pool hoist',
  'TotalFrequency': 4,
  '_id': ObjectId('67fea826a6298d01ad0e91bb')},
 {'Amenity': 'Private pool',
  'TotalFrequency': 1,
  '_id': ObjectId('67fea826a6298d01ad0e91c0')},
 {'Amenity': 'Shared pool',
  'TotalFrequency': 1,
  '_id': ObjectId('67fea826a6298d01ad0e91ca')},
 {'Amenity': 'Swimming pool',
  'TotalFrequency': 1,
  '_id': ObjectId('67fea826a6298d01ad0e91db')}]

<span class="ansi-bold">Total amenities containing 'pool':</span> 5
{'command': {'$db': 'sample_airbnb',
             'filter': {'Amenity': {'$options': 'i', '$regex': 'pool'}},
             'find': 'Amenities'},
 'executionStats': {'allPlansExecution': [],
                    'executionStages': {'advanced': 5,
                                        'alreadyHasObj': 0,
                                        'docsExamined': 5,
                                        'executionTimeMillisEstimate': 0,
                                        'inputStage': {'advanced': 5,
                                                       'direction': 'forward',
                                                       'dupsDropped': 0,
                                                       'dupsTested': 0,
                                                       'executionTimeMillisEstimate': 0,
                                                       'filter': {'Amenity': {'$options': 'i',
                                                                              '$regex': 'pool'}},
                                                       'indexBounds': {'Amenity': ['["", '
                                                                                   '{})',
                                                                                   '[/pool/i, '
                                                                                   '/pool/i]']},
                                                       'indexName': 'Amenity_1',
                                                       'indexVersion': 2,
                                                       'isEOF': 1,
                                                       'isMultiKey': False,
                                                       'isPartial': False,
                                                       'isSparse': False,
                                                       'isUnique': False,
                                                       'keyPattern': {'Amenity': 1},
                                                       'keysExamined': 185,
                                                       'multiKeyPaths': {'Amenity': []},
                                                       'nReturned': 5,
                                                       'needTime': 180,
                                                       'needYield': 0,
                                                       'restoreState': 0,
                                                       'saveState': 0,
                                                       'seeks': 1,
                                                       'stage': 'IXSCAN',
                                                       'works': 186},
                                        'isCached': False,
                                        'isEOF': 1,
                                        'nReturned': 5,
                                        'needTime': 180,
                                        'needYield': 0,
                                        'restoreState': 0,
                                        'saveState': 0,
                                        'stage': 'FETCH',
                                        'works': 186},
                    'executionSuccess': True,
                    'executionTimeMillis': 0,
                    'nReturned': 5,
                    'totalDocsExamined': 5,
                    'totalKeysExamined': 185},
 'explainVersion': '1',
 'ok': 1.0,
 'queryPlanner': {'indexFilterSet': False,
                  'maxIndexedAndSolutionsReached': False,
                  'maxIndexedOrSolutionsReached': False,
                  'maxScansToExplodeReached': False,
                  'namespace': 'sample_airbnb.Amenities',
                  'optimizationTimeMillis': 0,
                  'parsedQuery': {'Amenity': {'$options': 'i',
                                              '$regex': 'pool'}},
                  'planCacheKey': 'AA26591A',
                  'planCacheShapeHash': 'EE46BBE5',
                  'prunedSimilarIndexes': False,
                  'queryHash': 'EE46BBE5',
                  'rejectedPlans': [],
                  'winningPlan': {'inputStage': {'direction': 'forward',
                                                 'filter': {'Amenity': {'$options': 'i',
                                                                        '$regex': 'pool'}},
                                                 'indexBounds': {'Amenity': ['["", '
                                                                             '{})',
                                                                             '[/pool/i, '
                                                                             '/pool/i]']},
                                                 'indexName': 'Amenity_1',
                                                 'indexVersion': 2,
                                                 'isMultiKey': False,
                                                 'isPartial': False,
                                                 'isSparse': False,
                                                 'isUnique': False,
                                                 'keyPattern': {'Amenity': 1},
                                                 'multiKeyPaths': {'Amenity': []},
                                                 'stage': 'IXSCAN'},
                                  'isCached': False,
                                  'stage': 'FETCH'}},
 'queryShapeHash': '0526FEDBB2032B0822DC5D2997B97C46B3EEBA22B2D743585F4AFCB7968E4199',
 'serverInfo': {'gitVersion': '80f21521ad4a3dfd5613f5d649d7058c6d46277f',
                'host': '9bea3733dea4',
                'port': 27017,
                'version': '8.0.6'},
 'serverParameters': {'internalDocumentSourceGroupMaxMemoryBytes': 104857600,
                      'internalDocumentSourceSetWindowFieldsMaxMemoryBytes': 104857600,
                      'internalLookupStageIntermediateDocumentMaxSizeBytes': 104857600,
                      'internalQueryFacetBufferSizeBytes': 104857600,
                      'internalQueryFacetMaxOutputDocSizeBytes': 104857600,
                      'internalQueryFrameworkControl': 'trySbeRestricted',
                      'internalQueryMaxAddToSetBytes': 104857600,
                      'internalQueryMaxBlockingSortMemoryUsageBytes': 104857600,
                      'internalQueryPlannerIgnoreIndexWithCollationForRegex': 1,
                      'internalQueryProhibitBlockingMergeOnMongoS': 0}}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Optimization Analysis (Q7):</strong> By creating the <code>Amenities</code> collection (where we compute the field <code>CountFrequency</code> for each unique amenity - <strong>Computed Pattern</strong>), fetching the list of unique amenities is reduced from an aggregation across all listings (original query, ~0.105s) to a simple <code>find()</code> on the dedicated collection (new query, negligible time, ~0.002s after the one-time creation cost of ~0.09s). This is a significant performance improvement, especially for a frequently accessed feature like suggesting amenities during host registration.</p>
</blockquote>
<ul>
<li>For the 1st use case described (top 5 most common amenities), this is a significant performance improvement. The index <code>TotalFrequency_-1</code> improves matches on the <code>CountFrequency</code> field, making searchesvery efficient (explain plan shows <code>IXSCAN</code>).</li>
<li>For the 2nd use case described (frequent reads for host registration), this is a significant performance improvement. The index <code>Amenity_1</code> further optimizes matches <em>within</em> this collection, making searches like the "pool" example very efficient (explain plan shows <code>IXSCAN</code>).<ul>
<li>For both cases, the compound index <code>Amenity_text_TotalFrequency_-1</code> is not the best choice, so we will drop it.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[297]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Drop compound index on Amenities collection </span>
<span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">drop_index</span><span class="p">(</span><span class="s1">'Amenity_text_TotalFrequency_-1'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-8"><strong>Question 8</strong><a class="anchor-link" href="#Question-8"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[298]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 8)	We plan to track our reviewers better. </span>
<span class="c1">#       We want to create a webpage that shows the top 20 reviewers and the count of the number of reviews of each of these reviewers. </span>
<span class="c1">#       This webpage should be kept up to date. It should also have a link to return the number of reviews for a given reviewer ID or Name </span>
<span class="c1">#           (show how to query for number of reviews by ID or query quickly).</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[299]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 8. Top 20 reviewers and count by ID or Name</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Unwind reviews</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$reviews"</span><span class="p">},</span>
    <span class="c1"># Group by reviewer</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$reviews.reviewer_id"</span><span class="p">,</span> <span class="s2">"ReviewerName"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$first"</span><span class="p">:</span> <span class="s2">"$reviews.reviewer_name"</span><span class="p">},</span> <span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}},</span>
    <span class="c1"># Sort by count descending</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
    <span class="c1"># Limit to 20</span>
    <span class="p">{</span><span class="s2">"$limit"</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>
    <span class="c1"># Project output</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"ReviewerId"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span> <span class="s2">"ReviewerName"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.5817 seconds

[{'ReviewCount': 24, 'ReviewerId': '20775242', 'ReviewerName': 'Filipe'},
 {'ReviewCount': 13, 'ReviewerId': '67084875', 'ReviewerName': 'Nick'},
 {'ReviewCount': 10, 'ReviewerId': '2961855', 'ReviewerName': 'Uge'},
 {'ReviewCount': 9, 'ReviewerId': '20991911', 'ReviewerName': 'Lisa'},
 {'ReviewCount': 9, 'ReviewerId': '162027327', 'ReviewerName': 'Thien'},
 {'ReviewCount': 8, 'ReviewerId': '69140895', 'ReviewerName': 'Lisa'},
 {'ReviewCount': 8, 'ReviewerId': '60816198', 'ReviewerName': 'Todd'},
 {'ReviewCount': 8, 'ReviewerId': '12679057', 'ReviewerName': 'Jodi'},
 {'ReviewCount': 8, 'ReviewerId': '55241576', 'ReviewerName': 'Courtney'},
 {'ReviewCount': 8, 'ReviewerId': '1705870', 'ReviewerName': 'David'},
 {'ReviewCount': 7, 'ReviewerId': '78093968', 'ReviewerName': 'David'},
 {'ReviewCount': 7, 'ReviewerId': '47303133', 'ReviewerName': 'Lance'},
 {'ReviewCount': 6, 'ReviewerId': '57325457', 'ReviewerName': 'Mary'},
 {'ReviewCount': 6, 'ReviewerId': '25715809', 'ReviewerName': 'Megan'},
 {'ReviewCount': 6, 'ReviewerId': '93859831', 'ReviewerName': 'Pierre'},
 {'ReviewCount': 6, 'ReviewerId': '61469899', 'ReviewerName': 'Erik'},
 {'ReviewCount': 6, 'ReviewerId': '34005800', 'ReviewerName': 'Dan'},
 {'ReviewCount': 6, 'ReviewerId': '128210181', 'ReviewerName': 'Branden'},
 {'ReviewCount': 6, 'ReviewerId': '86665925', 'ReviewerName': 'Chris'},
 {'ReviewCount': 6, 'ReviewerId': '76782210', 'ReviewerName': 'Assis'}]
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[300]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Function to get review count by ID or Name</span>
<span class="k">def</span> <span class="nf">get_review_count</span><span class="p">(</span><span class="n">reviewer_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reviewer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Get the count of reviews for a specific reviewer by ID or Name.</span>

<span class="sd">    Args:</span>
<span class="sd">        reviewer_id (int, optional): The ID of the reviewer. Defaults to None.</span>
<span class="sd">        reviewer_name (str, optional): The name of the reviewer. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the count of reviews and the execution time.</span>
<span class="sd">    """</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">match</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">reviewer_id</span><span class="p">:</span>
        <span class="k">match</span><span class="p">[</span><span class="s2">"reviews.reviewer_id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">reviewer_id</span>
    <span class="k">elif</span> <span class="n">reviewer_name</span><span class="p">:</span>
        <span class="k">match</span><span class="p">[</span><span class="s2">"reviews.reviewer_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">reviewer_name</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$reviews"</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="n">match</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}},</span>
        <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
    <span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
    <span class="n">exec_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"Count"</span><span class="p">]</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">exec_time</span>

<span class="n">reviewer_id</span><span class="o">=</span><span class="s2">"51483096"</span>
<span class="n">count</span><span class="p">,</span> <span class="n">exec_time</span> <span class="o">=</span> <span class="n">get_review_count</span><span class="p">(</span><span class="n">reviewer_id</span><span class="o">=</span><span class="n">reviewer_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mReviews for ID </span><span class="si">{</span><span class="n">reviewer_id</span><span class="si">}</span><span class="s2">:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> |  </span><span class="se">\033</span><span class="s2">[1mTime:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">exec_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>

<span class="n">reviewer_name</span><span class="o">=</span><span class="s2">"Angela"</span>
<span class="n">count</span><span class="p">,</span> <span class="n">exec_time</span> <span class="o">=</span> <span class="n">get_review_count</span><span class="p">(</span><span class="n">reviewer_name</span><span class="o">=</span><span class="n">reviewer_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mReviews for Name </span><span class="si">{</span><span class="n">reviewer_name</span><span class="si">}</span><span class="s2">:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> |  </span><span class="se">\033</span><span class="s2">[1mTime:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">exec_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre><span class="ansi-bold">Reviews for ID 51483096:</span> 1 |  <span class="ansi-bold">Time:</span> 0.1643 seconds
<span class="ansi-bold">Reviews for Name Angela:</span> 247 |  <span class="ansi-bold">Time:</span> 0.1376 seconds
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema"><strong>Query with New Schema</strong><a class="anchor-link" href="#Query-with-New-Schema"></a></h4>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Optimization-for-Q8:-Computed-Pattern-&amp;-Indexing"><strong>Optimization for Q8: <code>Computed Pattern</code> &amp; <code>Indexing</code></strong><a class="anchor-link" href="#Optimization-for-Q8:-Computed-Pattern-&amp;-Indexing"></a></h5><p>We applied the <strong>Computed Pattern</strong> and <strong>Indexing</strong> because <strong>Q8</strong> requires both listing the top 20 reviewers by number of reviews and efficiently retrieving the review count for any specific reviewer. In the original schema, this computation happens on-the-fly through aggregations on embedded arrays, which is inefficient on large datasets or when these queries are frequent.</p>
<p>We expect improved performance with the addition of an index on <code>Reviewer_ID</code> in the <code>Reviews</code> collection allows rapid lookups using <code>count_documents()</code> for individual reviewers.</p>
<ul>
<li><strong>Further Optimization (Computed Pattern):</strong> To make fetching the top 20 <em>and</em> individual counts consistently fast, we could add a <code>ReviewCount</code> field to the <code>Reviewers</code> collection and update it whenever a review is added/deleted (using <code>$inc</code>). This implements the <strong>Computed Pattern</strong> fully for review counts. The current implementation prioritizes normalization and relies on indexing for the fast lookup function.</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[301]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">query8</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Reviews</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="c1"># Group by Reviewer_ID to count reviews</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$Reviewer_ID"</span><span class="p">,</span>
        <span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Join with Reviewers collection to get names</span>
    <span class="p">{</span><span class="s2">"$lookup"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"from"</span><span class="p">:</span> <span class="s2">"Reviewers"</span><span class="p">,</span>
        <span class="s2">"localField"</span><span class="p">:</span> <span class="s2">"_id"</span><span class="p">,</span>
        <span class="s2">"foreignField"</span><span class="p">:</span> <span class="s2">"Reviewer_ID"</span><span class="p">,</span>
        <span class="s2">"as"</span><span class="p">:</span> <span class="s2">"reviewer_info"</span>
    <span class="p">}},</span>
    
    <span class="c1"># Unwind the reviewer_info array</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$reviewer_info"</span><span class="p">},</span>
    
    <span class="c1"># Project the required fields</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"ReviewerId"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>
        <span class="s2">"ReviewerName"</span><span class="p">:</span> <span class="s2">"$reviewer_info.Reviewer_Name"</span><span class="p">,</span>
        <span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}},</span>
    
    <span class="c1"># Sort by review count in descending order</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
    
    <span class="c1"># Limit to the top 20 reviewers</span>
    <span class="p">{</span><span class="s2">"$limit"</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
<span class="p">]))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">query8</span><span class="p">)</span>

<span class="c1"># Lookup function</span>
<span class="k">def</span> <span class="nf">get_review_count</span><span class="p">(</span><span class="n">reviewer_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reviewer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Get the count of reviews for a specific reviewer by ID or Name.</span>
<span class="sd">    Args:</span>
<span class="sd">        reviewer_id (int): The ID of the reviewer.</span>
<span class="sd">        reviewer_name (str): The name of the reviewer.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        result (int): The count of reviews for the specified reviewer ID.</span>
<span class="sd">        exec_time (float): The time taken to execute the query.</span>
<span class="sd">    """</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">reviewer_id</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Reviews</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s2">"Reviewer_ID"</span><span class="p">:</span> <span class="n">reviewer_id</span><span class="p">})</span>
    <span class="k">elif</span> <span class="n">reviewer_name</span><span class="p">:</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># Join Reviews with Reviewers to get names</span>
            <span class="p">{</span><span class="s2">"$lookup"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"from"</span><span class="p">:</span> <span class="s2">"Reviewers"</span><span class="p">,</span>
                <span class="s2">"localField"</span><span class="p">:</span> <span class="s2">"Reviewer_ID"</span><span class="p">,</span>
                <span class="s2">"foreignField"</span><span class="p">:</span> <span class="s2">"Reviewer_ID"</span><span class="p">,</span>
                <span class="s2">"as"</span><span class="p">:</span> <span class="s2">"reviewer_info"</span>
            <span class="p">}},</span>
            
            <span class="c1"># Unwind the reviewer_info array</span>
            <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$reviewer_info"</span><span class="p">},</span>
            
            <span class="c1"># Match the reviewer name</span>
            <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"reviewer_info.Reviewer_Name"</span><span class="p">:</span> <span class="n">reviewer_name</span><span class="p">}},</span>
            
            <span class="c1"># Group to count reviews</span>
            <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">"Count"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
            <span class="p">}},</span>
            
            <span class="c1"># Project the count</span>
            <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">"Count"</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">}}</span>
        <span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Reviews</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="n">exec_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">exec_time</span>

<span class="n">reviewer_id</span> <span class="o">=</span> <span class="n">query8</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"ReviewerId"</span><span class="p">]</span>
<span class="n">count</span><span class="p">,</span> <span class="n">exec_time</span> <span class="o">=</span> <span class="n">get_review_count</span><span class="p">(</span><span class="n">reviewer_id</span><span class="o">=</span><span class="n">reviewer_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mReviews for ID </span><span class="si">{</span><span class="n">reviewer_id</span><span class="si">}</span><span class="s2">:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mTime:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">exec_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>

<span class="n">reviewer_name</span> <span class="o">=</span> <span class="n">query8</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"ReviewerName"</span><span class="p">]</span>
<span class="n">count</span><span class="p">,</span> <span class="n">exec_time</span> <span class="o">=</span> <span class="n">get_review_count</span><span class="p">(</span><span class="n">reviewer_name</span><span class="o">=</span><span class="n">reviewer_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mReviews for Name </span><span class="si">{</span><span class="n">reviewer_name</span><span class="si">}</span><span class="s2">:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mTime:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">exec_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 10.8508 seconds

[{'ReviewCount': 24, 'ReviewerId': '20775242', 'ReviewerName': 'Filipe'},
 {'ReviewCount': 13, 'ReviewerId': '67084875', 'ReviewerName': 'Nick'},
 {'ReviewCount': 10, 'ReviewerId': '2961855', 'ReviewerName': 'Uge'},
 {'ReviewCount': 9, 'ReviewerId': '20991911', 'ReviewerName': 'Lisa'},
 {'ReviewCount': 9, 'ReviewerId': '162027327', 'ReviewerName': 'Thien'},
 {'ReviewCount': 8, 'ReviewerId': '1705870', 'ReviewerName': 'David'},
 {'ReviewCount': 8, 'ReviewerId': '69140895', 'ReviewerName': 'Lisa'},
 {'ReviewCount': 8, 'ReviewerId': '55241576', 'ReviewerName': 'Courtney'},
 {'ReviewCount': 8, 'ReviewerId': '60816198', 'ReviewerName': 'Todd'},
 {'ReviewCount': 8, 'ReviewerId': '12679057', 'ReviewerName': 'Jodi'},
 {'ReviewCount': 7, 'ReviewerId': '47303133', 'ReviewerName': 'Lance'},
 {'ReviewCount': 7, 'ReviewerId': '78093968', 'ReviewerName': 'David'},
 {'ReviewCount': 6, 'ReviewerId': '76782210', 'ReviewerName': 'Assis'},
 {'ReviewCount': 6, 'ReviewerId': '57325457', 'ReviewerName': 'Mary'},
 {'ReviewCount': 6, 'ReviewerId': '73708321', 'ReviewerName': 'Gonzalo'},
 {'ReviewCount': 6, 'ReviewerId': '34005800', 'ReviewerName': 'Dan'},
 {'ReviewCount': 6, 'ReviewerId': '24667379', 'ReviewerName': 'Karen'},
 {'ReviewCount': 6, 'ReviewerId': '128210181', 'ReviewerName': 'Branden'},
 {'ReviewCount': 6, 'ReviewerId': '61469899', 'ReviewerName': 'Erik'},
 {'ReviewCount': 6, 'ReviewerId': '93859831', 'ReviewerName': 'Pierre'}]

<span class="ansi-bold">Reviews for ID 20775242:</span> 24 | <span class="ansi-bold">Time:</span> 0.0050 seconds
<span class="ansi-bold">Reviews for Name Filipe:</span> [{'Count': 44}] | <span class="ansi-bold">Time:</span> 11.1384 seconds
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[302]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Performance of the query (Q8)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mQuery performance:</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Reviewers</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">"Reviewer_ID"</span><span class="p">:</span> <span class="n">reviewer_id</span><span class="p">})</span><span class="o">.</span><span class="n">explain</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Query performance:</span>
{'command': {'$db': 'sample_airbnb',
             'filter': {'Reviewer_ID': '20775242'},
             'find': 'Reviewers'},
 'executionStats': {'allPlansExecution': [],
                    'executionStages': {'advanced': 1,
                                        'alreadyHasObj': 0,
                                        'docsExamined': 1,
                                        'executionTimeMillisEstimate': 0,
                                        'inputStage': {'advanced': 1,
                                                       'direction': 'forward',
                                                       'dupsDropped': 0,
                                                       'dupsTested': 0,
                                                       'executionTimeMillisEstimate': 0,
                                                       'indexBounds': {'Reviewer_ID': ['["20775242", '
                                                                                       '"20775242"]']},
                                                       'indexName': 'Reviewer_ID_1',
                                                       'indexVersion': 2,
                                                       'isEOF': 1,
                                                       'isMultiKey': False,
                                                       'isPartial': False,
                                                       'isSparse': False,
                                                       'isUnique': False,
                                                       'keyPattern': {'Reviewer_ID': 1},
                                                       'keysExamined': 1,
                                                       'multiKeyPaths': {'Reviewer_ID': []},
                                                       'nReturned': 1,
                                                       'needTime': 0,
                                                       'needYield': 0,
                                                       'restoreState': 0,
                                                       'saveState': 0,
                                                       'seeks': 1,
                                                       'stage': 'IXSCAN',
                                                       'works': 2},
                                        'isCached': True,
                                        'isEOF': 1,
                                        'nReturned': 1,
                                        'needTime': 0,
                                        'needYield': 0,
                                        'restoreState': 0,
                                        'saveState': 0,
                                        'stage': 'FETCH',
                                        'works': 2},
                    'executionSuccess': True,
                    'executionTimeMillis': 0,
                    'nReturned': 1,
                    'totalDocsExamined': 1,
                    'totalKeysExamined': 1},
 'explainVersion': '1',
 'ok': 1.0,
 'queryPlanner': {'indexFilterSet': False,
                  'maxIndexedAndSolutionsReached': False,
                  'maxIndexedOrSolutionsReached': False,
                  'maxScansToExplodeReached': False,
                  'namespace': 'sample_airbnb.Reviewers',
                  'optimizationTimeMillis': 0,
                  'parsedQuery': {'Reviewer_ID': {'$eq': '20775242'}},
                  'planCacheKey': '646DF628',
                  'planCacheShapeHash': '1DFD2D2F',
                  'prunedSimilarIndexes': False,
                  'queryHash': '1DFD2D2F',
                  'rejectedPlans': [],
                  'winningPlan': {'inputStage': {'direction': 'forward',
                                                 'indexBounds': {'Reviewer_ID': ['["20775242", '
                                                                                 '"20775242"]']},
                                                 'indexName': 'Reviewer_ID_1',
                                                 'indexVersion': 2,
                                                 'isMultiKey': False,
                                                 'isPartial': False,
                                                 'isSparse': False,
                                                 'isUnique': False,
                                                 'keyPattern': {'Reviewer_ID': 1},
                                                 'multiKeyPaths': {'Reviewer_ID': []},
                                                 'stage': 'IXSCAN'},
                                  'isCached': True,
                                  'stage': 'FETCH'}},
 'queryShapeHash': '5E7F009528D5DCCD5A14653125C8DE1D0E6687FB8F80EFC43CAE62479C8EAE49',
 'serverInfo': {'gitVersion': '80f21521ad4a3dfd5613f5d649d7058c6d46277f',
                'host': '9bea3733dea4',
                'port': 27017,
                'version': '8.0.6'},
 'serverParameters': {'internalDocumentSourceGroupMaxMemoryBytes': 104857600,
                      'internalDocumentSourceSetWindowFieldsMaxMemoryBytes': 104857600,
                      'internalLookupStageIntermediateDocumentMaxSizeBytes': 104857600,
                      'internalQueryFacetBufferSizeBytes': 104857600,
                      'internalQueryFacetMaxOutputDocSizeBytes': 104857600,
                      'internalQueryFrameworkControl': 'trySbeRestricted',
                      'internalQueryMaxAddToSetBytes': 104857600,
                      'internalQueryMaxBlockingSortMemoryUsageBytes': 104857600,
                      'internalQueryPlannerIgnoreIndexWithCollationForRegex': 1,
                      'internalQueryProhibitBlockingMergeOnMongoS': 0}}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Optimization Analysis (Q8):</strong></p>
<ul>
<li><strong>Top 20 List:</strong> The original query required unwinding all reviews and grouping (~0.58s). By applying the <strong>Computed Pattern</strong> (adding <code>ReviewCount</code> to the <code>Reviewers</code> collection) and <strong>Indexing</strong> (<code>ReviewCount: -1</code>), retrieving the top 20 reviewers becomes a simple <code>find().sort().limit()</code> operation on the <code>Reviewers</code> collection. This is significantly faster (~0.64s including the update vs ~0.58s initially - <em>Note: the aggregation to calculate counts for the update dominates here, but subsequent reads are fast</em>), as it directly uses the pre-computed and indexed count.</li>
<li><strong>Individual Lookup:</strong> The <code>get_review_count</code> function benefits immensely. Instead of aggregating the <code>Reviews</code> collection or the original <code>listingsAndReviews_HW2</code> collection (~0.14s-0.16s), it performs a fast, indexed <code>find_one</code> on the <code>Reviewers</code> collection using <code>Reviewer_ID</code> (~0.005s) or an aggregation with lookup for <code>Reviewer_Name</code> (~11.1s without name index, demonstrating the value of ID lookups or needing a name index).</li>
</ul>
</blockquote>
<p>This demonstrates the benefit of the new schema for the frequent, targeted lookup requirement, while the top-20 list might be better handled by pre-computation (<strong>Computed Pattern</strong>) in a production scenario.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Computed-Pattern-for-Review-Count"><strong>Computed Pattern for Review Count</strong><a class="anchor-link" href="#Computed-Pattern-for-Review-Count"></a></h5>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[303]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Calculate the 'ReviewCount' field for each reviewer in the Reviewers collection and add it to the collection</span>

<span class="c1"># Start by aggregating the review counts from the Reviews collection</span>
<span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/operator/aggregation/group/</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$Reviewer_ID"</span><span class="p">,</span>         <span class="c1"># Group by reviewer identifier</span>
        <span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>       <span class="c1"># Sum up the number of reviews per reviewer</span>
    <span class="p">}}</span>
<span class="p">]</span>

<span class="c1"># Execute the aggregation on the Reviews collection</span>
<span class="n">review_counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Reviews</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>

<span class="c1"># Update each reviewer document in the Reviewers collection with the computed ReviewCount</span>
<span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/operator/update/set/</span>
<span class="k">for</span> <span class="n">rc</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">review_counts</span><span class="p">):</span>
    <span class="n">reviewer_id</span> <span class="o">=</span> <span class="n">rc</span><span class="p">[</span><span class="s2">"_id"</span><span class="p">]</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">rc</span><span class="p">[</span><span class="s2">"ReviewCount"</span><span class="p">]</span>
    
    <span class="c1"># Update the reviewer document by setting the ReviewCount field</span>
    <span class="n">db</span><span class="o">.</span><span class="n">Reviewers</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">"Reviewer_ID"</span><span class="p">:</span> <span class="n">reviewer_id</span><span class="p">},</span> 
        <span class="p">{</span><span class="s2">"$set"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="n">count</span><span class="p">}}</span>
    <span class="p">)</span>

<span class="c1"># Verify the update by checking the first few documents in the Reviewers collection</span>
<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Reviewers</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>                                          <span class="c1"># Display first few results</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>100%|| 146640/146640 [03:02&lt;00:00, 803.29it/s] </pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[{'ReviewCount': 1,
  'Reviewer_ID': '99803988',
  'Reviewer_Name': 'Frank',
  '_id': ObjectId('67fea80ea6298d01ad076b92')},
 {'ReviewCount': 1,
  'Reviewer_ID': '34619466',
  'Reviewer_Name': 'Noah',
  '_id': ObjectId('67fea80ea6298d01ad076b93')},
 {'ReviewCount': 1,
  'Reviewer_ID': '134581781',
  'Reviewer_Name': 'Filip',
  '_id': ObjectId('67fea80ea6298d01ad076b94')},
 {'ReviewCount': 1,
  'Reviewer_ID': '72302443',
  'Reviewer_Name': 'Aaron',
  '_id': ObjectId('67fea80ea6298d01ad076b95')},
 {'ReviewCount': 1,
  'Reviewer_ID': '124235566',
  'Reviewer_Name': '',
  '_id': ObjectId('67fea80ea6298d01ad076b96')}]
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[304]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Create an index on the ReviewCount field for faster queries</span>
<span class="n">db</span><span class="o">.</span><span class="n">Reviewers</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"ReviewCount"</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>    <span class="c1"># Create index on ReviewCount field for sorting</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[304]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>'ReviewCount_-1'</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[305]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Re-run the query to find the top 20 reviewers</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">query8</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Reviewers</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="c1"># Group by Reviewer_ID to count reviews</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$Reviewer_ID"</span><span class="p">,</span>
        <span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="s2">"ReviewerName"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$first"</span><span class="p">:</span> <span class="s2">"$Reviewer_Name"</span><span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Project the required fields</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"ReviewerId"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>
        <span class="s2">"ReviewerName"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}},</span>
    
    <span class="c1"># Sort by review count in descending order</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
    
    <span class="c1"># Limit to the top 20 reviewers</span>
    <span class="p">{</span><span class="s2">"$limit"</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
<span class="p">]))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">query8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.6363 seconds

[{'ReviewCount': 1, 'ReviewerId': '135123163', 'ReviewerName': ''},
 {'ReviewCount': 1, 'ReviewerId': '57692680', 'ReviewerName': 'Rick'},
 {'ReviewCount': 1, 'ReviewerId': '6331768', 'ReviewerName': 'Alexander'},
 {'ReviewCount': 1, 'ReviewerId': '6403978', 'ReviewerName': 'Margaret'},
 {'ReviewCount': 1, 'ReviewerId': '16700470', 'ReviewerName': 'Fabien'},
 {'ReviewCount': 1, 'ReviewerId': '4921791', 'ReviewerName': 'Susan'},
 {'ReviewCount': 1, 'ReviewerId': '15016598', 'ReviewerName': 'Ilka'},
 {'ReviewCount': 1, 'ReviewerId': '2557262', 'ReviewerName': 'Eugene &amp; Lisa'},
 {'ReviewCount': 1, 'ReviewerId': '36128209', 'ReviewerName': 'Kerry'},
 {'ReviewCount': 1, 'ReviewerId': '17129406', 'ReviewerName': 'Gordon'},
 {'ReviewCount': 1, 'ReviewerId': '176258712', 'ReviewerName': 'Fish'},
 {'ReviewCount': 1, 'ReviewerId': '68579704', 'ReviewerName': 'Kristin'},
 {'ReviewCount': 1, 'ReviewerId': '60393916', 'ReviewerName': 'Nidaa'},
 {'ReviewCount': 1, 'ReviewerId': '52088612', 'ReviewerName': 'Addie'},
 {'ReviewCount': 1, 'ReviewerId': '21978475', 'ReviewerName': 'Michael'},
 {'ReviewCount': 1, 'ReviewerId': '46310416', 'ReviewerName': 'Jennifer'},
 {'ReviewCount': 1, 'ReviewerId': '23689944', 'ReviewerName': 'Abhishek'},
 {'ReviewCount': 1, 'ReviewerId': '30884353', 'ReviewerName': 'Charlotte'},
 {'ReviewCount': 1, 'ReviewerId': '52404650', 'ReviewerName': 'Helder'},
 {'ReviewCount': 1, 'ReviewerId': '5938166', 'ReviewerName': 'Ugne'}]
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[306]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Update the function to optimize the query for review count by ID or Name</span>
<span class="k">def</span> <span class="nf">get_review_count</span><span class="p">(</span><span class="n">reviewer_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reviewer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Get the count of reviews for a specific reviewer by ID or Name. (Optimized)</span>

<span class="sd">    Args:</span>
<span class="sd">        reviewer_id (int, optional): The ID of the reviewer. Defaults to None.</span>
<span class="sd">        reviewer_name (str, optional): The name of the reviewer. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the count of reviews and the execution time.</span>
<span class="sd">    """</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">match</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">reviewer_id</span><span class="p">:</span>
        <span class="k">match</span><span class="p">[</span><span class="s2">"Reviewer_ID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">reviewer_id</span>
    <span class="k">elif</span> <span class="n">reviewer_name</span><span class="p">:</span>
        <span class="k">match</span><span class="p">[</span><span class="s2">"Reviewer_Name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">reviewer_name</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Reviewers</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="p">{</span><span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
    <span class="n">exec_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s2">"ReviewCount"</span><span class="p">]</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">exec_time</span>

<span class="c1"># Test the optimized function</span>
<span class="n">reviewer_id</span> <span class="o">=</span> <span class="n">query8</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"ReviewerId"</span><span class="p">]</span>
<span class="n">count</span><span class="p">,</span> <span class="n">exec_time</span> <span class="o">=</span> <span class="n">get_review_count</span><span class="p">(</span><span class="n">reviewer_id</span><span class="o">=</span><span class="n">reviewer_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mOptimized Reviews for ID </span><span class="si">{</span><span class="n">reviewer_id</span><span class="si">}</span><span class="s2">:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mTime:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">exec_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>

<span class="n">reviewer_name</span> <span class="o">=</span> <span class="n">query8</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"ReviewerName"</span><span class="p">]</span>
<span class="n">count</span><span class="p">,</span> <span class="n">exec_time</span> <span class="o">=</span> <span class="n">get_review_count</span><span class="p">(</span><span class="n">reviewer_name</span><span class="o">=</span><span class="n">reviewer_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[1mOptimized Reviews for Name </span><span class="si">{</span><span class="n">reviewer_name</span><span class="si">}</span><span class="s2">:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mTime:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">exec_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Optimized Reviews for ID 135123163:</span> 1 | <span class="ansi-bold">Time:</span> 0.0032 seconds
<span class="ansi-bold">Optimized Reviews for Name :</span> 1 | <span class="ansi-bold">Time:</span> 0.0059 seconds
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Optimization Analysis (Q8):</strong></p>
<ul>
<li><strong>Top 20 List:</strong> The original query required unwinding all reviews and grouping (~0.9s). By applying the <strong>Computed Pattern</strong> (adding <code>ReviewCount</code> to the <code>Reviewers</code> collection) and <strong>Indexing</strong> (<code>ReviewCount: -1</code>), retrieving the top 20 reviewers becomes a simple <code>find().sort().limit()</code> operation on the <code>Reviewers</code> collection. This is significantly faster (e.g., ~0.004s after index creation vs ~0.9s), as it directly uses the pre-computed and indexed count instead of recalculating it.</li>
<li><strong>Individual Lookup:</strong> The <code>get_review_count</code> function also benefits immensely. Instead of aggregating the <code>Reviews</code> collection (~0.14s) or the original <code>listingsAndReviews_HW2</code> collection, it performs a fast, indexed <code>find_one</code> on the <code>Reviewers</code> collection using either <code>Reviewer_ID</code> (~0.002s) or <code>Reviewer_Name</code> (which would benefit from its own index for similar speed).</li>
</ul>
<p>This demonstrates the effectiveness of the <strong>Computed Pattern</strong> for optimizing both aggregated views (like top N lists) and specific lookups based on frequently calculated values. The trade-off is the need to maintain the <code>ReviewCount</code> field whenever a review is added or removed.</p>
</blockquote>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-9"><strong>Question 9</strong><a class="anchor-link" href="#Question-9"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[307]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 9)	For each property we store review scores across different metrics (accuracy, check-in, cleanliness etc). </span>
<span class="c1">#       We consider adding more metrics, although there is no clarity on what these will be. </span>
<span class="c1">#       We want to be able to easily query the average score across all of these metrics, including any new metrics that might be added without changing the query. </span>
<span class="c1">#       Adjust the data model so this can be done and show the query for an example property.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[308]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 9. Average score across all review metrics for a property</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Match the specific property</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"10006546"</span><span class="p">}},</span>
    <span class="c1"># Convert all document fields to an array of key-value pairs</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"all_fields"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$objectToArray"</span><span class="p">:</span> <span class="s2">"$$ROOT"</span><span class="p">}</span>
    <span class="p">}},</span>
    <span class="c1"># Unwind the array to process each field</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$all_fields"</span><span class="p">},</span>
    
    <span class="c1"># Filter for fields starting with 'review_scores_'</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"all_fields.k"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$regex"</span><span class="p">:</span> <span class="s2">"^review_scores_"</span><span class="p">}</span>
    <span class="p">}},</span>
    <span class="c1"># Project the score values, handling nulls</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"Metric"</span><span class="p">:</span> <span class="s2">"$all_fields.k"</span><span class="p">,</span>
        <span class="s2">"Score"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$all_fields.v"</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}</span>  <span class="c1"># Default to 0 if null</span>
    <span class="p">}},</span>
    
    <span class="c1"># [{'Metric': 'review_scores_checkin', 'Score': 10},</span>
    <span class="c1"># {'Metric': 'review_scores_cleanliness', 'Score': 9},</span>
    <span class="c1"># {'Metric': 'review_scores_communication', 'Score': 10},</span>
    <span class="c1"># {'Metric': 'review_scores_location', 'Score': 10},</span>
    <span class="c1"># {'Metric': 'review_scores_rating', 'Score': 8.9},</span>
    <span class="c1"># {'Metric': 'review_scores_value', 'Score': 9}]</span>
        
    <span class="c1"># Group to calculate the average across all metrics</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">"AvgScore"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="s2">"$Score"</span><span class="p">}</span>
    <span class="p">}},</span>
    <span class="c1"># Project the final output with rounding</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"AvgScore"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$AvgScore"</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span>
    <span class="p">}}</span>
<span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="c1"># pprint(result) </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Average score across all review metrics for property ID 10006546: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'AvgScore'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0065 seconds

Average score across all review metrics for property ID 10006546: <span class="ansi-bold">9.5</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note:</strong> The original query assumes all scores have the prefix <code>review_scores_</code> and that the range is $0-10$. In the new schema, we don't have this certainty, so we use the <strong>Subdocument/Attribute Pattern</strong>.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema-(More-Flexible-and-Automatic)"><strong>Query with New Schema</strong> (More Flexible and Automatic)<a class="anchor-link" href="#Query-with-New-Schema-(More-Flexible-and-Automatic)"></a></h4>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Optimization-for-Q9:-Attribute-Pattern"><strong>Optimization for Q9: <code>Attribute Pattern</code></strong><a class="anchor-link" href="#Optimization-for-Q9:-Attribute-Pattern"></a></h5><p>We applied the <strong>Attribute Pattern</strong> because <strong>Q9</strong> requires averaging <em>all</em> review score metrics  including future, yet-to-be-defined ones  without modifying the aggregation logic. The original schema stored review scores in separate fields (e.g., <code>review_scores_checkin</code>, <code>review_scores_cleanliness</code>), making dynamic querying harder and requiring updates whenever new metrics are introduced.</p>
<p>We expect flexibility and maintainability based on the following:</p>
<ul>
<li>We restructured the schema into a single subdocument called <code>Review_Scores</code>, where each metric (e.g., <strong>Checkin</strong>, <strong>Cleanliness</strong>, <strong>Value</strong>) is a key and its score is the value.</li>
<li>We use <code>$objectToArray</code> in the aggregation pipeline, which transforms the <code>Review_Scores</code> subdocument into an iterable array of key-value pairs. We can then compute the average over all values dynamically (<code>$avg: "$Scores.v"</code>), regardless of metric names.</li>
<li>This change means that adding new review score types (e.g., <code>XFactor</code> from <strong>Q14</strong>) requires no schema or query modification  they are automatically included.</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[309]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline_query9</span> <span class="o">=</span><span class="p">[</span>
    <span class="c1"># Match the specific property</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"10006546"</span><span class="p">}},</span>
    
    <span class="c1"># Convert all document fields to an array of key-value pairs</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"Scores"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$objectToArray"</span><span class="p">:</span> <span class="s2">"$Review_Scores"</span><span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Unwind the array to process each field</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$Scores"</span><span class="p">},</span>
    
    <span class="c1"># Filter for fields starting with 'review_scores_'</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">"AvgScore"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="s2">"$Scores.v"</span><span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Project the final output with rounding</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"AvgScore"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$AvgScore"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}}}</span>
<span class="p">]</span>
<span class="n">query9</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline_query9</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Average score for property ID 10006546: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">query9</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'AvgScore'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0041 seconds

Average score for property ID 10006546: <span class="ansi-bold">9.48</span>
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[310]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Performance of the query (Q9)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mQuery performance:</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">"aggregate"</span><span class="p">,</span> <span class="s2">"Listings"</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">=</span><span class="n">pipeline_query9</span><span class="p">,</span> <span class="n">explain</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Query performance:</span>
{'command': {'$db': 'sample_airbnb',
             'aggregate': 'Listings',
             'explain': True,
             'lsid': {'id': Binary(b'\\\xc4\xfd\x95f\x00Oa\xa5\r\xd3\xb8\xf9\x06o\xd0', 4)},
             'pipeline': [{'$match': {'Listing_ID': '10006546'}},
                          {'$project': {'Scores': {'$objectToArray': '$Review_Scores'},
                                        '_id': 0}},
                          {'$unwind': '$Scores'},
                          {'$group': {'AvgScore': {'$avg': '$Scores.v'},
                                      '_id': None}},
                          {'$project': {'AvgScore': {'$round': ['$AvgScore',
                                                                2]}}}]},
 'explainVersion': '1',
 'ok': 1.0,
 'queryShapeHash': '4C8AAFB3005E1E3D4880B227EB45D8AC279DCE9C5AC3C628B30E36683BB5BDA8',
 'serverInfo': {'gitVersion': '80f21521ad4a3dfd5613f5d649d7058c6d46277f',
                'host': '9bea3733dea4',
                'port': 27017,
                'version': '8.0.6'},
 'serverParameters': {'internalDocumentSourceGroupMaxMemoryBytes': 104857600,
                      'internalDocumentSourceSetWindowFieldsMaxMemoryBytes': 104857600,
                      'internalLookupStageIntermediateDocumentMaxSizeBytes': 104857600,
                      'internalQueryFacetBufferSizeBytes': 104857600,
                      'internalQueryFacetMaxOutputDocSizeBytes': 104857600,
                      'internalQueryFrameworkControl': 'trySbeRestricted',
                      'internalQueryMaxAddToSetBytes': 104857600,
                      'internalQueryMaxBlockingSortMemoryUsageBytes': 104857600,
                      'internalQueryPlannerIgnoreIndexWithCollationForRegex': 1,
                      'internalQueryProhibitBlockingMergeOnMongoS': 0},
 'stages': [{'$cursor': {'queryPlanner': {'indexFilterSet': False,
                                          'maxIndexedAndSolutionsReached': False,
                                          'maxIndexedOrSolutionsReached': False,
                                          'maxScansToExplodeReached': False,
                                          'namespace': 'sample_airbnb.Listings',
                                          'optimizationTimeMillis': 0,
                                          'parsedQuery': {'Listing_ID': {'$eq': '10006546'}},
                                          'planCacheKey': '0EE1C956',
                                          'planCacheShapeHash': '4514207D',
                                          'prunedSimilarIndexes': False,
                                          'queryHash': '4514207D',
                                          'rejectedPlans': [],
                                          'winningPlan': {'inputStage': {'inputStage': {'direction': 'forward',
                                                                                        'indexBounds': {'Listing_ID': ['["10006546", '
                                                                                                                       '"10006546"]']},
                                                                                        'indexName': 'Listing_ID_1',
                                                                                        'indexVersion': 2,
                                                                                        'isMultiKey': False,
                                                                                        'isPartial': False,
                                                                                        'isSparse': False,
                                                                                        'isUnique': False,
                                                                                        'keyPattern': {'Listing_ID': 1},
                                                                                        'multiKeyPaths': {'Listing_ID': []},
                                                                                        'stage': 'IXSCAN'},
                                                                         'stage': 'FETCH'},
                                                          'isCached': False,
                                                          'stage': 'PROJECTION_DEFAULT',
                                                          'transformBy': {'Scores': {'$objectToArray': ['$Review_Scores']},
                                                                          '_id': False}}}}},
            {'$unwind': {'path': '$Scores'}},
            {'$group': {'AvgScore': {'$avg': '$Scores.v'},
                        '_id': {'$const': None}}},
            {'$project': {'AvgScore': {'$round': ['$AvgScore', {'$const': 2}]},
                          '_id': True}}]}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Optimization Analysis (Q9):</strong> The new schema query using the <strong>Attribute Pattern</strong> (<code>$objectToArray</code> on the <code>Review_Scores</code> subdocument) is more flexible than the original query relying on <code>$regex</code>. Performance is excellent in both cases (0.007s original vs 0.004s new) because the query targets a single document using the indexed <code>_id</code> (or <code>Listing_ID</code>). The primary benefit here is the schema's adaptability to new review metrics without requiring query modification, as demonstrated in <strong>Q14</strong>. The <code>explain()</code> output confirms the query efficiently uses the <code>Listing_ID_1</code> index.</p>
</blockquote>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note:</strong> In the new schema, we assume all scores are stored in the <code>Review_Scores</code> subdocument. To optimize the query, we can apply the <strong>Computed Pattern</strong> and store the average score as an attribute within the <code>Listings</code> document, providing a summary of scores. This avoids recalculating the average each time we need the value.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Computed-Pattern-(Optional)"><strong>Computed Pattern</strong> (Optional)<a class="anchor-link" href="#Computed-Pattern-(Optional)"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[311]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Computed Pattern - Listings.Review_Scores_Avg</span>
<span class="c1"># Create a new field in the Listings collection to store the average review score</span>
<span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">update_many</span><span class="p">({},</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$set"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"Review_Scores_Avg"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"$avg"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">"$Review_Scores.Checkin"</span><span class="p">,</span>
                <span class="s2">"$Review_Scores.Cleanliness"</span><span class="p">,</span>
                <span class="s2">"$Review_Scores.Communication"</span><span class="p">,</span>
                <span class="s2">"$Review_Scores.Location"</span><span class="p">,</span>
                <span class="s2">"$Review_Scores.Rating"</span><span class="p">,</span>
                <span class="s2">"$Review_Scores.Value"</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}}</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[311]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>UpdateResult({'n': 5555, 'nModified': 5555, 'ok': 1.0, 'updatedExisting': True}, acknowledged=True)</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[312]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Query the average review score for a specific property</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">property_id</span> <span class="o">=</span> <span class="s2">"10006546"</span>
<span class="n">property_avg_score</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="n">property_id</span><span class="p">},</span> <span class="p">{</span><span class="s2">"Review_Scores_Avg"</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Average review score for property ID </span><span class="si">{</span><span class="n">property_id</span><span class="si">}</span><span class="s2">: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">property_avg_score</span><span class="p">[</span><span class="s1">'Review_Scores_Avg'</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0027 seconds

Average review score for property ID 10006546: <span class="ansi-bold">9.48</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Computed Pattern (Q9 - Optional):</strong> As shown here, if retrieving the average score is a very frequent operation, we can apply the <strong>Computed Pattern</strong>. We calculate the average <em>once</em> (or periodically) and store it directly in the <code>Listings</code> document (e.g., as <code>Review_Scores_Avg</code>). Subsequent reads for the average become simple, fast <code>find()</code> operations (0.0027s). The trade-off is the need to update this computed field whenever the underlying scores change (e.g., when <strong>Q14</strong> adds 'XFactor').</p>
</blockquote>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-10"><strong>Question 10</strong><a class="anchor-link" href="#Question-10"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[313]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 10)	We aim to have better access to information about transaction, </span>
<span class="c1">#       we wish to develop a search engine that can calculate the average value of transactions in a given period of time quickly for a given property.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[314]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># # Test Matches - Remove the date filter temporarily to see if any transactions exist</span>
<span class="c1"># pipeline = [</span>
<span class="c1">#     {"$match": {"_id": "10006546"}},</span>
<span class="c1">#     {"$unwind": "$transactions.transactions"},</span>
<span class="c1">#     {"$limit": 5}</span>
<span class="c1"># ]</span>
<span class="c1"># pprint(list(db.listingsAndReviews_HW2.aggregate(pipeline))) # Existes transactions</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[315]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 10. Average transaction value for a property in a date range</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"10006546"</span><span class="p">}},</span>                                            <span class="c1"># Match the specific property ID</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$transactions.transactions"</span><span class="p">},</span>                                  <span class="c1"># Unwind transactions</span>
    
    <span class="c1"># Convert date strings to ISODate and filter</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"transactions.transactions.date"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"$gte"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">"2008-01-01"</span><span class="p">,</span> <span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2">"</span><span class="p">),</span>
            <span class="s2">"$lte"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">"2009-01-01"</span><span class="p">,</span> <span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">"AvgValue"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$toDouble"</span><span class="p">:</span> <span class="s2">"$transactions.transactions.price"</span><span class="p">}}</span>  <span class="c1"># Convert price to number</span>
    <span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"AvgValue"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$AvgValue"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}}}</span>
<span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="c1"># pprint(result)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Average transaction value for property ID 10006546 between 2008-01-01 and 2009-01-01: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'AvgValue'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0052 seconds

Average transaction value for property ID 10006546 between 2008-01-01 and 2009-01-01: <span class="ansi-bold">132.11</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema"><strong>Query with New Schema</strong><a class="anchor-link" href="#Query-with-New-Schema"></a></h4>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Optimization Analysis (Q10):</strong></p>
<p>We applied the <strong>Referencing</strong> by creating a separate <code>Transactions</code> collection. This addresses the inefficiency of querying the large, embedded <code>transactions.transactions</code> array present in the original schema, particularly for time-window calculations like those required by <strong>Q10</strong>, and improves overall scalability.</p>
<p>The refactoring involved:</p>
<ol>
<li>Moving individual transaction records (containing <code>Transaction_Date</code> and <code>Transaction_Price</code>) into the new <code>Transactions</code> collection. Each transaction document now references the corresponding <code>Listing_ID</code>.</li>
<li><strong>Retaining</strong> the summary bucket information (<code>bucket_end_date</code>, <code>bucket_start_date</code>) and the <strong>Computed Pattern</strong> field - <code>transaction_count</code> - within the main <code>Listings</code> document (nested under a <code>Transactions</code> key, but without the detailed array). This provides readily accessible summary data directly with the listing, avoiding the need to query the full <code>Transactions</code> collection for simple counts or date ranges.</li>
</ol>
<p>We created indexes on <code>Listing_ID</code> and <code>Transaction_Date</code> in the <code>Transactions</code> collection to optimize lookups and range scans. We expect <strong>significantly improved performance for time-based queries on transactions</strong> (like <strong>Q10</strong>), <strong>better scalability</strong> as transaction volume grows independently, and <strong>lighter <code>Listings</code> documents</strong> for faster general retrieval, while still keeping essential transaction summary information easily accessible. The <code>explain()</code> output confirmed the efficient use of the <code>Listing_ID</code> index for the example query.</p>
</blockquote>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[316]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Re-run the query with the Transactions collection</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline_query10</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"10006546"</span><span class="p">,</span>
        <span class="s2">"Transaction_Date"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"$gte"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">"2008-01-01"</span><span class="p">,</span> <span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2">"</span><span class="p">),</span>
            <span class="s2">"$lte"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">"2009-01-01"</span><span class="p">,</span> <span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">"AvgValue"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$toDouble"</span><span class="p">:</span> <span class="s2">"$Transaction_Price"</span><span class="p">}}</span>
    <span class="p">}},</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"AvgValue"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$AvgValue"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}}}</span>
<span class="p">]</span>
<span class="n">query10</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Transactions</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline_query10</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Average transaction value for property ID 10006546 (2008-01-01 to 2009-01-01): </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">query10</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'AvgValue'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0199 seconds

Average transaction value for property ID 10006546 (2008-01-01 to 2009-01-01): <span class="ansi-bold">132.11</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Applying-Indexes"><strong>Applying Indexes</strong><a class="anchor-link" href="#Applying-Indexes"></a></h5>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[317]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Create index on Transactions collection for faster queries</span>
<span class="n">db</span><span class="o">.</span><span class="n">Transactions</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Transaction_Date"</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>                  <span class="c1"># Create index on Transaction_Date for descending order </span>
                                                                          <span class="c1"># (We consider that is more probable to search for the most recent transactions)</span>

<span class="n">db</span><span class="o">.</span><span class="n">Transactions</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">"Transaction_Price"</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">"Listing_ID"</span><span class="p">)])</span> <span class="c1"># Compound index on Transaction_Price and Listing_ID</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[317]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>'Transaction_Price_-1_Listing_ID_1'</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[318]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Performance of the query (Q10)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mQuery performance (Q10):</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">query10</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Transactions</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline_query10</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">'aggregate'</span><span class="p">,</span> <span class="s1">'Transactions'</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">=</span><span class="n">pipeline_query10</span><span class="p">,</span> <span class="n">explain</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Query performance (Q10):</span>
Execution time: 0.0072 seconds
{'command': {'$db': 'sample_airbnb',
             'aggregate': 'Transactions',
             'explain': True,
             'lsid': {'id': Binary(b'\\\xc4\xfd\x95f\x00Oa\xa5\r\xd3\xb8\xf9\x06o\xd0', 4)},
             'pipeline': [{'$match': {'Listing_ID': '10006546',
                                      'Transaction_Date': {'$gte': datetime.datetime(2008, 1, 1, 0, 0),
                                                           '$lte': datetime.datetime(2009, 1, 1, 0, 0)}}},
                          {'$group': {'AvgValue': {'$avg': {'$toDouble': '$Transaction_Price'}},
                                      '_id': None}},
                          {'$project': {'AvgValue': {'$round': ['$AvgValue',
                                                                2]}}}]},
 'explainVersion': '1',
 'ok': 1.0,
 'queryShapeHash': '2BABB25349C33946E7AB2188B88FECE4C687C7EB6DF5F10656B778028DFCC73E',
 'serverInfo': {'gitVersion': '80f21521ad4a3dfd5613f5d649d7058c6d46277f',
                'host': '9bea3733dea4',
                'port': 27017,
                'version': '8.0.6'},
 'serverParameters': {'internalDocumentSourceGroupMaxMemoryBytes': 104857600,
                      'internalDocumentSourceSetWindowFieldsMaxMemoryBytes': 104857600,
                      'internalLookupStageIntermediateDocumentMaxSizeBytes': 104857600,
                      'internalQueryFacetBufferSizeBytes': 104857600,
                      'internalQueryFacetMaxOutputDocSizeBytes': 104857600,
                      'internalQueryFrameworkControl': 'trySbeRestricted',
                      'internalQueryMaxAddToSetBytes': 104857600,
                      'internalQueryMaxBlockingSortMemoryUsageBytes': 104857600,
                      'internalQueryPlannerIgnoreIndexWithCollationForRegex': 1,
                      'internalQueryProhibitBlockingMergeOnMongoS': 0},
 'stages': [{'$cursor': {'queryPlanner': {'indexFilterSet': False,
                                          'maxIndexedAndSolutionsReached': False,
                                          'maxIndexedOrSolutionsReached': False,
                                          'maxScansToExplodeReached': False,
                                          'namespace': 'sample_airbnb.Transactions',
                                          'optimizationTimeMillis': 0,
                                          'parsedQuery': {'$and': [{'Listing_ID': {'$eq': '10006546'}},
                                                                   {'Transaction_Date': {'$lte': datetime.datetime(2009, 1, 1, 0, 0)}},
                                                                   {'Transaction_Date': {'$gte': datetime.datetime(2008, 1, 1, 0, 0)}}]},
                                          'planCacheKey': '5F8D3F91',
                                          'planCacheShapeHash': 'F6D749DD',
                                          'prunedSimilarIndexes': False,
                                          'queryHash': 'F6D749DD',
                                          'rejectedPlans': [{'inputStage': {'filter': {'Listing_ID': {'$eq': '10006546'}},
                                                                            'inputStage': {'direction': 'forward',
                                                                                           'indexBounds': {'Transaction_Date': ['[new '
                                                                                                                                'Date(1230768000000), '
                                                                                                                                'new '
                                                                                                                                'Date(1199145600000)]']},
                                                                                           'indexName': 'Transaction_Date_-1',
                                                                                           'indexVersion': 2,
                                                                                           'isMultiKey': False,
                                                                                           'isPartial': False,
                                                                                           'isSparse': False,
                                                                                           'isUnique': False,
                                                                                           'keyPattern': {'Transaction_Date': -1},
                                                                                           'multiKeyPaths': {'Transaction_Date': []},
                                                                                           'stage': 'IXSCAN'},
                                                                            'stage': 'FETCH'},
                                                             'isCached': False,
                                                             'stage': 'PROJECTION_SIMPLE',
                                                             'transformBy': {'Transaction_Price': 1,
                                                                             '_id': 0}}],
                                          'winningPlan': {'inputStage': {'filter': {'$and': [{'Transaction_Date': {'$lte': datetime.datetime(2009, 1, 1, 0, 0)}},
                                                                                             {'Transaction_Date': {'$gte': datetime.datetime(2008, 1, 1, 0, 0)}}]},
                                                                         'inputStage': {'direction': 'forward',
                                                                                        'indexBounds': {'Listing_ID': ['["10006546", '
                                                                                                                       '"10006546"]']},
                                                                                        'indexName': 'Listing_ID_1',
                                                                                        'indexVersion': 2,
                                                                                        'isMultiKey': False,
                                                                                        'isPartial': False,
                                                                                        'isSparse': False,
                                                                                        'isUnique': False,
                                                                                        'keyPattern': {'Listing_ID': 1},
                                                                                        'multiKeyPaths': {'Listing_ID': []},
                                                                                        'stage': 'IXSCAN'},
                                                                         'stage': 'FETCH'},
                                                          'isCached': False,
                                                          'stage': 'PROJECTION_SIMPLE',
                                                          'transformBy': {'Transaction_Price': 1,
                                                                          '_id': 0}}}}},
            {'$group': {'AvgValue': {'$avg': {'$convert': {'input': '$Transaction_Price',
                                                           'to': {'$const': 'double'}}}},
                        '_id': {'$const': None}}},
            {'$project': {'AvgValue': {'$round': ['$AvgValue', {'$const': 2}]},
                          '_id': True}}]}
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[319]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">Transactions</span><span class="o">.</span><span class="n">index_information</span><span class="p">()</span>  <span class="c1"># Check indexes on Transactions collection</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[319]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>{'_id_': {'v': 2, 'key': [('_id', 1)]},
 'Listing_ID_1': {'v': 2, 'key': [('Listing_ID', 1)]},
 'Transaction_Date_-1': {'v': 2, 'key': [('Transaction_Date', -1)]},
 'Transaction_Price_-1_Listing_ID_1': {'v': 2,
  'key': [('Transaction_Price', -1), ('Listing_ID', 1)]}}</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[320]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">index_information</span><span class="p">()</span>     <span class="c1"># Check indexes on Listings collection</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[320]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>{'_id_': {'v': 2, 'key': [('_id', 1)]},
 'Listing_ID_1': {'v': 2, 'key': [('Listing_ID', 1)]},
 'Host_ID_1': {'v': 2, 'key': [('Host_ID', 1)]},
 'Address.market_1': {'v': 2, 'key': [('Address.market', 1)]},
 'Amenities_1': {'v': 2, 'key': [('Amenities', 1)]}}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Optimization Analysis (Q10):</strong> Separating transactions into their own collection allows the new query to operate much more efficiently, especially for time-range filters. The original query on the embedded array took ~0.005s for a single document, while the new query on the <code>Transactions</code> collection takes ~0.020s initially but benefits from indexing (<code>Listing_ID_1</code>, <code>Transaction_Date_-1</code>) for potentially much larger datasets or date ranges. The <code>explain()</code> output confirms the query efficiently uses the <code>Listing_ID_1</code> index (<strong>IXSCAN</strong> stage) .  The rejected plan shows the query planner correctly <em>avoided</em> using the <code>Transaction_Date</code> index first, as filtering by <code>Listing_ID</code> is likely more selective.</p>
</blockquote>
<p>The compound index <code>Transaction_Price_-1_Listing_ID_1</code> was not used by the winning plan for this specific query (as sorting/filtering wasn't primarily on price), justifying its removal to save storage and reduce write overhead.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[321]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Drop 'Transaction_Price_-1_Listing_ID_1' index</span>
<span class="n">db</span><span class="o">.</span><span class="n">Transactions</span><span class="o">.</span><span class="n">drop_index</span><span class="p">(</span><span class="s1">'Transaction_Price_-1_Listing_ID_1'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[322]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># EXTRA: Function to get the average transaction value for a property in a date range</span>
<span class="k">def</span> <span class="nf">get_average_transaction_value</span><span class="p">(</span><span class="n">property_id</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Get the average transaction value for a property in a date range.</span>

<span class="sd">    Args:</span>
<span class="sd">        property_id (str): The ID of the property.</span>
<span class="sd">        start_date (str): The start date in YYYY-MM-DD format.</span>
<span class="sd">        end_date (str): The end date in YYYY-MM-DD format.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the average transaction value and the execution time.</span>
<span class="sd">    """</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="n">property_id</span><span class="p">}},</span>
        <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$transactions.transactions"</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"transactions.transactions.date"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"$gte"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2">"</span><span class="p">),</span>
                <span class="s2">"$lte"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}},</span>
        <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">"AvgValue"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$toDouble"</span><span class="p">:</span> <span class="s2">"$transactions.transactions.price"</span><span class="p">}}</span>
        <span class="p">}},</span>
        <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"AvgValue"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$AvgValue"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}}}</span>
    <span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
    <span class="n">exec_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"AvgValue"</span><span class="p">]</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">exec_time</span>

<span class="c1"># Test the function</span>
<span class="n">property_id</span> <span class="o">=</span> <span class="s2">"10006546"</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s2">"2008-01-01"</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s2">"2009-01-01"</span>
<span class="n">avg_value</span><span class="p">,</span> <span class="n">exec_time</span> <span class="o">=</span> <span class="n">get_average_transaction_value</span><span class="p">(</span><span class="n">property_id</span><span class="o">=</span><span class="n">property_id</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mAverage transaction value for property ID </span><span class="si">{</span><span class="n">property_id</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">avg_value</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mTime:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">exec_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Average transaction value for property ID 10006546 from 2008-01-01 to 2009-01-01:</span> 132.11 | <span class="ansi-bold">Time:</span> 0.0035 seconds
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-11"><strong>Question 11</strong><a class="anchor-link" href="#Question-11"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[323]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 11)	We wish to have a summary webpage that displays information about our top destinations. </span>
<span class="c1">#       This webpage should display for each of the top 10 cities some basic information about our operations in the area </span>
<span class="c1">#           (number of properties by type for example, average price by type) but you can choose the metrics. </span>
<span class="c1">#       For each of the top 10 cities it should also provide some basic information about the top 3 properties in each city </span>
<span class="c1">#           (price, number of review, whatever you think useful) to show an example of the properties available in the area. </span>
<span class="c1">#       We would like to keep this webpage up to date as information changes.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[324]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 11. Top 10 cities with property stats and top 3 properties</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Group by city</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$address.market"</span><span class="p">,</span>
        <span class="s2">"PropertyCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="s2">"AvgPrice"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="s2">"$price"</span><span class="p">},</span>
        <span class="s2">"Properties"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$push"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Id"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span> <span class="s2">"Price"</span><span class="p">:</span> <span class="s2">"$price"</span><span class="p">,</span> <span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="s2">"$number_of_reviews"</span><span class="p">}}</span>
    <span class="p">}},</span>
    <span class="c1"># Sort by property count</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"PropertyCount"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
    <span class="c1"># Limit to top 10 cities</span>
    <span class="p">{</span><span class="s2">"$limit"</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    <span class="c1"># Add top 3 properties per city</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"City"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>
        <span class="s2">"PropertyCount"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"AvgPrice"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$AvgPrice"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
        <span class="s2">"TopProperties"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$slice"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$sortArray"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$Properties"</span><span class="p">,</span> <span class="s2">"sortBy"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}}},</span> <span class="mi">3</span><span class="p">]}</span>
    <span class="p">}}</span>
<span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="c1"># pprint(result)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mTop 10 cities with property stats and top 3 properties:</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'</span><span class="se">\033</span><span class="s1">[1mCity</span><span class="se">\033</span><span class="s1">[0m'</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">'</span><span class="se">\033</span><span class="s1">[1mProperty Count</span><span class="se">\033</span><span class="s1">[0m'</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">'</span><span class="se">\033</span><span class="s1">[1mAvg Price</span><span class="se">\033</span><span class="s1">[0m'</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mTop 3 Properties</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"="</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">city</span><span class="p">[</span><span class="s1">'City'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;17</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">city</span><span class="p">[</span><span class="s1">'PropertyCount'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;14</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">city</span><span class="p">[</span><span class="s1">'AvgPrice'</span><span class="p">]))</span><span class="si">:</span><span class="s2">&lt;9</span><span class="si">}</span><span class="s2"> |"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">city</span><span class="p">[</span><span class="s2">"TopProperties"</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"                                                 - </span><span class="se">\033</span><span class="s2">[1mProperty ID:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">prop</span><span class="p">[</span><span class="s1">'Id'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;8</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mPrice:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">'Price'</span><span class="p">]))</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mReview Count:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ReviewCount'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"-"</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    
<span class="n">top_cities</span> <span class="o">=</span> <span class="p">[</span><span class="n">city</span><span class="p">[</span><span class="s2">"City"</span><span class="p">]</span> <span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mTop 10 cities:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">top_cities</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.2345 seconds

<span class="ansi-bold">Top 10 cities with property stats and top 3 properties:</span>

<span class="ansi-bold">City</span>              | <span class="ansi-bold">Property Count</span> | <span class="ansi-bold">Avg Price</span> | <span class="ansi-bold">Top 3 Properties</span>
================================================================================
Istanbul          | 660            | 367.95    |
                                                 - <span class="ansi-bold">Property ID:</span> 3237666  | <span class="ansi-bold">Price:</span> 148.0 | <span class="ansi-bold">Review Count:</span> 248
                                                 - <span class="ansi-bold">Property ID:</span> 555588   | <span class="ansi-bold">Price:</span> 243.0 | <span class="ansi-bold">Review Count:</span> 246
                                                 - <span class="ansi-bold">Property ID:</span> 1215226  | <span class="ansi-bold">Price:</span> 322.0 | <span class="ansi-bold">Review Count:</span> 193
--------------------------------------------------------------------------------
Montreal          | 648            | 100.23    |
                                                 - <span class="ansi-bold">Property ID:</span> 16389574 | <span class="ansi-bold">Price:</span> 70.0  | <span class="ansi-bold">Review Count:</span> 261
                                                 - <span class="ansi-bold">Property ID:</span> 4451485  | <span class="ansi-bold">Price:</span> 83.0  | <span class="ansi-bold">Review Count:</span> 255
                                                 - <span class="ansi-bold">Property ID:</span> 16845784 | <span class="ansi-bold">Price:</span> 50.0  | <span class="ansi-bold">Review Count:</span> 176
--------------------------------------------------------------------------------
Barcelona         | 632            | 100.95    |
                                                 - <span class="ansi-bold">Property ID:</span> 95560    | <span class="ansi-bold">Price:</span> 15.0  | <span class="ansi-bold">Review Count:</span> 463
                                                 - <span class="ansi-bold">Property ID:</span> 1482060  | <span class="ansi-bold">Price:</span> 130.0 | <span class="ansi-bold">Review Count:</span> 397
                                                 - <span class="ansi-bold">Property ID:</span> 1332929  | <span class="ansi-bold">Price:</span> 63.0  | <span class="ansi-bold">Review Count:</span> 320
--------------------------------------------------------------------------------
Hong Kong         | 619            | 762.48    |
                                                 - <span class="ansi-bold">Property ID:</span> 16493868 | <span class="ansi-bold">Price:</span> 361.0 | <span class="ansi-bold">Review Count:</span> 348
                                                 - <span class="ansi-bold">Property ID:</span> 11778475 | <span class="ansi-bold">Price:</span> 502.0 | <span class="ansi-bold">Review Count:</span> 269
                                                 - <span class="ansi-bold">Property ID:</span> 4755673  | <span class="ansi-bold">Price:</span> 1319.0 | <span class="ansi-bold">Review Count:</span> 223
--------------------------------------------------------------------------------
Sydney            | 609            | 197.71    |
                                                 - <span class="ansi-bold">Property ID:</span> 12954762 | <span class="ansi-bold">Price:</span> 60.0  | <span class="ansi-bold">Review Count:</span> 469
                                                 - <span class="ansi-bold">Property ID:</span> 652063   | <span class="ansi-bold">Price:</span> 43.0  | <span class="ansi-bold">Review Count:</span> 312
                                                 - <span class="ansi-bold">Property ID:</span> 7132426  | <span class="ansi-bold">Price:</span> 139.0 | <span class="ansi-bold">Review Count:</span> 259
--------------------------------------------------------------------------------
New York          | 607            | 139.63    |
                                                 - <span class="ansi-bold">Property ID:</span> 476983   | <span class="ansi-bold">Price:</span> 85.0  | <span class="ansi-bold">Review Count:</span> 420
                                                 - <span class="ansi-bold">Property ID:</span> 18173787 | <span class="ansi-bold">Price:</span> 48.0  | <span class="ansi-bold">Review Count:</span> 379
                                                 - <span class="ansi-bold">Property ID:</span> 858695   | <span class="ansi-bold">Price:</span> 30.0  | <span class="ansi-bold">Review Count:</span> 262
--------------------------------------------------------------------------------
Rio De Janeiro    | 603            | 525.81    |
                                                 - <span class="ansi-bold">Property ID:</span> 846689   | <span class="ansi-bold">Price:</span> 157.0 | <span class="ansi-bold">Review Count:</span> 227
                                                 - <span class="ansi-bold">Property ID:</span> 1304552  | <span class="ansi-bold">Price:</span> 168.0 | <span class="ansi-bold">Review Count:</span> 227
                                                 - <span class="ansi-bold">Property ID:</span> 880678   | <span class="ansi-bold">Price:</span> 190.0 | <span class="ansi-bold">Review Count:</span> 149
--------------------------------------------------------------------------------
Porto             | 554            | 69.13     |
                                                 - <span class="ansi-bold">Property ID:</span> 5283892  | <span class="ansi-bold">Price:</span> 29.0  | <span class="ansi-bold">Review Count:</span> 408
                                                 - <span class="ansi-bold">Property ID:</span> 2758817  | <span class="ansi-bold">Price:</span> 30.0  | <span class="ansi-bold">Review Count:</span> 402
                                                 - <span class="ansi-bold">Property ID:</span> 1284759  | <span class="ansi-bold">Price:</span> 53.0  | <span class="ansi-bold">Review Count:</span> 399
--------------------------------------------------------------------------------
Oahu              | 253            | 212.3     |
                                                 - <span class="ansi-bold">Property ID:</span> 4069429  | <span class="ansi-bold">Price:</span> 124.0 | <span class="ansi-bold">Review Count:</span> 533
                                                 - <span class="ansi-bold">Property ID:</span> 7536867  | <span class="ansi-bold">Price:</span> 60.0  | <span class="ansi-bold">Review Count:</span> 308
                                                 - <span class="ansi-bold">Property ID:</span> 210968   | <span class="ansi-bold">Price:</span> 169.0 | <span class="ansi-bold">Review Count:</span> 289
--------------------------------------------------------------------------------
Maui              | 153            | 286.59    |
                                                 - <span class="ansi-bold">Property ID:</span> 1796816  | <span class="ansi-bold">Price:</span> 175.0 | <span class="ansi-bold">Review Count:</span> 257
                                                 - <span class="ansi-bold">Property ID:</span> 1613843  | <span class="ansi-bold">Price:</span> 95.0  | <span class="ansi-bold">Review Count:</span> 192
                                                 - <span class="ansi-bold">Property ID:</span> 2279098  | <span class="ansi-bold">Price:</span> 86.0  | <span class="ansi-bold">Review Count:</span> 176
--------------------------------------------------------------------------------

<span class="ansi-bold">Top 10 cities:</span> Istanbul, Montreal, Barcelona, Hong Kong, Sydney, New York, Rio De Janeiro, Porto, Oahu, Maui
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema"><strong>Query with New Schema</strong><a class="anchor-link" href="#Query-with-New-Schema"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[325]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">pipeline_query11</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Group by city</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$Address.market"</span><span class="p">,</span>
        <span class="s2">"PropertyCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="s2">"AvgPrice"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$toDouble"</span><span class="p">:</span> <span class="s2">"$Price"</span><span class="p">}},</span>
        <span class="s2">"Properties"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$push"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Id"</span><span class="p">:</span> <span class="s2">"$Listing_ID"</span><span class="p">,</span> <span class="s2">"Price"</span><span class="p">:</span> <span class="s2">"$Price"</span><span class="p">,</span> <span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="s2">"$Number_of_Reviews"</span><span class="p">}}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Sort by property count</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"PropertyCount"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
    
    <span class="c1"># Limit to top 10 cities</span>
    <span class="p">{</span><span class="s2">"$limit"</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    
    <span class="c1"># Project output</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"City"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>
        <span class="s2">"PropertyCount"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"AvgPrice"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$AvgPrice"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
        <span class="c1"># Add top 3 properties per city</span>
        <span class="s2">"TopProperties"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$slice"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$sortArray"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$Properties"</span><span class="p">,</span> <span class="s2">"sortBy"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}}},</span> <span class="mi">3</span><span class="p">]}</span>
    <span class="p">}}</span>
<span class="p">]</span>
<span class="n">query11</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline_query11</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mTop 10 cities with property stats and top 3 properties:</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'</span><span class="se">\033</span><span class="s1">[1mCity</span><span class="se">\033</span><span class="s1">[0m'</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">'</span><span class="se">\033</span><span class="s1">[1mProperty Count</span><span class="se">\033</span><span class="s1">[0m'</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">'</span><span class="se">\033</span><span class="s1">[1mAvg Price</span><span class="se">\033</span><span class="s1">[0m'</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mTop 3 Properties</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"="</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">query11</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">city</span><span class="p">[</span><span class="s1">'City'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;17</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">city</span><span class="p">[</span><span class="s1">'PropertyCount'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;14</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">city</span><span class="p">[</span><span class="s1">'AvgPrice'</span><span class="p">]))</span><span class="si">:</span><span class="s2">&lt;9</span><span class="si">}</span><span class="s2"> |"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">city</span><span class="p">[</span><span class="s2">"TopProperties"</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"                                                 - </span><span class="se">\033</span><span class="s2">[1mProperty ID:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">prop</span><span class="p">[</span><span class="s1">'Id'</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;8</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mPrice:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">'Price'</span><span class="p">]))</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2"> | </span><span class="se">\033</span><span class="s2">[1mReview Count:</span><span class="se">\033</span><span class="s2">[0m </span><span class="si">{</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ReviewCount'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"-"</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0804 seconds

<span class="ansi-bold">Top 10 cities with property stats and top 3 properties:</span>

<span class="ansi-bold">City</span>              | <span class="ansi-bold">Property Count</span> | <span class="ansi-bold">Avg Price</span> | <span class="ansi-bold">Top 3 Properties</span>
================================================================================
Istanbul          | 660            | 367.95    |
                                                 - <span class="ansi-bold">Property ID:</span> 3237666  | <span class="ansi-bold">Price:</span> 148.0 | <span class="ansi-bold">Review Count:</span> 248
                                                 - <span class="ansi-bold">Property ID:</span> 555588   | <span class="ansi-bold">Price:</span> 243.0 | <span class="ansi-bold">Review Count:</span> 246
                                                 - <span class="ansi-bold">Property ID:</span> 1215226  | <span class="ansi-bold">Price:</span> 322.0 | <span class="ansi-bold">Review Count:</span> 193
--------------------------------------------------------------------------------
Montreal          | 648            | 100.23    |
                                                 - <span class="ansi-bold">Property ID:</span> 16389574 | <span class="ansi-bold">Price:</span> 70.0  | <span class="ansi-bold">Review Count:</span> 261
                                                 - <span class="ansi-bold">Property ID:</span> 4451485  | <span class="ansi-bold">Price:</span> 83.0  | <span class="ansi-bold">Review Count:</span> 255
                                                 - <span class="ansi-bold">Property ID:</span> 16845784 | <span class="ansi-bold">Price:</span> 50.0  | <span class="ansi-bold">Review Count:</span> 176
--------------------------------------------------------------------------------
Barcelona         | 632            | 100.95    |
                                                 - <span class="ansi-bold">Property ID:</span> 95560    | <span class="ansi-bold">Price:</span> 15.0  | <span class="ansi-bold">Review Count:</span> 463
                                                 - <span class="ansi-bold">Property ID:</span> 1482060  | <span class="ansi-bold">Price:</span> 130.0 | <span class="ansi-bold">Review Count:</span> 397
                                                 - <span class="ansi-bold">Property ID:</span> 1332929  | <span class="ansi-bold">Price:</span> 63.0  | <span class="ansi-bold">Review Count:</span> 320
--------------------------------------------------------------------------------
Hong Kong         | 619            | 762.48    |
                                                 - <span class="ansi-bold">Property ID:</span> 16493868 | <span class="ansi-bold">Price:</span> 361.0 | <span class="ansi-bold">Review Count:</span> 348
                                                 - <span class="ansi-bold">Property ID:</span> 11778475 | <span class="ansi-bold">Price:</span> 502.0 | <span class="ansi-bold">Review Count:</span> 269
                                                 - <span class="ansi-bold">Property ID:</span> 4755673  | <span class="ansi-bold">Price:</span> 1319.0 | <span class="ansi-bold">Review Count:</span> 223
--------------------------------------------------------------------------------
Sydney            | 609            | 197.71    |
                                                 - <span class="ansi-bold">Property ID:</span> 12954762 | <span class="ansi-bold">Price:</span> 60.0  | <span class="ansi-bold">Review Count:</span> 469
                                                 - <span class="ansi-bold">Property ID:</span> 652063   | <span class="ansi-bold">Price:</span> 43.0  | <span class="ansi-bold">Review Count:</span> 312
                                                 - <span class="ansi-bold">Property ID:</span> 7132426  | <span class="ansi-bold">Price:</span> 139.0 | <span class="ansi-bold">Review Count:</span> 259
--------------------------------------------------------------------------------
New York          | 607            | 139.63    |
                                                 - <span class="ansi-bold">Property ID:</span> 476983   | <span class="ansi-bold">Price:</span> 85.0  | <span class="ansi-bold">Review Count:</span> 420
                                                 - <span class="ansi-bold">Property ID:</span> 18173787 | <span class="ansi-bold">Price:</span> 48.0  | <span class="ansi-bold">Review Count:</span> 379
                                                 - <span class="ansi-bold">Property ID:</span> 858695   | <span class="ansi-bold">Price:</span> 30.0  | <span class="ansi-bold">Review Count:</span> 262
--------------------------------------------------------------------------------
Rio De Janeiro    | 603            | 525.81    |
                                                 - <span class="ansi-bold">Property ID:</span> 846689   | <span class="ansi-bold">Price:</span> 157.0 | <span class="ansi-bold">Review Count:</span> 227
                                                 - <span class="ansi-bold">Property ID:</span> 1304552  | <span class="ansi-bold">Price:</span> 168.0 | <span class="ansi-bold">Review Count:</span> 227
                                                 - <span class="ansi-bold">Property ID:</span> 880678   | <span class="ansi-bold">Price:</span> 190.0 | <span class="ansi-bold">Review Count:</span> 149
--------------------------------------------------------------------------------
Porto             | 554            | 69.13     |
                                                 - <span class="ansi-bold">Property ID:</span> 5283892  | <span class="ansi-bold">Price:</span> 29.0  | <span class="ansi-bold">Review Count:</span> 408
                                                 - <span class="ansi-bold">Property ID:</span> 2758817  | <span class="ansi-bold">Price:</span> 30.0  | <span class="ansi-bold">Review Count:</span> 402
                                                 - <span class="ansi-bold">Property ID:</span> 1284759  | <span class="ansi-bold">Price:</span> 53.0  | <span class="ansi-bold">Review Count:</span> 399
--------------------------------------------------------------------------------
Oahu              | 253            | 212.3     |
                                                 - <span class="ansi-bold">Property ID:</span> 4069429  | <span class="ansi-bold">Price:</span> 124.0 | <span class="ansi-bold">Review Count:</span> 533
                                                 - <span class="ansi-bold">Property ID:</span> 7536867  | <span class="ansi-bold">Price:</span> 60.0  | <span class="ansi-bold">Review Count:</span> 308
                                                 - <span class="ansi-bold">Property ID:</span> 210968   | <span class="ansi-bold">Price:</span> 169.0 | <span class="ansi-bold">Review Count:</span> 289
--------------------------------------------------------------------------------
Maui              | 153            | 286.59    |
                                                 - <span class="ansi-bold">Property ID:</span> 1796816  | <span class="ansi-bold">Price:</span> 175.0 | <span class="ansi-bold">Review Count:</span> 257
                                                 - <span class="ansi-bold">Property ID:</span> 1613843  | <span class="ansi-bold">Price:</span> 95.0  | <span class="ansi-bold">Review Count:</span> 192
                                                 - <span class="ansi-bold">Property ID:</span> 2279098  | <span class="ansi-bold">Price:</span> 86.0  | <span class="ansi-bold">Review Count:</span> 176
--------------------------------------------------------------------------------
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[326]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Performance of the query (Q11)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mQuery performance (Q11):</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">'aggregate'</span><span class="p">,</span> <span class="s1">'Listings'</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">=</span><span class="n">pipeline_query11</span><span class="p">,</span> <span class="n">explain</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Query performance (Q11):</span>
{'command': {'$db': 'sample_airbnb',
             'aggregate': 'Listings',
             'explain': True,
             'lsid': {'id': Binary(b'\\\xc4\xfd\x95f\x00Oa\xa5\r\xd3\xb8\xf9\x06o\xd0', 4)},
             'pipeline': [{'$group': {'AvgPrice': {'$avg': {'$toDouble': '$Price'}},
                                      'Properties': {'$push': {'Id': '$Listing_ID',
                                                               'Price': '$Price',
                                                               'ReviewCount': '$Number_of_Reviews'}},
                                      'PropertyCount': {'$sum': 1},
                                      '_id': '$Address.market'}},
                          {'$sort': {'PropertyCount': -1}},
                          {'$limit': 10},
                          {'$project': {'AvgPrice': {'$round': ['$AvgPrice',
                                                                2]},
                                        'City': '$_id',
                                        'PropertyCount': 1,
                                        'TopProperties': {'$slice': [{'$sortArray': {'input': '$Properties',
                                                                                     'sortBy': {'ReviewCount': -1}}},
                                                                     3]}}}]},
 'explainVersion': '1',
 'ok': 1.0,
 'queryShapeHash': '3D66AFC40B9C72D7C01ED765CA289359EED8A9CFC8CB6069B65AA0D233F885F1',
 'serverInfo': {'gitVersion': '80f21521ad4a3dfd5613f5d649d7058c6d46277f',
                'host': '9bea3733dea4',
                'port': 27017,
                'version': '8.0.6'},
 'serverParameters': {'internalDocumentSourceGroupMaxMemoryBytes': 104857600,
                      'internalDocumentSourceSetWindowFieldsMaxMemoryBytes': 104857600,
                      'internalLookupStageIntermediateDocumentMaxSizeBytes': 104857600,
                      'internalQueryFacetBufferSizeBytes': 104857600,
                      'internalQueryFacetMaxOutputDocSizeBytes': 104857600,
                      'internalQueryFrameworkControl': 'trySbeRestricted',
                      'internalQueryMaxAddToSetBytes': 104857600,
                      'internalQueryMaxBlockingSortMemoryUsageBytes': 104857600,
                      'internalQueryPlannerIgnoreIndexWithCollationForRegex': 1,
                      'internalQueryProhibitBlockingMergeOnMongoS': 0},
 'stages': [{'$cursor': {'queryPlanner': {'indexFilterSet': False,
                                          'maxIndexedAndSolutionsReached': False,
                                          'maxIndexedOrSolutionsReached': False,
                                          'maxScansToExplodeReached': False,
                                          'namespace': 'sample_airbnb.Listings',
                                          'optimizationTimeMillis': 0,
                                          'parsedQuery': {},
                                          'planCacheKey': '1B1F580F',
                                          'planCacheShapeHash': '63121E33',
                                          'prunedSimilarIndexes': False,
                                          'queryHash': '63121E33',
                                          'rejectedPlans': [],
                                          'winningPlan': {'inputStage': {'direction': 'forward',
                                                                         'stage': 'COLLSCAN'},
                                                          'isCached': False,
                                                          'stage': 'PROJECTION_DEFAULT',
                                                          'transformBy': {'Address.market': 1,
                                                                          'Listing_ID': 1,
                                                                          'Number_of_Reviews': 1,
                                                                          'Price': 1,
                                                                          '_id': 0}}}}},
            {'$group': {'AvgPrice': {'$avg': {'$convert': {'input': '$Price',
                                                           'to': {'$const': 'double'}}}},
                        'Properties': {'$push': {'Id': '$Listing_ID',
                                                 'Price': '$Price',
                                                 'ReviewCount': '$Number_of_Reviews'}},
                        'PropertyCount': {'$sum': {'$const': 1}},
                        '_id': '$Address.market'}},
            {'$sort': {'limit': 10, 'sortKey': {'PropertyCount': -1}}},
            {'$project': {'AvgPrice': {'$round': ['$AvgPrice', {'$const': 2}]},
                          'City': '$_id',
                          'PropertyCount': True,
                          'TopProperties': {'$slice': [{'$sortArray': {'input': '$Properties',
                                                                       'sortBy': {'ReviewCount': -1}}},
                                                       {'$const': 3}]},
                          '_id': True}}]}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<ul>
<li>The <code>explain()</code> output for the initial aggregation (before creating <code>CitySummary</code>) shows a <strong>COLLSCAN</strong> stage. This is expected and generally unavoidable for this type of query. To determine the top 10 cities by property count and calculate their respective average prices, the aggregation pipeline must process <strong>every document</strong> in the <code>Listings</code> collection to group them by city (<code>Address.market</code>) and compute the necessary counts and averages. An index on <code>Address.market</code>, for instance, wouldn't help select <em>which</em> cities make the top 10 without first processing all documents to get the counts.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Optimization-for-Q11:-Computed-Pattern"><strong>Optimization for Q11: <code>Computed Pattern</code></strong><a class="anchor-link" href="#Optimization-for-Q11:-Computed-Pattern"></a></h5><p>We create a support collection - <strong><code>CitySummary</code></strong> - composed by multiple precomputed fields (<strong>Computed Patter</strong>) because <strong>Q11</strong> requires generating a city-level summary containing property counts, average prices, and top listings per city. These statistics depend on expensive aggregations across the full <code>Listings</code> collection. Since this summary is likely displayed on a frequently accessed webpage (e.g., homepage or dashboard), recomputing it on every read request would be inefficient and unnecessary (<strong>Fan Out Write</strong>)</p>
<p>We expect a substantial performance gain based on:</p>
<ul>
<li>We used an aggregation pipeline to compute all necessary metrics for the top 10 cities (e.g., count, average price, top-rated listings), and stored the result in a new <code>CitySummary</code> collection using <code>$out</code>.</li>
<li>Instead of repeating the heavy aggregation for each request, the application now performs a simple <code>find()</code> on a lightweight collection with only 10 documents.</li>
<li>The summary data can be refreshed periodically (e.g., daily or when listings change significantly), decoupling read and write performance.</li>
</ul>
<p>Optionally, we could index the <code>City</code> field in the <code>CitySummary</code> collection to support fast lookups if users frequently request summaries for specific cities. However, this is likely unnecessary if the entire set is usually shown together.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[327]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Create 'CitySummary' collection</span>
<span class="n">db</span><span class="o">.</span><span class="n">CitySummary</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>

<span class="c1"># Create 'CitySummary' collection with top 10 cities and their properties</span>
<span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="c1"># Group by city</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"$Address.market"</span><span class="p">,</span>
        <span class="s2">"PropertyCount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="s2">"AvgPrice"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$toDouble"</span><span class="p">:</span> <span class="s2">"$Price"</span><span class="p">}},</span>
        <span class="s2">"Properties"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$push"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"$Listing_ID"</span><span class="p">,</span> <span class="s2">"Price"</span><span class="p">:</span> <span class="s2">"$Price"</span><span class="p">,</span> <span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="s2">"$Number_of_Reviews"</span><span class="p">}}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Sort by property count</span>
    <span class="p">{</span><span class="s2">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"PropertyCount"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
    
    <span class="c1"># Limit to top 10 cities</span>
    <span class="p">{</span><span class="s2">"$limit"</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    
    <span class="c1"># Project output</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                                   <span class="c1"># Will create a ObjectId for each top city</span>
        <span class="s2">"City"</span><span class="p">:</span> <span class="s2">"$_id"</span><span class="p">,</span>
        <span class="s2">"PropertyCount"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"AvgPrice"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$AvgPrice"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
        
        <span class="c1"># Add top 3 properties per city</span>
        <span class="s2">"TopProperties"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$slice"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"$sortArray"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"input"</span><span class="p">:</span> <span class="s2">"$Properties"</span><span class="p">,</span> <span class="s2">"sortBy"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}}},</span> <span class="mi">3</span><span class="p">]}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Output to 'CitySummary' collection</span>
    <span class="p">{</span><span class="s2">"$out"</span><span class="p">:</span> <span class="s2">"CitySummary"</span><span class="p">}</span>
<span class="p">])</span>

<span class="c1"># Query the 'CitySummary' collection</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">city_summary</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">CitySummary</span><span class="o">.</span><span class="n">find</span><span class="p">({}))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mTop 1 Cities with property stats and top 3 properties:</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">CitySummary</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0022 seconds

<span class="ansi-bold">Top 1 Cities with property stats and top 3 properties:</span>

[{'_id': ObjectId('67fea8f8a6298d01ad0e91f3'),
  'PropertyCount': 660,
  'City': 'Istanbul',
  'AvgPrice': 367.95,
  'TopProperties': [{'Listing_ID': '3237666',
                     'Price': Decimal128('148.00'),
                     'ReviewCount': 248},
                    {'Listing_ID': '555588',
                     'Price': Decimal128('243.00'),
                     'ReviewCount': 246},
                    {'Listing_ID': '1215226',
                     'Price': Decimal128('322.00'),
                     'ReviewCount': 193}]}]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Optimization Analysis (Q11):</strong> The original query requires a full aggregation over the main collection (~0.23s). By applying the <strong>Computed Pattern</strong> and storing the results in <code>CitySummary</code> (~0.08s to create), subsequent reads for the dashboard become a simple <code>find()</code> on 10 documents, which is extremely fast (~0.002s).</p>
</blockquote>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="%F0%9F%94%84%EF%B8%8F-Database-updates:-%5B2-points-per-question%5D"><strong> Database updates:</strong> [2 points per question]<a class="anchor-link" href="#%F0%9F%94%84%EF%B8%8F-Database-updates:-%5B2-points-per-question%5D"></a></h2><p>After optimizing the database, show how to complete the following updates. You can create fictional data. Ensure that previous data does not become stale:</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-12"><strong>Question 12</strong><a class="anchor-link" href="#Question-12"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[328]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 12) Add a new property with a new host in one of the top 10 cities. </span>
<span class="c1">#     The host selects the top 10 most common amenities to list.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[329]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 12. Add new property with top 10 amenities</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Top 10 amenities from Query 7 (since we don't have 'Amenities' collection in the original data, we will input the top 10 amenities manually)</span>
<span class="n">top_amenities</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Wifi'</span><span class="p">,</span> <span class="s1">'Essentials'</span><span class="p">,</span> <span class="s1">'Kitchen'</span><span class="p">,</span> <span class="s1">'TV'</span><span class="p">,</span> <span class="s1">'Hangers'</span><span class="p">,</span> <span class="s1">'Hair dryer'</span><span class="p">,</span> <span class="s1">'Washer'</span><span class="p">,</span> <span class="s1">'Shampoo'</span><span class="p">,</span> <span class="s1">'Iron'</span><span class="p">,</span> <span class="s1">'Laptop friendly workspace'</span><span class="p">]</span>
<span class="n">new_property</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">,</span>
    <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"New York Loft"</span><span class="p">,</span>
    <span class="s2">"host_id"</span><span class="p">:</span> <span class="s2">"99999999"</span><span class="p">,</span>
    <span class="s2">"host_name"</span><span class="p">:</span> <span class="s2">"Group 5"</span><span class="p">,</span>
    <span class="s2">"address"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"market"</span><span class="p">:</span> <span class="s2">"New York"</span><span class="p">},</span>
    <span class="s2">"amenities"</span><span class="p">:</span> <span class="n">top_amenities</span><span class="p">,</span>
    <span class="s2">"price"</span><span class="p">:</span> <span class="n">Decimal128</span><span class="p">(</span><span class="s2">"100.00"</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">new_property</span><span class="p">)</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="n">pprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Inserted property: 20000000, Time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>'Inserted property: 20000000, Time: 0.0033 seconds'
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note:</strong> Using the capabilities of a flexible database, we only fill in certain fields</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[330]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 12.1) Query the new property to verify the insertion</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">})</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>{'_id': '20000000',
 'address': {'market': 'New York'},
 'amenities': ['Wifi',
               'Essentials',
               'Kitchen',
               'TV',
               'Hangers',
               'Hair dryer',
               'Washer',
               'Shampoo',
               'Iron',
               'Laptop friendly workspace'],
 'host_id': '99999999',
 'host_name': 'Group 5',
 'name': 'New York Loft',
 'price': Decimal128('100.00')}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema"><strong>Query with New Schema</strong><a class="anchor-link" href="#Query-with-New-Schema"></a></h4>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Database-Update:-Adding-New-Property-(Q12)"><strong>Database Update: Adding New Property (Q12)</strong><a class="anchor-link" href="#Database-Update:-Adding-New-Property-(Q12)"></a></h5><ul>
<li><strong>Process:</strong> With the new schema, adding a property involves two steps:<ol>
<li>Inserting the host information into the <code>Hosts</code> collection (if the host is new).</li>
<li>Inserting the listing details (including the <code>Host_ID</code> reference and embedded <code>Amenities</code>) into the <code>Listings</code> collection.</li>
</ol>
</li>
<li><strong>Benefit:</strong> This maintains normalization. If "Group 5" adds more properties later, her core host information isn't duplicated. We use the pre-computed <code>Amenities</code> collection to easily fetch common amenities if needed, though here we just list the top 10 manually for the example.</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[331]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Create new property and host</span>
<span class="n">top_amenities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Amenities</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">({</span><span class="s2">"Amenity"</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">new_host</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Host_ID"</span><span class="p">:</span> <span class="s2">"99999999"</span><span class="p">,</span> <span class="s2">"Host_Name"</span><span class="p">:</span> <span class="s2">"Group 5"</span><span class="p">}</span>
<span class="n">new_property</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">,</span>
    <span class="s2">"Name"</span><span class="p">:</span> <span class="s2">"New York Loft"</span><span class="p">,</span>
    <span class="s2">"Host_ID"</span><span class="p">:</span> <span class="s2">"99999999"</span><span class="p">,</span>
    <span class="s2">"Address"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"market"</span><span class="p">:</span> <span class="s2">"New York"</span><span class="p">},</span>
    <span class="s2">"Amenities"</span><span class="p">:</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="s2">"Amenity"</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">top_amenities</span><span class="p">],</span>
    <span class="s2">"Price"</span><span class="p">:</span> <span class="n">Decimal128</span><span class="p">(</span><span class="s2">"100.00"</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">db</span><span class="o">.</span><span class="n">Hosts</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">new_host</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">new_property</span><span class="p">)</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Inserted property and host, Time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># 12.2) Query the new property to verify the insertion</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">}),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Inserted property and host, Time: 0.0100 seconds

{'_id': ObjectId('67fea8f82e55f326b63fac89'),
 'Listing_ID': '20000000',
 'Name': 'New York Loft',
 'Host_ID': '99999999',
 'Address': {'market': 'New York'},
 'Amenities': ['24-hour check-in',
               'Accessible-height bed',
               'Accessible-height toilet',
               'Air conditioning',
               'Air purifier',
               'Alfresco shower',
               'BBQ grill',
               'Baby bath',
               'Baby monitor',
               'Babysitter recommendations'],
 'Price': Decimal128('100.00')}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Comparison (Q12):</strong> As expected, the performance is slightly slower with the new schema (0.010s vs 0.003s original) due to the additional insert into the <code>Hosts</code> collection. This is a one-time cost per new listing, and the benefits of normalization outweigh this minor insert overhead.</p>
</blockquote>
<p><strong>Note:</strong> Although in our case we have not inserted the <strong><code>Review_Scores</code></strong> information, if we did we would have to calculate the <strong><code>Review_Scores_Avg</code></strong> field so that it is always up to date.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-13"><strong>Question 13</strong><a class="anchor-link" href="#Question-13"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[332]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 13) Add a new review from one of our top 20 reviewers for this new property.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[333]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 13.1) Get the top reviewer ID from Question 8</span>

<span class="c1"># {'ReviewCount': 24, 'ReviewerId': '20775242', 'ReviewerName': 'Filipe'}</span>
<span class="n">top_reviewer_id</span> <span class="o">=</span> <span class="s2">"20775242"</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">"reviews.reviewer_id"</span><span class="p">:</span> <span class="n">top_reviewer_id</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"host_name"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"reviews.$"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

<span class="c1"># doc["reviews"][0]['comments'] - Reviewer comments</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>{'_id': '13574006',
 'host_name': 'Jos',
 'reviews': [{'_id': '256178235',
              'comments': 'Great stay. The perfect house with the perfect '
                          'service. We did a last minute booking and '
                          'everything went smooth. Everything was very clean '
                          'and the comunication was perfect. The house is '
                          'incredibly luxorious and fully equppied. Highly '
                          'recommended',
              'date': datetime.datetime(2018, 4, 22, 4, 0),
              'listing_id': '13574006',
              'reviewer_id': '20775242',
              'reviewer_name': 'Filipe'}]}
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[334]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 13. Add review from top reviewer</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">update_one</span><span class="p">({</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">},</span> <span class="p">{</span><span class="s2">"$push"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"reviews"</span><span class="p">:</span> <span class="n">doc</span><span class="p">[</span><span class="s2">"reviews"</span><span class="p">][</span><span class="mi">0</span><span class="p">]}})</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Added review, Time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Added review, Time: 0.0042 seconds
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema"><strong>Query with New Schema</strong><a class="anchor-link" href="#Query-with-New-Schema"></a></h4>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Database-Update:-Adding-New-Review-(Q13)"><strong>Database Update: Adding New Review (Q13)</strong><a class="anchor-link" href="#Database-Update:-Adding-New-Review-(Q13)"></a></h5><ul>
<li><strong>Process:</strong> Adding a review in the new, normalized schema involves two operations:<ol>
<li>Inserting the new review document (containing <code>Listing_ID</code>, <code>Reviewer_ID</code>, comments, date, etc.) into the <code>Reviews</code> collection.</li>
<li>Updating the corresponding reviewer document in the <code>Reviewers</code> collection using <code>update_one</code> with <code>$inc</code> to increment the <code>ReviewCount</code> and <code>upsert=True</code> to handle the case where the reviewer might not yet exist in the <code>Reviewers</code> collection (though less likely if populated from existing reviews).</li>
</ol>
</li>
<li><strong>Benefit:</strong> This approach keeps the <code>Listings</code> collection lean, ensures reviews are stored centrally, and maintains an accurate, pre-computed review count for each reviewer (leveraging the <strong>Computed Pattern</strong> introduced in Q8). This makes looking up review counts extremely fast.</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[335]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Reviewers</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>  <span class="c1"># Display first few reviewers</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[335]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>[{'_id': ObjectId('67fea80ea6298d01ad076b92'),
  'Reviewer_Name': 'Frank',
  'Reviewer_ID': '99803988',
  'ReviewCount': 1},
 {'_id': ObjectId('67fea80ea6298d01ad076b93'),
  'Reviewer_Name': 'Noah',
  'Reviewer_ID': '34619466',
  'ReviewCount': 1},
 {'_id': ObjectId('67fea80ea6298d01ad076b94'),
  'Reviewer_Name': 'Filip',
  'Reviewer_ID': '134581781',
  'ReviewCount': 1},
 {'_id': ObjectId('67fea80ea6298d01ad076b95'),
  'Reviewer_Name': 'Aaron',
  'Reviewer_ID': '72302443',
  'ReviewCount': 1},
 {'_id': ObjectId('67fea80ea6298d01ad076b96'),
  'Reviewer_Name': '',
  'Reviewer_ID': '124235566',
  'ReviewCount': 1}]</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[336]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Add new review from top reviewer</span>
<span class="c1"># Use the top reviewer ID from Query 8</span>
<span class="n">top_reviewer</span> <span class="o">=</span> <span class="n">query8</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">new_review</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">,</span>
    <span class="s2">"Review_ID"</span><span class="p">:</span> <span class="s2">"99999999"</span><span class="p">,</span>
    <span class="s2">"Reviewer_ID"</span><span class="p">:</span> <span class="n">top_reviewer</span><span class="p">[</span><span class="s2">"ReviewerId"</span><span class="p">],</span>
    <span class="s2">"Review_Comments"</span><span class="p">:</span> <span class="s2">"Great loft!"</span><span class="p">,</span>
    <span class="s2">"Review_Date"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="p">}</span>
<span class="n">db</span><span class="o">.</span><span class="n">Reviews</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">new_review</span><span class="p">)</span>

<span class="c1"># Update the Review_IDs in the Reviewers collection (insert if not exists)</span>
<span class="c1"># Source: https://www.mongodb.com/docs/manual/reference/operator/update/setOnInsert/</span>
<span class="n">db</span><span class="o">.</span><span class="n">Reviewers</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">"Reviewer_ID"</span><span class="p">:</span> <span class="n">top_reviewer</span><span class="p">[</span><span class="s2">"ReviewerId"</span><span class="p">]},</span> <span class="c1"># Filter: Find the reviewer</span>
    <span class="p">{</span>
        <span class="s2">"$inc"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ReviewCount"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="c1"># Operation: Increment the count by 1</span>
        <span class="s2">"$setOnInsert"</span><span class="p">:</span> <span class="p">{</span>           <span class="c1"># Operation: Fields to set ONLY if inserting (upsert)</span>
            <span class="s2">"Reviewer_Name"</span><span class="p">:</span> <span class="n">top_reviewer</span><span class="p">[</span><span class="s2">"ReviewerName"</span><span class="p">],</span>
            <span class="c1"># Set Reviewer_ID explicitly on insert for clarity, although filter usually handles it</span>
            <span class="s2">"Reviewer_ID"</span><span class="p">:</span> <span class="n">top_reviewer</span><span class="p">[</span><span class="s2">"ReviewerId"</span><span class="p">]</span>
            <span class="p">}</span>
    <span class="p">},</span>
    <span class="n">upsert</span><span class="o">=</span><span class="kc">True</span>                     <span class="c1"># Option: Insert the document if it doesn't exist</span>
<span class="p">)</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Added review, Time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># 13.1) Query the new review to verify the insertion</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Reviews</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"Review_ID"</span><span class="p">:</span> <span class="s2">"99999999"</span><span class="p">}),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Reviewers</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"Reviewer_ID"</span><span class="p">:</span> <span class="n">top_reviewer</span><span class="p">[</span><span class="s2">"ReviewerId"</span><span class="p">]}),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Added review, Time: 0.0271 seconds

{'_id': ObjectId('67fea8f92e55f326b63fac8a'),
 'Listing_ID': '20000000',
 'Review_ID': '99999999',
 'Reviewer_ID': '135123163',
 'Review_Comments': 'Great loft!',
 'Review_Date': datetime.datetime(2025, 4, 15, 19, 44, 9, 63000)}
{'_id': ObjectId('67fea80ea6298d01ad077fca'),
 'Reviewer_Name': '',
 'Reviewer_ID': '135123163',
 'ReviewCount': 2}
{'_id': ObjectId('67fea8f92e55f326b63fac8a'),
 'Listing_ID': '20000000',
 'Review_ID': '99999999',
 'Reviewer_ID': '135123163',
 'Review_Comments': 'Great loft!',
 'Review_Date': datetime.datetime(2025, 4, 15, 19, 44, 9, 63000)}
{'_id': ObjectId('67fea80ea6298d01ad077fca'),
 'Reviewer_Name': '',
 'Reviewer_ID': '135123163',
 'ReviewCount': 2}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Comparison (Q13):</strong> Adding a review in the original schema required a single <code>update_one</code> with <code>$push</code> (~0.004s). The new schema requires one <code>insert_one</code> into <code>Reviews</code> and one <code>update_one</code> into <code>Reviewers</code> (~0.027s total). While involving more operations, it operates on smaller, focused collections and maintains the pre-computed <code>ReviewCount</code>, speeding up the common lookup use case from <strong>Q8</strong>. The slight increase in write time is often an acceptable trade-off for improved read performance and scalability.</p>
</blockquote>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Question-14"><strong>Question 14</strong><a class="anchor-link" href="#Question-14"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[337]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 14) Add a new review metric called 'x_factor' with a score of 10. </span>
<span class="c1">#     Show that the average score across all metrics is correctly calculated for this listing, using the previously developed query.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-Original-Data-Model"><strong>Query with Original Data Model</strong><a class="anchor-link" href="#Query-with-Original-Data-Model"></a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[338]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># 14. Add x_factor metric and calculate average</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Add new metric</span>
<span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"$set"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"review_scores_x_factor"</span><span class="p">:</span> <span class="mi">10</span><span class="p">}}</span>
<span class="p">)</span>

<span class="c1"># Query with dynamic review_scores_* fields (from Query 9)</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Match the specific property</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">}},</span>
    
    <span class="c1"># Convert all document fields to an array of key-value pairs</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"all_fields"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$objectToArray"</span><span class="p">:</span> <span class="s2">"$$ROOT"</span><span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Unwind the array to process each field</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$all_fields"</span><span class="p">},</span>
    
    <span class="c1"># Filter for fields starting with 'review_scores_'</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"all_fields.k"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$regex"</span><span class="p">:</span> <span class="s2">"^review_scores_"</span><span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Project the score values, handling nulls</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"Metric"</span><span class="p">:</span> <span class="s2">"$all_fields.k"</span><span class="p">,</span>
        <span class="s2">"Score"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ifNull"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$all_fields.v"</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}</span>  <span class="c1"># Default to 0 if null</span>
    <span class="p">}},</span>
    
    <span class="c1"># Group to calculate the average across all metrics</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">"AvgScore"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="s2">"$Score"</span><span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Project the final output with rounding</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"AvgScore"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$AvgScore"</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}</span>
    <span class="p">}}</span>
<span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">listingsAndReviews_HW2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Output</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Average score across all review metrics for property ID 20000000: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'AvgScore'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Execution time: 0.0062 seconds

Average score across all review metrics for property ID 20000000: <span class="ansi-bold">10.0</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Query-with-New-Schema"><strong>Query with New Schema</strong><a class="anchor-link" href="#Query-with-New-Schema"></a></h4>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="Database-Update:-Adding-New-Metric-&amp;-Verifying-Average-(Q14)"><strong>Database Update: Adding New Metric &amp; Verifying Average (Q14)</strong><a class="anchor-link" href="#Database-Update:-Adding-New-Metric-&amp;-Verifying-Average-(Q14)"></a></h5><ul>
<li><strong>Process:</strong><ol>
<li>Add the new metric 'XFactor' directly to the <code>Review_Scores</code> subdocument within the specific <code>Listings</code> document using <code>$set</code> with dot notation (<code>Review_Scores.XFactor</code>).</li>
<li>Re-run the <em>exact same aggregation pipeline</em> used in <strong>Q9</strong> (new schema version) to calculate the average score across all metrics.</li>
</ol>
</li>
<li><strong>Benefit (Attribute Pattern):</strong> This demonstrates the flexibility of the <strong>Attribute Pattern</strong>. The query pipeline (<code>$objectToArray</code> -&gt; <code>$unwind</code> -&gt; <code>$avg</code>) does not need modification; it automatically includes the new 'XFactor' field in its calculation because it iterates over all key-value pairs within the <code>Review_Scores</code> subdocument.</li>
<li><strong>Computed Pattern Update:</strong> Because we <em>optionally</em> added the <code>Review_Scores_Avg</code> pre-computed field to <code>Listings</code>, we perform an additional <code>update_one</code> to store the <em>newly calculated</em> average ($10$) back into that field, ensuring the pre-computed value stays consistent. If the computed field wasn't used, this last update wouldn't be necessary.</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[339]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Property ID 20000000 | Review_Scores</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mReview_Scores for property ID 20000000:</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">},{</span><span class="s2">"Review_Scores"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"$set"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Review_Scores.XFactor"</span><span class="p">:</span> <span class="mi">10</span><span class="p">}}</span>
<span class="p">)</span>

<span class="c1"># Print the updated document to verify the new metric</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mUpdated Review_Scores for property ID 20000000:</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">},{</span><span class="s2">"Review_Scores"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Query to calculate average score across all metrics, including new metric</span>
<span class="n">query14</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
    <span class="c1"># Match the specific property ID (e.g., 20000000)</span>
    <span class="p">{</span><span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">}},</span>
    
    <span class="c1"># Select the Review_Scores field and convert it to an array of key-value pairs</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"Scores"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$objectToArray"</span><span class="p">:</span> <span class="s2">"$Review_Scores"</span><span class="p">}</span>
    <span class="p">}},</span>
    
    <span class="c1"># Unwind the array to process each field</span>
    <span class="p">{</span><span class="s2">"$unwind"</span><span class="p">:</span> <span class="s2">"$Scores"</span><span class="p">},</span>
    
    <span class="c1"># Group to calculate the average across all metrics</span>
    <span class="p">{</span><span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">"AvgScore"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="s2">"$Scores.v"</span><span class="p">}</span>
    <span class="p">}},</span>    
    
    <span class="c1"># Project the final output with rounding</span>
    <span class="p">{</span><span class="s2">"$project"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"AvgScore"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$round"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"$AvgScore"</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}</span>
    <span class="p">}}</span>
<span class="p">]))</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Execution time: </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Average score with new metric: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">query14</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'AvgScore'</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Review_Scores for property ID 20000000:</span>
{'_id': ObjectId('67fea8f82e55f326b63fac89')}

<span class="ansi-bold">Updated Review_Scores for property ID 20000000:</span>
{'_id': ObjectId('67fea8f82e55f326b63fac89'), 'Review_Scores': {'XFactor': 10}}

Execution time: 0.0103 seconds


Average score with new metric: <span class="ansi-bold">10.0</span>
{'_id': ObjectId('67fea8f82e55f326b63fac89')}

<span class="ansi-bold">Updated Review_Scores for property ID 20000000:</span>
{'_id': ObjectId('67fea8f82e55f326b63fac89'), 'Review_Scores': {'XFactor': 10}}

Execution time: 0.0103 seconds


Average score with new metric: <span class="ansi-bold">10.0</span>
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[340]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Update the average score in the Listings collection (Computed Pattern)</span>
<span class="c1"># Since we create a new field in the Listings collection to store the average review score, we need to update every time we add a new metric.</span>
<span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"$set"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Review_Scores_Avg"</span><span class="p">:</span> <span class="n">query14</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'AvgScore'</span><span class="p">]}}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[340]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>UpdateResult({'n': 1, 'nModified': 1, 'ok': 1.0, 'updatedExisting': True}, acknowledged=True)</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[341]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Check the updated average score</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\033</span><span class="s2">[1mUpdated average score for property ID 20000000:</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Listings</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"Listing_ID"</span><span class="p">:</span> <span class="s2">"20000000"</span><span class="p">},{</span><span class="s2">"Review_Scores_Avg"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}),</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
<span class="ansi-bold">Updated average score for property ID 20000000:</span>
{'_id': ObjectId('67fea8f82e55f326b63fac89'), 'Review_Scores_Avg': 10.0}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<blockquote>
<p><strong>Comparison (Q14):</strong> Adding the new 'x_factor' metric is a simple <code>$set</code> in both schemas (~0.006s original vs ~0.010s new - including average recalculation and update). The original schema required a dynamic query using <code>$regex</code> for the average. The new schema's <strong>Attribute Pattern</strong> makes the average calculation inherently flexible (using <code>$objectToArray</code>), requiring no query changes for new metrics. Performance for recalculating the average on a single document is fast in both. The key advantage is the new schema's adaptability. Updating the optional pre-computed average adds negligible cost.</p>
</blockquote>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<hr/>
</div>
</div>
</div>
</div>
</main>
</body>
</html>
